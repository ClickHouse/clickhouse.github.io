<!DOCTYPE html><html lang=ru data-version=v19.10 data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Как запустить тесты - Документация ClickHouse v19.10</title><link rel="shortcut icon" href=/favicon.ico><meta property=og:title content="Как запустить тесты - Документация ClickHouse v19.10"><meta property=og:description content="ClickHouse Testing Functional Tests Functional tests are the most simple and convenient to use. Most of ClickHouse featu"><meta property=og:type content=website><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta property=twitter:title content="Как запустить тесты - Документация ClickHouse v19.10"><meta name=description content="ClickHouse Testing Functional Tests Functional tests are the most simple and convenient to use. Most of ClickHouse featu"><meta name=keywords content="ClickHouse, DBMS, OLAP, relational, analytics, analytical, big data, open-source, SQL, web-analytics"><link href=/css/base.css?1d858e50 media=all rel=stylesheet></head> <body dir=ltr data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> Как запустить тесты </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li class=nav-item> <a href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/ru/development/tests.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/ru.svg alt=Русский title=Русский width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/v19.10/en/development/tests/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/v19.10/zh/development/tests/ class=dropdown-item> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/v19.10/es/development/tests/ class=dropdown-item> <img src=/images/flags/es.svg alt title width=32 class="d-inline-block mr-2">Español </a> <a href=/docs/v19.10/fr/development/tests/ class=dropdown-item> <img src=/images/flags/fr.svg alt title width=32 class="d-inline-block mr-2">Français </a> <a href=/docs/v19.10/ru/development/tests/ class="dropdown-item disabled"> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/v19.10/ja/development/tests/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> <a href=/docs/v19.10/fa/development/tests/ class=dropdown-item> <img src=/images/flags/fa.svg alt title width=32 class="d-inline-block mr-2">فارسی </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class=container-fluid> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label="Многостраничный или одностраничный"> <a href=../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt="Многостраничная версия" title="Многостраничная версия"> </a> <a href=../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt="Одностраничная версия" title="Одностраничная версия"> </a> </div> <div class="dropdown mb-3"> <a class="btn btn-dark dropdown-toggle text-muted" href=# role=button id=select-version data-toggle=dropdown aria-haspopup=true aria-expanded=false> Версия: <span class=text-light>v19.10</span> </a> <div class="dropdown-menu bg-dark text-muted p-1" aria-labelledby=select-version> <a href=/docs/ru/ class=dropdown-item> <span class=text-light>последняя</span> </a> <a href=/docs/v20.3/ru/ class=dropdown-item>v20.3</a> <a href=/docs/v20.1/ru/ class=dropdown-item>v20.1</a> <a href=/docs/v19.17/ru/ class=dropdown-item>v19.17</a> <a href=/docs/v19.16/ru/ class=dropdown-item>v19.16</a> <a href=/docs/v19.15/ru/ class=dropdown-item>v19.15</a> <a href=/docs/v19.14/ru/ class=dropdown-item>v19.14</a> <a href=/docs/v19.13/ru/ class=dropdown-item>v19.13</a> <a href=/docs/v19.11/ru/ class=dropdown-item>v19.11</a> <a href=/docs/v19.10/ru/ class="dropdown-item disable">v19.10</a> <a href=/docs/v19.9/ru/ class=dropdown-item>v19.9</a> <a href=/docs/v19.8/ru/ class=dropdown-item>v19.8</a> </div> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=Введение class="nav-link text-light text-wrap dropdown-toggle px-0">Введение</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../introduction/distinctive_features/ title="Отличительные возможности ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Отличительные возможности ClickHouse</a> <a href=../../introduction/features_considered_disadvantages/ title="Особенности ClickHouse, которые могут считаться недостатками" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Особенности ClickHouse, которые могут считаться недостатками</a> <a href=../../introduction/performance/ title=Производительность class="nav-link text-light text-wrap d-inline-block w-100 px-0">Производительность</a> <a href=../../introduction/ya_metrika_task/ title="Постановка задачи в Яндекс.Метрике" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Постановка задачи в Яндекс.Метрике</a> <a href=../../introduction/info/ title="Информационная поддержка" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Информационная поддержка</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title="Начало работы" class="nav-link text-light text-wrap dropdown-toggle px-0">Начало работы</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/ title="Установка и запуск" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Установка и запуск</a> <a href=#sidebar-sidebar-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-2 title="Тестовые наборы данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Тестовые наборы данных</a> <div id=sidebar-sidebar-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/example_datasets/ontime/ title=OnTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">OnTime</a> <a href=../../getting_started/example_datasets/nyc_taxi/ title="Данные о такси в Нью-Йорке" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Данные о такси в Нью-Йорке</a> <a href=../../getting_started/example_datasets/amplab_benchmark/ title="AMPLab Big Data Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AMPLab Big Data Benchmark</a> <a href=../../getting_started/example_datasets/wikistat/ title=WikiStat class="nav-link text-light text-wrap d-inline-block w-100 px-0">WikiStat</a> <a href=../../getting_started/example_datasets/criteo/ title="Терабайт логов кликов от Criteo" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Терабайт логов кликов от Criteo</a> <a href=../../getting_started/example_datasets/star_schema/ title="Схема «Звезда»" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Схема «Звезда»</a> <a href=../../getting_started/example_datasets/metrica/ title="Данные Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Данные Яндекс.Метрики</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=Интерфейсы class="nav-link text-light text-wrap dropdown-toggle px-0">Интерфейсы</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../interfaces/cli/ title="Клиент командной строки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиент командной строки</a> <a href=../../interfaces/tcp/ title="Нативный интерфейс (TCP)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Нативный интерфейс (TCP)</a> <a href=../../interfaces/http/ title=HTTP-интерфейс class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP-интерфейс</a> <a href=../../interfaces/formats/ title="Форматы входных и выходных данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Форматы входных и выходных данных</a> <a href=../../interfaces/jdbc/ title=JDBC-драйвер class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC-драйвер</a> <a href=../../interfaces/odbc/ title=ODBC-драйвер class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC-драйвер</a> <a href=#sidebar-sidebar-3-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-8 title="От сторонних разработчиков" class="nav-link text-light text-wrap dropdown-toggle px-0">От сторонних разработчиков</a> <div id=sidebar-sidebar-3-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/third-party/client_libraries/ title="Клиентские библиотеки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиентские библиотеки</a> <a href=../../interfaces/third-party/integrations/ title=Интеграции class="nav-link text-light text-wrap d-inline-block w-100 px-0">Интеграции</a> <a href=../../interfaces/third-party/gui/ title="Визуальные интерфейсы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Визуальные интерфейсы</a> <a href=../../interfaces/third-party/proxy/ title=Прокси class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прокси</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title="Типы данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Типы данных</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../data_types/int_uint/ title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</a> <a href=../../data_types/float/ title="Float32, Float64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32, Float64</a> <a href=../../data_types/decimal/ title=Decimal class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal</a> <a href=../../data_types/boolean/ title="Булевы значения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Булевы значения</a> <a href=../../data_types/string/ title=String class="nav-link text-light text-wrap d-inline-block w-100 px-0">String</a> <a href=../../data_types/fixedstring/ title=FixedString(N) class="nav-link text-light text-wrap d-inline-block w-100 px-0">FixedString(N)</a> <a href=../../data_types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../data_types/date/ title=Date class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date</a> <a href=../../data_types/datetime/ title=DateTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime</a> <a href=../../data_types/enum/ title=Enum class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum</a> <a href=../../data_types/array/ title=Array(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Array(T)</a> <a href=../../data_types/nested_data_structures/aggregatefunction/ title="AggregateFunction(name, types_of_arguments...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction(name, types_of_arguments...)</a> <a href=../../data_types/tuple/ title="Tuple(T1, T2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, ...)</a> <a href=../../data_types/nullable/ title=Nullable class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable</a> <a href=#sidebar-sidebar-4-16 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-16 title="Вложенные структуры данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Вложенные структуры данных</a> <div id=sidebar-sidebar-4-16 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/nested_data_structures/nested/ title="Nested(Name1 Type1, Name2 Type2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, ...)</a> </nav> </div> <a href=#sidebar-sidebar-4-17 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-17 title="Служебные типы данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Служебные типы данных</a> <div id=sidebar-sidebar-4-17 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/special_data_types/expression/ title=Expression class="nav-link text-light text-wrap d-inline-block w-100 px-0">Expression</a> <a href=../../data_types/special_data_types/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../data_types/special_data_types/nothing/ title=Nothing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nothing</a> </nav> </div> <a href=#sidebar-sidebar-4-18 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-18 title=Domains class="nav-link text-light text-wrap dropdown-toggle px-0">Domains</a> <div id=sidebar-sidebar-4-18 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/domains/overview/ title=Overview class="nav-link text-light text-wrap d-inline-block w-100 px-0">Overview</a> <a href=../../data_types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../data_types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title="Движки таблиц" class="nav-link text-light text-wrap dropdown-toggle px-0">Движки таблиц</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=#sidebar-sidebar-5-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-2 title="Семейство MergeTree" class="nav-link text-light text-wrap dropdown-toggle px-0">Семейство MergeTree</a> <div id=sidebar-sidebar-5-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/mergetree/ title=MergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../operations/table_engines/replication/ title="Репликация данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Репликация данных</a> <a href=../../operations/table_engines/custom_partitioning_key/ title="Произвольный ключ партиционирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Произвольный ключ партиционирования</a> <a href=../../operations/table_engines/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../operations/table_engines/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../operations/table_engines/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../operations/table_engines/collapsingmergetree/ title=CollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">CollapsingMergeTree</a> <a href=../../operations/table_engines/versionedcollapsingmergetree/ title=VersionedCollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">VersionedCollapsingMergeTree</a> <a href=../../operations/table_engines/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> </nav> </div> <a href=#sidebar-sidebar-5-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-3 title="Семейство Log" class="nav-link text-light text-wrap dropdown-toggle px-0">Семейство Log</a> <div id=sidebar-sidebar-5-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/log_family/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../operations/table_engines/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../operations/table_engines/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../operations/table_engines/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> </nav> </div> <a href=#sidebar-sidebar-5-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-4 title=Интеграции class="nav-link text-light text-wrap dropdown-toggle px-0">Интеграции</a> <div id=sidebar-sidebar-5-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../operations/table_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> </nav> </div> <a href=#sidebar-sidebar-5-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-5 title=Особые class="nav-link text-light text-wrap dropdown-toggle px-0">Особые</a> <div id=sidebar-sidebar-5-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/distributed/ title=Distributed class="nav-link text-light text-wrap d-inline-block w-100 px-0">Distributed</a> <a href=../../operations/table_engines/external_data/ title="Внешние данные" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Внешние данные</a> <a href=../../operations/table_engines/dictionary/ title=Dictionary class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary</a> <a href=../../operations/table_engines/merge/ title=Merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">Merge</a> <a href=../../operations/table_engines/file/ title=File class="nav-link text-light text-wrap d-inline-block w-100 px-0">File</a> <a href=../../operations/table_engines/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../operations/table_engines/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../operations/table_engines/join/ title=Join class="nav-link text-light text-wrap d-inline-block w-100 px-0">Join</a> <a href=../../operations/table_engines/url/ title=URL class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL</a> <a href=../../operations/table_engines/view/ title=View class="nav-link text-light text-wrap d-inline-block w-100 px-0">View</a> <a href=../../operations/table_engines/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../operations/table_engines/memory/ title=Memory class="nav-link text-light text-wrap d-inline-block w-100 px-0">Memory</a> <a href=../../operations/table_engines/buffer/ title=Buffer class="nav-link text-light text-wrap d-inline-block w-100 px-0">Buffer</a> <a href=../../operations/table_engines/jdbc/ title=JDBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC</a> <a href=../../operations/table_engines/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6 title="Справка по SQL" class="nav-link text-light text-wrap dropdown-toggle px-0">Справка по SQL</a> <div id=sidebar-sidebar-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/select/ title=SELECT class="nav-link text-light text-wrap d-inline-block w-100 px-0">SELECT</a> <a href=../../query_language/insert_into/ title="INSERT INTO" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO</a> <a href=../../query_language/create/ title=CREATE class="nav-link text-light text-wrap d-inline-block w-100 px-0">CREATE</a> <a href=../../query_language/alter/ title=ALTER class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../query_language/misc/ title="Прочие виды запросов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прочие виды запросов</a> <a href=#sidebar-sidebar-6-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-7 title=Функции class="nav-link text-light text-wrap dropdown-toggle px-0">Функции</a> <div id=sidebar-sidebar-6-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../query_language/functions/arithmetic_functions/ title="Арифметические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Арифметические функции</a> <a href=../../query_language/functions/comparison_functions/ title="Функции сравнения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции сравнения</a> <a href=../../query_language/functions/logical_functions/ title="Логические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Логические функции</a> <a href=../../query_language/functions/type_conversion_functions/ title="Функции преобразования типов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции преобразования типов</a> <a href=../../query_language/functions/date_time_functions/ title="Функции для работы с датами и временем" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с датами и временем</a> <a href=../../query_language/functions/string_functions/ title="Функции для работы со строками" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со строками</a> <a href=../../query_language/functions/string_search_functions/ title="Функции поиска в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска в строках</a> <a href=../../query_language/functions/string_replace_functions/ title="Функции поиска и замены в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска и замены в строках</a> <a href=../../query_language/functions/conditional_functions/ title="Условные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Условные функции</a> <a href=../../query_language/functions/math_functions/ title="Математические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Математические функции</a> <a href=../../query_language/functions/rounding_functions/ title="Функции округления" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции округления</a> <a href=../../query_language/functions/array_functions/ title="Функции по работе с массивами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции по работе с массивами</a> <a href=../../query_language/functions/splitting_merging_functions/ title="Функции разбиения и слияния строк и массивов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции разбиения и слияния строк и массивов</a> <a href=../../query_language/functions/bit_functions/ title="Битовые функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Битовые функции</a> <a href=../../query_language/functions/bitmap_functions/ title="Функции для битмапов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для битмапов</a> <a href=../../query_language/functions/hash_functions/ title="Функции хэширования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции хэширования</a> <a href=../../query_language/functions/random_functions/ title="Функции генерации псевдослучайных чисел" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции генерации псевдослучайных чисел</a> <a href=../../query_language/functions/uuid_functions/ title="Функции для работы с UUID" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с UUID</a> <a href=../../query_language/functions/encoding_functions/ title="Функции кодирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции кодирования</a> <a href=../../query_language/functions/url_functions/ title="Функции для работы с URL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с URL</a> <a href=../../query_language/functions/ip_address_functions/ title="Функции для работы с IP-адресами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с IP-адресами</a> <a href=../../query_language/functions/json_functions/ title="Функции для работы с JSON." class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с JSON.</a> <a href=../../query_language/functions/higher_order_functions/ title="Функции высшего порядка" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции высшего порядка</a> <a href=../../query_language/functions/ext_dict_functions/ title="Функции для работы с внешними словарями" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с внешними словарями</a> <a href=../../query_language/functions/ym_dict_functions/ title="Функции для работы со словарями Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со словарями Яндекс.Метрики</a> <a href=../../query_language/functions/in_functions/ title="Функции для реализации оператора IN." class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для реализации оператора IN.</a> <a href=../../query_language/functions/array_join/ title="Функция arrayJoin" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функция arrayJoin</a> <a href=../../query_language/functions/geo/ title="Функции для работы с географическими координатами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с географическими координатами</a> <a href=../../query_language/functions/functions_for_nulls/ title="Функции c Nullable агрументами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции c Nullable агрументами</a> <a href=../../query_language/functions/machine_learning_functions/ title="Функции машинного обучения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции машинного обучения</a> <a href=../../query_language/functions/other_functions/ title="Прочие функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прочие функции</a> </nav> </div> <a href=#sidebar-sidebar-6-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-8 title="Агрегатные функции" class="nav-link text-light text-wrap dropdown-toggle px-0">Агрегатные функции</a> <div id=sidebar-sidebar-6-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/agg_functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../query_language/agg_functions/reference/ title="Справочник функций" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Справочник функций</a> <a href=../../query_language/agg_functions/combinators/ title="Комбинаторы агрегатных функций" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Комбинаторы агрегатных функций</a> <a href=../../query_language/agg_functions/parametric_functions/ title="Параметрические агрегатные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Параметрические агрегатные функции</a> </nav> </div> <a href=#sidebar-sidebar-6-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-9 title="Табличные функции" class="nav-link text-light text-wrap dropdown-toggle px-0">Табличные функции</a> <div id=sidebar-sidebar-6-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/table_functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../query_language/table_functions/file/ title=file class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a> <a href=../../query_language/table_functions/merge/ title=merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a> <a href=../../query_language/table_functions/numbers/ title=numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a> <a href=../../query_language/table_functions/remote/ title=remote class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote</a> <a href=../../query_language/table_functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../query_language/table_functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../query_language/table_functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../query_language/table_functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> </nav> </div> <a href=#sidebar-sidebar-6-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-10 title=Словари class="nav-link text-light text-wrap dropdown-toggle px-0">Словари</a> <div id=sidebar-sidebar-6-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/dicts/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=#sidebar-sidebar-6-10-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-10-2 title="Внешние словари" class="nav-link text-light text-wrap dropdown-toggle px-0">Внешние словари</a> <div id=sidebar-sidebar-6-10-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/dicts/external_dicts/ title="Общее описание" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Общее описание</a> <a href=../../query_language/dicts/external_dicts_dict/ title="Настройка внешнего словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройка внешнего словаря</a> <a href=../../query_language/dicts/external_dicts_dict_layout/ title="Хранение словарей в памяти" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Хранение словарей в памяти</a> <a href=../../query_language/dicts/external_dicts_dict_lifetime/ title="Обновление словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление словарей</a> <a href=../../query_language/dicts/external_dicts_dict_sources/ title="Источники внешних словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Источники внешних словарей</a> <a href=../../query_language/dicts/external_dicts_dict_structure/ title="Ключ и поля словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ключ и поля словаря</a> </nav> </div> <a href=../../query_language/dicts/internal_dicts/ title="Встроенные словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Встроенные словари</a> </nav> </div> <a href=../../query_language/operators/ title=Операторы class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операторы</a> <a href=../../query_language/syntax/ title="Общий синтаксис" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Общий синтаксис</a> </nav> </div> <a href=#sidebar-sidebar-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7 title=Эксплуатация class="nav-link text-light text-wrap dropdown-toggle px-0">Эксплуатация</a> <div id=sidebar-sidebar-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../operations/requirements/ title=Требования class="nav-link text-light text-wrap d-inline-block w-100 px-0">Требования</a> <a href=../../operations/monitoring/ title=Мониторинг class="nav-link text-light text-wrap d-inline-block w-100 px-0">Мониторинг</a> <a href=../../operations/troubleshooting/ title="Устранение неисправностей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Устранение неисправностей</a> <a href=../../operations/tips/ title="Советы по эксплуатации" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Советы по эксплуатации</a> <a href=../../operations/update/ title="Обновление ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление ClickHouse</a> <a href=../../operations/access_rights/ title="Права доступа" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Права доступа</a> <a href=../../operations/backup/ title="Резервное копирование" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Резервное копирование</a> <a href=../../operations/configuration_files/ title="Конфигурационные файлы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Конфигурационные файлы</a> <a href=../../operations/quotas/ title=Квоты class="nav-link text-light text-wrap d-inline-block w-100 px-0">Квоты</a> <a href=../../operations/system_tables/ title="Системные таблицы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Системные таблицы</a> <a href=#sidebar-sidebar-7-12 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-12 title="Конфигурационные параметры сервера" class="nav-link text-light text-wrap dropdown-toggle px-0">Конфигурационные параметры сервера</a> <div id=sidebar-sidebar-7-12 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/server_settings/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../operations/server_settings/settings/ title="Серверные настройки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Серверные настройки</a> </nav> </div> <a href=#sidebar-sidebar-7-13 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-13 title=Настройки class="nav-link text-light text-wrap dropdown-toggle px-0">Настройки</a> <div id=sidebar-sidebar-7-13 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/settings/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../operations/settings/permissions_for_queries/ title="Разрешения на выполнение запросов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Разрешения на выполнение запросов</a> <a href=../../operations/settings/query_complexity/ title="Ограничения на сложность запроса" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на сложность запроса</a> <a href=../../operations/settings/settings/ title=Настройки class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки</a> <a href=../../operations/settings/constraints_on_settings/ title="Ограничения на изменение настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на изменение настроек</a> <a href=../../operations/settings/settings_profiles/ title="Профили настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Профили настроек</a> </nav> </div> <a href=#sidebar-sidebar-7-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-14 title=Утилиты class="nav-link text-light text-wrap dropdown-toggle px-0">Утилиты</a> <div id=sidebar-sidebar-7-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/utils/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../operations/utils/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../operations/utils/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=F.A.Q. class="nav-link text-light text-wrap dropdown-toggle px-0">F.A.Q.</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../faq/general/ title="Общие вопросы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Общие вопросы</a> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title=Разработка class="nav-link text-light text-wrap dropdown-toggle px-0">Разработка</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../development/architecture/ title="Обзор архитектуры ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор архитектуры ClickHouse</a> <a href=../../development/build/ title="Как собрать ClickHouse на Linux" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как собрать ClickHouse на Linux</a> <a href=../../development/build_osx/ title="Как собрать ClickHouse на Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как собрать ClickHouse на Mac OS X</a> <a href=../../development/style/ title="Как писать код на C++" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как писать код на C++</a> <a href=../../development/tests/ title="Как запустить тесты" class="nav-link text-white active text-wrap d-inline-block w-100 px-0">Как запустить тесты</a> <a href=../../development/contrib/ title="Сторонние библиотеки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Сторонние библиотеки</a> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title="Что нового" class="nav-link text-light text-wrap dropdown-toggle px-0">Что нового</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../changelog/ title=Changelog class="nav-link text-light text-wrap d-inline-block w-100 px-0">Changelog</a> <a href=../../security_changelog/ title="Security changelog" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Security changelog</a> <a href=../../roadmap/ title=Roadmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">Roadmap</a> </nav> </div> <a href=../../single/clickhouse_ru.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt=PDF-версия title=PDF-версия height=24 class="d-block mr-1 float-left"><div>PDF-версия</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-5"> <div id=content> <h1 id=clickhouse-testing>ClickHouse Testing<a class=headerlink href=#clickhouse-testing title="Permanent link">&para;</a></h1> <h2 id=functional-tests>Functional Tests<a class=headerlink href=#functional-tests title="Permanent link">&para;</a></h2> <p>Functional tests are the most simple and convenient to use. Most of ClickHouse features can be tested with functional tests and they are mandatory to use for every change in ClickHouse code that can be tested that way.</p> <p>Each functional test sends one or multiple queries to the running ClickHouse server and compares the result with reference.</p> <p>Tests are located in <code>dbms/tests/queries</code> directory. There are two subdirectories: <code>stateless</code> and <code>stateful</code>. Stateless tests run queries without any preloaded test data - they often create small synthetic datasets on the fly, within the test itself. Stateful tests require preloaded test data from Yandex.Metrica and not available to general public. We tend to use only <code>stateless</code> tests and avoid adding new <code>stateful</code> tests.</p> <p>Each test can be one of two types: <code>.sql</code> and <code>.sh</code>. <code>.sql</code> test is the simple SQL script that is piped to <code>clickhouse-client --multiquery --testmode</code>. <code>.sh</code> test is a script that is run by itself.</p> <p>To run all tests, use <code>dbms/tests/clickhouse-test</code> tool. Look <code>--help</code> for the list of possible options. You can simply run all tests or run subset of tests filtered by substring in test name: <code>./clickhouse-test substring</code>.</p> <p>The most simple way to invoke functional tests is to copy <code>clickhouse-client</code> to <code>/usr/bin/</code>, run <code>clickhouse-server</code> and then run <code>./clickhouse-test</code> from its own directory.</p> <p>To add new test, create a <code>.sql</code> or <code>.sh</code> file in <code>dbms/tests/queries/0_stateless</code> directory, check it manually and then generate <code>.reference</code> file in the following way: <code>clickhouse-client -n --testmode &lt; 00000_test.sql &gt; 00000_test.reference</code> or <code>./00000_test.sh &gt; ./00000_test.reference</code>.</p> <p>Tests should use (create, drop, etc) only tables in <code>test</code> database that is assumed to be created beforehand; also tests can use temporary tables.</p> <p>If you want to use distributed queries in functional tests, you can leverage <code>remote</code> table function with <code>127.0.0.{1..2}</code> addresses for the server to query itself; or you can use predefined test clusters in server configuration file like <code>test_shard_localhost</code>.</p> <p>Some tests are marked with <code>zookeeper</code>, <code>shard</code> or <code>long</code> in their names.<br> <code>zookeeper</code> is for tests that are using ZooKeeper. <code>shard</code> is for tests that<br> requires server to listen <code>127.0.0.*</code>; <code>distributed</code> or <code>global</code> have the same<br> meaning. <code>long</code> is for tests that run slightly longer that one second. You can<br> disable these groups of tests using <code>--no-zookeeper</code>, <code>--no-shard</code> and<br> <code>--no-long</code> options, respectively.</p> <h2 id=known-bugs>Known bugs<a class=headerlink href=#known-bugs title="Permanent link">&para;</a></h2> <p>If we know some bugs that can be easily reproduced by functional tests, we place prepared functional tests in <code>dbms/tests/queries/bugs</code> directory. These tests will be moved to <code>dbms/tests/queries/0_stateless</code> when bugs are fixed.</p> <h2 id=integration-tests>Integration Tests<a class=headerlink href=#integration-tests title="Permanent link">&para;</a></h2> <p>Integration tests allow to test ClickHouse in clustered configuration and ClickHouse interaction with other servers like MySQL, Postgres, MongoDB. They are useful to emulate network splits, packet drops, etc. These tests are run under Docker and create multiple containers with various software.</p> <p>See <code>dbms/tests/integration/README.md</code> on how to run these tests.</p> <p>Note that integration of ClickHouse with third-party drivers is not tested. Also we currently don't have integration tests with our JDBC and ODBC drivers.</p> <h2 id=unit-tests>Unit Tests<a class=headerlink href=#unit-tests title="Permanent link">&para;</a></h2> <p>Unit tests are useful when you want to test not the ClickHouse as a whole, but a single isolated library or class. You can enable or disable build of tests with <code>ENABLE_TESTS</code> CMake option. Unit tests (and other test programs) are located in <code>tests</code> subdirectories across the code. To run unit tests, type <code>ninja test</code>. Some tests use <code>gtest</code>, but some are just programs that return non-zero exit code on test failure.</p> <p>It's not necessarily to have unit tests if the code is already covered by functional tests (and functional tests are usually much more simple to use).</p> <h2 id=performance-tests>Performance Tests<a class=headerlink href=#performance-tests title="Permanent link">&para;</a></h2> <p>Performance tests allow to measure and compare performance of some isolated part of ClickHouse on synthetic queries. Tests are located at <code>dbms/tests/performance</code>. Each test is represented by <code>.xml</code> file with description of test case. Tests are run with <code>clickhouse performance-test</code> tool (that is embedded in <code>clickhouse</code> binary). See <code>--help</code> for invocation.</p> <p>Each test run one or miltiple queries (possibly with combinations of parameters) in a loop with some conditions for stop (like "maximum execution speed is not changing in three seconds") and measure some metrics about query performance (like "maximum execution speed"). Some tests can contain preconditions on preloaded test dataset.</p> <p>If you want to improve performance of ClickHouse in some scenario, and if improvements can be observed on simple queries, it is highly recommended to write a performance test. It always makes sense to use <code>perf top</code> or other perf tools during your tests.</p> <h2 id=test-tools-and-scripts>Test Tools And Scripts<a class=headerlink href=#test-tools-and-scripts title="Permanent link">&para;</a></h2> <p>Some programs in <code>tests</code> directory are not prepared tests, but are test tools. For example, for <code>Lexer</code> there is a tool <code>dbms/src/Parsers/tests/lexer</code> that just do tokenization of stdin and writes colorized result to stdout. You can use these kind of tools as a code examples and for exploration and manual testing.</p> <p>You can also place pair of files <code>.sh</code> and <code>.reference</code> along with the tool to run it on some predefined input - then script result can be compared to <code>.reference</code> file. These kind of tests are not automated.</p> <h2 id=miscellanous-tests>Miscellanous Tests<a class=headerlink href=#miscellanous-tests title="Permanent link">&para;</a></h2> <p>There are tests for external dictionaries located at <code>dbms/tests/external_dictionaries</code> and for machine learned models in <code>dbms/tests/external_models</code>. These tests are not updated and must be transferred to integration tests.</p> <p>There is separate test for quorum inserts. This test run ClickHouse cluster on separate servers and emulate various failure cases: network split, packet drop (between ClickHouse nodes, between ClickHouse and ZooKeeper, between ClickHouse server and client, etc.), <code>kill -9</code>, <code>kill -STOP</code> and <code>kill -CONT</code> , like <a href=https://aphyr.com/tags/Jepsen rel="external nofollow noreferrer">Jepsen</a>. Then the test checks that all acknowledged inserts was written and all rejected inserts was not.</p> <p>Quorum test was written by separate team before ClickHouse was open-sourced. This team no longer work with ClickHouse. Test was accidentially written in Java. For these reasons, quorum test must be rewritten and moved to integration tests.</p> <h2 id=manual-testing>Manual Testing<a class=headerlink href=#manual-testing title="Permanent link">&para;</a></h2> <p>When you develop a new feature, it is reasonable to also test it manually. You can do it with the following steps:</p> <p>Build ClickHouse. Run ClickHouse from the terminal: change directory to <code>dbms/src/programs/clickhouse-server</code> and run it with <code>./clickhouse-server</code>. It will use configuration (<code>config.xml</code>, <code>users.xml</code> and files within <code>config.d</code> and <code>users.d</code> directories) from the current directory by default. To connect to ClickHouse server, run <code>dbms/src/programs/clickhouse-client/clickhouse-client</code>.</p> <p>Note that all clickhouse tools (server, client, etc) are just symlinks to a single binary named <code>clickhouse</code>. You can find this binary at <code>dbms/src/programs/clickhouse</code>. All tools can also be invoked as <code>clickhouse tool</code> instead of <code>clickhouse-tool</code>.</p> <p>Alternatively you can install ClickHouse package: either stable release from Yandex repository or you can build package for yourself with <code>./release</code> in ClickHouse sources root. Then start the server with <code>sudo service clickhouse-server start</code> (or stop to stop the server). Look for logs at <code>/etc/clickhouse-server/clickhouse-server.log</code>.</p> <p>When ClickHouse is already installed on your system, you can build a new <code>clickhouse</code> binary and replace the existing binary:</p> <div class=codehilite><pre><span></span><code><span class=err>sudo service clickhouse-server stop</span>
<span class=err>sudo cp ./clickhouse /usr/bin/</span>
<span class=err>sudo service clickhouse-server start</span>
</code></pre></div> <p>Also you can stop system clickhouse-server and run your own with the same configuration but with logging to terminal:</p> <div class=codehilite><pre><span></span><code><span class=err>sudo service clickhouse-server stop</span>
<span class=err>sudo -u clickhouse /usr/bin/clickhouse server --config-file /etc/clickhouse-server/config.xml</span>
</code></pre></div> <p>Example with gdb:</p> <div class=codehilite><pre><span></span><code><span class=err>sudo -u clickhouse gdb --args /usr/bin/clickhouse server --config-file /etc/clickhouse-server/config.xml</span>
</code></pre></div> <p>If the system clickhouse-server is already running and you don't want to stop it, you can change port numbers in your <code>config.xml</code> (or override them in a file in <code>config.d</code> directory), provide appropriate data path, and run it.</p> <p><code>clickhouse</code> binary has almost no dependencies and works across wide range of Linux distributions. To quick and dirty test your changes on a server, you can simply <code>scp</code> your fresh built <code>clickhouse</code> binary to your server and then run it as in examples above.</p> <h2 id=testing-environment>Testing Environment<a class=headerlink href=#testing-environment title="Permanent link">&para;</a></h2> <p>Before publishing release as stable we deploy it on testing environment. Testing environment is a cluster that process 1/39 part of <a href=https://metrica.yandex.com/ rel="external nofollow noreferrer">Yandex.Metrica</a> data. We share our testing environment with Yandex.Metrica team. ClickHouse is upgraded without downtime on top of existing data. We look at first that data is processed successfully without lagging from realtime, the replication continue to work and there is no issues visible to Yandex.Metrica team. First check can be done in the following way:</p> <div class=codehilite><pre><span></span><code><span class=err>SELECT hostName() AS h, any(version()), any(uptime()), max(UTCEventTime), count() FROM remote(&#39;example01-01-{1..3}t&#39;, merge, hits) WHERE EventDate &gt;= today() - 2 GROUP BY h ORDER BY h;</span>
</code></pre></div> <p>In some cases we also deploy to testing environment of our friend teams in Yandex: Market, Cloud, etc. Also we have some hardware servers that are used for development purposes.</p> <h2 id=load-testing>Load Testing<a class=headerlink href=#load-testing title="Permanent link">&para;</a></h2> <p>After deploying to testing environment we run load testing with queries from production cluster. This is done manually.</p> <p>Make sure you have enabled <code>query_log</code> on your production cluster.</p> <p>Collect query log for a day or more:</p> <div class=codehilite><pre><span></span><code><span class=err>clickhouse-client --query=&quot;SELECT DISTINCT query FROM system.query_log WHERE event_date = today() AND query LIKE &#39;%ym:%&#39; AND query NOT LIKE &#39;%system.query_log%&#39; AND type = 2 AND is_initial_query&quot; &gt; queries.tsv</span>
</code></pre></div> <p>This is a way complicated example. <code>type = 2</code> will filter queries that are executed successfully. <code>query LIKE '%ym:%'</code> is to select relevant queries from Yandex.Metrica. <code>is_initial_query</code> is to select only queries that are initiated by client, not by ClickHouse itself (as parts of distributed query processing).</p> <p><code>scp</code> this log to your testing cluster and run it as following:</p> <div class=codehilite><pre><span></span><code><span class=err>clickhouse benchmark --concurrency 16 &lt; queries.tsv</span>
</code></pre></div> <p>(probably you also want to specify a <code>--user</code>)</p> <p>Then leave it for a night or weekend and go take a rest.</p> <p>You should check that <code>clickhouse-server</code> doesn't crash, memory footprint is bounded and performance not degrading over time.</p> <p>Precise query execution timings are not recorded and not compared due to high variability of queries and environment.</p> <h2 id=build-tests>Build Tests<a class=headerlink href=#build-tests title="Permanent link">&para;</a></h2> <p>Build tests allow to check that build is not broken on various alternative configurations and on some foreign systems. Tests are located at <code>ci</code> directory. They run build from source inside Docker, Vagrant, and sometimes with <code>qemu-user-static</code> inside Docker. These tests are under development and test runs are not automated.</p> <p>Motivation:</p> <p>Normally we release and run all tests on a single variant of ClickHouse build. But there are alternative build variants that are not thoroughly tested. Examples:</p> <ul> <li>build on FreeBSD;</li> <li>build on Debian with libraries from system packages;</li> <li>build with shared linking of libraries;</li> <li>build on AArch64 platform;</li> <li>build on PowerPc platform.</li> </ul> <p>For example, build with system packages is bad practice, because we cannot guarantee what exact version of packages a system will have. But this is really needed by Debian maintainers. For this reason we at least have to support this variant of build. Another example: shared linking is a common source of trouble, but it is needed for some enthusiasts.</p> <p>Though we cannot run all tests on all variant of builds, we want to check at least that various build variants are not broken. For this purpose we use build tests.</p> <h2 id=testing-for-protocol-compatibility>Testing For Protocol Compatibility<a class=headerlink href=#testing-for-protocol-compatibility title="Permanent link">&para;</a></h2> <p>When we extend ClickHouse network protocol, we test manually that old clickhouse-client works with new clickhouse-server and new clickhouse-client works with old clickhouse-server (simply by running binaries from corresponding packages).</p> <h2 id=help-from-the-compiler>Help From The Compiler<a class=headerlink href=#help-from-the-compiler title="Permanent link">&para;</a></h2> <p>Main ClickHouse code (that is located in <code>dbms</code> directory) is built with <code>-Wall -Wextra -Werror</code> and with some additional enabled warnings. Although these options are not enabled for third-party libraries.</p> <p>Clang has even more useful warnings - you can look for them with <code>-Weverything</code> and pick something to default build.</p> <p>For production builds, gcc is used (it still generates slightly more efficient code than clang). For development, clang is usually more convenient to use. You can build on your own machine with debug mode (to save battery of your laptop), but please note that compiler is able to generate more warnings with <code>-O3</code> due to better control flow and inter-procedure analysis. When building with clang, <code>libc++</code> is used instead of <code>libstdc++</code> and when building with debug mode, debug version of <code>libc++</code> is used that allows to catch more errors at runtime.</p> <h2 id=sanitizers>Sanitizers<a class=headerlink href=#sanitizers title="Permanent link">&para;</a></h2> <p><strong>Address sanitizer</strong>.<br> We run functional and integration tests under ASan on per-commit basis.</p> <p><strong>Valgrind (Memcheck)</strong>.<br> We run functional tests under Valgrind overnight. It takes multiple hours. Currently there is one known false positive in <code>re2</code> library, see <a href=https://research.swtch.com/sparse rel="external nofollow noreferrer">this article</a>.</p> <p><strong>Undefined behaviour sanitizer.</strong><br> We run functional and integration tests under ASan on per-commit basis.</p> <p><strong>Thread sanitizer</strong>.<br> We run functional tests under TSan on per-commit basis. We still don't run integration tests under TSan on per-commit basis.</p> <p><strong>Memory sanitizer</strong>.<br> Currently we still don't use MSan.</p> <p><strong>Debug allocator.</strong><br> Debug version of <code>jemalloc</code> is used for debug build.</p> <h2 id=fuzzing>Fuzzing<a class=headerlink href=#fuzzing title="Permanent link">&para;</a></h2> <p>We use simple fuzz test to generate random SQL queries and to check that the server doesn't die. Fuzz testing is performed with Address sanitizer. You can find it in <code>00746_sql_fuzzy.pl</code>. This test should be run continuously (overnight and longer).</p> <p>As of December 2018, we still don't use isolated fuzz testing of library code.</p> <h2 id=security-audit>Security Audit<a class=headerlink href=#security-audit title="Permanent link">&para;</a></h2> <p>People from Yandex Cloud department do some basic overview of ClickHouse capabilities from the security standpoint.</p> <h2 id=static-analyzers>Static Analyzers<a class=headerlink href=#static-analyzers title="Permanent link">&para;</a></h2> <p>We run <code>PVS-Studio</code> on per-commit basis. We have evaluated <code>clang-tidy</code>, <code>Coverity</code>, <code>cppcheck</code>, <code>PVS-Studio</code>, <code>tscancode</code>. You will find instructions for usage in <code>dbms/tests/instructions/</code> directory. Also you can read <a href=https://habr.com/company/yandex/blog/342018/ rel="external nofollow noreferrer">the article in russian</a>.</p> <p>If you use <code>CLion</code> as an IDE, you can leverage some <code>clang-tidy</code> checks out of the box.</p> <h2 id=hardening>Hardening<a class=headerlink href=#hardening title="Permanent link">&para;</a></h2> <p><code>FORTIFY_SOURCE</code> is used by default. It is almost useless, but still makes sense in rare cases and we don't disable it.</p> <h2 id=code-style>Code Style<a class=headerlink href=#code-style title="Permanent link">&para;</a></h2> <p>Code style rules are described <a href=https://clickhouse.yandex/docs/en/development/style/ rel="external nofollow noreferrer">here</a>.</p> <p>To check for some common style violations, you can use <code>utils/check-style</code> script.</p> <p>To force proper style of your code, you can use <code>clang-format</code>. File <code>.clang-format</code> is located at the sources root. It mostly corresponding with our actual code style. But it's not recommended to apply <code>clang-format</code> to existing files because it makes formatting worse. You can use <code>clang-format-diff</code> tool that you can find in clang source repository.</p> <p>Alternatively you can try <code>uncrustify</code> tool to reformat your code. Configuration is in <code>uncrustify.cfg</code> in the sources root. It is less tested than <code>clang-format</code>.</p> <p><code>CLion</code> has its own code formatter that has to be tuned for our code style.</p> <h2 id=metrica-b2b-tests>Metrica B2B Tests<a class=headerlink href=#metrica-b2b-tests title="Permanent link">&para;</a></h2> <p>Each ClickHouse release is tested with Yandex Metrica and AppMetrica engines. Testing and stable versions of ClickHouse are deployed on VMs and run with a small copy of Metrica engine that is processing fixed sample of input data. Then results of two instances of Metrica engine are compared together.</p> <p>These tests are automated by separate team. Due to high number of moving parts, tests are fail most of the time by completely unrelated reasons, that are very difficult to figure out. Most likely these tests have negative value for us. Nevertheless these tests was proved to be useful in about one or two times out of hundreds.</p> <h2 id=test-coverage>Test Coverage<a class=headerlink href=#test-coverage title="Permanent link">&para;</a></h2> <p>As of July 2018 we don't track test coverage.</p> <h2 id=test-automation>Test Automation<a class=headerlink href=#test-automation title="Permanent link">&para;</a></h2> <p>We run tests with Yandex internal CI and job automation system named "Sandbox".</p> <p>Build jobs and tests are run in Sandbox on per commit basis. Resulting packages and test results are published in GitHub and can be downloaded by direct links. Artifacts are stored eternally. When you send a pull request on GitHub, we tag it as "can be tested" and our CI system will build ClickHouse packages (release, debug, with address sanitizer, etc) for you.</p> <p>We don't use Travis CI due to the limit on time and computational power.<br> We don't use Jenkins. It was used before and now we are happy we are not using Jenkins.</p> </div> <div id=content-footer class="text-muted pt-5"> <div class=float-right>©2016–2020 Yandex LLC</div> <div>Собрано из <a href=https://github.com/ClickHouse/ClickHouse/commit/c1558f8c18e2727c5991cf923ee79710de89d1d0 rel="external nofollow noreferrer" target=_blank class=text-reset>c1558f8c18</a></div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>Cодержание</label> <a href=#functional-tests title="Functional Tests" class="nav-link text-wrap d-inline-block w-100"> Functional Tests </a> <a href=#known-bugs title="Known bugs" class="nav-link text-wrap d-inline-block w-100"> Known bugs </a> <a href=#integration-tests title="Integration Tests" class="nav-link text-wrap d-inline-block w-100"> Integration Tests </a> <a href=#unit-tests title="Unit Tests" class="nav-link text-wrap d-inline-block w-100"> Unit Tests </a> <a href=#performance-tests title="Performance Tests" class="nav-link text-wrap d-inline-block w-100"> Performance Tests </a> <a href=#test-tools-and-scripts title="Test Tools And Scripts" class="nav-link text-wrap d-inline-block w-100"> Test Tools And Scripts </a> <a href=#miscellanous-tests title="Miscellanous Tests" class="nav-link text-wrap d-inline-block w-100"> Miscellanous Tests </a> <a href=#manual-testing title="Manual Testing" class="nav-link text-wrap d-inline-block w-100"> Manual Testing </a> <a href=#testing-environment title="Testing Environment" class="nav-link text-wrap d-inline-block w-100"> Testing Environment </a> <a href=#load-testing title="Load Testing" class="nav-link text-wrap d-inline-block w-100"> Load Testing </a> <a href=#build-tests title="Build Tests" class="nav-link text-wrap d-inline-block w-100"> Build Tests </a> <a href=#testing-for-protocol-compatibility title="Testing For Protocol Compatibility" class="nav-link text-wrap d-inline-block w-100"> Testing For Protocol Compatibility </a> <a href=#help-from-the-compiler title="Help From The Compiler" class="nav-link text-wrap d-inline-block w-100"> Help From The Compiler </a> <a href=#sanitizers title=Sanitizers class="nav-link text-wrap d-inline-block w-100"> Sanitizers </a> <a href=#fuzzing title=Fuzzing class="nav-link text-wrap d-inline-block w-100"> Fuzzing </a> <a href=#security-audit title="Security Audit" class="nav-link text-wrap d-inline-block w-100"> Security Audit </a> <a href=#static-analyzers title="Static Analyzers" class="nav-link text-wrap d-inline-block w-100"> Static Analyzers </a> <a href=#hardening title=Hardening class="nav-link text-wrap d-inline-block w-100"> Hardening </a> <a href=#code-style title="Code Style" class="nav-link text-wrap d-inline-block w-100"> Code Style </a> <a href=#metrica-b2b-tests title="Metrica B2B Tests" class="nav-link text-wrap d-inline-block w-100"> Metrica B2B Tests </a> <a href=#test-coverage title="Test Coverage" class="nav-link text-wrap d-inline-block w-100"> Test Coverage </a> <a href=#test-automation title="Test Automation" class="nav-link text-wrap d-inline-block w-100"> Test Automation </a> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?7bd05efd></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>