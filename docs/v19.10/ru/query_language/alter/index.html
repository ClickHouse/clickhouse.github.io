<!DOCTYPE html><html lang=ru data-version=v19.10 data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>ALTER - Документация ClickHouse v19.10</title><link rel="shortcut icon" href=/favicon.ico><meta property=og:title content="ALTER - Документация ClickHouse v19.10"><meta property=og:description content="ALTER Запрос ALTER поддерживается только для таблиц типа *MergeTree, а также Merge и Distributed. Запрос имеет несколько"><meta property=og:type content=website><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta property=twitter:title content="ALTER - Документация ClickHouse v19.10"><meta name=description content="ALTER Запрос ALTER поддерживается только для таблиц типа *MergeTree, а также Merge и Distributed. Запрос имеет несколько"><meta name=keywords content="ClickHouse, DBMS, OLAP, relational, analytics, analytical, big data, open-source, SQL, web-analytics"><link href=/css/base.css?1d858e50 media=all rel=stylesheet></head> <body dir=ltr data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> ALTER </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li class=nav-item> <a href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/ru/query_language/alter.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/ru.svg alt=Русский title=Русский width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/v19.10/en/query_language/alter/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/v19.10/zh/query_language/alter/ class=dropdown-item> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/v19.10/es/query_language/alter/ class=dropdown-item> <img src=/images/flags/es.svg alt title width=32 class="d-inline-block mr-2">Español </a> <a href=/docs/v19.10/fr/query_language/alter/ class=dropdown-item> <img src=/images/flags/fr.svg alt title width=32 class="d-inline-block mr-2">Français </a> <a href=/docs/v19.10/ru/query_language/alter/ class="dropdown-item disabled"> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/v19.10/ja/query_language/alter/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> <a href=/docs/v19.10/fa/query_language/alter/ class=dropdown-item> <img src=/images/flags/fa.svg alt title width=32 class="d-inline-block mr-2">فارسی </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class=container-fluid> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label="Многостраничный или одностраничный"> <a href=../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt="Многостраничная версия" title="Многостраничная версия"> </a> <a href=../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt="Одностраничная версия" title="Одностраничная версия"> </a> </div> <div class="dropdown mb-3"> <a class="btn btn-dark dropdown-toggle text-muted" href=# role=button id=select-version data-toggle=dropdown aria-haspopup=true aria-expanded=false> Версия: <span class=text-light>v19.10</span> </a> <div class="dropdown-menu bg-dark text-muted p-1" aria-labelledby=select-version> <a href=/docs/ru/ class=dropdown-item> <span class=text-light>последняя</span> </a> <a href=/docs/v20.3/ru/ class=dropdown-item>v20.3</a> <a href=/docs/v20.1/ru/ class=dropdown-item>v20.1</a> <a href=/docs/v19.17/ru/ class=dropdown-item>v19.17</a> <a href=/docs/v19.16/ru/ class=dropdown-item>v19.16</a> <a href=/docs/v19.15/ru/ class=dropdown-item>v19.15</a> <a href=/docs/v19.14/ru/ class=dropdown-item>v19.14</a> <a href=/docs/v19.13/ru/ class=dropdown-item>v19.13</a> <a href=/docs/v19.11/ru/ class=dropdown-item>v19.11</a> <a href=/docs/v19.10/ru/ class="dropdown-item disable">v19.10</a> <a href=/docs/v19.9/ru/ class=dropdown-item>v19.9</a> <a href=/docs/v19.8/ru/ class=dropdown-item>v19.8</a> </div> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=Введение class="nav-link text-light text-wrap dropdown-toggle px-0">Введение</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../introduction/distinctive_features/ title="Отличительные возможности ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Отличительные возможности ClickHouse</a> <a href=../../introduction/features_considered_disadvantages/ title="Особенности ClickHouse, которые могут считаться недостатками" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Особенности ClickHouse, которые могут считаться недостатками</a> <a href=../../introduction/performance/ title=Производительность class="nav-link text-light text-wrap d-inline-block w-100 px-0">Производительность</a> <a href=../../introduction/ya_metrika_task/ title="Постановка задачи в Яндекс.Метрике" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Постановка задачи в Яндекс.Метрике</a> <a href=../../introduction/info/ title="Информационная поддержка" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Информационная поддержка</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title="Начало работы" class="nav-link text-light text-wrap dropdown-toggle px-0">Начало работы</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/ title="Установка и запуск" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Установка и запуск</a> <a href=#sidebar-sidebar-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-2 title="Тестовые наборы данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Тестовые наборы данных</a> <div id=sidebar-sidebar-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/example_datasets/ontime/ title=OnTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">OnTime</a> <a href=../../getting_started/example_datasets/nyc_taxi/ title="Данные о такси в Нью-Йорке" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Данные о такси в Нью-Йорке</a> <a href=../../getting_started/example_datasets/amplab_benchmark/ title="AMPLab Big Data Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AMPLab Big Data Benchmark</a> <a href=../../getting_started/example_datasets/wikistat/ title=WikiStat class="nav-link text-light text-wrap d-inline-block w-100 px-0">WikiStat</a> <a href=../../getting_started/example_datasets/criteo/ title="Терабайт логов кликов от Criteo" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Терабайт логов кликов от Criteo</a> <a href=../../getting_started/example_datasets/star_schema/ title="Схема «Звезда»" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Схема «Звезда»</a> <a href=../../getting_started/example_datasets/metrica/ title="Данные Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Данные Яндекс.Метрики</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=Интерфейсы class="nav-link text-light text-wrap dropdown-toggle px-0">Интерфейсы</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../interfaces/cli/ title="Клиент командной строки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиент командной строки</a> <a href=../../interfaces/tcp/ title="Нативный интерфейс (TCP)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Нативный интерфейс (TCP)</a> <a href=../../interfaces/http/ title=HTTP-интерфейс class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP-интерфейс</a> <a href=../../interfaces/formats/ title="Форматы входных и выходных данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Форматы входных и выходных данных</a> <a href=../../interfaces/jdbc/ title=JDBC-драйвер class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC-драйвер</a> <a href=../../interfaces/odbc/ title=ODBC-драйвер class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC-драйвер</a> <a href=#sidebar-sidebar-3-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-8 title="От сторонних разработчиков" class="nav-link text-light text-wrap dropdown-toggle px-0">От сторонних разработчиков</a> <div id=sidebar-sidebar-3-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/third-party/client_libraries/ title="Клиентские библиотеки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиентские библиотеки</a> <a href=../../interfaces/third-party/integrations/ title=Интеграции class="nav-link text-light text-wrap d-inline-block w-100 px-0">Интеграции</a> <a href=../../interfaces/third-party/gui/ title="Визуальные интерфейсы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Визуальные интерфейсы</a> <a href=../../interfaces/third-party/proxy/ title=Прокси class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прокси</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title="Типы данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Типы данных</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../data_types/int_uint/ title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</a> <a href=../../data_types/float/ title="Float32, Float64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32, Float64</a> <a href=../../data_types/decimal/ title=Decimal class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal</a> <a href=../../data_types/boolean/ title="Булевы значения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Булевы значения</a> <a href=../../data_types/string/ title=String class="nav-link text-light text-wrap d-inline-block w-100 px-0">String</a> <a href=../../data_types/fixedstring/ title=FixedString(N) class="nav-link text-light text-wrap d-inline-block w-100 px-0">FixedString(N)</a> <a href=../../data_types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../data_types/date/ title=Date class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date</a> <a href=../../data_types/datetime/ title=DateTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime</a> <a href=../../data_types/enum/ title=Enum class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum</a> <a href=../../data_types/array/ title=Array(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Array(T)</a> <a href=../../data_types/nested_data_structures/aggregatefunction/ title="AggregateFunction(name, types_of_arguments...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction(name, types_of_arguments...)</a> <a href=../../data_types/tuple/ title="Tuple(T1, T2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, ...)</a> <a href=../../data_types/nullable/ title=Nullable class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable</a> <a href=#sidebar-sidebar-4-16 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-16 title="Вложенные структуры данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Вложенные структуры данных</a> <div id=sidebar-sidebar-4-16 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/nested_data_structures/nested/ title="Nested(Name1 Type1, Name2 Type2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, ...)</a> </nav> </div> <a href=#sidebar-sidebar-4-17 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-17 title="Служебные типы данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Служебные типы данных</a> <div id=sidebar-sidebar-4-17 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/special_data_types/expression/ title=Expression class="nav-link text-light text-wrap d-inline-block w-100 px-0">Expression</a> <a href=../../data_types/special_data_types/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../data_types/special_data_types/nothing/ title=Nothing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nothing</a> </nav> </div> <a href=#sidebar-sidebar-4-18 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-18 title=Domains class="nav-link text-light text-wrap dropdown-toggle px-0">Domains</a> <div id=sidebar-sidebar-4-18 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/domains/overview/ title=Overview class="nav-link text-light text-wrap d-inline-block w-100 px-0">Overview</a> <a href=../../data_types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../data_types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title="Движки таблиц" class="nav-link text-light text-wrap dropdown-toggle px-0">Движки таблиц</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=#sidebar-sidebar-5-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-2 title="Семейство MergeTree" class="nav-link text-light text-wrap dropdown-toggle px-0">Семейство MergeTree</a> <div id=sidebar-sidebar-5-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/mergetree/ title=MergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../operations/table_engines/replication/ title="Репликация данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Репликация данных</a> <a href=../../operations/table_engines/custom_partitioning_key/ title="Произвольный ключ партиционирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Произвольный ключ партиционирования</a> <a href=../../operations/table_engines/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../operations/table_engines/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../operations/table_engines/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../operations/table_engines/collapsingmergetree/ title=CollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">CollapsingMergeTree</a> <a href=../../operations/table_engines/versionedcollapsingmergetree/ title=VersionedCollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">VersionedCollapsingMergeTree</a> <a href=../../operations/table_engines/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> </nav> </div> <a href=#sidebar-sidebar-5-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-3 title="Семейство Log" class="nav-link text-light text-wrap dropdown-toggle px-0">Семейство Log</a> <div id=sidebar-sidebar-5-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/log_family/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../operations/table_engines/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../operations/table_engines/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../operations/table_engines/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> </nav> </div> <a href=#sidebar-sidebar-5-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-4 title=Интеграции class="nav-link text-light text-wrap dropdown-toggle px-0">Интеграции</a> <div id=sidebar-sidebar-5-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../operations/table_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> </nav> </div> <a href=#sidebar-sidebar-5-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-5 title=Особые class="nav-link text-light text-wrap dropdown-toggle px-0">Особые</a> <div id=sidebar-sidebar-5-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/distributed/ title=Distributed class="nav-link text-light text-wrap d-inline-block w-100 px-0">Distributed</a> <a href=../../operations/table_engines/external_data/ title="Внешние данные" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Внешние данные</a> <a href=../../operations/table_engines/dictionary/ title=Dictionary class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary</a> <a href=../../operations/table_engines/merge/ title=Merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">Merge</a> <a href=../../operations/table_engines/file/ title=File class="nav-link text-light text-wrap d-inline-block w-100 px-0">File</a> <a href=../../operations/table_engines/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../operations/table_engines/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../operations/table_engines/join/ title=Join class="nav-link text-light text-wrap d-inline-block w-100 px-0">Join</a> <a href=../../operations/table_engines/url/ title=URL class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL</a> <a href=../../operations/table_engines/view/ title=View class="nav-link text-light text-wrap d-inline-block w-100 px-0">View</a> <a href=../../operations/table_engines/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../operations/table_engines/memory/ title=Memory class="nav-link text-light text-wrap d-inline-block w-100 px-0">Memory</a> <a href=../../operations/table_engines/buffer/ title=Buffer class="nav-link text-light text-wrap d-inline-block w-100 px-0">Buffer</a> <a href=../../operations/table_engines/jdbc/ title=JDBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC</a> <a href=../../operations/table_engines/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6 title="Справка по SQL" class="nav-link text-light text-wrap dropdown-toggle px-0">Справка по SQL</a> <div id=sidebar-sidebar-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/select/ title=SELECT class="nav-link text-light text-wrap d-inline-block w-100 px-0">SELECT</a> <a href=../../query_language/insert_into/ title="INSERT INTO" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO</a> <a href=../../query_language/create/ title=CREATE class="nav-link text-light text-wrap d-inline-block w-100 px-0">CREATE</a> <a href=../../query_language/alter/ title=ALTER class="nav-link text-white active text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../query_language/misc/ title="Прочие виды запросов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прочие виды запросов</a> <a href=#sidebar-sidebar-6-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-7 title=Функции class="nav-link text-light text-wrap dropdown-toggle px-0">Функции</a> <div id=sidebar-sidebar-6-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../query_language/functions/arithmetic_functions/ title="Арифметические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Арифметические функции</a> <a href=../../query_language/functions/comparison_functions/ title="Функции сравнения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции сравнения</a> <a href=../../query_language/functions/logical_functions/ title="Логические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Логические функции</a> <a href=../../query_language/functions/type_conversion_functions/ title="Функции преобразования типов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции преобразования типов</a> <a href=../../query_language/functions/date_time_functions/ title="Функции для работы с датами и временем" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с датами и временем</a> <a href=../../query_language/functions/string_functions/ title="Функции для работы со строками" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со строками</a> <a href=../../query_language/functions/string_search_functions/ title="Функции поиска в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска в строках</a> <a href=../../query_language/functions/string_replace_functions/ title="Функции поиска и замены в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска и замены в строках</a> <a href=../../query_language/functions/conditional_functions/ title="Условные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Условные функции</a> <a href=../../query_language/functions/math_functions/ title="Математические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Математические функции</a> <a href=../../query_language/functions/rounding_functions/ title="Функции округления" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции округления</a> <a href=../../query_language/functions/array_functions/ title="Функции по работе с массивами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции по работе с массивами</a> <a href=../../query_language/functions/splitting_merging_functions/ title="Функции разбиения и слияния строк и массивов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции разбиения и слияния строк и массивов</a> <a href=../../query_language/functions/bit_functions/ title="Битовые функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Битовые функции</a> <a href=../../query_language/functions/bitmap_functions/ title="Функции для битмапов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для битмапов</a> <a href=../../query_language/functions/hash_functions/ title="Функции хэширования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции хэширования</a> <a href=../../query_language/functions/random_functions/ title="Функции генерации псевдослучайных чисел" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции генерации псевдослучайных чисел</a> <a href=../../query_language/functions/uuid_functions/ title="Функции для работы с UUID" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с UUID</a> <a href=../../query_language/functions/encoding_functions/ title="Функции кодирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции кодирования</a> <a href=../../query_language/functions/url_functions/ title="Функции для работы с URL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с URL</a> <a href=../../query_language/functions/ip_address_functions/ title="Функции для работы с IP-адресами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с IP-адресами</a> <a href=../../query_language/functions/json_functions/ title="Функции для работы с JSON." class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с JSON.</a> <a href=../../query_language/functions/higher_order_functions/ title="Функции высшего порядка" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции высшего порядка</a> <a href=../../query_language/functions/ext_dict_functions/ title="Функции для работы с внешними словарями" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с внешними словарями</a> <a href=../../query_language/functions/ym_dict_functions/ title="Функции для работы со словарями Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со словарями Яндекс.Метрики</a> <a href=../../query_language/functions/in_functions/ title="Функции для реализации оператора IN." class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для реализации оператора IN.</a> <a href=../../query_language/functions/array_join/ title="Функция arrayJoin" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функция arrayJoin</a> <a href=../../query_language/functions/geo/ title="Функции для работы с географическими координатами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с географическими координатами</a> <a href=../../query_language/functions/functions_for_nulls/ title="Функции c Nullable агрументами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции c Nullable агрументами</a> <a href=../../query_language/functions/machine_learning_functions/ title="Функции машинного обучения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции машинного обучения</a> <a href=../../query_language/functions/other_functions/ title="Прочие функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прочие функции</a> </nav> </div> <a href=#sidebar-sidebar-6-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-8 title="Агрегатные функции" class="nav-link text-light text-wrap dropdown-toggle px-0">Агрегатные функции</a> <div id=sidebar-sidebar-6-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/agg_functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../query_language/agg_functions/reference/ title="Справочник функций" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Справочник функций</a> <a href=../../query_language/agg_functions/combinators/ title="Комбинаторы агрегатных функций" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Комбинаторы агрегатных функций</a> <a href=../../query_language/agg_functions/parametric_functions/ title="Параметрические агрегатные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Параметрические агрегатные функции</a> </nav> </div> <a href=#sidebar-sidebar-6-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-9 title="Табличные функции" class="nav-link text-light text-wrap dropdown-toggle px-0">Табличные функции</a> <div id=sidebar-sidebar-6-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/table_functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../query_language/table_functions/file/ title=file class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a> <a href=../../query_language/table_functions/merge/ title=merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a> <a href=../../query_language/table_functions/numbers/ title=numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a> <a href=../../query_language/table_functions/remote/ title=remote class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote</a> <a href=../../query_language/table_functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../query_language/table_functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../query_language/table_functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../query_language/table_functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> </nav> </div> <a href=#sidebar-sidebar-6-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-10 title=Словари class="nav-link text-light text-wrap dropdown-toggle px-0">Словари</a> <div id=sidebar-sidebar-6-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/dicts/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=#sidebar-sidebar-6-10-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-10-2 title="Внешние словари" class="nav-link text-light text-wrap dropdown-toggle px-0">Внешние словари</a> <div id=sidebar-sidebar-6-10-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/dicts/external_dicts/ title="Общее описание" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Общее описание</a> <a href=../../query_language/dicts/external_dicts_dict/ title="Настройка внешнего словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройка внешнего словаря</a> <a href=../../query_language/dicts/external_dicts_dict_layout/ title="Хранение словарей в памяти" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Хранение словарей в памяти</a> <a href=../../query_language/dicts/external_dicts_dict_lifetime/ title="Обновление словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление словарей</a> <a href=../../query_language/dicts/external_dicts_dict_sources/ title="Источники внешних словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Источники внешних словарей</a> <a href=../../query_language/dicts/external_dicts_dict_structure/ title="Ключ и поля словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ключ и поля словаря</a> </nav> </div> <a href=../../query_language/dicts/internal_dicts/ title="Встроенные словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Встроенные словари</a> </nav> </div> <a href=../../query_language/operators/ title=Операторы class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операторы</a> <a href=../../query_language/syntax/ title="Общий синтаксис" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Общий синтаксис</a> </nav> </div> <a href=#sidebar-sidebar-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7 title=Эксплуатация class="nav-link text-light text-wrap dropdown-toggle px-0">Эксплуатация</a> <div id=sidebar-sidebar-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../operations/requirements/ title=Требования class="nav-link text-light text-wrap d-inline-block w-100 px-0">Требования</a> <a href=../../operations/monitoring/ title=Мониторинг class="nav-link text-light text-wrap d-inline-block w-100 px-0">Мониторинг</a> <a href=../../operations/troubleshooting/ title="Устранение неисправностей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Устранение неисправностей</a> <a href=../../operations/tips/ title="Советы по эксплуатации" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Советы по эксплуатации</a> <a href=../../operations/update/ title="Обновление ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление ClickHouse</a> <a href=../../operations/access_rights/ title="Права доступа" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Права доступа</a> <a href=../../operations/backup/ title="Резервное копирование" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Резервное копирование</a> <a href=../../operations/configuration_files/ title="Конфигурационные файлы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Конфигурационные файлы</a> <a href=../../operations/quotas/ title=Квоты class="nav-link text-light text-wrap d-inline-block w-100 px-0">Квоты</a> <a href=../../operations/system_tables/ title="Системные таблицы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Системные таблицы</a> <a href=#sidebar-sidebar-7-12 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-12 title="Конфигурационные параметры сервера" class="nav-link text-light text-wrap dropdown-toggle px-0">Конфигурационные параметры сервера</a> <div id=sidebar-sidebar-7-12 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/server_settings/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../operations/server_settings/settings/ title="Серверные настройки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Серверные настройки</a> </nav> </div> <a href=#sidebar-sidebar-7-13 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-13 title=Настройки class="nav-link text-light text-wrap dropdown-toggle px-0">Настройки</a> <div id=sidebar-sidebar-7-13 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/settings/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../operations/settings/permissions_for_queries/ title="Разрешения на выполнение запросов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Разрешения на выполнение запросов</a> <a href=../../operations/settings/query_complexity/ title="Ограничения на сложность запроса" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на сложность запроса</a> <a href=../../operations/settings/settings/ title=Настройки class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки</a> <a href=../../operations/settings/constraints_on_settings/ title="Ограничения на изменение настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на изменение настроек</a> <a href=../../operations/settings/settings_profiles/ title="Профили настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Профили настроек</a> </nav> </div> <a href=#sidebar-sidebar-7-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-14 title=Утилиты class="nav-link text-light text-wrap dropdown-toggle px-0">Утилиты</a> <div id=sidebar-sidebar-7-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/utils/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../operations/utils/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../operations/utils/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=F.A.Q. class="nav-link text-light text-wrap dropdown-toggle px-0">F.A.Q.</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../faq/general/ title="Общие вопросы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Общие вопросы</a> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title=Разработка class="nav-link text-light text-wrap dropdown-toggle px-0">Разработка</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../development/architecture/ title="Обзор архитектуры ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор архитектуры ClickHouse</a> <a href=../../development/build/ title="Как собрать ClickHouse на Linux" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как собрать ClickHouse на Linux</a> <a href=../../development/build_osx/ title="Как собрать ClickHouse на Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как собрать ClickHouse на Mac OS X</a> <a href=../../development/style/ title="Как писать код на C++" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как писать код на C++</a> <a href=../../development/tests/ title="Как запустить тесты" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как запустить тесты</a> <a href=../../development/contrib/ title="Сторонние библиотеки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Сторонние библиотеки</a> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title="Что нового" class="nav-link text-light text-wrap dropdown-toggle px-0">Что нового</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../changelog/ title=Changelog class="nav-link text-light text-wrap d-inline-block w-100 px-0">Changelog</a> <a href=../../security_changelog/ title="Security changelog" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Security changelog</a> <a href=../../roadmap/ title=Roadmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">Roadmap</a> </nav> </div> <a href=../../single/clickhouse_ru.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt=PDF-версия title=PDF-версия height=24 class="d-block mr-1 float-left"><div>PDF-версия</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-5"> <div id=content> <h2 id=query_language_queries_alter>ALTER<a class=headerlink href=#query_language_queries_alter title="Permanent link">&para;</a></h2> <p>Запрос <code>ALTER</code> поддерживается только для таблиц типа <code>*MergeTree</code>, а также <code>Merge</code> и <code>Distributed</code>. Запрос имеет несколько вариантов.</p> <h3 id=manipuliatsii-so-stolbtsami>Манипуляции со столбцами<a class=headerlink href=#manipuliatsii-so-stolbtsami title="Permanent link">&para;</a></h3> <p>Изменение структуры таблицы.</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=p>[</span><span class=n>db</span><span class=p>].</span><span class=n>name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span> <span class=k>ADD</span><span class=o>|</span><span class=k>DROP</span><span class=o>|</span><span class=n>CLEAR</span><span class=o>|</span><span class=k>COMMENT</span><span class=o>|</span><span class=k>MODIFY</span> <span class=k>COLUMN</span> <span class=p>...</span>
</code></pre></div> <p>В запросе указывается список из одного или более действий через запятую.<br> Каждое действие — операция над столбцом.</p> <p>Существуют следующие действия:</p> <ul> <li><a href=#alter_add-column>ADD COLUMN</a> — добавляет столбец в таблицу;</li> <li><a href=#alter_drop-column>DROP COLUMN</a> — удаляет столбец;</li> <li><a href=#alter_clear-column>CLEAR COLUMN</a> — сбрасывает все значения в столбце для заданной партиции;</li> <li><a href=#alter_comment-column>COMMENT COLUMN</a> — добавляет комментарий к столбцу;</li> <li><a href=#alter_modify-column>MODIFY COLUMN</a> — изменяет тип столбца и/или выражение для значения по умолчанию.</li> </ul> <p>Подробное описание для каждого действия приведено ниже.</p> <h4 id=alter_add-column>ADD COLUMN<a class=headerlink href=#alter_add-column title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ADD</span> <span class=k>COLUMN</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=n>name</span> <span class=p>[</span><span class=k>type</span><span class=p>]</span> <span class=p>[</span><span class=n>default_expr</span><span class=p>]</span> <span class=p>[</span><span class=k>AFTER</span> <span class=n>name_after</span><span class=p>]</span>
</code></pre></div> <p>Добавляет в таблицу новый столбец с именем <code>name</code>, типом <code>type</code> и выражением для умолчания <code>default_expr</code> (смотрите раздел <a href=../create/#create-default-values>Значения по умолчанию</a>). </p> <p>Если указано <code>IF NOT EXISTS</code>, запрос не будет возвращать ошибку, если столбец уже существует. Если указано <code>AFTER name_after</code> (имя другого столбца), то столбец добавляется (в список столбцов таблицы) после указанного. Иначе, столбец добавляется в конец таблицы. Обратите внимание, ClickHouse не позволяет добавлять столбцы в начало таблицы. Для цепочки действий, <code>name_after</code> может быть именем столбца, который добавляется в одном из предыдущих действий.</p> <p>Добавление столбца всего лишь меняет структуру таблицы, и не производит никаких действий с данными - соответствующие данные не появляются на диске после ALTER-а. При чтении из таблицы, если для какого-либо столбца отсутствуют данные, то он заполняется значениями по умолчанию (выполняя выражение по умолчанию, если такое есть, или нулями, пустыми строками). Также, столбец появляется на диске при слиянии кусков данных (см. <a href=../../operations/table_engines/mergetree/ >MergeTree</a>).</p> <p>Такая схема позволяет добиться мгновенной работы запроса <code>ALTER</code> и отсутствия необходимости увеличивать объём старых данных.</p> <p>Пример:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=k>ADD</span> <span class=k>COLUMN</span> <span class=n>browser</span> <span class=n>String</span> <span class=k>AFTER</span> <span class=n>user_id</span>
</code></pre></div> <h4 id=alter_drop-column>DROP COLUMN<a class=headerlink href=#alter_drop-column title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>DROP</span> <span class=k>COLUMN</span> <span class=p>[</span><span class=k>IF</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=n>name</span>
</code></pre></div> <p>Удаляет столбец с именем <code>name</code>. Если указано <code>IF EXISTS</code>, запрос не будет возвращать ошибку, если столбца не существует.</p> <p>Запрос удаляет данные из файловой системы. Так как это представляет собой удаление целых файлов, запрос выполняется почти мгновенно.</p> <p>Пример:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=k>DROP</span> <span class=k>COLUMN</span> <span class=n>browser</span>
</code></pre></div> <h4 id=alter_clear-column>CLEAR COLUMN<a class=headerlink href=#alter_clear-column title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=n>CLEAR</span> <span class=k>COLUMN</span> <span class=p>[</span><span class=k>IF</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=n>name</span> <span class=k>IN</span> <span class=n>PARTITION</span> <span class=n>partition_name</span>
</code></pre></div> <p>Сбрасывает все значения в столбце для заданной партиции. Если указано <code>IF EXISTS</code>, запрос не будет возвращать ошибку, если столбца не существует.</p> <p>Как корректно задать имя партиции, см. в разделе <a href=#alter-how-to-specify-part-expr>Как задавать имя партиции в запросах ALTER</a>.</p> <p>Пример:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=n>CLEAR</span> <span class=k>COLUMN</span> <span class=n>browser</span> <span class=k>IN</span> <span class=n>PARTITION</span> <span class=n>tuple</span><span class=p>()</span>
</code></pre></div> <h4 id=alter_comment-column>COMMENT COLUMN<a class=headerlink href=#alter_comment-column title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>COMMENT</span> <span class=k>COLUMN</span> <span class=p>[</span><span class=k>IF</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=n>name</span> <span class=s1>&#39;Text comment&#39;</span>
</code></pre></div> <p>Добавляет комментарий к таблице. Если указано <code>IF EXISTS</code>, запрос не будет возвращать ошибку, если столбца не существует.</p> <p>Каждый столбец может содержать только один комментарий. При выполнении запроса существующий комментарий заменяется на новый.</p> <p>Посмотреть комментарии можно в столбце <code>comment_expression</code> из запроса <a href=../misc/#misc-describe-table>DESCRIBE TABLE</a>. </p> <p>Пример:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=k>COMMENT</span> <span class=k>COLUMN</span> <span class=n>browser</span> <span class=s1>&#39;Столбец показывает, из каких браузеров пользователи заходили на сайт.&#39;</span>
</code></pre></div> <h4 id=alter_modify-column>MODIFY COLUMN<a class=headerlink href=#alter_modify-column title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>MODIFY</span> <span class=k>COLUMN</span> <span class=p>[</span><span class=k>IF</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=n>name</span> <span class=p>[</span><span class=k>type</span><span class=p>]</span> <span class=p>[</span><span class=n>default_expr</span><span class=p>]</span>
</code></pre></div> <p>Изменяет тип столбца <code>name</code> на <code>type</code> и/или выражение для умолчания на <code>default_expr</code>. Если указано <code>IF EXISTS</code>, запрос не будет возвращать ошибку, если столбца не существует.</p> <p>При изменении типа, значения преобразуются так, как если бы к ним была применена функция <a href=../functions/type_conversion_functions/ >toType</a>. Если изменяется только выражение для умолчания, запрос не делает никакой сложной работы и выполняется мгновенно.</p> <p>Пример запроса:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=k>MODIFY</span> <span class=k>COLUMN</span> <span class=n>browser</span> <span class=nb>Array</span><span class=p>(</span><span class=n>String</span><span class=p>)</span>
</code></pre></div> <p>Изменение типа столбца - это единственное действие, которое выполняет сложную работу - меняет содержимое файлов с данными. Для больших таблиц, выполнение может занять длительное время.</p> <p>Выполнение производится в несколько стадий:</p> <ul> <li>подготовка временных (новых) файлов с изменёнными данными;</li> <li>переименование старых файлов;</li> <li>переименование временных (новых) файлов в старые;</li> <li>удаление старых файлов.</li> </ul> <p>Из них, длительной является только первая стадия. Если на этой стадии возникнет сбой, то данные не поменяются.<br> Если на одной из следующих стадий возникнет сбой, то данные будет можно восстановить вручную. За исключением случаев, когда старые файлы удалены из файловой системы, а данные для новых файлов не доехали на диск и потеряны.</p> <p>Запрос <code>ALTER</code> на изменение столбцов реплицируется. Соответствующие инструкции сохраняются в ZooKeeper, и затем каждая реплика их применяет. Все запросы <code>ALTER</code> выполняются в одном и том же порядке. Запрос ждёт выполнения соответствующих действий на всех репликах. Но при этом, запрос на изменение столбцов в реплицируемой таблице можно прервать, и все действия будут осуществлены асинхронно.</p> <h4 id=ogranicheniia-zaprosa-alter>Ограничения запроса ALTER<a class=headerlink href=#ogranicheniia-zaprosa-alter title="Permanent link">&para;</a></h4> <p>Запрос <code>ALTER</code> позволяет создавать и удалять отдельные элементы (столбцы) вложенных структур данных, но не вложенные структуры данных целиком. Для добавления вложенной структуры данных, вы можете добавить столбцы с именем вида <code>name.nested_name</code> и типом <code>Array(T)</code> - вложенная структура данных полностью эквивалентна нескольким столбцам-массивам с именем, имеющим одинаковый префикс до точки.</p> <p>Отсутствует возможность удалять столбцы, входящие в первичный ключ или ключ для сэмплирования (в общем, входящие в выражение <code>ENGINE</code>). Изменение типа у столбцов, входящих в первичный ключ возможно только в том случае, если это изменение не приводит к изменению данных (например, разрешено добавление значения в Enum или изменение типа с <code>DateTime</code> на <code>UInt32</code>).</p> <p>Если возможностей запроса <code>ALTER</code> не хватает для нужного изменения таблицы, вы можете создать новую таблицу, скопировать туда данные с помощью запроса <a href=../insert_into/#insert_query_insert-select>INSERT SELECT</a>, затем поменять таблицы местами с помощью запроса <a href=../misc/#misc_operations-rename>RENAME</a>, и удалить старую таблицу. В качестве альтернативы для запроса <code>INSERT SELECT</code>, можно использовать инструмент <a href=../../operations/utils/clickhouse-copier/ >clickhouse-copier</a>.</p> <p>Запрос <code>ALTER</code> блокирует все чтения и записи для таблицы. То есть, если на момент запроса <code>ALTER</code>, выполнялся долгий <code>SELECT</code>, то запрос <code>ALTER</code> сначала дождётся его выполнения. И в это время, все новые запросы к той же таблице, будут ждать, пока завершится этот <code>ALTER</code>.</p> <p>Для таблиц, которые не хранят данные самостоятельно (типа <a href=../../operations/table_engines/merge/ >Merge</a> и <a href=../../operations/table_engines/distributed/ >Distributed</a>), <code>ALTER</code> всего лишь меняет структуру таблицы, но не меняет структуру подчинённых таблиц. Для примера, при ALTER-е таблицы типа <code>Distributed</code>, вам также потребуется выполнить запрос <code>ALTER</code> для таблиц на всех удалённых серверах.</p> <h3 id=manipuliatsii-s-kliuchevymi-vyrazheniiami-tablits>Манипуляции с ключевыми выражениями таблиц<a class=headerlink href=#manipuliatsii-s-kliuchevymi-vyrazheniiami-tablits title="Permanent link">&para;</a></h3> <p>Поддерживается операция:</p> <div class=codehilite><pre><span></span><code><span class=k>MODIFY</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=n>new_expression</span>
</code></pre></div> <p>Работает только для таблиц семейства <a href=../../operations/table_engines/mergetree/ ><code>MergeTree</code></a> (в том числе <a href=../../operations/table_engines/replication/ >реплицированных</a>). После выполнения запроса<br> <a href=../../operations/table_engines/mergetree/ >ключ сортировки</a> таблицы<br> заменяется на <code>new_expression</code> (выражение или кортеж выражений). Первичный ключ при этом остаётся прежним.</p> <p>Операция затрагивает только метаданные. Чтобы сохранить свойство упорядоченности кусков данных по ключу<br> сортировки, разрешено добавлять в ключ только новые столбцы (т.е. столбцы, добавляемые командой <code>ADD COLUMN</code><br> в том же запросе <code>ALTER</code>), у которых нет выражения по умолчанию.</p> <h3 id=manipuliatsii-s-indeksami>Манипуляции с индексами<a class=headerlink href=#manipuliatsii-s-indeksami title="Permanent link">&para;</a></h3> <p>Добавить или удалить индекс можно с помощью операций</p> <div class=codehilite><pre><span></span><code><span class=n>ALTER</span> <span class=n>TABLE</span> <span class=p>[</span><span class=n>db</span><span class=p>].</span><span class=n>name</span> <span class=n>ADD</span> <span class=n>INDEX</span> <span class=n>name</span> <span class=n>expression</span> <span class=n>TYPE</span> <span class=n>type</span> <span class=n>GRANULARITY</span> <span class=n>value</span> <span class=p>[</span><span class=n>AFTER</span> <span class=n>name</span><span class=p>]</span>
<span class=n>ALTER</span> <span class=n>TABLE</span> <span class=p>[</span><span class=n>db</span><span class=p>].</span><span class=n>name</span> <span class=n>DROP</span> <span class=n>INDEX</span> <span class=n>name</span>
</code></pre></div> <p>Поддерживается только таблицами семейства <code>*MergeTree</code>.</p> <p>Команда <code>ADD INDEX</code> добавляет описание индексов в метаданные, а <code>DROP INDEX</code> удаляет индекс из метаданных и стирает файлы индекса с диска, поэтому они легковесные и работают мгновенно.</p> <p>Если индекс появился в метаданных, то он начнет считаться в последующих слияниях и записях в таблицу, а не сразу после выполнения операции <code>ALTER</code>.</p> <p>Запрос на изменение индексов реплицируется, сохраняя новые метаданные в ZooKeeper и применяя изменения на всех репликах.</p> <h3 id=alter_manipulations-with-partitions>Манипуляции с партициями и кусками<a class=headerlink href=#alter_manipulations-with-partitions title="Permanent link">&para;</a></h3> <p>Для работы с <a href=../../operations/table_engines/custom_partitioning_key/ >партициями</a> доступны следующие операции:</p> <ul> <li><a href=#alter_detach-partition>DETACH PARTITION</a> – перенести партицию в директорию <code>detached</code>;</li> <li><a href=#alter_drop-partition>DROP PARTITION</a> – удалить партицию;</li> <li><a href=#alter_attach-partition>ATTACH PARTITION|PART</a> – добавить партицию/кусок в таблицу из директории <code>detached</code>;</li> <li><a href=#alter_replace-partition>REPLACE PARTITION</a> – скопировать партицию из другой таблицы;</li> <li><a href=#alter_clear-column-partition>CLEAR COLUMN IN PARTITION</a> – удалить все значения в столбце для заданной партиции;</li> <li><a href=#alter_freeze-partition>FREEZE PARTITION</a> – создать резервную копию партиции;</li> <li><a href=#alter_fetch-partition>FETCH PARTITION</a> – скачать партицию с другого сервера.</li> </ul> <h4 id=alter_detach-partition>DETACH PARTITION<a class=headerlink href=#alter_detach-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=n>DETACH</span> <span class=n>PARTITION</span> <span class=n>partition_expr</span>
</code></pre></div> <p>Перемещает заданную партицию в директорию <code>detached</code>. Сервер не будет знать об этой партиции до тех пор, пока вы не выполните запрос <a href=#alter_attach-partition>ATTACH</a>.</p> <p>Пример:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=n>DETACH</span> <span class=n>PARTITION</span> <span class=mi>201901</span>
</code></pre></div> <p>Подробнее о том, как корректно задать имя партиции, см. в разделе <a href=#alter-how-to-specify-part-expr>Как задавать имя партиции в запросах ALTER</a>.</p> <p>После того как запрос будет выполнен, вы сможете производить любые операции с данными в директории <code>detached</code>. Например, можно удалить их из файловой системы.</p> <p>Запрос реплицируется — данные будут перенесены в директорию <code>detached</code> и забыты на всех репликах. Обратите внимание, запрос может быть отправлен только на реплику-лидер. Чтобы узнать, является ли реплика лидером, выполните запрос <code>SELECT</code> к системной таблице <a href=../../operations/system_tables/#system_tables-replicas>system.replicas</a>. Либо можно выполнить запрос <code>DETACH</code> на всех репликах — тогда на всех репликах, кроме реплики-лидера, запрос вернет ошибку.</p> <h4 id=alter_drop-partition>DROP PARTITION<a class=headerlink href=#alter_drop-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=k>DROP</span> <span class=n>PARTITION</span> <span class=n>partition_expr</span>
</code></pre></div> <p>Удаляет партицию. Партиция помечается как неактивная и будет полностью удалена примерно через 10 минут.</p> <p>Подробнее о том, как корректно задать имя партиции, см. в разделе <a href=#alter-how-to-specify-part-expr>Как задавать имя партиции в запросах ALTER</a>.</p> <p>Запрос реплицируется — данные будут удалены на всех репликах.</p> <h4 id=alter_attach-partition>ATTACH PARTITION|PART<a class=headerlink href=#alter_attach-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=n>ATTACH</span> <span class=n>PARTITION</span><span class=o>|</span><span class=n>PART</span> <span class=n>partition_expr</span>
</code></pre></div> <p>Добавляет данные в таблицу из директории <code>detached</code>. Можно добавить данные как для целой партиции, так и для отдельного куска. Примеры:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=n>ATTACH</span> <span class=n>PARTITION</span> <span class=mi>201901</span><span class=p>;</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=n>ATTACH</span> <span class=n>PART</span> <span class=mi>201901</span><span class=n>_2_2_0</span><span class=p>;</span>
</code></pre></div> <p>Как корректно задать имя партиции или куска, см. в разделе <a href=#alter-how-to-specify-part-expr>Как задавать имя партиции в запросах ALTER</a>.</p> <p>Этот запрос реплицируется. Каждая реплика проверяет, есть ли данные в директории <code>detached</code>. Если данные есть, то запрос проверяет их целостность и соответствие данным на сервере-инициаторе запроса. В случае успеха данные добавляются в таблицу. В противном случае, реплика загружает данные с реплики-инициатора запроса или с другой реплики, на которой эти данные уже добавлены.</p> <p>Это означает, что вы можете разместить данные в директории <code>detached</code> на одной реплике и с помощью запроса <code>ALTER ... ATTACH</code> добавить их в таблицу на всех репликах.</p> <h4 id=alter_replace-partition>REPLACE PARTITION<a class=headerlink href=#alter_replace-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>table2</span> <span class=k>REPLACE</span> <span class=n>PARTITION</span> <span class=n>partition_expr</span> <span class=k>FROM</span> <span class=n>table1</span>
</code></pre></div> <p>Копирует партицию из таблицы <code>table1</code> в таблицу <code>table2</code>. Данные из <code>table1</code> не удаляются. </p> <p>Следует иметь в виду:</p> <ul> <li>Таблицы должны иметь одинаковую структуру.</li> <li>Для таблиц должен быть задан одинаковый ключ партиционирования.</li> </ul> <p>Подробнее о том, как корректно задать имя партиции, см. в разделе <a href=#alter-how-to-specify-part-expr>Как задавать имя партиции в запросах ALTER</a>.</p> <h4 id=alter_clear-column-partition>CLEAR COLUMN IN PARTITION<a class=headerlink href=#alter_clear-column-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=n>CLEAR</span> <span class=k>COLUMN</span> <span class=k>column_name</span> <span class=k>IN</span> <span class=n>PARTITION</span> <span class=n>partition_expr</span>
</code></pre></div> <p>Сбрасывает все значения в столбце для заданной партиции. Если для столбца определено значение по умолчанию (в секции <code>DEFAULT</code>), то будет выставлено это значение.</p> <p>Пример:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=n>CLEAR</span> <span class=k>COLUMN</span> <span class=n>hour</span> <span class=k>in</span> <span class=n>PARTITION</span> <span class=mi>201902</span>
</code></pre></div> <h4 id=alter_freeze-partition>FREEZE PARTITION<a class=headerlink href=#alter_freeze-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=k>FREEZE</span> <span class=p>[</span><span class=n>PARTITION</span> <span class=n>partition_expr</span><span class=p>]</span>
</code></pre></div> <p>Создаёт резервную копию для заданной партиции. Если выражение <code>PARTITION</code> опущено, резервные копии будут созданы для всех партиций. </p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Создание резервной копии не требует остановки сервера. </p> </div> <p>Для таблиц старого стиля имя партиций можно задавать в виде префикса (например, '2019'). В этом случае резервные копии будут созданы для всех соответствующих партиций. Подробнее о том, как корректно задать имя партиции, см. в разделе <a href=#alter-how-to-specify-part-expr>Как задавать имя партиции в запросах ALTER</a>.</p> <p>Запрос делает следующее — для текущего состояния таблицы он формирует жесткие ссылки на данные в этой таблице. Ссылки размещаются в директории <code>/var/lib/clickhouse/shadow/N/...</code>, где:</p> <ul> <li><code>/var/lib/clickhouse/</code> — рабочая директория ClickHouse, заданная в конфигурационном файле;</li> <li><code>N</code> — инкрементальный номер резервной копии.</li> </ul> <p>Структура директорий внутри резервной копии такая же, как внутри <code>/var/lib/clickhouse/</code>. Запрос выполнит 'chmod' для всех файлов, запрещая запись в них. </p> <p>Обратите внимание, запрос <code>ALTER TABLE t FREEZE PARTITION</code> не реплицируется. Он создает резервную копию только на локальном сервере. После создания резервной копии данные из <code>/var/lib/clickhouse/shadow/</code> можно скопировать на удалённый сервер, а локальную копию удалить.</p> <p>Резервная копия создается почти мгновенно (однако сначала запрос дожидается завершения всех запросов, которые выполняются для соответствующей таблицы).</p> <p><code>ALTER TABLE t FREEZE PARTITION</code> копирует только данные, но не метаданные таблицы. Чтобы сделать резервную копию метаданных таблицы, скопируйте файл <code>/var/lib/clickhouse/metadata/database/table.sql</code></p> <p>Чтобы восстановить данные из резервной копии, выполните следующее:</p> <ol> <li>Создайте таблицу, если она ещё не существует. Запрос на создание можно взять из .sql файла (замените в нём <code>ATTACH</code> на <code>CREATE</code>).</li> <li>Скопируйте данные из директории <code>data/database/table/</code> внутри резервной копии в директорию <code>/var/lib/clickhouse/data/database/table/detached/</code>.</li> <li>С помощью запросов <code>ALTER TABLE t ATTACH PARTITION</code> добавьте данные в таблицу.</li> </ol> <p>Восстановление данных из резервной копии не требует остановки сервера.</p> <p>Подробнее о резервном копировании и восстановлении данных читайте в разделе <a href=../../operations/backup/ >Резервное копирование данных</a>.</p> <h4 id=alter_fetch-partition>FETCH PARTITION<a class=headerlink href=#alter_fetch-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=k>FETCH</span> <span class=n>PARTITION</span> <span class=n>partition_expr</span> <span class=k>FROM</span> <span class=s1>&#39;path-in-zookeeper&#39;</span>
</code></pre></div> <p>Загружает партицию с другого сервера. Этот запрос работает только для реплицированных таблиц.</p> <p>Запрос выполняет следующее:</p> <ol> <li>Загружает партицию с указанного шарда. Путь к шарду задается в секции <code>FROM</code> ('path-in-zookeeper'). Обратите внимание, нужно задавать путь к шарду в ZooKeeper.</li> <li>Помещает загруженные данные в директорию <code>detached</code> таблицы <code>table_name</code>. Чтобы прикрепить эти данные к таблице, используйте запрос <a href=#alter_attach-partition>ATTACH PARTITION|PART</a>.</li> </ol> <p>Например:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>users</span> <span class=k>FETCH</span> <span class=n>PARTITION</span> <span class=mi>201902</span> <span class=k>FROM</span> <span class=s1>&#39;/clickhouse/tables/01-01/visits&#39;</span><span class=p>;</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>users</span> <span class=n>ATTACH</span> <span class=n>PARTITION</span> <span class=mi>201902</span><span class=p>;</span>
</code></pre></div> <p>Следует иметь в виду:</p> <ul> <li>Запрос <code>ALTER TABLE t FETCH PARTITION</code> не реплицируется. Он загружает партицию в директорию <code>detached</code> только на локальном сервере.</li> <li>Запрос <code>ALTER TABLE t ATTACH</code> реплицируется — он добавляет данные в таблицу сразу на всех репликах. На одной из реплик данные будут добавлены из директории <code>detached</code>, а на других — из соседних реплик.</li> </ul> <p>Перед загрузкой данных система проверяет, существует ли партиция и совпадает ли её структура со структурой таблицы. При этом автоматически выбирается наиболее актуальная реплика среди всех живых реплик.</p> <p>Несмотря на то что запрос называется <code>ALTER TABLE</code>, он не изменяет структуру таблицы и не изменяет сразу доступные данные в таблице.</p> <h4 id=alter-how-to-specify-part-expr>Как задавать имя партиции в запросах ALTER<a class=headerlink href=#alter-how-to-specify-part-expr title="Permanent link">&para;</a></h4> <p>Чтобы задать нужную партицию в запросах <code>ALTER ... PARTITION</code>, можно использовать: </p> <ul> <li>Имя партиции. Посмотреть имя партиции можно в столбце <code>partition</code> системной таблицы <a href=../../operations/system_tables/#system_tables-parts>system.parts</a>. Например, <code>ALTER TABLE visits DETACH PARTITION 201901</code>.</li> <li>Произвольное выражение из столбцов исходной таблицы. Также поддерживаются константы и константные выражения. Например, <code>ALTER TABLE visits DETACH PARTITION toYYYYMM(toDate('2019-01-25'))</code>.</li> <li>Строковый идентификатор партиции. Идентификатор партиции используется для именования кусков партиции на файловой системе и в ZooKeeper. В запросах <code>ALTER</code> идентификатор партиции нужно указывать в секции <code>PARTITION ID</code>, в одинарных кавычках. Например, <code>ALTER TABLE visits DETACH PARTITION ID '201901'</code>.</li> <li>Для запросов <a href=#alter_attach-partition>ATTACH PART</a>: чтобы задать имя куска партиции, используйте значение из столбца <code>name</code> системной таблицы <code>system.parts</code>. Например, <code>ALTER TABLE visits ATTACH PART 201901_1_1_0</code>.</li> </ul> <p>Использование кавычек в имени партиций зависит от типа данных столбца, по которому задано партиционирование. Например, для столбца с типом <code>String</code> имя партиции необходимо указывать в кавычках (одинарных). Для типов <code>Date</code> и <code>Int*</code> кавычки указывать не нужно.</p> <p>Замечание: для таблиц старого стиля партицию можно указывать и как число <code>201901</code>, и как строку <code>'201901'</code>. Синтаксис для таблиц нового типа более строг к типам (аналогично парсеру входного формата VALUES).</p> <p>Правила, сформулированные выше, актуальны также для запросов <a href=../misc/#misc_operations-optimize>OPTIMIZE</a>. Чтобы указать единственную партицию непартиционированной таблицы, укажите <code>PARTITION tuple()</code>. Например:</p> <div class=codehilite><pre><span></span><code><span class=n>OPTIMIZE</span> <span class=k>TABLE</span> <span class=n>table_not_partitioned</span> <span class=n>PARTITION</span> <span class=n>tuple</span><span class=p>()</span> <span class=k>FINAL</span><span class=p>;</span>
</code></pre></div> <p>Примеры запросов <code>ALTER ... PARTITION</code> можно посмотреть в тестах: <a href=https://github.com/yandex/ClickHouse/blob/master/dbms/tests/queries/0_stateless/00502_custom_partitioning_local.sql rel="external nofollow noreferrer"><code>00502_custom_partitioning_local</code></a> и <a href=https://github.com/yandex/ClickHouse/blob/master/dbms/tests/queries/0_stateless/00502_custom_partitioning_replicated_zookeeper.sql rel="external nofollow noreferrer"><code>00502_custom_partitioning_replicated_zookeeper</code></a>.</p> <h3 id=sinkhronnost-zaprosov-alter>Синхронность запросов ALTER<a class=headerlink href=#sinkhronnost-zaprosov-alter title="Permanent link">&para;</a></h3> <p>Для нереплицируемых таблиц, все запросы <code>ALTER</code> выполняются синхронно. Для реплицируемых таблиц, запрос всего лишь добавляет инструкцию по соответствующим действиям в <code>ZooKeeper</code>, а сами действия осуществляются при первой возможности. Но при этом, запрос может ждать завершения выполнения этих действий на всех репликах.</p> <p>Для запросов <code>ALTER ... ATTACH|DETACH|DROP</code> можно настроить ожидание, с помощью настройки <code>replication_alter_partitions_sync</code>.<br> Возможные значения: <code>0</code> - не ждать, <code>1</code> - ждать выполнения только у себя (по умолчанию), <code>2</code> - ждать всех.</p> <h3 id=alter-mutations>Мутации<a class=headerlink href=#alter-mutations title="Permanent link">&para;</a></h3> <p>Мутации - разновидность запроса ALTER, позволяющая изменять или удалять данные в таблице. В отличие от стандартных запросов <code>DELETE</code> и <code>UPDATE</code>, рассчитанных на точечное изменение данных, область применения мутаций - достаточно тяжёлые изменения, затрагивающие много строк в таблице.</p> <p>Функциональность находится в состоянии beta и доступна начиная с версии 1.1.54388. Реализована поддержка *MergeTree таблиц (с репликацией и без).</p> <p>Конвертировать существующие таблицы для работы с мутациями не нужно. Но после применения первой мутации формат данных таблицы становится несовместимым с предыдущими версиями и откатиться на предыдущую версию уже не получится.</p> <p>На данный момент доступны команды:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table</span> <span class=k>DELETE</span> <span class=k>WHERE</span> <span class=n>filter_expr</span>
</code></pre></div> <p>Выражение <code>filter_expr</code> должно иметь тип UInt8. Запрос удаляет строки таблицы, для которых это выражение принимает ненулевое значение.</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table</span> <span class=k>UPDATE</span> <span class=n>column1</span> <span class=o>=</span> <span class=n>expr1</span> <span class=p>[,</span> <span class=p>...]</span> <span class=k>WHERE</span> <span class=n>filter_expr</span>
</code></pre></div> <p>Команда доступна начиная с версии 18.12.14. Выражение <code>filter_expr</code> должно иметь тип UInt8. Запрос изменяет значение указанных столбцов на вычисленное значение соответствующих выражений в каждой строке, для которой <code>filter_expr</code> принимает ненулевое значение. Вычисленные значения преобразуются к типу столбца с помощью оператора <code>CAST</code>. Изменение столбцов, которые используются при вычислении первичного ключа или ключа партиционирования, не поддерживается.</p> <p>В одном запросе можно указать несколько команд через запятую.</p> <p>Для *MergeTree-таблиц мутации выполняются, перезаписывая данные по кускам (parts). При этом атомарности нет — куски заменяются на помутированные по мере выполнения и запрос <code>SELECT</code>, заданный во время выполнения мутации, увидит данные как из измененных кусков, так и из кусков, которые еще не были изменены.</p> <p>Мутации линейно упорядочены между собой и накладываются на каждый кусок в порядке добавления. Мутации также упорядочены со вставками - гарантируется, что данные, вставленные в таблицу до начала выполнения запроса мутации, будут изменены, а данные, вставленные после окончания запроса мутации, изменены не будут. При этом мутации никак не блокируют вставки.</p> <p>Запрос завершается немедленно после добавления информации о мутации (для реплицированных таблиц - в ZooKeeper, для нереплицированных - на файловую систему). Сама мутация выполняется асинхронно, используя настройки системного профиля. Следить за ходом её выполнения можно по таблице <a href=../../operations/system_tables/#system_tables-mutations><code>system.mutations</code></a>. Добавленные мутации будут выполняться до конца даже в случае перезапуска серверов ClickHouse. Откатить мутацию после её добавления нельзя, но если мутация по какой-то причине не может выполниться до конца, её можно остановить с помощью запроса <a href=../misc/#kill-mutation><code>KILL MUTATION</code></a>.</p> <p>Записи о последних выполненных мутациях удаляются не сразу (количество сохраняемых мутаций определяется параметром движка таблиц <code>finished_mutations_to_keep</code>). Более старые записи удаляются.</p> </div> <div id=content-footer class="text-muted pt-5"> <div class=float-right>©2016–2020 Yandex LLC</div> <div>Собрано из <a href=https://github.com/ClickHouse/ClickHouse/commit/a24471233fce463ffd70bff561f7842d4d0b7bd9 rel="external nofollow noreferrer" target=_blank class=text-reset>a24471233f</a></div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>Cодержание</label> <a href=#query_language_queries_alter title=ALTER class="nav-link text-wrap d-inline-block w-100"> ALTER </a> <nav id=toc-toc-1 class="nav flex-column pl-2"> <a href=#manipuliatsii-so-stolbtsami title="Манипуляции со столбцами" class="nav-link text-wrap d-inline-block w-100"> Манипуляции со столбцами </a> <nav id=toc-toc-1-1 class="nav flex-column pl-2"> <a href=#alter_add-column title="ADD COLUMN" class="nav-link text-wrap d-inline-block w-100"> ADD COLUMN </a> <a href=#alter_drop-column title="DROP COLUMN" class="nav-link text-wrap d-inline-block w-100"> DROP COLUMN </a> <a href=#alter_clear-column title="CLEAR COLUMN" class="nav-link text-wrap d-inline-block w-100"> CLEAR COLUMN </a> <a href=#alter_comment-column title="COMMENT COLUMN" class="nav-link text-wrap d-inline-block w-100"> COMMENT COLUMN </a> <a href=#alter_modify-column title="MODIFY COLUMN" class="nav-link text-wrap d-inline-block w-100"> MODIFY COLUMN </a> <a href=#ogranicheniia-zaprosa-alter title="Ограничения запроса ALTER" class="nav-link text-wrap d-inline-block w-100"> Ограничения запроса ALTER </a> </nav> <a href=#manipuliatsii-s-kliuchevymi-vyrazheniiami-tablits title="Манипуляции с ключевыми выражениями таблиц" class="nav-link text-wrap d-inline-block w-100"> Манипуляции с ключевыми выражениями таблиц </a> <a href=#manipuliatsii-s-indeksami title="Манипуляции с индексами" class="nav-link text-wrap d-inline-block w-100"> Манипуляции с индексами </a> <a href=#alter_manipulations-with-partitions title="Манипуляции с партициями и кусками" class="nav-link text-wrap d-inline-block w-100"> Манипуляции с партициями и кусками </a> <nav id=toc-toc-1-4 class="nav flex-column pl-2"> <a href=#alter_detach-partition title="DETACH PARTITION" class="nav-link text-wrap d-inline-block w-100"> DETACH PARTITION </a> <a href=#alter_drop-partition title="DROP PARTITION" class="nav-link text-wrap d-inline-block w-100"> DROP PARTITION </a> <a href=#alter_attach-partition title="ATTACH PARTITION|PART" class="nav-link text-wrap d-inline-block w-100"> ATTACH PARTITION|PART </a> <a href=#alter_replace-partition title="REPLACE PARTITION" class="nav-link text-wrap d-inline-block w-100"> REPLACE PARTITION </a> <a href=#alter_clear-column-partition title="CLEAR COLUMN IN PARTITION" class="nav-link text-wrap d-inline-block w-100"> CLEAR COLUMN IN PARTITION </a> <a href=#alter_freeze-partition title="FREEZE PARTITION" class="nav-link text-wrap d-inline-block w-100"> FREEZE PARTITION </a> <a href=#alter_fetch-partition title="FETCH PARTITION" class="nav-link text-wrap d-inline-block w-100"> FETCH PARTITION </a> <a href=#alter-how-to-specify-part-expr title="Как задавать имя партиции в запросах ALTER" class="nav-link text-wrap d-inline-block w-100"> Как задавать имя партиции в запросах ALTER </a> </nav> <a href=#sinkhronnost-zaprosov-alter title="Синхронность запросов ALTER" class="nav-link text-wrap d-inline-block w-100"> Синхронность запросов ALTER </a> <a href=#alter-mutations title=Мутации class="nav-link text-wrap d-inline-block w-100"> Мутации </a> </nav> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?7bd05efd></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>