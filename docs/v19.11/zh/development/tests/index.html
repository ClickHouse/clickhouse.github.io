<!DOCTYPE html><html lang=zh data-version=v19.11 data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>如何运行ClickHouse测试 - ClickHouse文档 v19.11</title><link rel="shortcut icon" href=/favicon.ico><meta property=og:title content="如何运行ClickHouse测试 - ClickHouse文档 v19.11"><meta property=og:description content="ClickHouse 测试 功能性测试 功能性测试是最简便使用的。绝大部分 ClickHouse 的功能可以通过功能性测试来测试，任何代码的更改都必须通过该测试。 每个功能测试会向正在运行的 ClickHouse服 务器发送一个或多个查询，"><meta property=og:type content=website><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta property=twitter:title content="如何运行ClickHouse测试 - ClickHouse文档 v19.11"><meta name=description content="ClickHouse 测试 功能性测试 功能性测试是最简便使用的。绝大部分 ClickHouse 的功能可以通过功能性测试来测试，任何代码的更改都必须通过该测试。 每个功能测试会向正在运行的 ClickHouse服 务器发送一个或多个查询，"><meta name=keywords content="ClickHouse, DBMS, OLAP, relational, analytics, analytical, big data, open-source, SQL, web-analytics"><link href=/css/base.css?1d858e50 media=all rel=stylesheet></head> <body dir=ltr data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> 如何运行ClickHouse测试 </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li class=nav-item> <a href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/zh/development/tests.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/zh.svg alt=中文 title=中文 width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/v19.11/en/development/tests/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/v19.11/zh/development/tests/ class="dropdown-item disabled"> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/v19.11/es/development/tests/ class=dropdown-item> <img src=/images/flags/es.svg alt title width=32 class="d-inline-block mr-2">Español </a> <a href=/docs/v19.11/fr/development/tests/ class=dropdown-item> <img src=/images/flags/fr.svg alt title width=32 class="d-inline-block mr-2">Français </a> <a href=/docs/v19.11/ru/development/tests/ class=dropdown-item> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/v19.11/ja/development/tests/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> <a href=/docs/v19.11/fa/development/tests/ class=dropdown-item> <img src=/images/flags/fa.svg alt title width=32 class="d-inline-block mr-2">فارسی </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class=container-fluid> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label=多页或单页> <a href=../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt=多页版本 title=多页版本> </a> <a href=../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt=单页版本 title=单页版本> </a> </div> <div class="dropdown mb-3"> <a class="btn btn-dark dropdown-toggle text-muted" href=# role=button id=select-version data-toggle=dropdown aria-haspopup=true aria-expanded=false> 版本: <span class=text-light>v19.11</span> </a> <div class="dropdown-menu bg-dark text-muted p-1" aria-labelledby=select-version> <a href=/docs/zh/ class=dropdown-item> <span class=text-light>最新消息</span> </a> <a href=/docs/v20.3/zh/ class=dropdown-item>v20.3</a> <a href=/docs/v20.1/zh/ class=dropdown-item>v20.1</a> <a href=/docs/v19.17/zh/ class=dropdown-item>v19.17</a> <a href=/docs/v19.16/zh/ class=dropdown-item>v19.16</a> <a href=/docs/v19.15/zh/ class=dropdown-item>v19.15</a> <a href=/docs/v19.14/zh/ class=dropdown-item>v19.14</a> <a href=/docs/v19.13/zh/ class=dropdown-item>v19.13</a> <a href=/docs/v19.11/zh/ class="dropdown-item disable">v19.11</a> <a href=/docs/v19.10/zh/ class=dropdown-item>v19.10</a> <a href=/docs/v19.9/zh/ class=dropdown-item>v19.9</a> <a href=/docs/v19.8/zh/ class=dropdown-item>v19.8</a> </div> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=介绍 class="nav-link text-light text-wrap dropdown-toggle px-0">介绍</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../ title=概貌 class="nav-link text-light text-wrap d-inline-block w-100 px-0">概貌</a> <a href=../../introduction/distinctive_features/ title=ClickHouse的独特功能 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse的独特功能</a> <a href=../../introduction/features_considered_disadvantages/ title=ClickHouse功能可被视为缺点 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse功能可被视为缺点</a> <a href=../../introduction/performance/ title=性能 class="nav-link text-light text-wrap d-inline-block w-100 px-0">性能</a> <a href=../../introduction/ya_metrika_task/ title=Yandex.Metrica使用案例 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Yandex.Metrica使用案例</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title=入门指南 class="nav-link text-light text-wrap dropdown-toggle px-0">入门指南</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/ title=部署运行 class="nav-link text-light text-wrap d-inline-block w-100 px-0">部署运行</a> <a href=#sidebar-sidebar-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-2 title=示例数据集 class="nav-link text-light text-wrap dropdown-toggle px-0">示例数据集</a> <div id=sidebar-sidebar-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/example_datasets/ontime/ title=航班飞行数据 class="nav-link text-light text-wrap d-inline-block w-100 px-0">航班飞行数据</a> <a href=../../getting_started/example_datasets/nyc_taxi/ title=纽约市出租车数据 class="nav-link text-light text-wrap d-inline-block w-100 px-0">纽约市出租车数据</a> <a href=../../getting_started/example_datasets/amplab_benchmark/ title=AMPLab大数据基准测试 class="nav-link text-light text-wrap d-inline-block w-100 px-0">AMPLab大数据基准测试</a> <a href=../../getting_started/example_datasets/wikistat/ title=维基访问数据 class="nav-link text-light text-wrap d-inline-block w-100 px-0">维基访问数据</a> <a href=../../getting_started/example_datasets/criteo/ title="Criteo TB级别点击日志" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Criteo TB级别点击日志</a> <a href=../../getting_started/example_datasets/star_schema/ title="Star Schema基准测试" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Star Schema基准测试</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=客户端 class="nav-link text-light text-wrap dropdown-toggle px-0">客户端</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../interfaces/cli/ title=命令行客户端接口 class="nav-link text-light text-wrap d-inline-block w-100 px-0">命令行客户端接口</a> <a href=../../interfaces/tcp/ title="原生客户端接口 (TCP)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">原生客户端接口 (TCP)</a> <a href=../../interfaces/http/ title="HTTP 客户端接口" class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP 客户端接口</a> <a href=../../interfaces/formats/ title=输入输出格式 class="nav-link text-light text-wrap d-inline-block w-100 px-0">输入输出格式</a> <a href=../../interfaces/jdbc/ title="JDBC 驱动" class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC 驱动</a> <a href=../../interfaces/odbc/ title="ODBC 驱动" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC 驱动</a> <a href=#sidebar-sidebar-3-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-8 title=第三方 class="nav-link text-light text-wrap dropdown-toggle px-0">第三方</a> <div id=sidebar-sidebar-3-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/third-party/client_libraries/ title=客户端库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">客户端库</a> <a href=../../interfaces/third-party/integrations/ title=集成 class="nav-link text-light text-wrap d-inline-block w-100 px-0">集成</a> <a href=../../interfaces/third-party/gui/ title=可视界面 class="nav-link text-light text-wrap d-inline-block w-100 px-0">可视界面</a> <a href=../../interfaces/third-party/proxy/ title=代理 class="nav-link text-light text-wrap d-inline-block w-100 px-0">代理</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title=数据类型 class="nav-link text-light text-wrap dropdown-toggle px-0">数据类型</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../data_types/int_uint/ title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</a> <a href=../../data_types/float/ title="Float32, Float64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32, Float64</a> <a href=../../data_types/decimal/ title=Decimal class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal</a> <a href=../../data_types/boolean/ title="Boolean values" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Boolean values</a> <a href=../../data_types/string/ title=String class="nav-link text-light text-wrap d-inline-block w-100 px-0">String</a> <a href=../../data_types/fixedstring/ title=FixedString(N) class="nav-link text-light text-wrap d-inline-block w-100 px-0">FixedString(N)</a> <a href=../../data_types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../data_types/date/ title=Date class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date</a> <a href=../../data_types/datetime/ title=DateTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime</a> <a href=../../data_types/enum/ title=Enum class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum</a> <a href=../../data_types/array/ title=Array(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Array(T)</a> <a href=../../data_types/nested_data_structures/aggregatefunction/ title="AggregateFunction(name, types_of_arguments...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction(name, types_of_arguments...)</a> <a href=../../data_types/tuple/ title="Tuple(T1, T2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, ...)</a> <a href=../../data_types/nullable/ title=Nullable class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable</a> <a href=#sidebar-sidebar-4-16 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-16 title="Nested data structures" class="nav-link text-light text-wrap dropdown-toggle px-0">Nested data structures</a> <div id=sidebar-sidebar-4-16 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/nested_data_structures/nested/ title="Nested(Name1 Type1, Name2 Type2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, ...)</a> </nav> </div> <a href=#sidebar-sidebar-4-17 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-17 title="Special data types" class="nav-link text-light text-wrap dropdown-toggle px-0">Special data types</a> <div id=sidebar-sidebar-4-17 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/special_data_types/expression/ title=Expression class="nav-link text-light text-wrap d-inline-block w-100 px-0">Expression</a> <a href=../../data_types/special_data_types/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../data_types/special_data_types/nothing/ title=Nothing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nothing</a> </nav> </div> <a href=#sidebar-sidebar-4-18 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-18 title=Domains class="nav-link text-light text-wrap dropdown-toggle px-0">Domains</a> <div id=sidebar-sidebar-4-18 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/domains/overview/ title=Overview class="nav-link text-light text-wrap d-inline-block w-100 px-0">Overview</a> <a href=../../data_types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../data_types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title="Table Engines" class="nav-link text-light text-wrap dropdown-toggle px-0">Table Engines</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=#sidebar-sidebar-5-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-2 title="MergeTree Family" class="nav-link text-light text-wrap dropdown-toggle px-0">MergeTree Family</a> <div id=sidebar-sidebar-5-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/mergetree/ title=MergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../operations/table_engines/replication/ title="Data Replication" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Data Replication</a> <a href=../../operations/table_engines/custom_partitioning_key/ title="Custom Partitioning Key" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Custom Partitioning Key</a> <a href=../../operations/table_engines/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../operations/table_engines/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../operations/table_engines/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../operations/table_engines/collapsingmergetree/ title=CollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">CollapsingMergeTree</a> <a href=../../operations/table_engines/versionedcollapsingmergetree/ title=VersionedCollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">VersionedCollapsingMergeTree</a> <a href=../../operations/table_engines/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> </nav> </div> <a href=#sidebar-sidebar-5-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-3 title="Log Family" class="nav-link text-light text-wrap dropdown-toggle px-0">Log Family</a> <div id=sidebar-sidebar-5-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/log_family/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../operations/table_engines/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../operations/table_engines/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../operations/table_engines/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> </nav> </div> <a href=#sidebar-sidebar-5-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-4 title=Integrations class="nav-link text-light text-wrap dropdown-toggle px-0">Integrations</a> <div id=sidebar-sidebar-5-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../operations/table_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> </nav> </div> <a href=#sidebar-sidebar-5-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-5 title=Special class="nav-link text-light text-wrap dropdown-toggle px-0">Special</a> <div id=sidebar-sidebar-5-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/distributed/ title=Distributed class="nav-link text-light text-wrap d-inline-block w-100 px-0">Distributed</a> <a href=../../operations/table_engines/external_data/ title="External data" class="nav-link text-light text-wrap d-inline-block w-100 px-0">External data</a> <a href=../../operations/table_engines/dictionary/ title=Dictionary class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary</a> <a href=../../operations/table_engines/merge/ title=Merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">Merge</a> <a href=../../operations/table_engines/file/ title=File class="nav-link text-light text-wrap d-inline-block w-100 px-0">File</a> <a href=../../operations/table_engines/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../operations/table_engines/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../operations/table_engines/join/ title=Join class="nav-link text-light text-wrap d-inline-block w-100 px-0">Join</a> <a href=../../operations/table_engines/url/ title=URL class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL</a> <a href=../../operations/table_engines/view/ title=View class="nav-link text-light text-wrap d-inline-block w-100 px-0">View</a> <a href=../../operations/table_engines/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../operations/table_engines/memory/ title=Memory class="nav-link text-light text-wrap d-inline-block w-100 px-0">Memory</a> <a href=../../operations/table_engines/buffer/ title=Buffer class="nav-link text-light text-wrap d-inline-block w-100 px-0">Buffer</a> <a href=../../operations/table_engines/jdbc/ title=JDBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC</a> <a href=../../operations/table_engines/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6 title=SQL语法 class="nav-link text-light text-wrap dropdown-toggle px-0">SQL语法</a> <div id=sidebar-sidebar-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/select/ title=SELECT class="nav-link text-light text-wrap d-inline-block w-100 px-0">SELECT</a> <a href=../../query_language/insert_into/ title="INSERT INTO" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO</a> <a href=../../query_language/create/ title=CREATE class="nav-link text-light text-wrap d-inline-block w-100 px-0">CREATE</a> <a href=../../query_language/alter/ title=ALTER class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../query_language/system/ title=SYSTEM class="nav-link text-light text-wrap d-inline-block w-100 px-0">SYSTEM</a> <a href=../../query_language/misc/ title="Other kinds of queries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Other kinds of queries</a> <a href=#sidebar-sidebar-6-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-8 title=Functions class="nav-link text-light text-wrap dropdown-toggle px-0">Functions</a> <div id=sidebar-sidebar-6-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/functions/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../query_language/functions/arithmetic_functions/ title=算术函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">算术函数</a> <a href=../../query_language/functions/comparison_functions/ title=比较函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">比较函数</a> <a href=../../query_language/functions/logical_functions/ title=逻辑函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">逻辑函数</a> <a href=../../query_language/functions/type_conversion_functions/ title=类型转换函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">类型转换函数</a> <a href=../../query_language/functions/date_time_functions/ title=时间日期函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">时间日期函数</a> <a href=../../query_language/functions/string_functions/ title=字符串函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串函数</a> <a href=../../query_language/functions/string_search_functions/ title=字符串搜索函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串搜索函数</a> <a href=../../query_language/functions/string_replace_functions/ title=字符串替换函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串替换函数</a> <a href=../../query_language/functions/conditional_functions/ title="条件函数 " class="nav-link text-light text-wrap d-inline-block w-100 px-0">条件函数 </a> <a href=../../query_language/functions/math_functions/ title=数学函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数学函数</a> <a href=../../query_language/functions/rounding_functions/ title=取整函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">取整函数</a> <a href=../../query_language/functions/array_functions/ title=数组函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数组函数</a> <a href=../../query_language/functions/splitting_merging_functions/ title=字符串拆分合并函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串拆分合并函数</a> <a href=../../query_language/functions/bit_functions/ title=位操作函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">位操作函数</a> <a href=../../query_language/functions/bitmap_functions/ title=位图函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">位图函数</a> <a href=../../query_language/functions/hash_functions/ title=Hash函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Hash函数</a> <a href=../../query_language/functions/random_functions/ title=随机函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">随机函数</a> <a href=../../query_language/functions/encoding_functions/ title=编码函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">编码函数</a> <a href=../../query_language/functions/uuid_functions/ title=UUID函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID函数</a> <a href=../../query_language/functions/url_functions/ title=URL函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL函数</a> <a href=../../query_language/functions/ip_address_functions/ title=IP函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IP函数</a> <a href=../../query_language/functions/json_functions/ title=JSON函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">JSON函数</a> <a href=../../query_language/functions/higher_order_functions/ title=高阶函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">高阶函数</a> <a href=../../query_language/functions/ext_dict_functions/ title=字典函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典函数</a> <a href=../../query_language/functions/ym_dict_functions/ title=Yandex.Metrica字典函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Yandex.Metrica字典函数</a> <a href=../../query_language/functions/in_functions/ title=IN运算符相关函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IN运算符相关函数</a> <a href=../../query_language/functions/array_join/ title=arrayJoin函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">arrayJoin函数</a> <a href=../../query_language/functions/geo/ title=GEO函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">GEO函数</a> <a href=../../query_language/functions/functions_for_nulls/ title=Nullable处理函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable处理函数</a> <a href=../../query_language/functions/machine_learning_functions/ title=机器学习函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">机器学习函数</a> <a href=../../query_language/functions/other_functions/ title=其他函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">其他函数</a> </nav> </div> <a href=#sidebar-sidebar-6-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-9 title="Aggregate functions" class="nav-link text-light text-wrap dropdown-toggle px-0">Aggregate functions</a> <div id=sidebar-sidebar-6-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/agg_functions/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../query_language/agg_functions/reference/ title="Function reference" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Function reference</a> <a href=../../query_language/agg_functions/combinators/ title="Aggregate function combinators" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Aggregate function combinators</a> <a href=../../query_language/agg_functions/parametric_functions/ title="Parametric aggregate functions" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Parametric aggregate functions</a> </nav> </div> <a href=#sidebar-sidebar-6-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-10 title="Table functions" class="nav-link text-light text-wrap dropdown-toggle px-0">Table functions</a> <div id=sidebar-sidebar-6-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/table_functions/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../query_language/table_functions/file/ title=file class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a> <a href=../../query_language/table_functions/merge/ title=merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a> <a href=../../query_language/table_functions/numbers/ title=numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a> <a href=../../query_language/table_functions/remote/ title=remote class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote</a> <a href=../../query_language/table_functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../query_language/table_functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../query_language/table_functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../query_language/table_functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> </nav> </div> <a href=#sidebar-sidebar-6-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-11 title=Dictionaries class="nav-link text-light text-wrap dropdown-toggle px-0">Dictionaries</a> <div id=sidebar-sidebar-6-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/dicts/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=#sidebar-sidebar-6-11-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-11-2 title="External dictionaries" class="nav-link text-light text-wrap dropdown-toggle px-0">External dictionaries</a> <div id=sidebar-sidebar-6-11-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/dicts/external_dicts/ title="General description" class="nav-link text-light text-wrap d-inline-block w-100 px-0">General description</a> <a href=../../query_language/dicts/external_dicts_dict/ title="Configuring an external dictionary" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Configuring an external dictionary</a> <a href=../../query_language/dicts/external_dicts_dict_layout/ title="Storing dictionaries in memory" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Storing dictionaries in memory</a> <a href=../../query_language/dicts/external_dicts_dict_lifetime/ title="Dictionary updates" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary updates</a> <a href=../../query_language/dicts/external_dicts_dict_sources/ title="Sources of external dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Sources of external dictionaries</a> <a href=../../query_language/dicts/external_dicts_dict_structure/ title="Dictionary key and fields" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary key and fields</a> </nav> </div> <a href=../../query_language/dicts/internal_dicts/ title="Internal dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Internal dictionaries</a> </nav> </div> <a href=../../query_language/operators/ title=Operators class="nav-link text-light text-wrap d-inline-block w-100 px-0">Operators</a> <a href=../../query_language/syntax/ title="General syntax" class="nav-link text-light text-wrap d-inline-block w-100 px-0">General syntax</a> </nav> </div> <a href=#sidebar-sidebar-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7 title=运维 class="nav-link text-light text-wrap dropdown-toggle px-0">运维</a> <div id=sidebar-sidebar-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../operations/requirements/ title=Requirements class="nav-link text-light text-wrap d-inline-block w-100 px-0">Requirements</a> <a href=../../operations/monitoring/ title=Monitoring class="nav-link text-light text-wrap d-inline-block w-100 px-0">Monitoring</a> <a href=../../operations/troubleshooting/ title=Troubleshooting class="nav-link text-light text-wrap d-inline-block w-100 px-0">Troubleshooting</a> <a href=../../operations/tips/ title="Usage recommendations" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Usage recommendations</a> <a href=../../operations/update/ title="ClickHouse Update" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse Update</a> <a href=../../operations/access_rights/ title="Access rights" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Access rights</a> <a href=../../operations/backup/ title="Data backup" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Data backup</a> <a href=../../operations/configuration_files/ title="Configuration files" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Configuration files</a> <a href=../../operations/quotas/ title=Quotas class="nav-link text-light text-wrap d-inline-block w-100 px-0">Quotas</a> <a href=../../operations/system_tables/ title="System tables" class="nav-link text-light text-wrap d-inline-block w-100 px-0">System tables</a> <a href=#sidebar-sidebar-7-12 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-12 title="Server configuration parameters" class="nav-link text-light text-wrap dropdown-toggle px-0">Server configuration parameters</a> <div id=sidebar-sidebar-7-12 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/server_settings/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../operations/server_settings/settings/ title="Server settings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Server settings</a> </nav> </div> <a href=#sidebar-sidebar-7-13 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-13 title=Settings class="nav-link text-light text-wrap dropdown-toggle px-0">Settings</a> <div id=sidebar-sidebar-7-13 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/settings/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../operations/settings/permissions_for_queries/ title="Permissions for queries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Permissions for queries</a> <a href=../../operations/settings/query_complexity/ title="Restrictions on query complexity" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Restrictions on query complexity</a> <a href=../../operations/settings/settings/ title=Settings class="nav-link text-light text-wrap d-inline-block w-100 px-0">Settings</a> <a href=../../operations/settings/settings_profiles/ title="Settings profiles" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Settings profiles</a> <a href=../../operations/settings/settings_users/ title="User Settings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">User Settings</a> <a href=../../operations/settings/constraints_on_settings/ title="Constraints on Settings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Constraints on Settings</a> </nav> </div> <a href=#sidebar-sidebar-7-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-14 title=Utilities class="nav-link text-light text-wrap dropdown-toggle px-0">Utilities</a> <div id=sidebar-sidebar-7-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/utils/ title=Overview class="nav-link text-light text-wrap d-inline-block w-100 px-0">Overview</a> <a href=../../operations/utils/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../operations/utils/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=常见问题 class="nav-link text-light text-wrap dropdown-toggle px-0">常见问题</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../faq/general/ title=一般的问题 class="nav-link text-light text-wrap d-inline-block w-100 px-0">一般的问题</a> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title=开发者指南 class="nav-link text-light text-wrap dropdown-toggle px-0">开发者指南</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../development/architecture/ title=ClickHouse架构概述 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse架构概述</a> <a href=../../development/build/ title=如何在Linux中编译ClickHouse class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何在Linux中编译ClickHouse</a> <a href=../../development/build_osx/ title="如何在Mac OS X中编译ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何在Mac OS X中编译ClickHouse</a> <a href=../../development/style/ title=如何编写C++代码 class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何编写C++代码</a> <a href=../../development/tests/ title=如何运行ClickHouse测试 class="nav-link text-white active text-wrap d-inline-block w-100 px-0">如何运行ClickHouse测试</a> <a href=../../development/contrib/ title=使用的第三方库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">使用的第三方库</a> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title=新功能特性 class="nav-link text-light text-wrap dropdown-toggle px-0">新功能特性</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../roadmap/ title=路线图 class="nav-link text-light text-wrap d-inline-block w-100 px-0">路线图</a> <a href=../../changelog/ title=更新日志 class="nav-link text-light text-wrap d-inline-block w-100 px-0">更新日志</a> <a href=../../security_changelog/ title=安全更改日志 class="nav-link text-light text-wrap d-inline-block w-100 px-0">安全更改日志</a> </nav> </div> <a href=../../single/clickhouse_zh.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt=PDF版本 title=PDF版本 height=24 class="d-block mr-1 float-left"><div>PDF版本</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-5"> <div id=content> <h1 id=clickhouse-ce-shi>ClickHouse 测试<a class=headerlink href=#clickhouse-ce-shi title="Permanent link">&para;</a></h1> <h2 id=gong-neng-xing-ce-shi>功能性测试<a class=headerlink href=#gong-neng-xing-ce-shi title="Permanent link">&para;</a></h2> <p>功能性测试是最简便使用的。绝大部分 ClickHouse 的功能可以通过功能性测试来测试，任何代码的更改都必须通过该测试。</p> <p>每个功能测试会向正在运行的 ClickHouse服 务器发送一个或多个查询，并将结果与预期结果进行比较。</p> <p>测试用例在 <code>dbms/src/tests/queries</code> 目录中。这里有两个子目录：<code>stateless</code> 和 <code>stateful</code>目录。 无状态的测试无需预加载测试数据集 - 通常是在测试运行期间动态创建小量的数据集。有状态测试需要来自 Yandex.Metrica 的预加载测试数据，而不向一般公众提供。 我们倾向于仅使用“无状态”测试并避免添加新的“有状态”测试。</p> <p>每个测试用例可以是两种类型之一：<code>.sql</code> 和 <code>.sh</code>。<code>.sql</code> 测试文件是用于管理<code>clickhouse-client --multiquery --testmode</code>的简单SQL脚本。<code>.sh</code> 测试文件是一个可以自己运行的脚本。</p> <p>要运行所有测试，请使用 <code>dbms/tests/clickhouse-test</code> 工具，用 <code>--help</code> 可以获取所有的选项列表。您可以简单地运行所有测试或运行测试名称中的子字符串过滤的测试子集：<code>./clickhouse-test substring</code>。</p> <p>调用功能测试最简单的方法是将 <code>clickhouse-client</code> 复制到<code>/usr/bin/</code>，运行<code>clickhouse-server</code>，然后从自己的目录运行<code>./ clickhouse-test</code>。</p> <p>要添加新测试，请在 <code>dbms/src/tests/queries/0_stateless</code> 目录内添加新的 <code>.sql</code> 或 <code>.sh</code> 文件，手动检查，然后按以下方式生成 <code>.reference</code> 文件： <code>clickhouse-client -n --testmode &lt; 00000_test.sql &gt; 00000_test.reference</code> or <code>./00000_test.sh &gt; ./00000_test.reference</code>。</p> <p>测试应该只使用（创建，删除等）<code>test</code> 数据库中的表，这些表假定是事先创建的; 测试也可以使用临时表。</p> <p>如果要在功能测试中使用分布式查询，可以利用 <code>remote</code> 表函数和 <code>127.0.0.{1..2}</code> 地址为服务器查询自身; 或者您可以在服务器配置文件中使用预定义的测试集群，例如<code>test_shard_localhost</code>。</p> <p>有些测试在名称中标有 <code>zookeeper</code>，<code>shard</code> 或 <code>long</code>。<code>zookeeper</code> 用于使用ZooKeeper的测试; <code>shard</code> 用于需要服务器监听<code>127.0.0.*</code>的测试。<code>long</code> 适用于运行时间稍长一秒的测试。</p> <h2 id=yi-zhi-de-bug>已知的bug<a class=headerlink href=#yi-zhi-de-bug title="Permanent link">&para;</a></h2> <p>如果我们知道一些可以通过功能测试轻松复制的错误，我们将准备好的功能测试放在 <code>dbms/src/tests/queries/bugs</code> 目录中。当修复错误时，这些测试将被移动到 <code>dbms/src/tests/queries/0_stateless</code> 目录中。</p> <h2 id=ji-cheng-ce-shi>集成测试<a class=headerlink href=#ji-cheng-ce-shi title="Permanent link">&para;</a></h2> <p>集成测试允许在集群配置中测试 ClickHouse，并与其他服务器（如MySQL，Postgres，MongoDB）进行 ClickHouse 交互。它们可用于模拟网络拆分，数据包丢弃等。这些测试在Docker 下运行，并使用各种软件创建多个容器。</p> <p>参考 <code>dbms/tests/integration/README.md</code> 文档关于如何使用集成测试。</p> <p>请注意，ClickHouse 与第三方驱动程序的集成未经过测试。此外，我们目前还没有与 JDBC 和ODBC 驱动程序进行集成测试。</p> <h2 id=dan-yuan-ce-shi>单元测试<a class=headerlink href=#dan-yuan-ce-shi title="Permanent link">&para;</a></h2> <p>当您想要测试整个 ClickHouse，而不是单个独立的库或类时，单元测试非常有用。您可以使用<code>ENABLE_TESTS</code> CMake 选项启用或禁用测试构建。单元测试（和其他测试程序）位于代码中的<code>tests</code> 子目录中。要运行单元测试，请键入 <code>ninja test</code>。有些测试使用 <code>gtest</code>，但有些只是在测试失败时返回非零状态码。</p> <p>如果代码已经被功能测试覆盖（并且功能测试通常使用起来要简单得多），则不一定要进行单元测试。</p> <h2 id=xing-neng-ce-shi>性能测试<a class=headerlink href=#xing-neng-ce-shi title="Permanent link">&para;</a></h2> <p>性能测试允许测量和比较综合查询中 ClickHouse 的某些独立部分的性能。测试位于<code>dbms/tests/performance</code> 目录中。每个测试都由 <code>.xml</code> 文件表示，并附有测试用例的描述。使用 <code>clickhouse performance-test</code> 工具（嵌入在 <code>clickhouse</code> 二进制文件中）运行测试。请参阅 <code>--help</code> 以进行调用。</p> <p>每个测试在循环中运行一个或多个查询（可能带有参数组合），并具有一些停止条件（如“最大执行速度不会在三秒内更改”）并测量一些有关查询性能的指标（如“最大执行速度”））。某些测试可以包含预加载的测试数据集的前提条件。</p> <p>如果要在某些情况下提高 ClickHouse 的性能，并且如果可以在简单查询上观察到改进，则强烈建议编写性能测试。在测试过程中使用 <code>perf top</code> 或其他 perf 工具总是有意义的。</p> <p>性能测试不是基于每个提交运行的。不收集性能测试结果，我们手动比较它们。</p> <h2 id=ce-shi-gong-ju-he-jiao-ben>测试工具和脚本<a class=headerlink href=#ce-shi-gong-ju-he-jiao-ben title="Permanent link">&para;</a></h2> <p><code>tests</code>目录中的一些程序不是准备测试，而是测试工具。例如，对于<code>Lexer</code>，有一个工具<code>dbms/src/Parsers/tests/lexer</code> 标准输出。您可以使用这些工具作为代码示例以及探索和手动测试。</p> <p>您还可以将一对文件 <code>.sh</code> 和 <code>.reference</code> 与工具放在一些预定义的输入上运行它 - 然后可以将脚本结果与 <code>.reference</code> 文件进行比较。这些测试不是自动化的。</p> <h2 id=za-xiang-ce-shi>杂项测试<a class=headerlink href=#za-xiang-ce-shi title="Permanent link">&para;</a></h2> <p>有一些外部字典的测试位于 <code>dbms/tests/external_dictionaries</code>，机器学习模型在<code>dbms/tests/external_models</code>目录。这些测试未更新，必须转移到集成测试。</p> <p>对于分布式数据的插入，有单独的测试。此测试在单独的服务器上运行 ClickHouse 集群并模拟各种故障情况：网络拆分，数据包丢弃（ClickHouse 节点之间，ClickHouse 和 ZooKeeper之间，ClickHouse 服务器和客户端之间等），进行 <code>kill -9</code>，<code>kill -STOP</code> 和<code>kill -CONT</code> 等操作，类似<a href=https://aphyr.com/tags/Jepsen rel="external nofollow noreferrer">Jepsen</a>。然后，测试检查是否已写入所有已确认的插入，并且所有已拒绝的插入都未写入。</p> <p>在 ClickHouse 开源之前，分布式测试是由单独的团队编写的，但该团队不再使用 ClickHouse，测试是在 Java 中意外编写的。由于这些原因，必须重写分布式测试并将其移至集成测试。</p> <h2 id=shou-dong-ce-shi>手动测试<a class=headerlink href=#shou-dong-ce-shi title="Permanent link">&para;</a></h2> <p>当您开发了新的功能，做手动测试也是合理的。可以按照以下步骤来进行：</p> <p>编译 ClickHouse。在命令行中运行 ClickHouse：进入 <code>dbms/src/programs/clickhouse-server</code> 目录并运行 <code>./clickhouse-server</code>。它会默认使用当前目录的配置文件 (<code>config.xml</code>， <code>users.xml</code> 以及在 <code>config.d</code> 和 <code>users.d</code> 目录的文件)。可以使用 <code>dbms/src/programs/clickhouse-client/clickhouse-client</code> 来连接数据库。</p> <p>或者，您可以安装 ClickHouse 软件包：从 Yandex 存储库中获得稳定版本，或者您可以在ClickHouse源根目录中使用 <code>./release</code> 构建自己的软件包。然后使用 <code>sudo service clickhouse-server start</code> 启动服务器（或停止服务器）。在 <code>/etc/clickhouse-server/clickhouse-server.log</code> 中查找日志。</p> <p>当您的系统上已经安装了 ClickHouse 时，您可以构建一个新的 <code>clickhouse</code> 二进制文件并替换现有的二进制文件：</p> <div class=codehilite><pre><span></span><code><span class=err>sudo service clickhouse-server stop</span>
<span class=err>sudo cp ./clickhouse /usr/bin/</span>
<span class=err>sudo service clickhouse-server start</span>
</code></pre></div> <p>您也可以停止 clickhouse-server 并使用相同的配置运行您自己的服务器，日志打印到终端：</p> <div class=codehilite><pre><span></span><code><span class=err>sudo service clickhouse-server stop</span>
<span class=err>sudo -u clickhouse /usr/bin/clickhouse server --config-file /etc/clickhouse-server/config.xml</span>
</code></pre></div> <p>使用 gdb 的一个示例:</p> <div class=codehilite><pre><span></span><code><span class=err>sudo -u clickhouse gdb --args /usr/bin/clickhouse server --config-file /etc/clickhouse-server/config.xml</span>
</code></pre></div> <p>如果 clickhouse-server 已经运行并且您不想停止它，您可以更改 <code>config.xml</code> 中的端口号（或在 <code>config.d</code> 目录中的文件中覆盖它们），配置适当的数据路径，然后运行它。</p> <p><code>clickhouse</code> 二进制文件几乎没有依赖关系，适用于各种 Linux 发行版。要快速地测试服务器上的更改，您可以简单地将新建的 <code>clickhouse</code> 二进制文件 <code>scp</code> 到其他服务器，然后按照上面的示例运行它。</p> <h2 id=ce-shi-huan-jing>测试环境<a class=headerlink href=#ce-shi-huan-jing title="Permanent link">&para;</a></h2> <p>在将版本发布为稳定之前，我们将其部署在测试环境中 测试环境是一个处理[Yandex.Metrica]（<a href=https://metrica.yandex.com/ >https://metrica.yandex.com/</a>）总数据的1/39部分大小的集群。 我们与 Yandex.Metrica 团队公用我们的测试环境。ClickHouse 在现有数据的基础上无需停机即可升级。 我们首先看到数据处理成功而不会实时滞后，复制继续工作，并且 Yandex.Metrica 团队无法看到问题。 首先的检查可以通过以下方式完成：</p> <div class=codehilite><pre><span></span><code><span class=err>SELECT hostName() AS h, any(version()), any(uptime()), max(UTCEventTime), count() FROM remote(&#39;example01-01-{1..3}t&#39;, merge, hits) WHERE EventDate &gt;= today() - 2 GROUP BY h ORDER BY h;</span>
</code></pre></div> <p>在某些情况下，我们还部署到 Yandex 的合作团队的测试环境：市场，云等。此外，我们还有一些用于开发目的的硬件服务器。</p> <h2 id=fu-zai-ce-shi>负载测试<a class=headerlink href=#fu-zai-ce-shi title="Permanent link">&para;</a></h2> <p>部署到测试环境后，我们使用生产群集中的查询运行负载测试。 这是手动完成的。</p> <p>确保在生产集群中开启了 <code>query_log</code> 选项。</p> <p>收集一天或更多的查询日志：</p> <div class=codehilite><pre><span></span><code><span class=err>clickhouse-client --query=&quot;SELECT DISTINCT query FROM system.query_log WHERE event_date = today() AND query LIKE &#39;%ym:%&#39; AND query NOT LIKE &#39;%system.query_log%&#39; AND type = 2 AND is_initial_query&quot; &gt; queries.tsv</span>
</code></pre></div> <p>这是一个复杂的例子。<code>type = 2</code> 将过滤成功执行的查询。<code>query LIKE'％ym：％'</code> 用于从 Yandex.Metrica 中选择相关查询。<code>is_initial_query</code> 是仅选择由客户端发起的查询，而不是由 ClickHouse 本身（作为分布式查询处理的一部分）。</p> <p><code>scp</code> 这份日志到测试机器，并运行以下操作：</p> <div class=codehilite><pre><span></span><code><span class=err>clickhouse benchmark --concurrency 16 &lt; queries.tsv</span>
</code></pre></div> <p>(可能你需要指定运行的用户 <code>--user</code>)</p> <p>然后离开它一晚或周末休息一下。</p> <p>你要检查下 <code>clickhouse-server</code> 是否崩溃，内存占用是否合理，性能也不会随着时间的推移而降低。</p> <p>由于查询和环境的高度可变性，不会记录精确的查询执行时序并且不进行比较。</p> <h2 id=bian-yi-ce-shi>编译测试<a class=headerlink href=#bian-yi-ce-shi title="Permanent link">&para;</a></h2> <p>构建测试允许检查构建在各种替代配置和某些外部系统上是否被破坏。测试位于<code>ci</code>目录。 它们从 Docker，Vagrant 中的源代码运行构建，有时在 Docker 中运行 <code>qemu-user-static</code>。这些测试正在开发中，测试运行不是自动化的。</p> <p>动机：</p> <p>通常我们会在 ClickHouse 构建的单个版本上发布并运行所有测试。 但是有一些未经过彻底测试的替代构建版本。 例子：</p> <ul> <li>在 FreeBSD 中的构建；</li> <li>在 Debian 中使用系统包中的库进行构建；</li> <li>使用库的共享链接构建；</li> <li>在 AArch64 平台进行构建。</li> </ul> <p>例如，使用系统包构建是不好的做法，因为我们无法保证系统具有的确切版本的软件包。但 Debian 维护者确实需要这样做。出于这个原因，我们至少必须支持这种构建。另一个例子：共享链接是一个常见的麻烦来源，但是对于一些爱好者来说需要它。</p> <p>虽然我们无法对所有构建版本运行所有测试，但我们想要检查至少不会破坏各种构建变体。为此，我们使用构建测试。</p> <h2 id=ce-shi-xie-yi-jian-rong-xing>测试协议兼容性<a class=headerlink href=#ce-shi-xie-yi-jian-rong-xing title="Permanent link">&para;</a></h2> <p>当我们扩展 ClickHouse 网络协议时，我们手动测试旧的 clickhouse-client 与新的 clickhouse-server 和新的clickhouse-client 一起使用旧的 clickhouse-server (只需从相应的包中运行二进制文件)</p> <h2 id=lai-zi-bian-yi-qi-de-bang-zhu>来自编译器的帮助<a class=headerlink href=#lai-zi-bian-yi-qi-de-bang-zhu title="Permanent link">&para;</a></h2> <p>ClickHouse 主要的代码 (位于<code>dbms</code>目录中) 使用 <code>-Wall -Wextra -Werror</code> 构建，并带有一些其他已启用的警告。 虽然没有为第三方库启用这些选项。</p> <p>Clang 有更多有用的警告 - 您可以使用 <code>-Weverything</code> 查找它们并选择默认构建的东西。</p> <p>对于生产构建，使用 gcc（它仍然生成比 clang 稍高效的代码）。对于开发来说，clang 通常更方便使用。您可以使用调试模式在自己的机器上构建（以节省笔记本电脑的电量），但请注意，由于更好的控制流程和过程分析，编译器使用 <code>-O3</code> 会生成更多警告。 当使用 clang 构建时，使用 <code>libc++</code> 而不是 <code>libstdc++</code>，并且在使用调试模式构建时，使用调试版本的 <code>libc++</code>，它允许在运行时捕获更多错误。</p> <h2 id=sanitizers>Sanitizers<a class=headerlink href=#sanitizers title="Permanent link">&para;</a></h2> <p><strong>Address sanitizer</strong>.<br> 我们在每个提交的基础上在 ASan 下运行功能和集成测试。</p> <p><strong>Valgrind (Memcheck)</strong>.<br> 我们在 Valgrind 过夜进行功能测试。 这需要几个小时。 目前在 <code>re2</code> 库中有一个已知的误报，请参阅 <a href=https://research.swtch.com/sparse rel="external nofollow noreferrer">文章</a>。</p> <p><strong>Thread sanitizer</strong>.<br> 我们在 TSan 下进行功能测试。ClickHouse 必须通过所有测试。在 TSan 下运行不是自动化的，只是偶尔执行。</p> <p><strong>Memory sanitizer</strong>.<br> 目前我们不使用 MSan。</p> <p><strong>Undefined behaviour sanitizer.</strong><br> 我们仍然不会在每次提交的基础上使用 UBSan。 有一些地方需要解决。</p> <p><strong>Debug allocator.</strong><br> 您可以使用 <code>DEBUG_TCMALLOC</code> CMake 选项启用 <code>tcmalloc</code> 的调试版本。我们在每次提交的基础上使用调试分配器运行测试。</p> <p>更多请参阅 <code>dbms/tests/instructions/sanitizers.txt</code>。</p> <h2 id=mo-hu-ce-shi>模糊测试<a class=headerlink href=#mo-hu-ce-shi title="Permanent link">&para;</a></h2> <p>我们使用简单的模糊测试来生成随机SQL查询并检查服务器是否正常，使用 Address sanitizer 执行模糊测试。你可以在<code>00746_sql_fuzzy.pl</code> 找到它。 测试应连续进行（过夜和更长时间）。</p> <p>截至2018年12月，我们仍然不使用库代码的孤立模糊测试。</p> <h2 id=an-quan-shen-ji>安全审计<a class=headerlink href=#an-quan-shen-ji title="Permanent link">&para;</a></h2> <p>Yandex Cloud 部门的人员从安全角度对 ClickHouse 功能进行了一些基本概述。</p> <h2 id=jing-tai-fen-xi>静态分析<a class=headerlink href=#jing-tai-fen-xi title="Permanent link">&para;</a></h2> <p>我们偶尔使用静态分析。我们已经评估过 <code>clang-tidy</code>， <code>Coverity</code>， <code>cppcheck</code>， <code>PVS-Studio</code>， <code>tscancode</code>。您将在 <code>dbms/tests/instructions/</code> 目录中找到使用说明。你也可以阅读<a href=https://habr.com/company/yandex/blog/342018/ rel="external nofollow noreferrer">俄文文章</a>.</p> <p>如果您使用 <code>CLion</code> 作为 IDE，您可以开箱即用一些 <code>clang-tidy</code> 检查。</p> <h2 id=qi-ta-qiang-hua>其他强化<a class=headerlink href=#qi-ta-qiang-hua title="Permanent link">&para;</a></h2> <p>默认情况下使用 <code>FORTIFY_SOURCE</code>。它几乎没用，但在极少数情况下仍然有意义，我们不会禁用它。</p> <h2 id=dai-ma-feng-ge>代码风格<a class=headerlink href=#dai-ma-feng-ge title="Permanent link">&para;</a></h2> <p>代码风格在<a href=https://clickhouse.yandex/docs/en/development/style/ rel="external nofollow noreferrer">这里</a> 有说明。</p> <p>要检查一些常见的样式冲突，您可以使用 <code>utils/check-style</code> 脚本。</p> <p>为了强制你的代码的正确风格，你可以使用 <code>clang-format</code> 文件。<code>.clang-format</code> 位于源代码根目录， 它主要与我们的实际代码风格对应。但不建议将 <code>clang-format</code> 应用于现有文件，因为它会使格式变得更糟。您可以使用 <code>clang-format-diff</code> 工具，您可以在 clang 源代码库中找到</p> <p>或者，您可以尝试<code>uncrustify</code> 工具来格式化您的代码。配置文件在源代码的根目录中的<code>uncrustify.cfg</code>。它比 <code>clang-format</code> 经过更少的测试。</p> <p><code>CLion</code> 有自己的代码格式化程序，必须调整为我们的代码风格。</p> <h2 id=metrica-b2b-ce-shi>Metrica B2B 测试<a class=headerlink href=#metrica-b2b-ce-shi title="Permanent link">&para;</a></h2> <p>每个 ClickHouse 版本都经过 Yandex Metrica 和 AppMetrica 引擎的测试。测试和稳定版本的 ClickHouse 部署在虚拟机上，并使用处理输入数据固定样本的度量引擎的小副本运行。 将度量引擎的两个实例的结果一起进行比较</p> <p>这些测试是由单独的团队自动完成的。由于移动部件的数量很多，大部分时间的测试都是完全无关的，很难弄清楚。很可能这些测试对我们来说是负值。然而，这些测试被证明是有用的大约一个或两个倍的数百。</p> <h2 id=ce-shi-fu-gai-lu>测试覆盖率<a class=headerlink href=#ce-shi-fu-gai-lu title="Permanent link">&para;</a></h2> <p>截至2018年7月，我们不会跟踪测试复盖率。</p> <h2 id=zi-dong-hua-ce-shi>自动化测试<a class=headerlink href=#zi-dong-hua-ce-shi title="Permanent link">&para;</a></h2> <p>我们使用 Yandex 内部 CI 和名为"沙箱"的作业自动化系统运行测试。 我们还继续使用 Jenkins（可在Yandex内部使用）。</p> <p>构建作业和测试在沙箱中按每次提交的基础上运行。结果包和测试结果发布在 GitHub 上，可以通过直接链接下载，结果会被永久存储。当您在 GitHub 上发送拉取请求时，我们将其标记为"可以测试"，我们的 CI 系统将为您构建 ClickHouse 包（发布，调试，地址消除等）。</p> <p>由于时间和计算能力的限制，我们不使用 Travis CI。</p> <p>在 Jenkins，我们运行字典测试，指标B2B测试。 我们使用 Jenkins 来准备和发布版本。 Jenkins是一种传统的技术，所有的工作将被转移到沙箱中。</p> </div> <div id=content-footer class="text-muted pt-5"> <div class=float-right>©2016–2020 Yandex LLC</div> <div>建于 <a href=https://github.com/ClickHouse/ClickHouse/commit/23e757bcb79e11756e72134fdf037052a0b295b5 rel="external nofollow noreferrer" target=_blank class=text-reset>23e757bcb7</a></div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>目录</label> <a href=#gong-neng-xing-ce-shi title=功能性测试 class="nav-link text-wrap d-inline-block w-100"> 功能性测试 </a> <a href=#yi-zhi-de-bug title=已知的bug class="nav-link text-wrap d-inline-block w-100"> 已知的bug </a> <a href=#ji-cheng-ce-shi title=集成测试 class="nav-link text-wrap d-inline-block w-100"> 集成测试 </a> <a href=#dan-yuan-ce-shi title=单元测试 class="nav-link text-wrap d-inline-block w-100"> 单元测试 </a> <a href=#xing-neng-ce-shi title=性能测试 class="nav-link text-wrap d-inline-block w-100"> 性能测试 </a> <a href=#ce-shi-gong-ju-he-jiao-ben title=测试工具和脚本 class="nav-link text-wrap d-inline-block w-100"> 测试工具和脚本 </a> <a href=#za-xiang-ce-shi title=杂项测试 class="nav-link text-wrap d-inline-block w-100"> 杂项测试 </a> <a href=#shou-dong-ce-shi title=手动测试 class="nav-link text-wrap d-inline-block w-100"> 手动测试 </a> <a href=#ce-shi-huan-jing title=测试环境 class="nav-link text-wrap d-inline-block w-100"> 测试环境 </a> <a href=#fu-zai-ce-shi title=负载测试 class="nav-link text-wrap d-inline-block w-100"> 负载测试 </a> <a href=#bian-yi-ce-shi title=编译测试 class="nav-link text-wrap d-inline-block w-100"> 编译测试 </a> <a href=#ce-shi-xie-yi-jian-rong-xing title=测试协议兼容性 class="nav-link text-wrap d-inline-block w-100"> 测试协议兼容性 </a> <a href=#lai-zi-bian-yi-qi-de-bang-zhu title=来自编译器的帮助 class="nav-link text-wrap d-inline-block w-100"> 来自编译器的帮助 </a> <a href=#sanitizers title=Sanitizers class="nav-link text-wrap d-inline-block w-100"> Sanitizers </a> <a href=#mo-hu-ce-shi title=模糊测试 class="nav-link text-wrap d-inline-block w-100"> 模糊测试 </a> <a href=#an-quan-shen-ji title=安全审计 class="nav-link text-wrap d-inline-block w-100"> 安全审计 </a> <a href=#jing-tai-fen-xi title=静态分析 class="nav-link text-wrap d-inline-block w-100"> 静态分析 </a> <a href=#qi-ta-qiang-hua title=其他强化 class="nav-link text-wrap d-inline-block w-100"> 其他强化 </a> <a href=#dai-ma-feng-ge title=代码风格 class="nav-link text-wrap d-inline-block w-100"> 代码风格 </a> <a href=#metrica-b2b-ce-shi title="Metrica B2B 测试" class="nav-link text-wrap d-inline-block w-100"> Metrica B2B 测试 </a> <a href=#ce-shi-fu-gai-lu title=测试覆盖率 class="nav-link text-wrap d-inline-block w-100"> 测试覆盖率 </a> <a href=#zi-dong-hua-ce-shi title=自动化测试 class="nav-link text-wrap d-inline-block w-100"> 自动化测试 </a> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?7bd05efd></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>