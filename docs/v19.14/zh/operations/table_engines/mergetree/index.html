<!DOCTYPE html><html lang=zh data-version=v19.14 data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>MergeTree - ClickHouse文档 v19.14</title><link rel="shortcut icon" href=/favicon.ico><meta property=og:title content="MergeTree - ClickHouse文档 v19.14"><meta property=og:description content="MergeTree Clickhouse 中最强大的表引擎当属 MergeTree （合并树）引擎及该系列（*MergeTree）中的其他引擎。 MergeTree 引擎系列的基本理念如下。当你有巨量数据要插入到表中，你要高效地一批批写入数"><meta property=og:type content=website><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta property=twitter:title content="MergeTree - ClickHouse文档 v19.14"><meta name=description content="MergeTree Clickhouse 中最强大的表引擎当属 MergeTree （合并树）引擎及该系列（*MergeTree）中的其他引擎。 MergeTree 引擎系列的基本理念如下。当你有巨量数据要插入到表中，你要高效地一批批写入数"><meta name=keywords content="ClickHouse, DBMS, OLAP, relational, analytics, analytical, big data, open-source, SQL, web-analytics"><link href=/css/base.css?1d858e50 media=all rel=stylesheet></head> <body dir=ltr data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> MergeTree </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li class=nav-item> <a href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/zh/operations/table_engines/mergetree.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/zh.svg alt=中文 title=中文 width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/v19.14/en/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/v19.14/zh/operations/table_engines/mergetree/ class="dropdown-item disabled"> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/v19.14/es/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/es.svg alt title width=32 class="d-inline-block mr-2">Español </a> <a href=/docs/v19.14/fr/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/fr.svg alt title width=32 class="d-inline-block mr-2">Français </a> <a href=/docs/v19.14/ru/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/v19.14/ja/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> <a href=/docs/v19.14/fa/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/fa.svg alt title width=32 class="d-inline-block mr-2">فارسی </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class=container-fluid> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label=多页或单页> <a href=../../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt=多页版本 title=多页版本> </a> <a href=../../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt=单页版本 title=单页版本> </a> </div> <div class="dropdown mb-3"> <a class="btn btn-dark dropdown-toggle text-muted" href=# role=button id=select-version data-toggle=dropdown aria-haspopup=true aria-expanded=false> 版本: <span class=text-light>v19.14</span> </a> <div class="dropdown-menu bg-dark text-muted p-1" aria-labelledby=select-version> <a href=/docs/zh/ class=dropdown-item> <span class=text-light>最新消息</span> </a> <a href=/docs/v20.3/zh/ class=dropdown-item>v20.3</a> <a href=/docs/v20.1/zh/ class=dropdown-item>v20.1</a> <a href=/docs/v19.17/zh/ class=dropdown-item>v19.17</a> <a href=/docs/v19.16/zh/ class=dropdown-item>v19.16</a> <a href=/docs/v19.15/zh/ class=dropdown-item>v19.15</a> <a href=/docs/v19.14/zh/ class="dropdown-item disable">v19.14</a> <a href=/docs/v19.13/zh/ class=dropdown-item>v19.13</a> <a href=/docs/v19.11/zh/ class=dropdown-item>v19.11</a> <a href=/docs/v19.10/zh/ class=dropdown-item>v19.10</a> <a href=/docs/v19.9/zh/ class=dropdown-item>v19.9</a> <a href=/docs/v19.8/zh/ class=dropdown-item>v19.8</a> </div> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=介绍 class="nav-link text-light text-wrap dropdown-toggle px-0">介绍</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../ title=概貌 class="nav-link text-light text-wrap d-inline-block w-100 px-0">概貌</a> <a href=../../../introduction/distinctive_features/ title=ClickHouse的独特功能 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse的独特功能</a> <a href=../../../introduction/features_considered_disadvantages/ title=ClickHouse功能可被视为缺点 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse功能可被视为缺点</a> <a href=../../../introduction/performance/ title=性能 class="nav-link text-light text-wrap d-inline-block w-100 px-0">性能</a> <a href=../../../introduction/ya_metrika_task/ title=Yandex.Metrica使用案例 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Yandex.Metrica使用案例</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title=入门指南 class="nav-link text-light text-wrap dropdown-toggle px-0">入门指南</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../getting_started/ title=部署运行 class="nav-link text-light text-wrap d-inline-block w-100 px-0">部署运行</a> <a href=#sidebar-sidebar-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-2 title=示例数据集 class="nav-link text-light text-wrap dropdown-toggle px-0">示例数据集</a> <div id=sidebar-sidebar-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../getting_started/example_datasets/ontime/ title=航班飞行数据 class="nav-link text-light text-wrap d-inline-block w-100 px-0">航班飞行数据</a> <a href=../../../getting_started/example_datasets/nyc_taxi/ title=纽约市出租车数据 class="nav-link text-light text-wrap d-inline-block w-100 px-0">纽约市出租车数据</a> <a href=../../../getting_started/example_datasets/amplab_benchmark/ title=AMPLab大数据基准测试 class="nav-link text-light text-wrap d-inline-block w-100 px-0">AMPLab大数据基准测试</a> <a href=../../../getting_started/example_datasets/wikistat/ title=维基访问数据 class="nav-link text-light text-wrap d-inline-block w-100 px-0">维基访问数据</a> <a href=../../../getting_started/example_datasets/criteo/ title="Criteo TB级别点击日志" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Criteo TB级别点击日志</a> <a href=../../../getting_started/example_datasets/star_schema/ title="Star Schema基准测试" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Star Schema基准测试</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=客户端 class="nav-link text-light text-wrap dropdown-toggle px-0">客户端</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../interfaces/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../interfaces/cli/ title=命令行客户端接口 class="nav-link text-light text-wrap d-inline-block w-100 px-0">命令行客户端接口</a> <a href=../../../interfaces/tcp/ title="原生客户端接口 (TCP)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">原生客户端接口 (TCP)</a> <a href=../../../interfaces/http/ title="HTTP 客户端接口" class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP 客户端接口</a> <a href=../../../interfaces/formats/ title=输入输出格式 class="nav-link text-light text-wrap d-inline-block w-100 px-0">输入输出格式</a> <a href=../../../interfaces/jdbc/ title="JDBC 驱动" class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC 驱动</a> <a href=../../../interfaces/odbc/ title="ODBC 驱动" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC 驱动</a> <a href=#sidebar-sidebar-3-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-8 title=第三方 class="nav-link text-light text-wrap dropdown-toggle px-0">第三方</a> <div id=sidebar-sidebar-3-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../interfaces/third-party/client_libraries/ title=客户端库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">客户端库</a> <a href=../../../interfaces/third-party/integrations/ title=集成 class="nav-link text-light text-wrap d-inline-block w-100 px-0">集成</a> <a href=../../../interfaces/third-party/gui/ title=可视界面 class="nav-link text-light text-wrap d-inline-block w-100 px-0">可视界面</a> <a href=../../../interfaces/third-party/proxy/ title=代理 class="nav-link text-light text-wrap d-inline-block w-100 px-0">代理</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title=数据类型 class="nav-link text-light text-wrap dropdown-toggle px-0">数据类型</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../data_types/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../data_types/int_uint/ title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</a> <a href=../../../data_types/float/ title="Float32, Float64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32, Float64</a> <a href=../../../data_types/decimal/ title=Decimal class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal</a> <a href=../../../data_types/boolean/ title="Boolean values" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Boolean values</a> <a href=../../../data_types/string/ title=String class="nav-link text-light text-wrap d-inline-block w-100 px-0">String</a> <a href=../../../data_types/fixedstring/ title=FixedString(N) class="nav-link text-light text-wrap d-inline-block w-100 px-0">FixedString(N)</a> <a href=../../../data_types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../../data_types/date/ title=Date class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date</a> <a href=../../../data_types/datetime/ title=DateTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime</a> <a href=../../../data_types/enum/ title=Enum class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum</a> <a href=../../../data_types/array/ title=Array(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Array(T)</a> <a href=../../../data_types/nested_data_structures/aggregatefunction/ title="AggregateFunction(name, types_of_arguments...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction(name, types_of_arguments...)</a> <a href=../../../data_types/tuple/ title="Tuple(T1, T2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, ...)</a> <a href=../../../data_types/nullable/ title=Nullable class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable</a> <a href=#sidebar-sidebar-4-16 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-16 title=嵌套数据结构 class="nav-link text-light text-wrap dropdown-toggle px-0">嵌套数据结构</a> <div id=sidebar-sidebar-4-16 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../data_types/nested_data_structures/nested/ title="Nested(Name1 Type1, Name2 Type2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, ...)</a> </nav> </div> <a href=#sidebar-sidebar-4-17 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-17 title=特殊数据类型 class="nav-link text-light text-wrap dropdown-toggle px-0">特殊数据类型</a> <div id=sidebar-sidebar-4-17 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../data_types/special_data_types/expression/ title=Expression class="nav-link text-light text-wrap d-inline-block w-100 px-0">Expression</a> <a href=../../../data_types/special_data_types/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../../data_types/special_data_types/nothing/ title=Nothing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nothing</a> </nav> </div> <a href=#sidebar-sidebar-4-18 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-18 title=Domain类型 class="nav-link text-light text-wrap dropdown-toggle px-0">Domain类型</a> <div id=sidebar-sidebar-4-18 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../data_types/domains/overview/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../data_types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../../data_types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title=数据库引擎 class="nav-link text-light text-wrap dropdown-toggle px-0">数据库引擎</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../database_engines/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../database_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> </nav> </div> <a href=#sidebar-sidebar-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6 title=表引擎 class="nav-link text-light text-wrap dropdown-toggle px-0">表引擎</a> <div id=sidebar-sidebar-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/table_engines/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=#sidebar-sidebar-6-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-2 title=MergeTree class="nav-link text-light text-wrap dropdown-toggle px-0">MergeTree</a> <div id=sidebar-sidebar-6-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/table_engines/mergetree/ title=MergeTree class="nav-link text-white active text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../../operations/table_engines/replication/ title="Data Replication" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Data Replication</a> <a href=../../../operations/table_engines/custom_partitioning_key/ title="Custom Partitioning Key" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Custom Partitioning Key</a> <a href=../../../operations/table_engines/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../../operations/table_engines/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../../operations/table_engines/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../../operations/table_engines/collapsingmergetree/ title=CollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">CollapsingMergeTree</a> <a href=../../../operations/table_engines/versionedcollapsingmergetree/ title=VersionedCollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">VersionedCollapsingMergeTree</a> <a href=../../../operations/table_engines/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> </nav> </div> <a href=#sidebar-sidebar-6-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-3 title=Log class="nav-link text-light text-wrap dropdown-toggle px-0">Log</a> <div id=sidebar-sidebar-6-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/table_engines/log_family/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../operations/table_engines/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../../operations/table_engines/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../../operations/table_engines/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> </nav> </div> <a href=#sidebar-sidebar-6-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-4 title=外部表引擎 class="nav-link text-light text-wrap dropdown-toggle px-0">外部表引擎</a> <div id=sidebar-sidebar-6-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/table_engines/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../../operations/table_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../../operations/table_engines/jdbc/ title=JDBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC</a> <a href=../../../operations/table_engines/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> </nav> </div> <a href=#sidebar-sidebar-6-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-5 title=其他表引擎 class="nav-link text-light text-wrap dropdown-toggle px-0">其他表引擎</a> <div id=sidebar-sidebar-6-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/table_engines/distributed/ title=Distributed class="nav-link text-light text-wrap d-inline-block w-100 px-0">Distributed</a> <a href=../../../operations/table_engines/external_data/ title="External data" class="nav-link text-light text-wrap d-inline-block w-100 px-0">External data</a> <a href=../../../operations/table_engines/dictionary/ title=Dictionary class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary</a> <a href=../../../operations/table_engines/merge/ title=Merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">Merge</a> <a href=../../../operations/table_engines/file/ title=File class="nav-link text-light text-wrap d-inline-block w-100 px-0">File</a> <a href=../../../operations/table_engines/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../../operations/table_engines/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../../operations/table_engines/join/ title=Join class="nav-link text-light text-wrap d-inline-block w-100 px-0">Join</a> <a href=../../../operations/table_engines/url/ title=URL class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL</a> <a href=../../../operations/table_engines/view/ title=View class="nav-link text-light text-wrap d-inline-block w-100 px-0">View</a> <a href=../../../operations/table_engines/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../../operations/table_engines/memory/ title=Memory class="nav-link text-light text-wrap d-inline-block w-100 px-0">Memory</a> <a href=../../../operations/table_engines/buffer/ title=Buffer class="nav-link text-light text-wrap d-inline-block w-100 px-0">Buffer</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7 title=SQL语法 class="nav-link text-light text-wrap dropdown-toggle px-0">SQL语法</a> <div id=sidebar-sidebar-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/select/ title=SELECT class="nav-link text-light text-wrap d-inline-block w-100 px-0">SELECT</a> <a href=../../../query_language/insert_into/ title="INSERT INTO" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO</a> <a href=../../../query_language/create/ title=CREATE class="nav-link text-light text-wrap d-inline-block w-100 px-0">CREATE</a> <a href=../../../query_language/alter/ title=ALTER class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../../query_language/system/ title=SYSTEM class="nav-link text-light text-wrap d-inline-block w-100 px-0">SYSTEM</a> <a href=../../../query_language/misc/ title=其他类型的查询 class="nav-link text-light text-wrap d-inline-block w-100 px-0">其他类型的查询</a> <a href=#sidebar-sidebar-7-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-8 title=函数 class="nav-link text-light text-wrap dropdown-toggle px-0">函数</a> <div id=sidebar-sidebar-7-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/functions/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../query_language/functions/arithmetic_functions/ title=算术函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">算术函数</a> <a href=../../../query_language/functions/comparison_functions/ title=比较函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">比较函数</a> <a href=../../../query_language/functions/logical_functions/ title=逻辑函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">逻辑函数</a> <a href=../../../query_language/functions/type_conversion_functions/ title=类型转换函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">类型转换函数</a> <a href=../../../query_language/functions/date_time_functions/ title=时间日期函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">时间日期函数</a> <a href=../../../query_language/functions/string_functions/ title=字符串函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串函数</a> <a href=../../../query_language/functions/string_search_functions/ title=字符串搜索函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串搜索函数</a> <a href=../../../query_language/functions/string_replace_functions/ title=字符串替换函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串替换函数</a> <a href=../../../query_language/functions/conditional_functions/ title="条件函数 " class="nav-link text-light text-wrap d-inline-block w-100 px-0">条件函数 </a> <a href=../../../query_language/functions/math_functions/ title=数学函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数学函数</a> <a href=../../../query_language/functions/rounding_functions/ title=取整函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">取整函数</a> <a href=../../../query_language/functions/array_functions/ title=数组函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数组函数</a> <a href=../../../query_language/functions/splitting_merging_functions/ title=字符串拆分合并函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串拆分合并函数</a> <a href=../../../query_language/functions/bit_functions/ title=位操作函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">位操作函数</a> <a href=../../../query_language/functions/bitmap_functions/ title=位图函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">位图函数</a> <a href=../../../query_language/functions/hash_functions/ title=Hash函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Hash函数</a> <a href=../../../query_language/functions/random_functions/ title=随机函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">随机函数</a> <a href=../../../query_language/functions/encoding_functions/ title=编码函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">编码函数</a> <a href=../../../query_language/functions/uuid_functions/ title=UUID函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID函数</a> <a href=../../../query_language/functions/url_functions/ title=URL函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL函数</a> <a href=../../../query_language/functions/ip_address_functions/ title=IP函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IP函数</a> <a href=../../../query_language/functions/json_functions/ title=JSON函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">JSON函数</a> <a href=../../../query_language/functions/higher_order_functions/ title=高阶函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">高阶函数</a> <a href=../../../query_language/functions/ext_dict_functions/ title=字典函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典函数</a> <a href=../../../query_language/functions/ym_dict_functions/ title=Yandex.Metrica字典函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Yandex.Metrica字典函数</a> <a href=../../../query_language/functions/in_functions/ title=IN运算符相关函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IN运算符相关函数</a> <a href=../../../query_language/functions/array_join/ title=arrayJoin函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">arrayJoin函数</a> <a href=../../../query_language/functions/geo/ title=GEO函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">GEO函数</a> <a href=../../../query_language/functions/functions_for_nulls/ title=Nullable处理函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable处理函数</a> <a href=../../../query_language/functions/machine_learning_functions/ title=机器学习函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">机器学习函数</a> <a href=../../../query_language/functions/other_functions/ title=其他函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">其他函数</a> </nav> </div> <a href=#sidebar-sidebar-7-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-9 title=聚合函数 class="nav-link text-light text-wrap dropdown-toggle px-0">聚合函数</a> <div id=sidebar-sidebar-7-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/agg_functions/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../query_language/agg_functions/reference/ title=函数列表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">函数列表</a> <a href=../../../query_language/agg_functions/combinators/ title=聚合函数组合子 class="nav-link text-light text-wrap d-inline-block w-100 px-0">聚合函数组合子</a> <a href=../../../query_language/agg_functions/parametric_functions/ title=参数化聚合函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">参数化聚合函数</a> </nav> </div> <a href=#sidebar-sidebar-7-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-10 title=表引擎函数 class="nav-link text-light text-wrap dropdown-toggle px-0">表引擎函数</a> <div id=sidebar-sidebar-7-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/table_functions/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../query_language/table_functions/file/ title=file class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a> <a href=../../../query_language/table_functions/merge/ title=merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a> <a href=../../../query_language/table_functions/numbers/ title=numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a> <a href=../../../query_language/table_functions/remote/ title=remote class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote</a> <a href=../../../query_language/table_functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../../query_language/table_functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../../query_language/table_functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../../query_language/table_functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> </nav> </div> <a href=#sidebar-sidebar-7-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-11 title=字典 class="nav-link text-light text-wrap dropdown-toggle px-0">字典</a> <div id=sidebar-sidebar-7-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/dicts/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=#sidebar-sidebar-7-11-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-11-2 title=外部字典 class="nav-link text-light text-wrap dropdown-toggle px-0">外部字典</a> <div id=sidebar-sidebar-7-11-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/dicts/external_dicts/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../query_language/dicts/external_dicts_dict/ title=配置外部字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配置外部字典</a> <a href=../../../query_language/dicts/external_dicts_dict_layout/ title=字典的内存布局 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典的内存布局</a> <a href=../../../query_language/dicts/external_dicts_dict_lifetime/ title=字典的刷新策略 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典的刷新策略</a> <a href=../../../query_language/dicts/external_dicts_dict_sources/ title=字典的外部数据源 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典的外部数据源</a> <a href=../../../query_language/dicts/external_dicts_dict_structure/ title=字典的键和字段值 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典的键和字段值</a> </nav> </div> <a href=../../../query_language/dicts/internal_dicts/ title=内部字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">内部字典</a> </nav> </div> <a href=../../../query_language/operators/ title=操作符 class="nav-link text-light text-wrap d-inline-block w-100 px-0">操作符</a> <a href=../../../query_language/syntax/ title=语法说明 class="nav-link text-light text-wrap d-inline-block w-100 px-0">语法说明</a> </nav> </div> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=运维 class="nav-link text-light text-wrap dropdown-toggle px-0">运维</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../operations/requirements/ title=环境要求 class="nav-link text-light text-wrap d-inline-block w-100 px-0">环境要求</a> <a href=../../../operations/monitoring/ title=监控 class="nav-link text-light text-wrap d-inline-block w-100 px-0">监控</a> <a href=../../../operations/troubleshooting/ title=故障排查 class="nav-link text-light text-wrap d-inline-block w-100 px-0">故障排查</a> <a href=../../../operations/tips/ title=使用建议 class="nav-link text-light text-wrap d-inline-block w-100 px-0">使用建议</a> <a href=../../../operations/update/ title=版本升级 class="nav-link text-light text-wrap d-inline-block w-100 px-0">版本升级</a> <a href=../../../operations/access_rights/ title=访问权限控制 class="nav-link text-light text-wrap d-inline-block w-100 px-0">访问权限控制</a> <a href=../../../operations/backup/ title=数据备份 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数据备份</a> <a href=../../../operations/configuration_files/ title=配置文件 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配置文件</a> <a href=../../../operations/quotas/ title=配额 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配额</a> <a href=../../../operations/system_tables/ title=系统表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统表</a> <a href=#sidebar-sidebar-8-12 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-12 title=Server参数配置 class="nav-link text-light text-wrap dropdown-toggle px-0">Server参数配置</a> <div id=sidebar-sidebar-8-12 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/server_settings/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../operations/server_settings/settings/ title=Server参数说明 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Server参数说明</a> </nav> </div> <a href=#sidebar-sidebar-8-13 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-13 title=Settings配置 class="nav-link text-light text-wrap dropdown-toggle px-0">Settings配置</a> <div id=sidebar-sidebar-8-13 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/settings/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../operations/settings/permissions_for_queries/ title=查询权限管理 class="nav-link text-light text-wrap d-inline-block w-100 px-0">查询权限管理</a> <a href=../../../operations/settings/query_complexity/ title=查询复杂性的限制 class="nav-link text-light text-wrap d-inline-block w-100 px-0">查询复杂性的限制</a> <a href=../../../operations/settings/settings/ title=Setting列表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Setting列表</a> <a href=../../../operations/settings/settings_profiles/ title=Setting配置组 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Setting配置组</a> <a href=../../../operations/settings/settings_users/ title=用户配置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">用户配置</a> <a href=../../../operations/settings/constraints_on_settings/ title=Settings的约束 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Settings的约束</a> </nav> </div> <a href=#sidebar-sidebar-8-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-14 title=常用工具 class="nav-link text-light text-wrap dropdown-toggle px-0">常用工具</a> <div id=sidebar-sidebar-8-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/utils/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../../operations/utils/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../../operations/utils/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title=常见问题 class="nav-link text-light text-wrap dropdown-toggle px-0">常见问题</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../faq/general/ title=一般的问题 class="nav-link text-light text-wrap d-inline-block w-100 px-0">一般的问题</a> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title=开发者指南 class="nav-link text-light text-wrap dropdown-toggle px-0">开发者指南</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../development/architecture/ title=ClickHouse架构概述 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse架构概述</a> <a href=../../../development/build/ title=如何在Linux中编译ClickHouse class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何在Linux中编译ClickHouse</a> <a href=../../../development/build_osx/ title="如何在Mac OS X中编译ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何在Mac OS X中编译ClickHouse</a> <a href=../../../development/style/ title=如何编写C++代码 class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何编写C++代码</a> <a href=../../../development/tests/ title=如何运行ClickHouse测试 class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何运行ClickHouse测试</a> <a href=../../../development/contrib/ title=使用的第三方库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">使用的第三方库</a> </nav> </div> <a href=#sidebar-sidebar-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-11 title=新功能特性 class="nav-link text-light text-wrap dropdown-toggle px-0">新功能特性</a> <div id=sidebar-sidebar-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../roadmap/ title=路线图 class="nav-link text-light text-wrap d-inline-block w-100 px-0">路线图</a> <a href=../../../changelog/ title=更新日志 class="nav-link text-light text-wrap d-inline-block w-100 px-0">更新日志</a> <a href=../../../security_changelog/ title=安全更改日志 class="nav-link text-light text-wrap d-inline-block w-100 px-0">安全更改日志</a> </nav> </div> <a href=../../../single/clickhouse_zh.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt=PDF版本 title=PDF版本 height=24 class="d-block mr-1 float-left"><div>PDF版本</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-5"> <div id=content> <h1 id=table_engines-mergetree>MergeTree<a class=headerlink href=#table_engines-mergetree title="Permanent link">&para;</a></h1> <p>Clickhouse 中最强大的表引擎当属 <code>MergeTree</code> （合并树）引擎及该系列（<code>*MergeTree</code>）中的其他引擎。</p> <p><code>MergeTree</code> 引擎系列的基本理念如下。当你有巨量数据要插入到表中，你要高效地一批批写入数据片段，并希望这些数据片段在后台按照一定规则合并。相比在插入时不断修改（重写）数据进存储，这种策略会高效很多。</p> <p>主要特点:</p> <ul> <li> <p>存储的数据按主键排序。</p> <p>这让你可以创建一个用于快速检索数据的小稀疏索引。</p> </li> <li> <p>允许使用分区，如果指定了 <a href=../custom_partitioning_key/ >主键</a> 的话。</p> <p>在相同数据集和相同结果集的情况下 ClickHouse 中某些带分区的操作会比普通操作更快。查询中指定了分区键时 ClickHouse 会自动截取分区数据。这也有效增加了查询性能。</p> </li> <li> <p>支持数据副本。</p> <p><code>ReplicatedMergeTree</code> 系列的表便是用于此。更多信息，请参阅 <a href=../replication/ >数据副本</a> 一节。</p> </li> <li> <p>支持数据采样。</p> <p>需要的话，你可以给表设置一个采样方法。</p> </li> </ul> <div class="admonition 注意"> <p class=admonition-title>注意</p> <p><a href=../merge/ >Merge</a> 引擎并不属于 <code>*MergeTree</code> 系列。</p> </div> <h2 id=table_engine-mergetree-creating-a-table>建表<a class=headerlink href=#table_engine-mergetree-creating-a-table title="Permanent link">&para;</a></h2> <div class=codehilite><pre><span></span><code><span class=k>CREATE</span><span class=w> </span><span class=nc>TABLE</span><span class=w> </span><span class=o>[</span><span class=n>IF NOT EXISTS</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>db.</span><span class=o>]</span><span class=n>table_name</span><span class=w> </span><span class=o>[</span><span class=n>ON CLUSTER cluster</span><span class=o>]</span><span class=w></span>
<span class=p>(</span><span class=w></span>
<span class=w>    </span><span class=n>name1</span><span class=w> </span><span class=o>[</span><span class=n>type1</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>DEFAULT|MATERIALIZED|ALIAS expr1</span><span class=o>]</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>name2</span><span class=w> </span><span class=o>[</span><span class=n>type2</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>DEFAULT|MATERIALIZED|ALIAS expr2</span><span class=o>]</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=p>...</span><span class=w></span>
<span class=w>    </span><span class=k>INDEX</span><span class=w> </span><span class=n>index_name1</span><span class=w> </span><span class=n>expr1</span><span class=w> </span><span class=n>TYPE</span><span class=w> </span><span class=n>type1</span><span class=p>(...)</span><span class=w> </span><span class=n>GRANULARITY</span><span class=w> </span><span class=n>value1</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=k>INDEX</span><span class=w> </span><span class=n>index_name2</span><span class=w> </span><span class=n>expr2</span><span class=w> </span><span class=n>TYPE</span><span class=w> </span><span class=n>type2</span><span class=p>(...)</span><span class=w> </span><span class=n>GRANULARITY</span><span class=w> </span><span class=n>value2</span><span class=w></span>
<span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MergeTree</span><span class=p>()</span><span class=w></span>
<span class=o>[</span><span class=n>PARTITION BY expr</span><span class=o>]</span><span class=w></span>
<span class=o>[</span><span class=n>ORDER BY expr</span><span class=o>]</span><span class=w></span>
<span class=o>[</span><span class=n>PRIMARY KEY expr</span><span class=o>]</span><span class=w></span>
<span class=o>[</span><span class=n>SAMPLE BY expr</span><span class=o>]</span><span class=w></span>
<span class=o>[</span><span class=n>SETTINGS name=value, ...</span><span class=o>]</span><span class=w></span>
</code></pre></div> <p>请求参数的描述，参考 <a href=../../../query_language/create/ >请求描述</a> 。</p> <p><strong>子句</strong></p> <ul> <li> <p><code>ENGINE</code> - 引擎名和参数。 <code>ENGINE = MergeTree()</code>. <code>MergeTree</code> 引擎没有参数。</p> </li> <li> <p><code>PARTITION BY</code> — <a href=../custom_partitioning_key/ >分区键</a> 。</p> <p>要按月分区，可以使用表达式 <code>toYYYYMM(date_column)</code> ，这里的 <code>date_column</code> 是一个 <a href=../../../data_types/date/ >Date</a> 类型的列。这里该分区名格式会是 <code>"YYYYMM"</code> 这样。</p> </li> <li> <p><code>ORDER BY</code> — 表的排序键。</p> <p>可以是一组列的元组或任意的表达式。 例如: <code>ORDER BY (CounterID, EventDate)</code> 。</p> </li> <li> <p><code>PRIMARY KEY</code> - 主键，如果要设成 <a href=./ >跟排序键不相同</a>。</p> <p>默认情况下主键跟排序键（由 <code>ORDER BY</code> 子句指定）相同。<br> 因此，大部分情况下不需要再专门指定一个 <code>PRIMARY KEY</code> 子句。</p> </li> <li> <p><code>SAMPLE BY</code> — 用于抽样的表达式。</p> <p>如果要用抽样表达式，主键中必须包含这个表达式。例如：<br> <code>SAMPLE BY intHash32(UserID) ORDER BY (CounterID, EventDate, intHash32(UserID))</code> 。</p> </li> <li> <p><code>SETTINGS</code> — 影响 <code>MergeTree</code> 性能的额外参数：</p> <ul> <li><code>index_granularity</code> — 索引粒度。即索引中相邻『标记』间的数据行数。默认值，8192 。该列表中所有可用的参数可以从这里查看 <a href=https://github.com/yandex/ClickHouse/blob/master/dbms/src/Storages/MergeTree/MergeTreeSettings.h rel="external nofollow noreferrer">MergeTreeSettings.h</a> 。</li> <li><code>use_minimalistic_part_header_in_zookeeper</code> — 数据片段头在 ZooKeeper 中的存储方式。如果设置了 <code>use_minimalistic_part_header_in_zookeeper=1</code> ，ZooKeeper 会存储更少的数据。更多信息参考『服务配置参数』这章中的 <a href=../../server_settings/settings/#server-settings-use_minimalistic_part_header_in_zookeeper>设置描述</a> 。</li> <li><code>min_merge_bytes_to_use_direct_io</code> — 使用直接 I/O 来操作磁盘的合并操作时要求的最小数据量。合并数据片段时，ClickHouse 会计算要被合并的所有数据的总存储空间。如果大小超过了 <code>min_merge_bytes_to_use_direct_io</code> 设置的字节数，则 ClickHouse 将使用直接 I/O 接口（<code>O_DIRECT</code> 选项）对磁盘读写。如果设置 <code>min_merge_bytes_to_use_direct_io = 0</code> ，则会禁用直接 I/O。默认值：<code>10 * 1024 * 1024 * 1024</code> 字节。</li> </ul> </li> </ul> <p><strong>示例配置</strong></p> <div class=codehilite><pre><span></span><code><span class=err>ENGINE MergeTree() PARTITION BY toYYYYMM(EventDate) ORDER BY (CounterID, EventDate, intHash32(UserID)) SAMPLE BY intHash32(UserID) SETTINGS index_granularity=8192</span>
</code></pre></div> <p>示例中，我们设为按月分区。</p> <p>同时我们设置了一个按用户ID哈希的抽样表达式。这让你可以有该表中每个 <code>CounterID</code> 和 <code>EventDate</code> 下面的数据的伪随机分布。如果你在查询时指定了 <a href=../../../query_language/select/#select-sample-clause>SAMPLE</a> 子句。 ClickHouse会返回对于用户子集的一个均匀的伪随机数据采样。</p> <p><code>index_granularity</code> 可省略，默认值为 8192 。</p> <details> <p><summary>已弃用的建表方法</summary></p> <div class="admonition attention"> <p class=admonition-title>注意</p> <p>不要在新版项目中使用该方法，可能的话，请将旧项目切换到上述方法。</p> </div> <div class=codehilite><pre><span></span><code><span class=k>CREATE</span><span class=w> </span><span class=nc>TABLE</span><span class=w> </span><span class=o>[</span><span class=n>IF NOT EXISTS</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>db.</span><span class=o>]</span><span class=n>table_name</span><span class=w> </span><span class=o>[</span><span class=n>ON CLUSTER cluster</span><span class=o>]</span><span class=w></span>
<span class=p>(</span><span class=w></span>
<span class=w>    </span><span class=n>name1</span><span class=w> </span><span class=o>[</span><span class=n>type1</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>DEFAULT|MATERIALIZED|ALIAS expr1</span><span class=o>]</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>name2</span><span class=w> </span><span class=o>[</span><span class=n>type2</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>DEFAULT|MATERIALIZED|ALIAS expr2</span><span class=o>]</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=p>...</span><span class=w></span>
<span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>[</span><span class=n>=</span><span class=o>]</span><span class=w> </span><span class=n>MergeTree</span><span class=p>(</span><span class=nc>date</span><span class=o>-</span><span class=k>column</span><span class=w> </span><span class=o>[</span><span class=n>, sampling_expression</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=k>primary</span><span class=p>,</span><span class=w> </span><span class=k>key</span><span class=p>),</span><span class=w> </span><span class=n>index_granularity</span><span class=p>)</span><span class=w></span>
</code></pre></div> <p><strong>MergeTree() 参数</strong></p> <ul> <li><code>date-column</code> — 类型为 <a href=../../../data_types/date/ >Date</a> 的列名。ClickHouse 会自动依据这个列按月创建分区。分区名格式为 <code>"YYYYMM"</code> 。</li> <li><code>sampling_expression</code> — 采样表达式。</li> <li><code>(primary, key)</code> — 主键。类型 — <a href=../../../data_types/tuple/ >Tuple()</a></li> <li><code>index_granularity</code> — 索引粒度。即索引中相邻『标记』间的数据行数。设为 8192 可以适用大部分场景。</li> </ul> <p><strong>示例</strong></p> <div class=codehilite><pre><span></span><code><span class=err>MergeTree(EventDate, intHash32(UserID), (CounterID, EventDate, intHash32(UserID)), 8192)</span>
</code></pre></div> <p>对于主要的配置方法，这里 <code>MergeTree</code> 引擎跟前面的例子一样，可以以同样的方式配置。</p> </details> <h2 id=shu-ju-cun-chu>数据存储<a class=headerlink href=#shu-ju-cun-chu title="Permanent link">&para;</a></h2> <p>表由按主键排序的数据 <em>片段</em> 组成。</p> <p>当数据被插入到表中时，会分成数据片段并按主键的字典序排序。例如，主键是 <code>(CounterID, Date)</code> 时，片段中数据按 <code>CounterID</code> 排序，具有相同 <code>CounterID</code> 的部分按 <code>Date</code> 排序。</p> <p>不同分区的数据会被分成不同的片段，ClickHouse 在后台合并数据片段以便更高效存储。不会合并来自不同分区的数据片段。这个合并机制并不保证相同主键的所有行都会合并到同一个数据片段中。</p> <p>ClickHouse 会为每个数据片段创建一个索引文件，索引文件包含每个索引行（『标记』）的主键值。索引行号定义为 <code>n * index_granularity</code> 。最大的 <code>n</code> 等于总行数除以 <code>index_granularity</code> 的值的整数部分。对于每列，跟主键相同的索引行处也会写入『标记』。这些『标记』让你可以直接找到数据所在的列。</p> <p>你可以只用一单一大表并不断地一块块往里面加入数据 – <code>MergeTree</code> 引擎的就是为了这样的场景。</p> <h2 id=primary-keys-and-indexes-in-queries>主键和索引在查询中的表现<a class=headerlink href=#primary-keys-and-indexes-in-queries title="Permanent link">&para;</a></h2> <p>我们以 <code>(CounterID, Date)</code> 以主键。排序好的索引的图示会是下面这样：</p> <div class=codehilite><pre><span></span><code><span class=n>全部数据</span><span class=w>  </span><span class=err>:</span><span class=w>     </span><span class=o>[</span><span class=n>-------------------------------------------------------------------------</span><span class=o>]</span><span class=w></span>
<span class=nl>CounterID</span><span class=p>:</span><span class=w>      </span><span class=o>[</span><span class=n>aaaaaaaaaaaaaaaaaabbbbcdeeeeeeeeeeeeefgggggggghhhhhhhhhiiiiiiiiikllllllll</span><span class=o>]</span><span class=w></span>
<span class=nc>Date</span><span class=err>:</span><span class=w>           </span><span class=o>[</span><span class=n>1111111222222233331233211111222222333211111112122222223111112223311122333</span><span class=o>]</span><span class=w></span>
<span class=nl>标记</span><span class=p>:</span><span class=w>            </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w></span>
<span class=w>                </span><span class=n>a</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>a</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>a</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>b</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>e</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>e</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>g</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>h</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>i</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>l</span><span class=p>,</span><span class=mi>3</span><span class=w></span>
<span class=nl>标记号</span><span class=p>:</span><span class=w>          </span><span class=mi>0</span><span class=w>      </span><span class=mi>1</span><span class=w>      </span><span class=mi>2</span><span class=w>      </span><span class=mi>3</span><span class=w>      </span><span class=mi>4</span><span class=w>      </span><span class=mi>5</span><span class=w>      </span><span class=mi>6</span><span class=w>      </span><span class=mi>7</span><span class=w>      </span><span class=mi>8</span><span class=w>      </span><span class=mi>9</span><span class=w>      </span><span class=mi>10</span><span class=w></span>
</code></pre></div> <p>如果指定查询如下：</p> <ul> <li><code>CounterID in ('a', 'h')</code>，服务器会读取标记号在 <code>[0, 3)</code> 和 <code>[6, 8)</code> 区间中的数据。</li> <li><code>CounterID IN ('a', 'h') AND Date = 3</code>，服务器会读取标记号在 <code>[1, 3)</code> 和 <code>[7, 8)</code> 区间中的数据。</li> <li><code>Date = 3</code>，服务器会读取标记号在 <code>[1, 10]</code> 区间中的数据。</li> </ul> <p>上面例子可以看出使用索引通常会比全表描述要高效。</p> <p>稀疏索引会引起额外的数据读取。当读取主键单个区间范围的数据时，每个数据块中最多会多读 <code>index_granularity * 2</code> 行额外的数据。大部分情况下，当 <code>index_granularity = 8192</code> 时，ClickHouse的性能并不会降级。</p> <p>稀疏索引让你能操作有巨量行的表。因为这些索引是常驻内存（RAM）的。</p> <p>ClickHouse 不要求主键惟一。所以，你可以插入多条具有相同主键的行。</p> <h3 id=zhu-jian-de-xuan-ze>主键的选择<a class=headerlink href=#zhu-jian-de-xuan-ze title="Permanent link">&para;</a></h3> <p>主键中列的数量并没有明确的限制。依据数据结构，你应该让主键包含多些或少些列。这样可以：</p> <ul> <li> <p>改善索引的性能。</p> <p>如果当前主键是 <code>(a, b)</code> ，然后加入另一个 <code>c</code> 列，满足下面条件时，则可以改善性能：<br> - 有带有 <code>c</code> 列条件的查询。<br> - 很长的数据范围（ <code>index_granularity</code> 的数倍）里 <code>(a, b)</code> 都是相同的值，并且这种的情况很普遍。换言之，就是加入另一列后，可以让你的查询略过很长的数据范围。</p> </li> <li> <p>改善数据压缩。</p> <p>ClickHouse 以主键排序片段数据，所以，数据的一致性越高，压缩越好。</p> </li> <li> <p><a href=../collapsingmergetree/#table_engine-collapsingmergetree>CollapsingMergeTree</a> 和 <a href=../summingmergetree/ >SummingMergeTree</a> 引擎里，数据合并时，会有额外的处理逻辑。</p> <p>在这种情况下，指定一个跟主键不同的 <em>排序键</em> 也是有意义的。</p> </li> </ul> <p>长的主键会对插入性能和内存消耗有负面影响，但主键中额外的列并不影响 <code>SELECT</code> 查询的性能。</p> <h3 id=xuan-ze-gen-pai-xu-jian-bu-yi-yang-zhu-jian>选择跟排序键不一样主键<a class=headerlink href=#xuan-ze-gen-pai-xu-jian-bu-yi-yang-zhu-jian title="Permanent link">&para;</a></h3> <p>指定一个跟排序键（用于排序数据片段中行的表达式）<br> 不一样的主键（用于计算写到索引文件的每个标记值的表达式）是可以的。<br> 这种情况下，主键表达式元组必须是排序键表达式元组的一个前缀。</p> <p>当使用 <a href=../summingmergetree/ >SummingMergeTree</a> 和<br> <a href=../aggregatingmergetree/ >AggregatingMergeTree</a> 引擎时，这个特性非常有用。<br> 通常，使用这类引擎时，表里列分两种：<em>维度</em> 和 <em>度量</em> 。<br> 典型的查询是在 <code>GROUP BY</code> 并过虑维度的情况下统计度量列的值。<br> 像 SummingMergeTree 和 AggregatingMergeTree ，用相同的排序键值统计行时，<br> 通常会加上所有的维度。结果就是，这键的表达式会是一长串的列组成，<br> 并且这组列还会因为新加维度必须频繁更新。</p> <p>这种情况下，主键中仅预留少量列保证高效范围扫描，<br> 剩下的维度列放到排序键元组里。这样是合理的。</p> <p><a href=../../../query_language/alter/ >排序键的修改</a> 是轻量级的操作，因为一个新列同时被加入到表里和排序键后时，已存在的数据片段并不需要修改。由于旧的排序键是新排序键的前缀，并且刚刚添加的列中没有数据，因此在表修改时的数据对于新旧的排序键来说都是有序的。</p> <h3 id=suo-yin-he-fen-qu-zai-cha-xun-zhong-de-ying-yong>索引和分区在查询中的应用<a class=headerlink href=#suo-yin-he-fen-qu-zai-cha-xun-zhong-de-ying-yong title="Permanent link">&para;</a></h3> <p>对于 <code>SELECT</code> 查询，ClickHouse 分析是否可以使用索引。如果 <code>WHERE/PREWHERE</code> 子句具有下面这些表达式（作为谓词链接一子项或整个）则可以使用索引：基于主键或分区键的列或表达式的部分的等式或比较运算表达式；基于主键或分区键的列或表达式的固定前缀的 <code>IN</code> 或 <code>LIKE</code> 表达式；基于主键或分区键的列的某些函数；基于主键或分区键的表达式的逻辑表达式。 <!-- It is too hard for me to translate this section as the original text completely. So I did it with my own understanding. If you have good idea, please help me. --></p> <p>因此，在索引键的一个或多个区间上快速地跑查询都是可能的。下面例子中，指定标签；指定标签和日期范围；指定标签和日期；指定多个标签和日期范围等运行查询，都会非常快。</p> <p>当引擎配置如下时：</p> <div class=codehilite><pre><span></span><code><span class=err>ENGINE MergeTree() PARTITION BY toYYYYMM(EventDate) ORDER BY (CounterID, EventDate) SETTINGS index_granularity=8192</span>
</code></pre></div> <p>这种情况下，这些查询：</p> <div class=codehilite><pre><span></span><code><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>42</span><span class=p>)</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=p>((</span><span class=n>EventDate</span> <span class=o>&gt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>&#39;2014-01-01&#39;</span><span class=p>)</span> <span class=k>AND</span> <span class=n>EventDate</span> <span class=o>&lt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>&#39;2014-01-31&#39;</span><span class=p>))</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>&#39;2014-05-01&#39;</span><span class=p>))</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=k>IN</span> <span class=p>(</span><span class=mi>101500</span><span class=p>,</span> <span class=mi>731962</span><span class=p>,</span> <span class=mi>160656</span><span class=p>)</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>101500</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>!=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>&#39;2014-05-01&#39;</span><span class=p>))</span>
</code></pre></div> <p>ClickHouse 会依据主键索引剪掉不符合的数据，依据按月分区的分区键剪掉那些不包含符合数据的分区。</p> <p>上文的查询显示，即使索引用于复杂表达式。因为读表操作是组织好的，所以，使用索引不会比完整扫描慢。</p> <p>下面这个例子中，不会使用索引。</p> <div class=codehilite><pre><span></span><code><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>URL</span> <span class=k>LIKE</span> <span class=s1>&#39;%upyachka%&#39;</span>
</code></pre></div> <p>要检查 ClickHouse 执行一个查询时能否使用索引，可设置 <a href=../../settings/settings/#settings-force_index_by_date>force_index_by_date</a> 和 <a href=../../settings/settings/ >force_primary_key</a> 。</p> <p>按月分区的分区键是只能读取包含适当范围日期的数据块。这种情况下，数据块会包含很多天（最多整月）的数据。在块中，数据按主键排序，主键第一列可能不包含日期。因此，仅使用日期而没有带主键前缀条件的查询将会导致读取超过这个日期范围。</p> <h3 id=tiao-shu-suo-yin-fen-duan-hui-zong-suo-yin-shi-yan-xing-de>跳数索引（分段汇总索引，实验性的）<a class=headerlink href=#tiao-shu-suo-yin-fen-duan-hui-zong-suo-yin-shi-yan-xing-de title="Permanent link">&para;</a></h3> <p>需要设置 <code>allow_experimental_data_skipping_indices</code> 为 1 才能使用此索引。（执行 <code>SET allow_experimental_data_skipping_indices = 1</code>）。</p> <p>此索引在 <code>CREATE</code> 语句的列部分里定义。</p> <div class=codehilite><pre><span></span><code><span class=k>INDEX</span> <span class=n>index_name</span> <span class=n>expr</span> <span class=k>TYPE</span> <span class=k>type</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>granularity_value</span>
</code></pre></div> <p><code>*MergeTree</code> 系列的表都能指定跳数索引。</p> <p>这些索引是由数据块按粒度分割后的每部分在指定表达式上汇总信息 <code>granularity_value</code> 组成（粒度大小用表引擎里 <code>index_granularity</code> 的指定）。<br> 这些汇总信息有助于用 <code>where</code> 语句跳过大片不满足的数据，从而减少 <code>SELECT</code> 查询从磁盘读取的数据量，</p> <p>示例</p> <div class=codehilite><pre><span></span><code><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=k>table_name</span>
<span class=p>(</span>
    <span class=n>u64</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>i32</span> <span class=n>Int32</span><span class=p>,</span>
    <span class=n>s</span> <span class=n>String</span><span class=p>,</span>
    <span class=p>...</span>
    <span class=k>INDEX</span> <span class=n>a</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>3</span><span class=p>,</span>
    <span class=k>INDEX</span> <span class=n>b</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=p>...</span>
</code></pre></div> <p>上例中的索引能让 ClickHouse 执行下面这些查询时减少读取数据量。</p> <div class=codehilite><pre><span></span><code><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>s</span> <span class=o>&lt;</span> <span class=s1>&#39;z&#39;</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span> <span class=o>==</span> <span class=mi>10</span> <span class=k>AND</span> <span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>1234</span>
</code></pre></div> <h4 id=suo-yin-de-ke-yong-lei-xing>索引的可用类型<a class=headerlink href=#suo-yin-de-ke-yong-lei-xing title="Permanent link">&para;</a></h4> <ul> <li> <p><code>minmax</code><br> 存储指定表达式的极值（如果表达式是 <code>tuple</code> ，则存储 <code>tuple</code> 中每个元素的极值），这些信息用于跳过数据块，类似主键。</p> </li> <li> <p><code>set(max_rows)</code><br> 存储指定表达式的惟一值（不超过 <code>max_rows</code> 个，<code>max_rows=0</code> 则表示『无限制』）。这些信息可用于检查 <code>WHERE</code> 表达式是否满足某个数据块。</p> </li> <li> <p><code>ngrambf_v1(n, size_of_bloom_filter_in_bytes, number_of_hash_functions, random_seed)</code> <br> 存储包含数据块中所有 n 元短语的 <a href=https://en.wikipedia.org/wiki/Bloom_filter rel="external nofollow noreferrer">布隆过滤器</a> 。只可用在字符串上。<br> 可用于优化 <code>equals</code> ， <code>like</code> 和 <code>in</code> 表达式的性能。<br> <code>n</code> -- 短语长度。<br> <code>size_of_bloom_filter_in_bytes</code> -- 布隆过滤器大小，单位字节。（因为压缩得好，可以指定比较大的值，如256或512）。<br> <code>number_of_hash_functions</code> -- 布隆过滤器中使用的 hash 函数的个数。<br> <code>random_seed</code> -- hash 函数的随机种子。</p> </li> <li> <p><code>tokenbf_v1(size_of_bloom_filter_in_bytes, number_of_hash_functions, random_seed)</code> <br> 跟 <code>ngrambf_v1</code> 类似，不同于 ngrams 存储字符串指定长度的所有片段。它只存储被非字母数据字符分割的片段。</p> </li> </ul> <div class=codehilite><pre><span></span><code><span class=k>INDEX</span> <span class=n>sample_index</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=k>INDEX</span> <span class=n>sample_index2</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>i32</span> <span class=o>+</span> <span class=n>f64</span> <span class=o>*</span> <span class=mi>100</span><span class=p>,</span> <span class=nb>date</span><span class=p>,</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=k>INDEX</span> <span class=n>sample_index3</span> <span class=p>(</span><span class=k>lower</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>ngrambf_v1</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>256</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
</code></pre></div> <h2 id=bing-fa-shu-ju-fang-wen>并发数据访问<a class=headerlink href=#bing-fa-shu-ju-fang-wen title="Permanent link">&para;</a></h2> <p>应对表的并发访问，我们使用多版本机制。换言之，当同时读和更新表时，数据从当前查询到的一组片段中读取。没有冗长的的锁。插入不会阻碍读取。</p> <p>对表的读操作是自动并行的。</p> </div> <div id=content-footer class="text-muted pt-5"> <div class=float-right>©2016–2020 Yandex LLC</div> <div>建于 <a href=https://github.com/ClickHouse/ClickHouse/commit/23e757bcb79e11756e72134fdf037052a0b295b5 rel="external nofollow noreferrer" target=_blank class=text-reset>23e757bcb7</a></div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>目录</label> <a href=#table_engine-mergetree-creating-a-table title=建表 class="nav-link text-wrap d-inline-block w-100"> 建表 </a> <a href=#shu-ju-cun-chu title=数据存储 class="nav-link text-wrap d-inline-block w-100"> 数据存储 </a> <a href=#primary-keys-and-indexes-in-queries title=主键和索引在查询中的表现 class="nav-link text-wrap d-inline-block w-100"> 主键和索引在查询中的表现 </a> <nav id=toc-toc-3 class="nav flex-column pl-2"> <a href=#zhu-jian-de-xuan-ze title=主键的选择 class="nav-link text-wrap d-inline-block w-100"> 主键的选择 </a> <a href=#xuan-ze-gen-pai-xu-jian-bu-yi-yang-zhu-jian title=选择跟排序键不一样主键 class="nav-link text-wrap d-inline-block w-100"> 选择跟排序键不一样主键 </a> <a href=#suo-yin-he-fen-qu-zai-cha-xun-zhong-de-ying-yong title=索引和分区在查询中的应用 class="nav-link text-wrap d-inline-block w-100"> 索引和分区在查询中的应用 </a> <a href=#tiao-shu-suo-yin-fen-duan-hui-zong-suo-yin-shi-yan-xing-de title=跳数索引（分段汇总索引，实验性的） class="nav-link text-wrap d-inline-block w-100"> 跳数索引（分段汇总索引，实验性的） </a> <nav id=toc-toc-3-4 class="nav flex-column pl-2"> <a href=#suo-yin-de-ke-yong-lei-xing title=索引的可用类型 class="nav-link text-wrap d-inline-block w-100"> 索引的可用类型 </a> </nav> </nav> <a href=#bing-fa-shu-ju-fang-wen title=并发数据访问 class="nav-link text-wrap d-inline-block w-100"> 并发数据访问 </a> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?7bd05efd></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>