<!DOCTYPE html><html lang=zh data-version=v19.14 data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>使用建议 - ClickHouse文档 v19.14</title><link rel="shortcut icon" href=/favicon.ico><meta property=og:title content="使用建议 - ClickHouse文档 v19.14"><meta property=og:description content="Usage Recommendations CPU The SSE 4.2 instruction set must be supported. Modern processors (since 2008) support it. When"><meta property=og:type content=website><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta property=twitter:title content="使用建议 - ClickHouse文档 v19.14"><meta name=description content="Usage Recommendations CPU The SSE 4.2 instruction set must be supported. Modern processors (since 2008) support it. When"><meta name=keywords content="ClickHouse, DBMS, OLAP, relational, analytics, analytical, big data, open-source, SQL, web-analytics"><link href=/css/base.css?1d858e50 media=all rel=stylesheet></head> <body dir=ltr data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> 使用建议 </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li class=nav-item> <a href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/zh/operations/tips.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/zh.svg alt=中文 title=中文 width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/v19.14/en/operations/tips/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/v19.14/zh/operations/tips/ class="dropdown-item disabled"> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/v19.14/es/operations/tips/ class=dropdown-item> <img src=/images/flags/es.svg alt title width=32 class="d-inline-block mr-2">Español </a> <a href=/docs/v19.14/fr/operations/tips/ class=dropdown-item> <img src=/images/flags/fr.svg alt title width=32 class="d-inline-block mr-2">Français </a> <a href=/docs/v19.14/ru/operations/tips/ class=dropdown-item> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/v19.14/ja/operations/tips/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> <a href=/docs/v19.14/fa/operations/tips/ class=dropdown-item> <img src=/images/flags/fa.svg alt title width=32 class="d-inline-block mr-2">فارسی </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class=container-fluid> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label=多页或单页> <a href=../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt=多页版本 title=多页版本> </a> <a href=../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt=单页版本 title=单页版本> </a> </div> <div class="dropdown mb-3"> <a class="btn btn-dark dropdown-toggle text-muted" href=# role=button id=select-version data-toggle=dropdown aria-haspopup=true aria-expanded=false> 版本: <span class=text-light>v19.14</span> </a> <div class="dropdown-menu bg-dark text-muted p-1" aria-labelledby=select-version> <a href=/docs/zh/ class=dropdown-item> <span class=text-light>最新消息</span> </a> <a href=/docs/v20.3/zh/ class=dropdown-item>v20.3</a> <a href=/docs/v20.1/zh/ class=dropdown-item>v20.1</a> <a href=/docs/v19.17/zh/ class=dropdown-item>v19.17</a> <a href=/docs/v19.16/zh/ class=dropdown-item>v19.16</a> <a href=/docs/v19.15/zh/ class=dropdown-item>v19.15</a> <a href=/docs/v19.14/zh/ class="dropdown-item disable">v19.14</a> <a href=/docs/v19.13/zh/ class=dropdown-item>v19.13</a> <a href=/docs/v19.11/zh/ class=dropdown-item>v19.11</a> <a href=/docs/v19.10/zh/ class=dropdown-item>v19.10</a> <a href=/docs/v19.9/zh/ class=dropdown-item>v19.9</a> <a href=/docs/v19.8/zh/ class=dropdown-item>v19.8</a> </div> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=介绍 class="nav-link text-light text-wrap dropdown-toggle px-0">介绍</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../ title=概貌 class="nav-link text-light text-wrap d-inline-block w-100 px-0">概貌</a> <a href=../../introduction/distinctive_features/ title=ClickHouse的独特功能 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse的独特功能</a> <a href=../../introduction/features_considered_disadvantages/ title=ClickHouse功能可被视为缺点 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse功能可被视为缺点</a> <a href=../../introduction/performance/ title=性能 class="nav-link text-light text-wrap d-inline-block w-100 px-0">性能</a> <a href=../../introduction/ya_metrika_task/ title=Yandex.Metrica使用案例 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Yandex.Metrica使用案例</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title=入门指南 class="nav-link text-light text-wrap dropdown-toggle px-0">入门指南</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/ title=部署运行 class="nav-link text-light text-wrap d-inline-block w-100 px-0">部署运行</a> <a href=#sidebar-sidebar-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-2 title=示例数据集 class="nav-link text-light text-wrap dropdown-toggle px-0">示例数据集</a> <div id=sidebar-sidebar-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/example_datasets/ontime/ title=航班飞行数据 class="nav-link text-light text-wrap d-inline-block w-100 px-0">航班飞行数据</a> <a href=../../getting_started/example_datasets/nyc_taxi/ title=纽约市出租车数据 class="nav-link text-light text-wrap d-inline-block w-100 px-0">纽约市出租车数据</a> <a href=../../getting_started/example_datasets/amplab_benchmark/ title=AMPLab大数据基准测试 class="nav-link text-light text-wrap d-inline-block w-100 px-0">AMPLab大数据基准测试</a> <a href=../../getting_started/example_datasets/wikistat/ title=维基访问数据 class="nav-link text-light text-wrap d-inline-block w-100 px-0">维基访问数据</a> <a href=../../getting_started/example_datasets/criteo/ title="Criteo TB级别点击日志" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Criteo TB级别点击日志</a> <a href=../../getting_started/example_datasets/star_schema/ title="Star Schema基准测试" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Star Schema基准测试</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=客户端 class="nav-link text-light text-wrap dropdown-toggle px-0">客户端</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../interfaces/cli/ title=命令行客户端接口 class="nav-link text-light text-wrap d-inline-block w-100 px-0">命令行客户端接口</a> <a href=../../interfaces/tcp/ title="原生客户端接口 (TCP)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">原生客户端接口 (TCP)</a> <a href=../../interfaces/http/ title="HTTP 客户端接口" class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP 客户端接口</a> <a href=../../interfaces/formats/ title=输入输出格式 class="nav-link text-light text-wrap d-inline-block w-100 px-0">输入输出格式</a> <a href=../../interfaces/jdbc/ title="JDBC 驱动" class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC 驱动</a> <a href=../../interfaces/odbc/ title="ODBC 驱动" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC 驱动</a> <a href=#sidebar-sidebar-3-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-8 title=第三方 class="nav-link text-light text-wrap dropdown-toggle px-0">第三方</a> <div id=sidebar-sidebar-3-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/third-party/client_libraries/ title=客户端库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">客户端库</a> <a href=../../interfaces/third-party/integrations/ title=集成 class="nav-link text-light text-wrap d-inline-block w-100 px-0">集成</a> <a href=../../interfaces/third-party/gui/ title=可视界面 class="nav-link text-light text-wrap d-inline-block w-100 px-0">可视界面</a> <a href=../../interfaces/third-party/proxy/ title=代理 class="nav-link text-light text-wrap d-inline-block w-100 px-0">代理</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title=数据类型 class="nav-link text-light text-wrap dropdown-toggle px-0">数据类型</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../data_types/int_uint/ title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</a> <a href=../../data_types/float/ title="Float32, Float64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32, Float64</a> <a href=../../data_types/decimal/ title=Decimal class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal</a> <a href=../../data_types/boolean/ title="Boolean values" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Boolean values</a> <a href=../../data_types/string/ title=String class="nav-link text-light text-wrap d-inline-block w-100 px-0">String</a> <a href=../../data_types/fixedstring/ title=FixedString(N) class="nav-link text-light text-wrap d-inline-block w-100 px-0">FixedString(N)</a> <a href=../../data_types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../data_types/date/ title=Date class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date</a> <a href=../../data_types/datetime/ title=DateTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime</a> <a href=../../data_types/enum/ title=Enum class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum</a> <a href=../../data_types/array/ title=Array(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Array(T)</a> <a href=../../data_types/nested_data_structures/aggregatefunction/ title="AggregateFunction(name, types_of_arguments...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction(name, types_of_arguments...)</a> <a href=../../data_types/tuple/ title="Tuple(T1, T2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, ...)</a> <a href=../../data_types/nullable/ title=Nullable class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable</a> <a href=#sidebar-sidebar-4-16 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-16 title=嵌套数据结构 class="nav-link text-light text-wrap dropdown-toggle px-0">嵌套数据结构</a> <div id=sidebar-sidebar-4-16 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/nested_data_structures/nested/ title="Nested(Name1 Type1, Name2 Type2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, ...)</a> </nav> </div> <a href=#sidebar-sidebar-4-17 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-17 title=特殊数据类型 class="nav-link text-light text-wrap dropdown-toggle px-0">特殊数据类型</a> <div id=sidebar-sidebar-4-17 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/special_data_types/expression/ title=Expression class="nav-link text-light text-wrap d-inline-block w-100 px-0">Expression</a> <a href=../../data_types/special_data_types/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../data_types/special_data_types/nothing/ title=Nothing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nothing</a> </nav> </div> <a href=#sidebar-sidebar-4-18 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-18 title=Domain类型 class="nav-link text-light text-wrap dropdown-toggle px-0">Domain类型</a> <div id=sidebar-sidebar-4-18 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/domains/overview/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../data_types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../data_types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title=数据库引擎 class="nav-link text-light text-wrap dropdown-toggle px-0">数据库引擎</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../database_engines/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../database_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> </nav> </div> <a href=#sidebar-sidebar-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6 title=表引擎 class="nav-link text-light text-wrap dropdown-toggle px-0">表引擎</a> <div id=sidebar-sidebar-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=#sidebar-sidebar-6-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-2 title=MergeTree class="nav-link text-light text-wrap dropdown-toggle px-0">MergeTree</a> <div id=sidebar-sidebar-6-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/mergetree/ title=MergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../operations/table_engines/replication/ title="Data Replication" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Data Replication</a> <a href=../../operations/table_engines/custom_partitioning_key/ title="Custom Partitioning Key" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Custom Partitioning Key</a> <a href=../../operations/table_engines/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../operations/table_engines/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../operations/table_engines/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../operations/table_engines/collapsingmergetree/ title=CollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">CollapsingMergeTree</a> <a href=../../operations/table_engines/versionedcollapsingmergetree/ title=VersionedCollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">VersionedCollapsingMergeTree</a> <a href=../../operations/table_engines/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> </nav> </div> <a href=#sidebar-sidebar-6-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-3 title=Log class="nav-link text-light text-wrap dropdown-toggle px-0">Log</a> <div id=sidebar-sidebar-6-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/log_family/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../operations/table_engines/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../operations/table_engines/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../operations/table_engines/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> </nav> </div> <a href=#sidebar-sidebar-6-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-4 title=外部表引擎 class="nav-link text-light text-wrap dropdown-toggle px-0">外部表引擎</a> <div id=sidebar-sidebar-6-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../operations/table_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../operations/table_engines/jdbc/ title=JDBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC</a> <a href=../../operations/table_engines/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> </nav> </div> <a href=#sidebar-sidebar-6-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-5 title=其他表引擎 class="nav-link text-light text-wrap dropdown-toggle px-0">其他表引擎</a> <div id=sidebar-sidebar-6-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/distributed/ title=Distributed class="nav-link text-light text-wrap d-inline-block w-100 px-0">Distributed</a> <a href=../../operations/table_engines/external_data/ title="External data" class="nav-link text-light text-wrap d-inline-block w-100 px-0">External data</a> <a href=../../operations/table_engines/dictionary/ title=Dictionary class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary</a> <a href=../../operations/table_engines/merge/ title=Merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">Merge</a> <a href=../../operations/table_engines/file/ title=File class="nav-link text-light text-wrap d-inline-block w-100 px-0">File</a> <a href=../../operations/table_engines/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../operations/table_engines/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../operations/table_engines/join/ title=Join class="nav-link text-light text-wrap d-inline-block w-100 px-0">Join</a> <a href=../../operations/table_engines/url/ title=URL class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL</a> <a href=../../operations/table_engines/view/ title=View class="nav-link text-light text-wrap d-inline-block w-100 px-0">View</a> <a href=../../operations/table_engines/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../operations/table_engines/memory/ title=Memory class="nav-link text-light text-wrap d-inline-block w-100 px-0">Memory</a> <a href=../../operations/table_engines/buffer/ title=Buffer class="nav-link text-light text-wrap d-inline-block w-100 px-0">Buffer</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7 title=SQL语法 class="nav-link text-light text-wrap dropdown-toggle px-0">SQL语法</a> <div id=sidebar-sidebar-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/select/ title=SELECT class="nav-link text-light text-wrap d-inline-block w-100 px-0">SELECT</a> <a href=../../query_language/insert_into/ title="INSERT INTO" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO</a> <a href=../../query_language/create/ title=CREATE class="nav-link text-light text-wrap d-inline-block w-100 px-0">CREATE</a> <a href=../../query_language/alter/ title=ALTER class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../query_language/system/ title=SYSTEM class="nav-link text-light text-wrap d-inline-block w-100 px-0">SYSTEM</a> <a href=../../query_language/misc/ title=其他类型的查询 class="nav-link text-light text-wrap d-inline-block w-100 px-0">其他类型的查询</a> <a href=#sidebar-sidebar-7-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-8 title=函数 class="nav-link text-light text-wrap dropdown-toggle px-0">函数</a> <div id=sidebar-sidebar-7-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/functions/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../query_language/functions/arithmetic_functions/ title=算术函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">算术函数</a> <a href=../../query_language/functions/comparison_functions/ title=比较函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">比较函数</a> <a href=../../query_language/functions/logical_functions/ title=逻辑函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">逻辑函数</a> <a href=../../query_language/functions/type_conversion_functions/ title=类型转换函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">类型转换函数</a> <a href=../../query_language/functions/date_time_functions/ title=时间日期函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">时间日期函数</a> <a href=../../query_language/functions/string_functions/ title=字符串函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串函数</a> <a href=../../query_language/functions/string_search_functions/ title=字符串搜索函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串搜索函数</a> <a href=../../query_language/functions/string_replace_functions/ title=字符串替换函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串替换函数</a> <a href=../../query_language/functions/conditional_functions/ title="条件函数 " class="nav-link text-light text-wrap d-inline-block w-100 px-0">条件函数 </a> <a href=../../query_language/functions/math_functions/ title=数学函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数学函数</a> <a href=../../query_language/functions/rounding_functions/ title=取整函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">取整函数</a> <a href=../../query_language/functions/array_functions/ title=数组函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数组函数</a> <a href=../../query_language/functions/splitting_merging_functions/ title=字符串拆分合并函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串拆分合并函数</a> <a href=../../query_language/functions/bit_functions/ title=位操作函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">位操作函数</a> <a href=../../query_language/functions/bitmap_functions/ title=位图函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">位图函数</a> <a href=../../query_language/functions/hash_functions/ title=Hash函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Hash函数</a> <a href=../../query_language/functions/random_functions/ title=随机函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">随机函数</a> <a href=../../query_language/functions/encoding_functions/ title=编码函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">编码函数</a> <a href=../../query_language/functions/uuid_functions/ title=UUID函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID函数</a> <a href=../../query_language/functions/url_functions/ title=URL函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL函数</a> <a href=../../query_language/functions/ip_address_functions/ title=IP函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IP函数</a> <a href=../../query_language/functions/json_functions/ title=JSON函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">JSON函数</a> <a href=../../query_language/functions/higher_order_functions/ title=高阶函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">高阶函数</a> <a href=../../query_language/functions/ext_dict_functions/ title=字典函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典函数</a> <a href=../../query_language/functions/ym_dict_functions/ title=Yandex.Metrica字典函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Yandex.Metrica字典函数</a> <a href=../../query_language/functions/in_functions/ title=IN运算符相关函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IN运算符相关函数</a> <a href=../../query_language/functions/array_join/ title=arrayJoin函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">arrayJoin函数</a> <a href=../../query_language/functions/geo/ title=GEO函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">GEO函数</a> <a href=../../query_language/functions/functions_for_nulls/ title=Nullable处理函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable处理函数</a> <a href=../../query_language/functions/machine_learning_functions/ title=机器学习函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">机器学习函数</a> <a href=../../query_language/functions/other_functions/ title=其他函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">其他函数</a> </nav> </div> <a href=#sidebar-sidebar-7-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-9 title=聚合函数 class="nav-link text-light text-wrap dropdown-toggle px-0">聚合函数</a> <div id=sidebar-sidebar-7-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/agg_functions/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../query_language/agg_functions/reference/ title=函数列表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">函数列表</a> <a href=../../query_language/agg_functions/combinators/ title=聚合函数组合子 class="nav-link text-light text-wrap d-inline-block w-100 px-0">聚合函数组合子</a> <a href=../../query_language/agg_functions/parametric_functions/ title=参数化聚合函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">参数化聚合函数</a> </nav> </div> <a href=#sidebar-sidebar-7-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-10 title=表引擎函数 class="nav-link text-light text-wrap dropdown-toggle px-0">表引擎函数</a> <div id=sidebar-sidebar-7-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/table_functions/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../query_language/table_functions/file/ title=file class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a> <a href=../../query_language/table_functions/merge/ title=merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a> <a href=../../query_language/table_functions/numbers/ title=numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a> <a href=../../query_language/table_functions/remote/ title=remote class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote</a> <a href=../../query_language/table_functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../query_language/table_functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../query_language/table_functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../query_language/table_functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> </nav> </div> <a href=#sidebar-sidebar-7-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-11 title=字典 class="nav-link text-light text-wrap dropdown-toggle px-0">字典</a> <div id=sidebar-sidebar-7-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/dicts/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=#sidebar-sidebar-7-11-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-11-2 title=外部字典 class="nav-link text-light text-wrap dropdown-toggle px-0">外部字典</a> <div id=sidebar-sidebar-7-11-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/dicts/external_dicts/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../query_language/dicts/external_dicts_dict/ title=配置外部字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配置外部字典</a> <a href=../../query_language/dicts/external_dicts_dict_layout/ title=字典的内存布局 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典的内存布局</a> <a href=../../query_language/dicts/external_dicts_dict_lifetime/ title=字典的刷新策略 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典的刷新策略</a> <a href=../../query_language/dicts/external_dicts_dict_sources/ title=字典的外部数据源 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典的外部数据源</a> <a href=../../query_language/dicts/external_dicts_dict_structure/ title=字典的键和字段值 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典的键和字段值</a> </nav> </div> <a href=../../query_language/dicts/internal_dicts/ title=内部字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">内部字典</a> </nav> </div> <a href=../../query_language/operators/ title=操作符 class="nav-link text-light text-wrap d-inline-block w-100 px-0">操作符</a> <a href=../../query_language/syntax/ title=语法说明 class="nav-link text-light text-wrap d-inline-block w-100 px-0">语法说明</a> </nav> </div> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=运维 class="nav-link text-light text-wrap dropdown-toggle px-0">运维</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../operations/requirements/ title=环境要求 class="nav-link text-light text-wrap d-inline-block w-100 px-0">环境要求</a> <a href=../../operations/monitoring/ title=监控 class="nav-link text-light text-wrap d-inline-block w-100 px-0">监控</a> <a href=../../operations/troubleshooting/ title=故障排查 class="nav-link text-light text-wrap d-inline-block w-100 px-0">故障排查</a> <a href=../../operations/tips/ title=使用建议 class="nav-link text-white active text-wrap d-inline-block w-100 px-0">使用建议</a> <a href=../../operations/update/ title=版本升级 class="nav-link text-light text-wrap d-inline-block w-100 px-0">版本升级</a> <a href=../../operations/access_rights/ title=访问权限控制 class="nav-link text-light text-wrap d-inline-block w-100 px-0">访问权限控制</a> <a href=../../operations/backup/ title=数据备份 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数据备份</a> <a href=../../operations/configuration_files/ title=配置文件 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配置文件</a> <a href=../../operations/quotas/ title=配额 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配额</a> <a href=../../operations/system_tables/ title=系统表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统表</a> <a href=#sidebar-sidebar-8-12 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-12 title=Server参数配置 class="nav-link text-light text-wrap dropdown-toggle px-0">Server参数配置</a> <div id=sidebar-sidebar-8-12 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/server_settings/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../operations/server_settings/settings/ title=Server参数说明 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Server参数说明</a> </nav> </div> <a href=#sidebar-sidebar-8-13 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-13 title=Settings配置 class="nav-link text-light text-wrap dropdown-toggle px-0">Settings配置</a> <div id=sidebar-sidebar-8-13 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/settings/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../operations/settings/permissions_for_queries/ title=查询权限管理 class="nav-link text-light text-wrap d-inline-block w-100 px-0">查询权限管理</a> <a href=../../operations/settings/query_complexity/ title=查询复杂性的限制 class="nav-link text-light text-wrap d-inline-block w-100 px-0">查询复杂性的限制</a> <a href=../../operations/settings/settings/ title=Setting列表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Setting列表</a> <a href=../../operations/settings/settings_profiles/ title=Setting配置组 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Setting配置组</a> <a href=../../operations/settings/settings_users/ title=用户配置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">用户配置</a> <a href=../../operations/settings/constraints_on_settings/ title=Settings的约束 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Settings的约束</a> </nav> </div> <a href=#sidebar-sidebar-8-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-14 title=常用工具 class="nav-link text-light text-wrap dropdown-toggle px-0">常用工具</a> <div id=sidebar-sidebar-8-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/utils/ title=介绍 class="nav-link text-light text-wrap d-inline-block w-100 px-0">介绍</a> <a href=../../operations/utils/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../operations/utils/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title=常见问题 class="nav-link text-light text-wrap dropdown-toggle px-0">常见问题</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../faq/general/ title=一般的问题 class="nav-link text-light text-wrap d-inline-block w-100 px-0">一般的问题</a> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title=开发者指南 class="nav-link text-light text-wrap dropdown-toggle px-0">开发者指南</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../development/architecture/ title=ClickHouse架构概述 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse架构概述</a> <a href=../../development/build/ title=如何在Linux中编译ClickHouse class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何在Linux中编译ClickHouse</a> <a href=../../development/build_osx/ title="如何在Mac OS X中编译ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何在Mac OS X中编译ClickHouse</a> <a href=../../development/style/ title=如何编写C++代码 class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何编写C++代码</a> <a href=../../development/tests/ title=如何运行ClickHouse测试 class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何运行ClickHouse测试</a> <a href=../../development/contrib/ title=使用的第三方库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">使用的第三方库</a> </nav> </div> <a href=#sidebar-sidebar-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-11 title=新功能特性 class="nav-link text-light text-wrap dropdown-toggle px-0">新功能特性</a> <div id=sidebar-sidebar-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../roadmap/ title=路线图 class="nav-link text-light text-wrap d-inline-block w-100 px-0">路线图</a> <a href=../../changelog/ title=更新日志 class="nav-link text-light text-wrap d-inline-block w-100 px-0">更新日志</a> <a href=../../security_changelog/ title=安全更改日志 class="nav-link text-light text-wrap d-inline-block w-100 px-0">安全更改日志</a> </nav> </div> <a href=../../single/clickhouse_zh.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt=PDF版本 title=PDF版本 height=24 class="d-block mr-1 float-left"><div>PDF版本</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-5"> <div id=content> <h1 id=usage-recommendations>Usage Recommendations<a class=headerlink href=#usage-recommendations title="Permanent link">&para;</a></h1> <h2 id=cpu>CPU<a class=headerlink href=#cpu title="Permanent link">&para;</a></h2> <p>The SSE 4.2 instruction set must be supported. Modern processors (since 2008) support it.</p> <p>When choosing a processor, prefer a large number of cores and slightly slower clock rate over fewer cores and a higher clock rate.<br> For example, 16 cores with 2600 MHz is better than 8 cores with 3600 MHz.</p> <h2 id=hyper-threading>Hyper-threading<a class=headerlink href=#hyper-threading title="Permanent link">&para;</a></h2> <p>Don't disable hyper-threading. It helps for some queries, but not for others.</p> <h2 id=turbo-boost>Turbo Boost<a class=headerlink href=#turbo-boost title="Permanent link">&para;</a></h2> <p>Turbo Boost is highly recommended. It significantly improves performance with a typical load.<br> You can use <code>turbostat</code> to view the CPU's actual clock rate under a load.</p> <h2 id=cpu-scaling-governor>CPU Scaling Governor<a class=headerlink href=#cpu-scaling-governor title="Permanent link">&para;</a></h2> <p>Always use the <code>performance</code> scaling governor. The <code>on-demand</code> scaling governor works much worse with constantly high demand.</p> <div class=codehilite><pre><span></span><code><span class=nb>echo</span> <span class=s1>&#39;performance&#39;</span> <span class=p>|</span> sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
</code></pre></div> <h2 id=cpu-limitations>CPU Limitations<a class=headerlink href=#cpu-limitations title="Permanent link">&para;</a></h2> <p>Processors can overheat. Use <code>dmesg</code> to see if the CPU's clock rate was limited due to overheating.<br> The restriction can also be set externally at the datacenter level. You can use <code>turbostat</code> to monitor it under a load.</p> <h2 id=ram>RAM<a class=headerlink href=#ram title="Permanent link">&para;</a></h2> <p>For small amounts of data (up to \~200 GB compressed), it is best to use as much memory as the volume of data.<br> For large amounts of data and when processing interactive (online) queries, you should use a reasonable amount of RAM (128 GB or more) so the hot data subset will fit in the cache of pages.<br> Even for data volumes of \~50 TB per server, using 128 GB of RAM significantly improves query performance compared to 64 GB.</p> <h2 id=swap-file>Swap File<a class=headerlink href=#swap-file title="Permanent link">&para;</a></h2> <p>Always disable the swap file. The only reason for not doing this is if you are using ClickHouse on your personal laptop.</p> <h2 id=huge-pages>Huge Pages<a class=headerlink href=#huge-pages title="Permanent link">&para;</a></h2> <p>Always disable transparent huge pages. It interferes with memory allocators, which leads to significant performance degradation.</p> <div class=codehilite><pre><span></span><code><span class=nb>echo</span> <span class=s1>&#39;never&#39;</span> <span class=p>|</span> sudo tee /sys/kernel/mm/transparent_hugepage/enabled
</code></pre></div> <p>Use <code>perf top</code> to watch the time spent in the kernel for memory management.<br> Permanent huge pages also do not need to be allocated.</p> <h2 id=storage-subsystem>Storage Subsystem<a class=headerlink href=#storage-subsystem title="Permanent link">&para;</a></h2> <p>If your budget allows you to use SSD, use SSD.<br> If not, use HDD. SATA HDDs 7200 RPM will do.</p> <p>Give preference to a lot of servers with local hard drives over a smaller number of servers with attached disk shelves.<br> But for storing archives with rare queries, shelves will work.</p> <h2 id=raid>RAID<a class=headerlink href=#raid title="Permanent link">&para;</a></h2> <p>When using HDD, you can combine their RAID-10, RAID-5, RAID-6 or RAID-50.<br> For Linux, software RAID is better (with <code>mdadm</code>). We don't recommend using LVM.<br> When creating RAID-10, select the <code>far</code> layout.<br> If your budget allows, choose RAID-10.</p> <p>If you have more than 4 disks, use RAID-6 (preferred) or RAID-50, instead of RAID-5.<br> When using RAID-5, RAID-6 or RAID-50, always increase stripe_cache_size, since the default value is usually not the best choice.</p> <div class=codehilite><pre><span></span><code><span class=nb>echo</span> <span class=m>4096</span> <span class=p>|</span> sudo tee /sys/block/md2/md/stripe_cache_size
</code></pre></div> <p>Calculate the exact number from the number of devices and the block size, using the formula: <code>2 * num_devices * chunk_size_in_bytes / 4096</code>.</p> <p>A block size of 1025 KB is sufficient for all RAID configurations.<br> Never set the block size too small or too large.</p> <p>You can use RAID-0 on SSD.<br> Regardless of RAID use, always use replication for data security.</p> <p>Enable NCQ with a long queue. For HDD, choose the CFQ scheduler, and for SSD, choose noop. Don't reduce the 'readahead' setting.<br> For HDD, enable the write cache.</p> <h2 id=file-system>File System<a class=headerlink href=#file-system title="Permanent link">&para;</a></h2> <p>Ext4 is the most reliable option. Set the mount options <code>noatime, nobarrier</code>.<br> XFS is also suitable, but it hasn't been as thoroughly tested with ClickHouse.<br> Most other file systems should also work fine. File systems with delayed allocation work better.</p> <h2 id=linux-kernel>Linux Kernel<a class=headerlink href=#linux-kernel title="Permanent link">&para;</a></h2> <p>Don't use an outdated Linux kernel.</p> <h2 id=network>Network<a class=headerlink href=#network title="Permanent link">&para;</a></h2> <p>If you are using IPv6, increase the size of the route cache.<br> The Linux kernel prior to 3.2 had a multitude of problems with IPv6 implementation.</p> <p>Use at least a 10 GB network, if possible. 1 Gb will also work, but it will be much worse for patching replicas with tens of terabytes of data, or for processing distributed queries with a large amount of intermediate data.</p> <h2 id=zookeeper>ZooKeeper<a class=headerlink href=#zookeeper title="Permanent link">&para;</a></h2> <p>You are probably already using ZooKeeper for other purposes. You can use the same installation of ZooKeeper, if it isn't already overloaded.</p> <p>It's best to use a fresh version of ZooKeeper – 3.4.9 or later. The version in stable Linux distributions may be outdated.</p> <p>You should never use manually written scripts to transfer data between different ZooKeeper clusters, because the result will be incorrect for sequential nodes. Never use the "zkcopy" utility for the same reason: <a href=https://github.com/ksprojects/zkcopy/issues/15>https://github.com/ksprojects/zkcopy/issues/15</a></p> <p>If you want to divide an existing ZooKeeper cluster into two, the correct way is to increase the number of its replicas and then reconfigure it as two independent clusters.</p> <p>Do not run ZooKeeper on the same servers as ClickHouse. Because ZooKeeper is very sensitive for latency and ClickHouse may utilize all available system resources.</p> <p>With the default settings, ZooKeeper is a time bomb:</p> <blockquote> <p>The ZooKeeper server won't delete files from old snapshots and logs when using the default configuration (see autopurge), and this is the responsibility of the operator.</p> </blockquote> <p>This bomb must be defused.</p> <p>The ZooKeeper (3.5.1) configuration below is used in the Yandex.Metrica production environment as of May 20, 2017:</p> <p>zoo.cfg:</p> <div class=codehilite><pre><span></span><code><span class=c1># http://hadoop.apache.org/zookeeper/docs/current/zookeeperAdmin.html</span>

<span class=c1># The number of milliseconds of each tick</span>
<span class=nv>tickTime</span><span class=o>=</span><span class=m>2000</span>
<span class=c1># The number of ticks that the initial</span>
<span class=c1># synchronization phase can take</span>
<span class=nv>initLimit</span><span class=o>=</span><span class=m>30000</span>
<span class=c1># The number of ticks that can pass between</span>
<span class=c1># sending a request and getting an acknowledgement</span>
<span class=nv>syncLimit</span><span class=o>=</span><span class=m>10</span>

<span class=nv>maxClientCnxns</span><span class=o>=</span><span class=m>2000</span>

<span class=nv>maxSessionTimeout</span><span class=o>=</span><span class=m>60000000</span>
<span class=c1># the directory where the snapshot is stored.</span>
<span class=nv>dataDir</span><span class=o>=</span>/opt/zookeeper/<span class=o>{{</span> cluster<span class=o>[</span><span class=s1>&#39;name&#39;</span><span class=o>]</span> <span class=o>}}</span>/data
<span class=c1># Place the dataLogDir to a separate physical disc for better performance</span>
<span class=nv>dataLogDir</span><span class=o>=</span>/opt/zookeeper/<span class=o>{{</span> cluster<span class=o>[</span><span class=s1>&#39;name&#39;</span><span class=o>]</span> <span class=o>}}</span>/logs

autopurge.snapRetainCount<span class=o>=</span><span class=m>10</span>
autopurge.purgeInterval<span class=o>=</span><span class=m>1</span>


<span class=c1># To avoid seeks ZooKeeper allocates space in the transaction log file in</span>
<span class=c1># blocks of preAllocSize kilobytes. The default block size is 64M. One reason</span>
<span class=c1># for changing the size of the blocks is to reduce the block size if snapshots</span>
<span class=c1># are taken more often. (Also, see snapCount).</span>
<span class=nv>preAllocSize</span><span class=o>=</span><span class=m>131072</span>

<span class=c1># Clients can submit requests faster than ZooKeeper can process them,</span>
<span class=c1># especially if there are a lot of clients. To prevent ZooKeeper from running</span>
<span class=c1># out of memory due to queued requests, ZooKeeper will throttle clients so that</span>
<span class=c1># there is no more than globalOutstandingLimit outstanding requests in the</span>
<span class=c1># system. The default limit is 1,000.ZooKeeper logs transactions to a</span>
<span class=c1># transaction log. After snapCount transactions are written to a log file a</span>
<span class=c1># snapshot is started and a new transaction log file is started. The default</span>
<span class=c1># snapCount is 10,000.</span>
<span class=nv>snapCount</span><span class=o>=</span><span class=m>3000000</span>

<span class=c1># If this option is defined, requests will be will logged to a trace file named</span>
<span class=c1># traceFile.year.month.day.</span>
<span class=c1>#traceFile=</span>

<span class=c1># Leader accepts client connections. Default value is &quot;yes&quot;. The leader machine</span>
<span class=c1># coordinates updates. For higher update throughput at thes slight expense of</span>
<span class=c1># read throughput the leader can be configured to not accept clients and focus</span>
<span class=c1># on coordination.</span>
<span class=nv>leaderServes</span><span class=o>=</span>yes

<span class=nv>standaloneEnabled</span><span class=o>=</span><span class=nb>false</span>
<span class=nv>dynamicConfigFile</span><span class=o>=</span>/etc/zookeeper-<span class=o>{{</span> cluster<span class=o>[</span><span class=s1>&#39;name&#39;</span><span class=o>]</span> <span class=o>}}</span>/conf/zoo.cfg.dynamic
</code></pre></div> <p>Java version:</p> <div class=codehilite><pre><span></span><code><span class=err>Java(TM) SE Runtime Environment (build 1.8.0_25-b17)</span>
<span class=err>Java HotSpot(TM) 64-Bit Server VM (build 25.25-b02, mixed mode)</span>
</code></pre></div> <p>JVM parameters:</p> <div class=codehilite><pre><span></span><code><span class=nv>NAME</span><span class=o>=</span>zookeeper-<span class=o>{{</span> cluster<span class=o>[</span><span class=s1>&#39;name&#39;</span><span class=o>]</span> <span class=o>}}</span>
<span class=nv>ZOOCFGDIR</span><span class=o>=</span>/etc/<span class=nv>$NAME</span>/conf

<span class=c1># TODO this is really ugly</span>
<span class=c1># How to find out, which jars are needed?</span>
<span class=c1># seems, that log4j requires the log4j.properties file to be in the classpath</span>
<span class=nv>CLASSPATH</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$ZOOCFGDIR</span><span class=s2>:/usr/build/classes:/usr/build/lib/*.jar:/usr/share/zookeeper/zookeeper-3.5.1-metrika.jar:/usr/share/zookeeper/slf4j-log4j12-1.7.5.jar:/usr/share/zookeeper/slf4j-api-1.7.5.jar:/usr/share/zookeeper/servlet-api-2.5-20081211.jar:/usr/share/zookeeper/netty-3.7.0.Final.jar:/usr/share/zookeeper/log4j-1.2.16.jar:/usr/share/zookeeper/jline-2.11.jar:/usr/share/zookeeper/jetty-util-6.1.26.jar:/usr/share/zookeeper/jetty-6.1.26.jar:/usr/share/zookeeper/javacc.jar:/usr/share/zookeeper/jackson-mapper-asl-1.9.11.jar:/usr/share/zookeeper/jackson-core-asl-1.9.11.jar:/usr/share/zookeeper/commons-cli-1.2.jar:/usr/src/java/lib/*.jar:/usr/etc/zookeeper&quot;</span>

<span class=nv>ZOOCFG</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$ZOOCFGDIR</span><span class=s2>/zoo.cfg&quot;</span>
<span class=nv>ZOO_LOG_DIR</span><span class=o>=</span>/var/log/<span class=nv>$NAME</span>
<span class=nv>USER</span><span class=o>=</span>zookeeper
<span class=nv>GROUP</span><span class=o>=</span>zookeeper
<span class=nv>PIDDIR</span><span class=o>=</span>/var/run/<span class=nv>$NAME</span>
<span class=nv>PIDFILE</span><span class=o>=</span><span class=nv>$PIDDIR</span>/<span class=nv>$NAME</span>.pid
<span class=nv>SCRIPTNAME</span><span class=o>=</span>/etc/init.d/<span class=nv>$NAME</span>
<span class=nv>JAVA</span><span class=o>=</span>/usr/bin/java
<span class=nv>ZOOMAIN</span><span class=o>=</span><span class=s2>&quot;org.apache.zookeeper.server.quorum.QuorumPeerMain&quot;</span>
<span class=nv>ZOO_LOG4J_PROP</span><span class=o>=</span><span class=s2>&quot;INFO,ROLLINGFILE&quot;</span>
<span class=nv>JMXLOCALONLY</span><span class=o>=</span><span class=nb>false</span>
<span class=nv>JAVA_OPTS</span><span class=o>=</span><span class=s2>&quot;-Xms{{ cluster.get(&#39;xms&#39;,&#39;128M&#39;) }} \</span>
<span class=s2>    -Xmx{{ cluster.get(&#39;xmx&#39;,&#39;1G&#39;) }} \</span>
<span class=s2>    -Xloggc:/var/log/</span><span class=nv>$NAME</span><span class=s2>/zookeeper-gc.log \</span>
<span class=s2>    -XX:+UseGCLogFileRotation \</span>
<span class=s2>    -XX:NumberOfGCLogFiles=16 \</span>
<span class=s2>    -XX:GCLogFileSize=16M \</span>
<span class=s2>    -verbose:gc \</span>
<span class=s2>    -XX:+PrintGCTimeStamps \</span>
<span class=s2>    -XX:+PrintGCDateStamps \</span>
<span class=s2>    -XX:+PrintGCDetails</span>
<span class=s2>    -XX:+PrintTenuringDistribution \</span>
<span class=s2>    -XX:+PrintGCApplicationStoppedTime \</span>
<span class=s2>    -XX:+PrintGCApplicationConcurrentTime \</span>
<span class=s2>    -XX:+PrintSafepointStatistics \</span>
<span class=s2>    -XX:+UseParNewGC \</span>
<span class=s2>    -XX:+UseConcMarkSweepGC \</span>
<span class=s2>-XX:+CMSParallelRemarkEnabled&quot;</span>
</code></pre></div> <p>Salt init:</p> <div class=codehilite><pre><span></span><code>description &quot;zookeeper-{{ cluster[&#39;name&#39;] }} centralized coordination service&quot;

start on runlevel [2345]
stop on runlevel [!2345]

respawn

limit nofile 8192 8192

pre-start script
    [ -r &quot;/etc/zookeeper-{{ cluster[&#39;name&#39;] }}/conf/environment&quot; ] || exit 0
    . /etc/zookeeper-{{ cluster[&#39;name&#39;] }}/conf/environment
    [ -d <span class=nv>$ZOO_LOG_DIR</span> ] || mkdir -p <span class=nv>$ZOO_LOG_DIR</span>
    chown <span class=nv>$USER</span>:<span class=nv>$GROUP</span> <span class=nv>$ZOO_LOG_DIR</span>
end script

script
    . /etc/zookeeper-{{ cluster[&#39;name&#39;] }}/conf/environment
    [ -r /etc/default/zookeeper ] <span class=err>&amp;&amp;</span> . /etc/default/zookeeper
    if [ -z &quot;<span class=nv>$JMXDISABLE</span>&quot; ]; then
        JAVA_OPTS=&quot;<span class=nv>$JAVA_OPTS</span> -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.local.only=<span class=nv>$JMXLOCALONLY</span>&quot;
    fi
    exec start-stop-daemon --start -c <span class=nv>$USER</span> --exec <span class=nv>$JAVA</span> --name zookeeper-{{ cluster[&#39;name&#39;] }} \
        -- -cp <span class=nv>$CLASSPATH</span> <span class=nv>$JAVA_OPTS</span> -Dzookeeper.log.dir=<span class=cp>${</span><span class=n>ZOO_LOG_DIR</span><span class=cp>}</span> \
        -Dzookeeper.root.logger=<span class=cp>${</span><span class=n>ZOO_LOG4J_PROP</span><span class=cp>}</span> <span class=nv>$ZOOMAIN</span> <span class=nv>$ZOOCFG</span>
end script
</code></pre></div> </div> <div id=content-footer class="text-muted pt-5"> <div class=float-right>©2016–2020 Yandex LLC</div> <div>建于 <a href=https://github.com/ClickHouse/ClickHouse/commit/3166eab2dfc89323b9d756aeba6866381fd9c186 rel="external nofollow noreferrer" target=_blank class=text-reset>3166eab2df</a></div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>目录</label> <a href=#cpu title=CPU class="nav-link text-wrap d-inline-block w-100"> CPU </a> <a href=#hyper-threading title=Hyper-threading class="nav-link text-wrap d-inline-block w-100"> Hyper-threading </a> <a href=#turbo-boost title="Turbo Boost" class="nav-link text-wrap d-inline-block w-100"> Turbo Boost </a> <a href=#cpu-scaling-governor title="CPU Scaling Governor" class="nav-link text-wrap d-inline-block w-100"> CPU Scaling Governor </a> <a href=#cpu-limitations title="CPU Limitations" class="nav-link text-wrap d-inline-block w-100"> CPU Limitations </a> <a href=#ram title=RAM class="nav-link text-wrap d-inline-block w-100"> RAM </a> <a href=#swap-file title="Swap File" class="nav-link text-wrap d-inline-block w-100"> Swap File </a> <a href=#huge-pages title="Huge Pages" class="nav-link text-wrap d-inline-block w-100"> Huge Pages </a> <a href=#storage-subsystem title="Storage Subsystem" class="nav-link text-wrap d-inline-block w-100"> Storage Subsystem </a> <a href=#raid title=RAID class="nav-link text-wrap d-inline-block w-100"> RAID </a> <a href=#file-system title="File System" class="nav-link text-wrap d-inline-block w-100"> File System </a> <a href=#linux-kernel title="Linux Kernel" class="nav-link text-wrap d-inline-block w-100"> Linux Kernel </a> <a href=#network title=Network class="nav-link text-wrap d-inline-block w-100"> Network </a> <a href=#zookeeper title=ZooKeeper class="nav-link text-wrap d-inline-block w-100"> ZooKeeper </a> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?7bd05efd></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>