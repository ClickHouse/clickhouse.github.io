<!DOCTYPE html><html lang=ru data-version=master data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Обзор архитектуры ClickHouse - Документация ClickHouse</title><link rel="shortcut icon" href=/favicon.ico><meta property=og:title content="Обзор архитектуры ClickHouse - Документация ClickHouse "><meta property=og:description content="Обзор архитектуры ClickHouse ClickHouse-это настоящая СУБД, ориентированная на столбцы. Данные хранятся столбцами и во в"><meta property=og:type content=website><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta property=twitter:title content="Обзор архитектуры ClickHouse - Документация ClickHouse "><meta name=description content="Обзор архитектуры ClickHouse ClickHouse-это настоящая СУБД, ориентированная на столбцы. Данные хранятся столбцами и во в"><meta name=keywords content="ClickHouse, DBMS, OLAP, relational, analytics, analytical, big data, open-source, SQL, web-analytics"><link href=/css/base.css?1d858e50 media=all rel=stylesheet></head> <body dir=ltr data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> Обзор архитектуры ClickHouse </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li class=nav-item> <a href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/ru/development/architecture.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/ru.svg alt=Русский title=Русский width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/en/development/architecture/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/zh/development/architecture/ class=dropdown-item> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/es/development/architecture/ class=dropdown-item> <img src=/images/flags/es.svg alt title width=32 class="d-inline-block mr-2">Español </a> <a href=/docs/fr/development/architecture/ class=dropdown-item> <img src=/images/flags/fr.svg alt title width=32 class="d-inline-block mr-2">Français </a> <a href=/docs/ru/development/architecture/ class="dropdown-item disabled"> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/ja/development/architecture/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> <a href=/docs/fa/development/architecture/ class=dropdown-item> <img src=/images/flags/fa.svg alt title width=32 class="d-inline-block mr-2">فارسی </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class=container-fluid> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label="Многостраничный или одностраничный"> <a href=../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt="Многостраничная версия" title="Многостраничная версия"> </a> <a href=../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt="Одностраничная версия" title="Одностраничная версия"> </a> </div> <div class="dropdown mb-3"> <a class="btn btn-dark dropdown-toggle text-muted" href=# role=button id=select-version data-toggle=dropdown aria-haspopup=true aria-expanded=false> Версия: <span class=text-light>последняя</span> </a> <div class="dropdown-menu bg-dark text-muted p-1" aria-labelledby=select-version> <a href=/docs/ru/ class="dropdown-item disable"> <span class=text-light>последняя</span> </a> <a href=/docs/v20.3/ru/ class=dropdown-item>v20.3</a> <a href=/docs/v20.1/ru/ class=dropdown-item>v20.1</a> <a href=/docs/v19.17/ru/ class=dropdown-item>v19.17</a> <a href=/docs/v19.16/ru/ class=dropdown-item>v19.16</a> <a href=/docs/v19.15/ru/ class=dropdown-item>v19.15</a> <a href=/docs/v19.14/ru/ class=dropdown-item>v19.14</a> <a href=/docs/v19.13/ru/ class=dropdown-item>v19.13</a> <a href=/docs/v19.11/ru/ class=dropdown-item>v19.11</a> <a href=/docs/v19.10/ru/ class=dropdown-item>v19.10</a> <a href=/docs/v19.9/ru/ class=dropdown-item>v19.9</a> <a href=/docs/v19.8/ru/ class=dropdown-item>v19.8</a> </div> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=Introduction class="nav-link text-light text-wrap dropdown-toggle px-0">Introduction</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../introduction/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../introduction/info/ title="Информационная поддержка" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Информационная поддержка</a> <a href=../../introduction/history/ title="История ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">История ClickHouse</a> <a href=../../introduction/features_considered_disadvantages/ title="Особенности ClickHouse, которые могут считаться недостатками" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Особенности ClickHouse, которые могут считаться недостатками</a> <a href=../../introduction/distinctive_features/ title="Отличительные возможности ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Отличительные возможности ClickHouse</a> <a href=../../introduction/performance/ title=Производительность class="nav-link text-light text-wrap d-inline-block w-100 px-0">Производительность</a> <a href=../../introduction/adopters/ title="Усыновители ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Усыновители ClickHouse</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title=Engines class="nav-link text-light text-wrap dropdown-toggle px-0">Engines</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/ title=Engines class="nav-link text-light text-wrap d-inline-block w-100 px-0">Engines</a> <a href=#sidebar-sidebar-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-2 title="Движки баз данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Движки баз данных</a> <div id=sidebar-sidebar-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/database_engines/lazy/ title=Lazy class="nav-link text-light text-wrap d-inline-block w-100 px-0">Lazy</a> <a href=../../engines/database_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../engines/database_engines/ title="Движки баз данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Движки баз данных</a> </nav> </div> <a href=#sidebar-sidebar-2-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-3 title="Движки таблиц" class="nav-link text-light text-wrap dropdown-toggle px-0">Движки таблиц</a> <div id=sidebar-sidebar-2-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-2-3-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-3-1 title="MergeTree Family" class="nav-link text-light text-wrap dropdown-toggle px-0">MergeTree Family</a> <div id=sidebar-sidebar-2-3-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table_engines/mergetree_family/ title="MergeTree Family" class="nav-link text-light text-wrap d-inline-block w-100 px-0">MergeTree Family</a> <a href=../../engines/table_engines/mergetree_family/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../engines/table_engines/mergetree_family/collapsingmergetree/ title=CollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">CollapsingMergeTree</a> <a href=../../engines/table_engines/mergetree_family/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> <a href=../../engines/table_engines/mergetree_family/mergetree/ title=MergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../engines/table_engines/mergetree_family/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../engines/table_engines/mergetree_family/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../engines/table_engines/mergetree_family/versionedcollapsingmergetree/ title=VersionedCollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">VersionedCollapsingMergeTree</a> <a href=../../engines/table_engines/mergetree_family/custom_partitioning_key/ title="Произвольный ключ партиционирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Произвольный ключ партиционирования</a> <a href=../../engines/table_engines/mergetree_family/replication/ title="Репликация данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Репликация данных</a> </nav> </div> <a href=#sidebar-sidebar-2-3-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-3-2 title="Log Family" class="nav-link text-light text-wrap dropdown-toggle px-0">Log Family</a> <div id=sidebar-sidebar-2-3-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table_engines/log_family/ title="Log Family" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log Family</a> <a href=../../engines/table_engines/log_family/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../engines/table_engines/log_family/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../engines/table_engines/log_family/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> <a href=../../engines/table_engines/log_family/log_family/ title="Семейство Log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Семейство Log</a> </nav> </div> <a href=#sidebar-sidebar-2-3-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-3-3 title=Integrations class="nav-link text-light text-wrap dropdown-toggle px-0">Integrations</a> <div id=sidebar-sidebar-2-3-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table_engines/integrations/ title=Integrations class="nav-link text-light text-wrap d-inline-block w-100 px-0">Integrations</a> <a href=../../engines/table_engines/integrations/hdfs/ title=HDFS class="nav-link text-light text-wrap d-inline-block w-100 px-0">HDFS</a> <a href=../../engines/table_engines/integrations/jdbc/ title=JDBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC</a> <a href=../../engines/table_engines/integrations/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../engines/table_engines/integrations/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../engines/table_engines/integrations/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> </nav> </div> <a href=#sidebar-sidebar-2-3-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-3-4 title=Special class="nav-link text-light text-wrap dropdown-toggle px-0">Special</a> <div id=sidebar-sidebar-2-3-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table_engines/special/ title=Special class="nav-link text-light text-wrap d-inline-block w-100 px-0">Special</a> <a href=../../engines/table_engines/special/buffer/ title=Buffer class="nav-link text-light text-wrap d-inline-block w-100 px-0">Buffer</a> <a href=../../engines/table_engines/special/dictionary/ title=Dictionary class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary</a> <a href=../../engines/table_engines/special/distributed/ title=Distributed class="nav-link text-light text-wrap d-inline-block w-100 px-0">Distributed</a> <a href=../../engines/table_engines/special/file/ title=File(Format) class="nav-link text-light text-wrap d-inline-block w-100 px-0">File(Format)</a> <a href=../../engines/table_engines/special/generate/ title=GenerateRandom class="nav-link text-light text-wrap d-inline-block w-100 px-0">GenerateRandom</a> <a href=../../engines/table_engines/special/join/ title=Join class="nav-link text-light text-wrap d-inline-block w-100 px-0">Join</a> <a href=../../engines/table_engines/special/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../engines/table_engines/special/memory/ title=Memory class="nav-link text-light text-wrap d-inline-block w-100 px-0">Memory</a> <a href=../../engines/table_engines/special/merge/ title=Merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">Merge</a> <a href=../../engines/table_engines/special/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../engines/table_engines/special/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../engines/table_engines/special/url/ title="URL(URL, Format)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL(URL, Format)</a> <a href=../../engines/table_engines/special/view/ title=View class="nav-link text-light text-wrap d-inline-block w-100 px-0">View</a> <a href=../../engines/table_engines/special/external_data/ title="Внешние данные для обработки запроса" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Внешние данные для обработки запроса</a> </nav> </div> <a href=../../engines/table_engines/ title="Движки таблиц" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Движки таблиц</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=Commercial class="nav-link text-light text-wrap dropdown-toggle px-0">Commercial</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../commercial/ title=Commercial class="nav-link text-light text-wrap d-inline-block w-100 px-0">Commercial</a> <a href=../../commercial/cloud/ title="Поставщики облачных услуг ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Поставщики облачных услуг ClickHouse</a> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title="What's New" class="nav-link text-light text-wrap dropdown-toggle px-0">What's New</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../whats_new/ title="What's New" class="nav-link text-light text-wrap d-inline-block w-100 px-0">What's New</a> <a href=#sidebar-sidebar-4-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2 title=Changelog class="nav-link text-light text-wrap dropdown-toggle px-0">Changelog</a> <div id=sidebar-sidebar-4-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../whats_new/changelog/ title=2020 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2020</a> <a href=../../whats_new/changelog/2017/ title="ClickHouse релиз 1.1.54327, 2017-12-21" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse релиз 1.1.54327, 2017-12-21</a> <a href=../../whats_new/changelog/2018/ title="ClickHouse релиз 18.16" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse релиз 18.16</a> <a href=../../whats_new/changelog/2019/ title="Релиз ClickHouse в19.17" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Релиз ClickHouse в19.17</a> </nav> </div> <a href=../../whats_new/roadmap/ title="Дорожная карта" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Дорожная карта</a> <a href=../../whats_new/security_changelog/ title="Исправлено в релизе 19.14.3.3, 2019-09-10" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Исправлено в релизе 19.14.3.3, 2019-09-10</a> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title=F.A.Q. class="nav-link text-light text-wrap dropdown-toggle px-0">F.A.Q.</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../faq/ title=F.A.Q. class="nav-link text-light text-wrap d-inline-block w-100 px-0">F.A.Q.</a> <a href=../../faq/general/ title="Общие вопросы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Общие вопросы</a> </nav> </div> <a href=../../extended_roadmap/ title="Планы разработки ClickHouse 2020" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Планы разработки ClickHouse 2020</a> <a href=../../ title="Что такое ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Что такое ClickHouse</a> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=Интерфейсы class="nav-link text-light text-wrap dropdown-toggle px-0">Интерфейсы</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-8-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-1 title=Third-Party class="nav-link text-light text-wrap dropdown-toggle px-0">Third-Party</a> <div id=sidebar-sidebar-8-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/third-party/ title=Third-Party class="nav-link text-light text-wrap d-inline-block w-100 px-0">Third-Party</a> <a href=../../interfaces/third-party/integrations/ title="Библиотеки для интеграции от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Библиотеки для интеграции от сторонних разработчиков</a> <a href=../../interfaces/third-party/gui/ title="Визуальные интерфейсы от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Визуальные интерфейсы от сторонних разработчиков</a> <a href=../../interfaces/third-party/client_libraries/ title="Клиентские библиотеки от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиентские библиотеки от сторонних разработчиков</a> <a href=../../interfaces/third-party/proxy/ title="Прокси-серверы от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прокси-серверы от сторонних разработчиков</a> </nav> </div> <a href=../../interfaces/cpp/ title="C++ клиентская библиотека" class="nav-link text-light text-wrap d-inline-block w-100 px-0">C++ клиентская библиотека</a> <a href=../../interfaces/http/ title=HTTP-интерфейс class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP-интерфейс</a> <a href=../../interfaces/jdbc/ title=JDBC-драйвер class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC-драйвер</a> <a href=../../interfaces/mysql/ title=MySQL-интерфейс class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL-интерфейс</a> <a href=../../interfaces/odbc/ title=ODBC-драйвер class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC-драйвер</a> <a href=../../interfaces/ title=Интерфейсы class="nav-link text-light text-wrap d-inline-block w-100 px-0">Интерфейсы</a> <a href=../../interfaces/cli/ title="Клиент командной строки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиент командной строки</a> <a href=../../interfaces/tcp/ title="Родной интерфейс (TCP)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Родной интерфейс (TCP)</a> <a href=../../interfaces/formats/ title="Форматы входных и выходных данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Форматы входных и выходных данных</a> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title="Начало работы" class="nav-link text-light text-wrap dropdown-toggle px-0">Начало работы</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/playground/ title="ClickHouse Playground" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse Playground</a> <a href=../../getting_started/ title="Начало работы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Начало работы</a> <a href=../../getting_started/install/ title=Установка class="nav-link text-light text-wrap d-inline-block w-100 px-0">Установка</a> <a href=../../getting_started/tutorial/ title="Учебник По Клик-Хаусу" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Учебник По Клик-Хаусу</a> <a href=#sidebar-sidebar-9-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9-5 title="Тестовые массивы данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Тестовые массивы данных</a> <div id=sidebar-sidebar-9-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/example_datasets/amplab_benchmark/ title="AMPLab Big Data Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AMPLab Big Data Benchmark</a> <a href=../../getting_started/example_datasets/ontime/ title=OnTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">OnTime</a> <a href=../../getting_started/example_datasets/star_schema/ title="Star Schema Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Star Schema Benchmark</a> <a href=../../getting_started/example_datasets/wikistat/ title=WikiStat class="nav-link text-light text-wrap d-inline-block w-100 px-0">WikiStat</a> <a href=../../getting_started/example_datasets/metrica/ title="Анонимизированные данные Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Анонимизированные данные Яндекс.Метрики</a> <a href=../../getting_started/example_datasets/nyc_taxi/ title="Данные о такси в Нью-Йорке" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Данные о такси в Нью-Йорке</a> <a href=../../getting_started/example_datasets/criteo/ title="Терабайт логов кликов от Criteo" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Терабайт логов кликов от Criteo</a> <a href=../../getting_started/example_datasets/ title="Тестовые массивы данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Тестовые массивы данных</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title="Разработка ClickHouse" class="nav-link text-light text-wrap dropdown-toggle px-0">Разработка ClickHouse</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../development/developer_instruction/ title="Если вы используете Windows" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Если вы используете Windows</a> <a href=../../development/contrib/ title="Используемые сторонние библиотеки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Используемые сторонние библиотеки</a> <a href=../../development/style/ title="Как писать код на C++" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как писать код на C++</a> <a href=../../development/build/ title="Как построить ClickHouse для развития" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как построить ClickHouse для развития</a> <a href=../../development/build_cross_osx/ title="Как построить ClickHouse на Linux для Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как построить ClickHouse на Linux для Mac OS X</a> <a href=../../development/build_cross_arm/ title="Как построить ClickHouse на Linux для архитектуры AArch64 (ARM64)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как построить ClickHouse на Linux для архитектуры AArch64 (ARM64)</a> <a href=../../development/build_osx/ title="Как построить ClickHouse на Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как построить ClickHouse на Mac OS X</a> <a href=../../development/browse_code/ title="Навигация по коду ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Навигация по коду ClickHouse</a> <a href=../../development/architecture/ title="Обзор архитектуры ClickHouse" class="nav-link text-white active text-wrap d-inline-block w-100 px-0">Обзор архитектуры ClickHouse</a> <a href=../../development/ title="Разработка ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Разработка ClickHouse</a> <a href=../../development/tests/ title="Тестирование ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Тестирование ClickHouse</a> </nav> </div> <a href=#sidebar-sidebar-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-11 title=Руководства class="nav-link text-light text-wrap dropdown-toggle px-0">Руководства</a> <div id=sidebar-sidebar-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../guides/apply_catboost_model/ title="Применение модели CatBoost в ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Применение модели CatBoost в ClickHouse</a> <a href=../../guides/ title=Руководства class="nav-link text-light text-wrap d-inline-block w-100 px-0">Руководства</a> </nav> </div> <a href=#sidebar-sidebar-12 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12 title="Справка по SQL" class="nav-link text-light text-wrap dropdown-toggle px-0">Справка по SQL</a> <div id=sidebar-sidebar-12 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-12-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12-1 title=Statements class="nav-link text-light text-wrap dropdown-toggle px-0">Statements</a> <div id=sidebar-sidebar-12-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql_reference/statements/ title=Statements class="nav-link text-light text-wrap d-inline-block w-100 px-0">Statements</a> <a href=../../sql_reference/statements/alter/ title=ALTER class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../sql_reference/statements/create/ title="CREATE DATABASE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">CREATE DATABASE</a> <a href=../../sql_reference/statements/insert_into/ title=INSERT class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT</a> <a href=../../sql_reference/statements/show/ title="SHOW Queries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SHOW Queries</a> <a href=../../sql_reference/statements/system/ title="Запросы SYSTEM" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Запросы SYSTEM</a> <a href=../../sql_reference/statements/misc/ title="Прочие виды запросов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прочие виды запросов</a> <a href=../../sql_reference/statements/select/ title="Синтаксис запросов SELECT" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Синтаксис запросов SELECT</a> </nav> </div> <a href=../../sql_reference/operators/ title=Операторы class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операторы</a> <a href=../../sql_reference/syntax/ title=Синтаксис class="nav-link text-light text-wrap d-inline-block w-100 px-0">Синтаксис</a> <a href=../../sql_reference/ title="Справка по SQL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Справка по SQL</a> <a href=#sidebar-sidebar-12-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12-5 title="Агрегатные функции" class="nav-link text-light text-wrap dropdown-toggle px-0">Агрегатные функции</a> <div id=sidebar-sidebar-12-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql_reference/aggregate_functions/ title="Агрегатные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Агрегатные функции</a> <a href=../../sql_reference/aggregate_functions/combinators/ title="Комбинаторы агрегатных функций" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Комбинаторы агрегатных функций</a> <a href=../../sql_reference/aggregate_functions/parametric_functions/ title="Параметрические агрегатные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Параметрические агрегатные функции</a> <a href=../../sql_reference/aggregate_functions/reference/ title="Справочник функций" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Справочник функций</a> </nav> </div> <a href=#sidebar-sidebar-12-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12-6 title=Словари class="nav-link text-light text-wrap dropdown-toggle px-0">Словари</a> <div id=sidebar-sidebar-12-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-12-6-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12-6-1 title="External Dictionaries" class="nav-link text-light text-wrap dropdown-toggle px-0">External Dictionaries</a> <div id=sidebar-sidebar-12-6-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql_reference/dictionaries/external_dictionaries/ title="External Dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">External Dictionaries</a> <a href=../../sql_reference/dictionaries/external_dictionaries/external_dicts/ title="Внешние словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Внешние словари</a> <a href=../../sql_reference/dictionaries/external_dictionaries/external_dicts_dict_hierarchical/ title="Иерархические словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Иерархические словари</a> <a href=../../sql_reference/dictionaries/external_dictionaries/external_dicts_dict_sources/ title="Источники внешних словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Источники внешних словарей</a> <a href=../../sql_reference/dictionaries/external_dictionaries/external_dicts_dict_structure/ title="Ключ и поля словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ключ и поля словаря</a> <a href=../../sql_reference/dictionaries/external_dictionaries/external_dicts_dict/ title="Настройка внешнего словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройка внешнего словаря</a> <a href=../../sql_reference/dictionaries/external_dictionaries/external_dicts_dict_lifetime/ title="Обновление словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление словарей</a> <a href=../../sql_reference/dictionaries/external_dictionaries/external_dicts_dict_layout/ title="Хранение словарей в памяти" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Хранение словарей в памяти</a> </nav> </div> <a href=../../sql_reference/dictionaries/internal_dicts/ title="Встроенные словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Встроенные словари</a> <a href=../../sql_reference/dictionaries/ title=Словари class="nav-link text-light text-wrap d-inline-block w-100 px-0">Словари</a> </nav> </div> <a href=#sidebar-sidebar-12-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12-7 title="Табличные функции" class="nav-link text-light text-wrap dropdown-toggle px-0">Табличные функции</a> <div id=sidebar-sidebar-12-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql_reference/table_functions/file/ title=file class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a> <a href=../../sql_reference/table_functions/generate/ title=generate class="nav-link text-light text-wrap d-inline-block w-100 px-0">generate</a> <a href=../../sql_reference/table_functions/hdfs/ title=hdfs class="nav-link text-light text-wrap d-inline-block w-100 px-0">hdfs</a> <a href=../../sql_reference/table_functions/input/ title=input class="nav-link text-light text-wrap d-inline-block w-100 px-0">input</a> <a href=../../sql_reference/table_functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../sql_reference/table_functions/merge/ title=merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a> <a href=../../sql_reference/table_functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../sql_reference/table_functions/numbers/ title=numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a> <a href=../../sql_reference/table_functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> <a href=../../sql_reference/table_functions/remote/ title="remote, remoteSecure" class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote, remoteSecure</a> <a href=../../sql_reference/table_functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../sql_reference/table_functions/ title="Табличные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Табличные функции</a> </nav> </div> <a href=#sidebar-sidebar-12-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12-8 title="Типы данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Типы данных</a> <div id=sidebar-sidebar-12-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-12-8-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12-8-1 title=Domains class="nav-link text-light text-wrap dropdown-toggle px-0">Domains</a> <div id=sidebar-sidebar-12-8-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql_reference/data_types/domains/ title=Domains class="nav-link text-light text-wrap d-inline-block w-100 px-0">Domains</a> <a href=../../sql_reference/data_types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../sql_reference/data_types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> <a href=../../sql_reference/data_types/domains/overview/ title=Домены class="nav-link text-light text-wrap d-inline-block w-100 px-0">Домены</a> </nav> </div> <a href=../../sql_reference/data_types/aggregatefunction/ title="AggregateFunction(name, types\_of\_arguments…)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction(name, types\_of\_arguments…)</a> <a href=../../sql_reference/data_types/array/ title=Array(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Array(T)</a> <a href=../../sql_reference/data_types/date/ title=Date class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date</a> <a href=../../sql_reference/data_types/datetime/ title=DateTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime</a> <a href=../../sql_reference/data_types/datetime64/ title=DateTime64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime64</a> <a href=../../sql_reference/data_types/decimal/ title="Decimal(P, S), Decimal32(S), Decimal64(S), Decimal128(S)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal(P, S), Decimal32(S), Decimal64(S), Decimal128(S)</a> <a href=../../sql_reference/data_types/enum/ title=Enum class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum</a> <a href=../../sql_reference/data_types/fixedstring/ title=FixedString class="nav-link text-light text-wrap d-inline-block w-100 px-0">FixedString</a> <a href=../../sql_reference/data_types/float/ title="Float32, Float64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32, Float64</a> <a href=../../sql_reference/data_types/nullable/ title=Nullable(TypeName) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable(TypeName)</a> <a href=../../sql_reference/data_types/string/ title=String class="nav-link text-light text-wrap d-inline-block w-100 px-0">String</a> <a href=../../sql_reference/data_types/tuple/ title="Tuple(T1, T2, …)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, …)</a> <a href=../../sql_reference/data_types/int_uint/ title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</a> <a href=../../sql_reference/data_types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../sql_reference/data_types/boolean/ title="Булевы значения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Булевы значения</a> <a href=../../sql_reference/data_types/ title="Типы данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Типы данных</a> <a href=#sidebar-sidebar-12-8-18 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12-8-18 title="Вложенные структуры данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Вложенные структуры данных</a> <div id=sidebar-sidebar-12-8-18 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql_reference/data_types/nested_data_structures/nested/ title="Nested(Name1 Type1, Name2 Type2, …)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, …)</a> <a href=../../sql_reference/data_types/nested_data_structures/ title="Вложенные структуры данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Вложенные структуры данных</a> </nav> </div> <a href=#sidebar-sidebar-12-8-19 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12-8-19 title="Служебные типы данных" class="nav-link text-light text-wrap dropdown-toggle px-0">Служебные типы данных</a> <div id=sidebar-sidebar-12-8-19 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql_reference/data_types/special_data_types/expression/ title=Expression class="nav-link text-light text-wrap d-inline-block w-100 px-0">Expression</a> <a href=../../sql_reference/data_types/special_data_types/interval/ title=Interval class="nav-link text-light text-wrap d-inline-block w-100 px-0">Interval</a> <a href=../../sql_reference/data_types/special_data_types/nothing/ title=Nothing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nothing</a> <a href=../../sql_reference/data_types/special_data_types/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../sql_reference/data_types/special_data_types/ title="Служебные типы данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Служебные типы данных</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-12-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12-9 title=Функции class="nav-link text-light text-wrap dropdown-toggle px-0">Функции</a> <div id=sidebar-sidebar-12-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql_reference/functions/arithmetic_functions/ title="Арифметические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Арифметические функции</a> <a href=../../sql_reference/functions/bit_functions/ title="Битовые функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Битовые функции</a> <a href=../../sql_reference/functions/logical_functions/ title="Логические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Логические функции</a> <a href=../../sql_reference/functions/math_functions/ title="Математические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Математические функции</a> <a href=../../sql_reference/functions/other_functions/ title="Прочие функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прочие функции</a> <a href=../../sql_reference/functions/conditional_functions/ title="Условные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Условные функции</a> <a href=../../sql_reference/functions/ title=Функции class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции</a> <a href=../../sql_reference/functions/higher_order_functions/ title="Функции высшего порядка" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции высшего порядка</a> <a href=../../sql_reference/functions/random_functions/ title="Функции генерации псевдослучайных чисел" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции генерации псевдослучайных чисел</a> <a href=../../sql_reference/functions/bitmap_functions/ title="Функции для битмапов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для битмапов</a> <a href=../../sql_reference/functions/ip_address_functions/ title="Функции для работы с IP-адресами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с IP-адресами</a> <a href=../../sql_reference/functions/json_functions/ title="Функции для работы с JSON" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с JSON</a> <a href=../../sql_reference/functions/functions_for_nulls/ title="Функции для работы с Nullable-аргументами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с Nullable-аргументами</a> <a href=../../sql_reference/functions/url_functions/ title="Функции для работы с URL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с URL</a> <a href=../../sql_reference/functions/uuid_functions/ title="Функции для работы с UUID" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с UUID</a> <a href=../../sql_reference/functions/ext_dict_functions/ title="Функции для работы с внешними словарями" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с внешними словарями</a> <a href=../../sql_reference/functions/geo/ title="Функции для работы с географическими координатами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с географическими координатами</a> <a href=../../sql_reference/functions/date_time_functions/ title="Функции для работы с датами и временем" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с датами и временем</a> <a href=../../sql_reference/functions/ym_dict_functions/ title="Функции для работы со словарями Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со словарями Яндекс.Метрики</a> <a href=../../sql_reference/functions/string_functions/ title="Функции для работы со строками" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со строками</a> <a href=../../sql_reference/functions/in_functions/ title="Функции для реализации оператора IN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для реализации оператора IN</a> <a href=../../sql_reference/functions/introspection/ title="Функции интроспекции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции интроспекции</a> <a href=../../sql_reference/functions/encoding_functions/ title="Функции кодирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции кодирования</a> <a href=../../sql_reference/functions/machine_learning_functions/ title="Функции машинного обучения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции машинного обучения</a> <a href=../../sql_reference/functions/rounding_functions/ title="Функции округления" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции округления</a> <a href=../../sql_reference/functions/array_functions/ title="Функции по работе с массивами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции по работе с массивами</a> <a href=../../sql_reference/functions/string_search_functions/ title="Функции поиска в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска в строках</a> <a href=../../sql_reference/functions/string_replace_functions/ title="Функции поиска и замены в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска и замены в строках</a> <a href=../../sql_reference/functions/type_conversion_functions/ title="Функции преобразования типов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции преобразования типов</a> <a href=../../sql_reference/functions/splitting_merging_functions/ title="Функции разбиения и слияния строк и массивов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции разбиения и слияния строк и массивов</a> <a href=../../sql_reference/functions/comparison_functions/ title="Функции сравнения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции сравнения</a> <a href=../../sql_reference/functions/hash_functions/ title="Функции хэширования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции хэширования</a> <a href=../../sql_reference/functions/array_join/ title="Функция arrayJoin" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функция arrayJoin</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-13 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-13 title=Эксплуатация class="nav-link text-light text-wrap dropdown-toggle px-0">Эксплуатация</a> <div id=sidebar-sidebar-13 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-13-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-13-1 title="Optimizing Performance" class="nav-link text-light text-wrap dropdown-toggle px-0">Optimizing Performance</a> <div id=sidebar-sidebar-13-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/optimizing_performance/ title="Optimizing Performance" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Optimizing Performance</a> <a href=../../operations/optimizing_performance/sampling_query_profiler/ title="Выборки Профилировщик Запросов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Выборки Профилировщик Запросов</a> </nav> </div> <a href=../../operations/performance_test/ title="Как Протестировать Ваше Оборудование С Помощью ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как Протестировать Ваше Оборудование С Помощью ClickHouse</a> <a href=../../operations/quotas/ title=Квоты class="nav-link text-light text-wrap d-inline-block w-100 px-0">Квоты</a> <a href=../../operations/configuration_files/ title="Конфигурационные файлы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Конфигурационные файлы</a> <a href=../../operations/monitoring/ title=Мониторинг class="nav-link text-light text-wrap d-inline-block w-100 px-0">Мониторинг</a> <a href=../../operations/update/ title="Обновление ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление ClickHouse</a> <a href=../../operations/access_rights/ title="Права доступа" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Права доступа</a> <a href=../../operations/backup/ title="Резервное копирование данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Резервное копирование данных</a> <a href=../../operations/system_tables/ title="Системные таблицы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Системные таблицы</a> <a href=../../operations/tips/ title="Советы по эксплуатации" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Советы по эксплуатации</a> <a href=../../operations/requirements/ title=Требования class="nav-link text-light text-wrap d-inline-block w-100 px-0">Требования</a> <a href=../../operations/troubleshooting/ title="Устранение неисправностей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Устранение неисправностей</a> <a href=../../operations/ title=Эксплуатация class="nav-link text-light text-wrap d-inline-block w-100 px-0">Эксплуатация</a> <a href=#sidebar-sidebar-13-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-13-14 title="Конфигурационные параметры сервера" class="nav-link text-light text-wrap dropdown-toggle px-0">Конфигурационные параметры сервера</a> <div id=sidebar-sidebar-13-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/server_configuration_parameters/ title="Конфигурационные параметры сервера" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Конфигурационные параметры сервера</a> </nav> </div> <a href=#sidebar-sidebar-13-15 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-13-15 title=Настройки class="nav-link text-light text-wrap dropdown-toggle px-0">Настройки</a> <div id=sidebar-sidebar-13-15 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/settings/ title=Настройки class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки</a> <a href=../../operations/settings/settings_users/ title="Настройки пользователей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки пользователей</a> <a href=../../operations/settings/constraints_on_settings/ title="Ограничения на изменение настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на изменение настроек</a> <a href=../../operations/settings/query_complexity/ title="Ограничения на сложность запроса" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на сложность запроса</a> <a href=../../operations/settings/settings_profiles/ title="Профили настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Профили настроек</a> <a href=../../operations/settings/permissions_for_queries/ title="Разрешения для запросов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Разрешения для запросов</a> </nav> </div> <a href=#sidebar-sidebar-13-16 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-13-16 title="Утилиты ClickHouse" class="nav-link text-light text-wrap dropdown-toggle px-0">Утилиты ClickHouse</a> <div id=sidebar-sidebar-13-16 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/utilities/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../operations/utilities/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> <a href=../../operations/utilities/clickhouse-benchmark/ title=clickhouse-бенчмарк class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-бенчмарк</a> <a href=../../operations/utilities/ title="Утилиты ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Утилиты ClickHouse</a> </nav> </div> </nav> </div> <a href=../../single/clickhouse_ru.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt=PDF-версия title=PDF-версия height=24 class="d-block mr-1 float-left"><div>PDF-версия</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-5"> <div id=content> <div class="alert alert-primary" role=alert> <p class="display-5 mb-2">Помощь нужна!</p> <p class=lead>Следующее содержание этой страницы документации было переведено на машинный язык. Но в отличие от других сайтов, это делается не на лету. Этот переведенный текст живет в репозитории GitHub вместе с основной кодовой базой ClickHouse и ждет, когда другие носители языка сделают его более удобочитаемым для человека.</p> <p class=lead> <a class="btn btn-lg btn-primary text-white" href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/ru/development/architecture.md target=_blank rel="external nofollow noreferrer"> Помогите документации ClickHouse, отредактировав эту страницу </a> </p> </div> <h1 id=overview-of-clickhouse-architecture>Обзор архитектуры ClickHouse<a class=headerlink href=#overview-of-clickhouse-architecture title="Permanent link">&para;</a></h1> <p>ClickHouse-это настоящая СУБД, ориентированная на столбцы. Данные хранятся столбцами и во время выполнения массивов (векторов или кусков столбцов). Когда это возможно, операции отправляются на массивы, а не на отдельные значения. Это называется «vectorized query execution,» и это помогает снизить стоимость фактической обработки данных.</p> <blockquote> <p>В этой идее нет ничего нового. Она восходит к тому времени, когда <code>APL</code> язык программирования и его потомки: <code>A +</code>, <code>J</code>, <code>K</code>, и <code>Q</code>. Массивное программирование используется в научной обработке данных. Эта идея также не является чем-то новым в реляционных базах данных: например, она используется в <code>Vectorwise</code> система.</p> </blockquote> <p>Существует два различных подхода для ускорения обработки запросов: векторизованное выполнение запросов и генерация кода во время выполнения. Последнее устраняет все косвенные действия и динамическую диспетчеризацию. Ни один из этих подходов не является строго лучшим, чем другой. Генерация кода во время выполнения может быть лучше, когда он объединяет множество операций, таким образом полностью используя исполнительные блоки процессора и конвейер. Векторизованное выполнение запроса может быть менее практичным, поскольку оно включает временные векторы, которые должны быть записаны в кэш и считаны обратно. Если временные данные не помещаются в кэш L2, это становится проблемой. Но векторизованное выполнение запросов более легко использует возможности SIMD центрального процессора. Один <a href=http://15721.courses.cs.cmu.edu/spring2016/papers/p5-sompolski.pdf rel="external nofollow noreferrer">научная статья</a> написанное нашими друзьями показывает, что лучше сочетать оба подхода. ClickHouse использует векторизованное выполнение запросов и имеет ограниченную начальную поддержку для генерации кода во время выполнения.</p> <h2 id=columns>Столбцы<a class=headerlink href=#columns title="Permanent link">&para;</a></h2> <p><code>IColumn</code> интерфейс используется для представления столбцов в памяти (собственно, кусков столбцов). Этот интерфейс предоставляет вспомогательные методы для реализации различных реляционных операторов. Почти все операции неизменяемы: они не изменяют исходный столбец, а создают новый измененный. Например, в <code>IColumn :: filter</code> метод принимает маску байта фильтра. Он используется для <code>WHERE</code> и <code>HAVING</code> реляционный оператор. Дополнительные примеры: <code>IColumn :: permute</code> способ поддержки <code>ORDER BY</code>, этот <code>IColumn :: cut</code> способ поддержки <code>LIMIT</code>.</p> <p>Различный <code>IColumn</code> реализации (<code>ColumnUInt8</code>, <code>ColumnString</code>, и так далее) отвечают за расположение столбцов в памяти. Расположение памяти обычно представляет собой непрерывный массив. Для целочисленного типа столбцов это всего лишь один непрерывный массив, например <code>std :: vector</code>. Для <code>String</code> и <code>Array</code> столбцы, это два вектора: один для всех элементов массива, расположенных последовательно, и второй для смещений к началу каждого массива. Существует также <code>ColumnConst</code> это сохраняет только одно значение в памяти, но выглядит как столбец.</p> <h2 id=field>Поле<a class=headerlink href=#field title="Permanent link">&para;</a></h2> <p>Тем не менее, можно работать и с индивидуальными ценностями. Чтобы представить индивидуальную ценность, то <code>Field</code> предназначенный. <code>Field</code> это просто дискриминированный Союз <code>UInt64</code>, <code>Int64</code>, <code>Float64</code>, <code>String</code> и <code>Array</code>. <code>IColumn</code> имеет <code>operator[]</code> метод получения n-го значения в виде a <code>Field</code> и <code>insert</code> способ, чтобы добавить <code>Field</code> до самого конца колонны. Эти методы не очень эффективны, потому что они требуют решения временных проблем <code>Field</code> объекты, представляющие индивидуальную ценность. Существуют и более эффективные методы, такие как <code>insertFrom</code>, <code>insertRangeFrom</code> и так далее.</p> <p><code>Field</code> у него нет достаточной информации о конкретном типе данных для таблицы. Например, <code>UInt8</code>, <code>UInt16</code>, <code>UInt32</code>, и <code>UInt64</code> все они представлены в виде <code>UInt64</code> в <code>Field</code>.</p> <h2 id=leaky-abstractions>Дырявые абстракции<a class=headerlink href=#leaky-abstractions title="Permanent link">&para;</a></h2> <p><code>IColumn</code> есть методы для общих реляционных преобразований данных, но они не удовлетворяют всем потребностям. Например, <code>ColumnUInt64</code> не имеет метода для вычисления суммы двух столбцов, и <code>ColumnString</code> у него нет метода для запуска поиска по подстрокам. Эти бесчисленные процедуры реализуются за пределами <code>IColumn</code>.</p> <p>Различные функции на столбцах могут быть реализованы общим, неэффективным способом с использованием <code>IColumn</code> способы извлечения <code>Field</code> значения, или специализированным способом, использующим знание внутренней компоновки памяти данных в определенном месте. <code>IColumn</code> реализация. Он реализуется путем приведения функций к определенному виду <code>IColumn</code> тип и дело с внутренним представлением непосредственно. Например, <code>ColumnUInt64</code> имеет <code>getData</code> метод, который возвращает ссылку на внутренний массив, а затем отдельная процедура считывает или заполняет этот массив непосредственно. У нас есть «leaky abstractions» чтобы обеспечить эффективную специализацию различных процедур.</p> <h2 id=data_types>Тип данных<a class=headerlink href=#data_types title="Permanent link">&para;</a></h2> <p><code>IDataType</code> отвечает за сериализацию и десериализацию: чтение и запись фрагментов столбцов или отдельных значений в двоичной или текстовой форме. <code>IDataType</code> непосредственно соответствует типам данных в таблицах. Например, существуют <code>DataTypeUInt32</code>, <code>DataTypeDateTime</code>, <code>DataTypeString</code> и так далее.</p> <p><code>IDataType</code> и <code>IColumn</code> они лишь слабо связаны друг с другом. Различные типы данных могут быть представлены в памяти одним и тем же именем <code>IColumn</code> реализации. Например, <code>DataTypeUInt32</code> и <code>DataTypeDateTime</code> оба они представлены следующим образом <code>ColumnUInt32</code> или <code>ColumnConstUInt32</code>. Кроме того, один и тот же тип данных может быть представлен разными <code>IColumn</code> реализации. Например, <code>DataTypeUInt8</code> может быть представлен следующим образом <code>ColumnUInt8</code> или <code>ColumnConstUInt8</code>.</p> <p><code>IDataType</code> хранит только метаданные. Например, <code>DataTypeUInt8</code> не хранит вообще ничего (кроме vptr) и <code>DataTypeFixedString</code> магазины просто <code>N</code> (размер строк фиксированного размера).</p> <p><code>IDataType</code> имеет вспомогательные методы для различных форматов данных. Примерами являются методы сериализации значения с возможным цитированием, сериализации значения для JSON и сериализации значения в формате XML. Прямого соответствия форматам данных не существует. Например, различные форматы данных <code>Pretty</code> и <code>TabSeparated</code> можно использовать то же самое <code>serializeTextEscaped</code> вспомогательный метод от <code>IDataType</code> интерфейс.</p> <h2 id=block>Блок<a class=headerlink href=#block title="Permanent link">&para;</a></h2> <p>A <code>Block</code> это контейнер, представляющий подмножество (фрагмент) таблицы в памяти. Это всего лишь набор троек: <code>(IColumn, IDataType, column name)</code>. Во время выполнения запроса данные обрабатываются с помощью <code>Block</code>s. Если у нас есть <code>Block</code>, у нас есть данные (в <code>IColumn</code> объект), у нас есть информация о его типе (в <code>IDataType</code>) это говорит нам, как обращаться с этим столбцом, и у нас есть имя столбца. Это может быть либо исходное имя столбца из таблицы, либо какое-то искусственное имя, назначенное для получения временных результатов вычислений.</p> <p>Когда мы вычисляем некоторую функцию по столбцам в блоке, мы добавляем другой столбец с его результатом в блок, и мы не касаемся столбцов для аргументов функции, потому что операции неизменяемы. Позже ненужные столбцы могут быть удалены из блока, но не изменены. Это удобно для исключения общих подвыражений.</p> <p>Блоки создаются для каждого обработанного фрагмента данных. Обратите внимание, что для одного и того же типа вычисления имена столбцов и типы остаются одинаковыми для разных блоков, и изменяются только данные столбцов. Лучше разделить данные блока из заголовка блока, потому что небольшие размеры блока имеют высокую нагрузку временных строк для копирования shared_ptrs и имен столбцов.</p> <h2 id=block-streams>Блокировать Потоки<a class=headerlink href=#block-streams title="Permanent link">&para;</a></h2> <p>Блочные потоки предназначены для обработки данных. Мы используем потоки блоков для чтения данных откуда-то, выполнения преобразований данных или записи данных куда-то. <code>IBlockInputStream</code> имеет <code>read</code> метод для извлечения следующего блока, пока он доступен. <code>IBlockOutputStream</code> имеет <code>write</code> метод, чтобы подтолкнуть блок куда-то.</p> <p>Потоки отвечают за:</p> <ol> <li>Чтение или письмо за столом. Таблица просто возвращает поток для чтения или записи блоков.</li> <li>Реализация форматов данных. Например, если вы хотите вывести данные на терминал в <code>Pretty</code> форматирование, вы создаете поток вывода блока, где вы толкаете блоки, и он форматирует их.</li> <li>Выполнение преобразований данных. Скажем так у вас есть <code>IBlockInputStream</code> и хотите создать отфильтрованный поток. Вы создаете <code>FilterBlockInputStream</code> и инициализируйте его с помощью своего потока. Затем, когда вы вытащите блок из <code>FilterBlockInputStream</code>, он извлекает блок из вашего потока, фильтрует его и возвращает отфильтрованный блок вам. Конвейеры выполнения запросов представлены таким образом.</li> </ol> <p>Есть и более сложные трансформации. Например, когда вы тянете из <code>AggregatingBlockInputStream</code>, он считывает все данные из своего источника, агрегирует их, а затем возвращает поток агрегированных данных для вас. Еще пример: <code>UnionBlockInputStream</code> принимает множество источников ввода в конструкторе, а также ряд потоков. Он запускает несколько потоков и читает из нескольких источников параллельно.</p> <blockquote> <p>Потоки блокируют использовать «pull» подход к управлению потоком: когда вы вытягиваете блок из первого потока, он, следовательно, вытягивает необходимые блоки из вложенных потоков, и весь конвейер выполнения будет работать. Ни «pull» ни «push» это лучшее решение, потому что поток управления является неявным, и это ограничивает реализацию различных функций, таких как одновременное выполнение нескольких запросов (объединение многих конвейеров вместе). Это ограничение может быть преодолено с помощью сопрограмм или просто запуском дополнительных потоков, которые ждут друг друга. У нас может быть больше возможностей, если мы сделаем поток управления явным: если мы найдем логику для передачи данных из одной расчетной единицы в другую вне этих расчетных единиц. Читать это <a href=http://journal.stuffwithstuff.com/2013/01/13/iteration-inside-and-out/ rel="external nofollow noreferrer">статья</a> для новых мыслей.</p> </blockquote> <p>Следует отметить, что конвейер выполнения запроса создает временные данные на каждом шаге. Мы стараемся держать размер блока достаточно маленьким, чтобы временные данные помещались в кэш процессора. При таком допущении запись и чтение временных данных практически бесплатны по сравнению с другими расчетами. Мы могли бы рассмотреть альтернативу, которая заключается в том, чтобы объединить многие операции в трубопроводе вместе. Это может сделать конвейер как можно короче и удалить большую часть временных данных, что может быть преимуществом, но у него также есть недостатки. Например, разделенный конвейер позволяет легко реализовать кэширование промежуточных данных, кражу промежуточных данных из аналогичных запросов, выполняемых одновременно, и объединение конвейеров для аналогичных запросов.</p> <h2 id=formats>Форматы<a class=headerlink href=#formats title="Permanent link">&para;</a></h2> <p>Форматы данных реализуются с помощью блочных потоков. Есть «presentational» форматы, пригодные только для вывода данных клиенту, такие как <code>Pretty</code> формат, который предоставляет только <code>IBlockOutputStream</code>. И есть форматы ввода/вывода, такие как <code>TabSeparated</code> или <code>JSONEachRow</code>.</p> <p>Существуют также потоки подряд : <code>IRowInputStream</code> и <code>IRowOutputStream</code>. Они позволяют вытягивать / выталкивать данные отдельными строками, а не блоками. И они нужны только для упрощения реализации ориентированных на строки форматов. Обертка <code>BlockInputStreamFromRowInputStream</code> и <code>BlockOutputStreamFromRowOutputStream</code> позволяет конвертировать потоки, ориентированные на строки, в обычные потоки, ориентированные на блоки.</p> <h2 id=io>I/O<a class=headerlink href=#io title="Permanent link">&para;</a></h2> <p>Для байт-ориентированных входов / выходов существуют <code>ReadBuffer</code> и <code>WriteBuffer</code> абстрактный класс. Они используются вместо C++ <code>iostream</code>s. Не волнуйтесь: каждый зрелый проект C++ использует что-то другое, чем <code>iostream</code>s по уважительным причинам.</p> <p><code>ReadBuffer</code> и <code>WriteBuffer</code> это просто непрерывный буфер и курсор, указывающий на позицию в этом буфере. Реализации могут владеть или не владеть памятью для буфера. Существует виртуальный метод заполнения буфера следующими данными (для <code>ReadBuffer</code>) или смыть буфер куда-нибудь (например <code>WriteBuffer</code>). Виртуальные методы редко вызываются.</p> <p>Реализация следующих принципов: <code>ReadBuffer</code>/<code>WriteBuffer</code> используются для работы с файлами и файловыми дескрипторами, а также сетевыми сокетами, для реализации сжатия (<code>CompressedWriteBuffer</code> is initialized with another WriteBuffer and performs compression before writing data to it), and for other purposes – the names <code>ConcatReadBuffer</code>, <code>LimitReadBuffer</code>, и <code>HashingWriteBuffer</code> за себя говорить.</p> <p>Буферы чтения/записи имеют дело только с байтами. Есть функции от <code>ReadHelpers</code> и <code>WriteHelpers</code> заголовочные файлы, чтобы помочь с форматированием ввода / вывода. Например, есть помощники для записи числа в десятичном формате.</p> <p>Давайте посмотрим, что происходит, когда вы хотите написать результирующий набор в <code>JSON</code> форматирование в stdout. У вас есть результирующий набор, готовый к извлечению из него <code>IBlockInputStream</code>. Вы создаете <code>WriteBufferFromFileDescriptor(STDOUT_FILENO)</code> чтобы записать байты в stdout. Вы создаете <code>JSONRowOutputStream</code>, инициализируется с помощью этого <code>WriteBuffer</code>, чтобы записать строки в <code>JSON</code> в stdout. Вы создаете <code>BlockOutputStreamFromRowOutputStream</code> кроме того, чтобы представить его как <code>IBlockOutputStream</code>. А потом ты позвонишь <code>copyData</code> для передачи данных из <code>IBlockInputStream</code> к <code>IBlockOutputStream</code> и все это работает. Внутренне, <code>JSONRowOutputStream</code> буду писать в формате JSON различные разделители и вызвать <code>IDataType::serializeTextJSON</code> метод со ссылкой на <code>IColumn</code> и номер строки в качестве аргументов. Следовательно, <code>IDataType::serializeTextJSON</code> вызовет метод из <code>WriteHelpers.h</code>: например, <code>writeText</code> для числовых типов и <code>writeJSONString</code> для <code>DataTypeString</code>.</p> <h2 id=tables>Таблицы<a class=headerlink href=#tables title="Permanent link">&para;</a></h2> <p>То <code>IStorage</code> интерфейс представляет собой таблицы. Различные реализации этого интерфейса являются различными движками таблиц. Примеры <code>StorageMergeTree</code>, <code>StorageMemory</code> и так далее. Экземпляры этих классов являются просто таблицами.</p> <p>Ключ <code>IStorage</code> методы <code>read</code> и <code>write</code>. Есть и другие варианты <code>alter</code>, <code>rename</code>, <code>drop</code> и так далее. То <code>read</code> метод принимает следующие аргументы: набор столбцов для чтения из таблицы, набор столбцов для чтения из таблицы. <code>AST</code> запрос для рассмотрения и желаемое количество потоков для возврата. Он возвращает один или несколько <code>IBlockInputStream</code> объекты и информация о стадии обработки данных, которая была завершена внутри табличного движка во время выполнения запроса.</p> <p>В большинстве случаев метод read отвечает только за чтение указанных столбцов из таблицы, а не за дальнейшую обработку данных. Вся дальнейшая обработка данных осуществляется интерпретатором запросов и не входит в сферу ответственности компании <code>IStorage</code>.</p> <p>Но есть и заметные исключения:</p> <ul> <li>Запрос AST передается на сервер <code>read</code> метод, и механизм таблиц может использовать его для получения использования индекса и считывания меньшего количества данных из таблицы.</li> <li>Иногда механизм таблиц может сам обрабатывать данные до определенного этапа. Например, <code>StorageDistributed</code> можно отправить запрос на удаленные серверы, попросить их обработать данные на этапе, когда данные с разных удаленных серверов могут быть объединены, и вернуть эти предварительно обработанные данные. Затем интерпретатор запросов завершает обработку данных.</li> </ul> <p>Стол <code>read</code> метод может возвращать несколько значений <code>IBlockInputStream</code> объекты, позволяющие осуществлять параллельную обработку данных. Эти несколько блочных входных потоков могут считываться из таблицы параллельно. Затем вы можете обернуть эти потоки с помощью различных преобразований (таких как вычисление выражений или фильтрация), которые могут быть вычислены независимо, и создать <code>UnionBlockInputStream</code> поверх них, чтобы читать из нескольких потоков параллельно.</p> <p>Есть и другие варианты <code>TableFunction</code>s. Это функции, которые возвращают временное значение <code>IStorage</code> объект для использования в <code>FROM</code> предложение запроса.</p> <p>Чтобы получить быстрое представление о том, как реализовать свой движок таблиц, посмотрите на что-то простое, например <code>StorageMemory</code> или <code>StorageTinyLog</code>.</p> <blockquote> <p>В результате этого <code>read</code> метод, <code>IStorage</code> возвращается <code>QueryProcessingStage</code> – information about what parts of the query were already calculated inside storage.</p> </blockquote> <h2 id=parsers>Синтаксический анализатор<a class=headerlink href=#parsers title="Permanent link">&para;</a></h2> <p>Написанный от руки рекурсивный парсер спуска анализирует запрос. Например, <code>ParserSelectQuery</code> просто рекурсивно вызывает базовые Парсеры для различных частей запроса. Парсеры создают <code>AST</code>. То <code>AST</code> представлен узлами, которые являются экземплярами <code>IAST</code>.</p> <blockquote> <p>Генераторы парсеров не используются по историческим причинам.</p> </blockquote> <h2 id=interpreters>Переводчики<a class=headerlink href=#interpreters title="Permanent link">&para;</a></h2> <p>Интерпретаторы отвечают за создание конвейера выполнения запроса из <code>AST</code>. Есть простые переводчики, такие как <code>InterpreterExistsQuery</code> и <code>InterpreterDropQuery</code> или более изощренные <code>InterpreterSelectQuery</code>. Конвейер выполнения запроса представляет собой комбинацию блочных входных и выходных потоков. Например, результат интерпретации <code>SELECT</code> запросов <code>IBlockInputStream</code> для чтения результирующего набора из; результат запроса INSERT - это <code>IBlockOutputStream</code> чтобы записать данные для вставки в, и результат интерпретации <code>INSERT SELECT</code> запросов <code>IBlockInputStream</code> это возвращает пустой результирующий набор при первом чтении, но копирует данные из него <code>SELECT</code> к <code>INSERT</code> в то же время.</p> <p><code>InterpreterSelectQuery</code> использует <code>ExpressionAnalyzer</code> и <code>ExpressionActions</code> машины для анализа запросов и преобразований. Именно здесь выполняется большинство оптимизаций запросов на основе правил. <code>ExpressionAnalyzer</code> это довольно грязно и должно быть переписано: различные преобразования запросов и оптимизации должны быть извлечены в отдельные классы, чтобы позволить модульные преобразования или запрос.</p> <h2 id=functions>Функции<a class=headerlink href=#functions title="Permanent link">&para;</a></h2> <p>Существуют обычные функции и агрегатные функции. Агрегатные функции см. В следующем разделе.</p> <p>Ordinary functions don't change the number of rows – they work as if they are processing each row independently. In fact, functions are not called for individual rows, but for <code>Block</code>'s данных для реализации векторизованного выполнения запросов.</p> <p>Есть некоторые другие функции, такие как <a href=../../sql_reference/functions/other_functions/#function-blocksize>размер блока</a>, <a href=../../sql_reference/functions/other_functions/#function-rownumberinblock>роунумберинблок</a>, и <a href=../../sql_reference/functions/other_functions/#function-runningaccumulate>runningAccumulate</a>, которые эксплуатируют обработку блоков и нарушают независимость строк.</p> <p>ClickHouse имеет сильную типизацию, поэтому нет никакого неявного преобразования типов. Если функция не поддерживает определенную комбинацию типов, она создает исключение. Но функции могут работать (перегружаться) для многих различных комбинаций типов. Например, в <code>plus</code> функция (для реализации <code>+</code> оператор) работает для любой комбинации числовых типов: <code>UInt8</code> + <code>Float32</code>, <code>UInt16</code> + <code>Int8</code> и так далее. Кроме того, некоторые вариадические функции могут принимать любое количество аргументов, например <code>concat</code> функция.</p> <p>Реализация функции может быть немного неудобной, поскольку функция явно отправляет поддерживаемые типы данных и поддерживается <code>IColumns</code>. Например, в <code>plus</code> функция имеет код, генерируемый экземпляром шаблона C++ для каждой комбинации числовых типов, а также постоянные или непостоянные левые и правые аргументы.</p> <p>Это отличное место для реализации генерации кода во время выполнения, чтобы избежать раздувания кода шаблона. Кроме того, он позволяет добавлять слитые функции, такие как fused multiply-add или выполнять несколько сравнений в одной итерации цикла.</p> <p>Из-за векторизованного выполнения запроса функции не закорачиваются. Например, если вы пишете <code>WHERE f(x) AND g(y)</code>, обе стороны вычисляются, даже для строк, когда <code>f(x)</code> равно нулю (за исключением тех случаев, когда <code>f(x)</code> является нулевым постоянным выражением). Но если избирательность самого <code>f(x)</code> состояние является высоким, и расчет <code>f(x)</code> это гораздо дешевле, чем <code>g(y)</code>, лучше всего реализовать многоходовой расчет. Это будет первый расчет <code>f(x)</code>, затем отфильтруйте столбцы по результату, а затем вычислите <code>g(y)</code> только для небольших отфильтрованных фрагментов данных.</p> <h2 id=aggregate-functions>Статистическая функция<a class=headerlink href=#aggregate-functions title="Permanent link">&para;</a></h2> <p>Агрегатные функции - это функции, определяющие состояние. Они накапливают переданные значения в некотором состоянии и позволяют получать результаты из этого состояния. Они управляются с помощью <code>IAggregateFunction</code> интерфейс. Состояния могут быть довольно простыми (состояние для <code>AggregateFunctionCount</code> это всего лишь один человек <code>UInt64</code> значение) или довольно сложное (состояние <code>AggregateFunctionUniqCombined</code> представляет собой комбинацию линейного массива, хэш-таблицы и <code>HyperLogLog</code> вероятностная структура данных).</p> <p>Государства распределяются в <code>Arena</code> (пул памяти) для работы с несколькими состояниями при выполнении высокой мощности <code>GROUP BY</code> запрос. Состояния могут иметь нетривиальный конструктор и деструктор: например, сложные агрегатные состояния могут сами выделять дополнительную память. Это требует некоторого внимания к созданию и уничтожению государств и правильной передаче их права собственности и порядка уничтожения.</p> <p>Агрегатные состояния могут быть сериализованы и десериализованы для передачи по сети во время выполнения распределенного запроса или для записи их на диск, где недостаточно оперативной памяти. Они даже могут храниться в таблице с <code>DataTypeAggregateFunction</code> чтобы разрешить инкрементное агрегирование данных.</p> <blockquote> <p>Сериализованный формат данных для состояний агрегатных функций в настоящее время не является версионным. Это нормально, если агрегатные состояния хранятся только временно. Но у нас есть такая возможность <code>AggregatingMergeTree</code> механизм таблиц для инкрементного агрегирования, и люди уже используют его в производстве. Именно по этой причине обратная совместимость требуется при изменении сериализованного формата для любой агрегатной функции в будущем.</p> </blockquote> <h2 id=server>Сервер<a class=headerlink href=#server title="Permanent link">&para;</a></h2> <p>Сервер реализует несколько различных интерфейсов:</p> <ul> <li>Интерфейс HTTP для любых иностранных клиентов.</li> <li>TCP-интерфейс для собственного клиента ClickHouse и для межсерверной связи во время выполнения распределенного запроса.</li> <li>Интерфейс для передачи данных для репликации.</li> </ul> <p>Внутренне это просто примитивный многопоточный сервер без сопрограмм или волокон. Поскольку сервер предназначен не для обработки высокой скорости простых запросов, а для обработки относительно низкой скорости сложных запросов, каждый из них может обрабатывать огромное количество данных для аналитики.</p> <p>Сервер инициализирует программу <code>Context</code> класс с необходимой средой для выполнения запроса: список доступных баз данных, пользователей и прав доступа, настройки, кластеры, список процессов, журнал запросов и так далее. Переводчики используют эту среду.</p> <p>Мы поддерживаем полную обратную и прямую совместимость для протокола TCP сервера: старые клиенты могут разговаривать с новыми серверами, а новые клиенты-со старыми серверами. Но мы не хотим поддерживать его вечно, и мы удаляем поддержку старых версий примерно через год.</p> <div class="admonition note"> <p class=admonition-title>Примечание</p> <p>Для большинства внешних приложений мы рекомендуем использовать интерфейс HTTP, поскольку он прост и удобен в использовании. Протокол TCP более тесно связан с внутренними структурами данных: он использует внутренний формат для передачи блоков данных, а также использует пользовательское обрамление для сжатых данных. Мы не выпустили библиотеку C для этого протокола, потому что она требует связывания большей части кодовой базы ClickHouse, что нецелесообразно.</p> </div> <h2 id=distributed-query-execution>Выполнение Распределенных Запросов<a class=headerlink href=#distributed-query-execution title="Permanent link">&para;</a></h2> <p>Серверы в кластерной установке в основном независимы. Вы можете создать <code>Distributed</code> таблица на одном или всех серверах кластера. То <code>Distributed</code> table does not store data itself – it only provides a «view» ко всем локальным таблицам на нескольких узлах кластера. Когда вы выберите из <code>Distributed</code> таблица, он переписывает этот запрос, выбирает удаленные узлы в соответствии с настройками балансировки нагрузки и отправляет запрос к ним. То <code>Distributed</code> таблица запрашивает удаленные серверы для обработки запроса только до стадии, когда промежуточные результаты с разных серверов могут быть объединены. Затем он получает промежуточные результаты и сливает их. Распределенная таблица пытается распределить как можно больше работы на удаленные серверы и не отправляет много промежуточных данных по сети.</p> <p>Все становится сложнее, когда у вас есть подзапросы в предложениях IN или JOIN, и каждый из них использует a <code>Distributed</code> стол. У нас есть разные стратегии выполнения этих запросов.</p> <p>Глобального плана запросов для выполнения распределенных запросов не существует. Каждый узел имеет свой локальный план запроса для своей части задания. У нас есть только простое однопроходное распределенное выполнение запросов: мы отправляем запросы на удаленные узлы, а затем объединяем результаты. Но это неосуществимо для сложных запросов с высокой мощностью группы BYs или с большим количеством временных данных для соединения. В таких случаях нам необходимо: «reshuffle» данные между серверами, что требует дополнительной координации. ClickHouse не поддерживает такого рода выполнение запросов, и мы должны работать над этим.</p> <h2 id=merge-tree>Дерево Слияния<a class=headerlink href=#merge-tree title="Permanent link">&para;</a></h2> <p><code>MergeTree</code> это семейство механизмов хранения данных, поддерживающих индексацию по первичному ключу. Первичный ключ может быть произвольным кортежем столбцов или выражений. Данные в a <code>MergeTree</code> таблица хранится в «parts». Каждая часть хранит данные в порядке первичного ключа, поэтому данные лексикографически упорядочиваются кортежем первичного ключа. Все столбцы таблицы хранятся отдельно <code>column.bin</code> файлы в этих краях. Файлы состоят из сжатых блоков. Каждый блок обычно содержит от 64 КБ до 1 МБ несжатых данных, в зависимости от среднего размера значения. Блоки состоят из значений столбцов, расположенных последовательно друг за другом. Значения столбцов находятся в одном и том же порядке для каждого столбца (первичный ключ определяет порядок), поэтому при итерации по многим столбцам вы получаете значения для соответствующих строк.</p> <p>Сам первичный ключ является «sparse». Он адресует не каждую отдельную строку, а только некоторые диапазоны данных. Разделение <code>primary.idx</code> файл имеет значение первичного ключа для каждой N-й строки, где N называется <code>index_granularity</code> (обычно N = 8192). Кроме того, для каждой колонки у нас есть <code>column.mrk</code> файлы с «marks,» которые являются смещениями для каждой N-й строки в файле данных. Каждая метка представляет собой пару: смещение в файле к началу сжатого блока и смещение в распакованном блоке к началу данных. Обычно сжатые блоки выравниваются по меткам, а смещение в распакованном блоке равно нулю. Данные для <code>primary.idx</code> всегда находится в памяти, а данные для <code>column.mrk</code> файлы кэшируются.</p> <p>Когда мы собираемся прочитать что-то из части в <code>MergeTree</code>, мы смотрим на <code>primary.idx</code> данные и найдите диапазоны, которые могут содержать запрошенные данные, а затем посмотрите на <code>column.mrk</code> данные и рассчитать смещения для того, чтобы начать чтение этих диапазонов. Из-за разреженности могут быть прочитаны избыточные данные. ClickHouse не подходит для высокой загрузки простых точечных запросов, так как весь диапазон с <code>index_granularity</code> строки должны быть прочитаны для каждого ключа, и весь сжатый блок должен быть распакован для каждого столбца. Мы сделали индекс разреженным, потому что мы должны быть в состоянии поддерживать триллионы строк на одном сервере без заметного потребления памяти для индекса. Кроме того, поскольку первичный ключ разрежен, он не является уникальным: он не может проверить существование ключа в таблице во время вставки. В таблице может быть много строк с одним и тем же ключом.</p> <p>Когда вы <code>INSERT</code> куча данных в <code>MergeTree</code>, эта связка сортируется по порядку первичного ключа и образует новую часть. Существуют фоновые потоки, которые периодически выделяют некоторые детали и объединяют их в одну сортированную деталь, чтобы сохранить количество деталей относительно низким. Вот почему он так называется <code>MergeTree</code>. Конечно, слияние приводит к тому, что «write amplification». Все части неизменны: они только создаются и удаляются, но не изменяются. Когда SELECT выполняется, он содержит снимок таблицы (набор деталей). После слияния мы также сохраняем старые детали в течение некоторого времени, чтобы облегчить восстановление после сбоя, поэтому, если мы видим, что какая-то объединенная деталь, вероятно, сломана, мы можем заменить ее исходными частями.</p> <p><code>MergeTree</code> это не дерево LSM, потому что оно не содержит «memtable» и «log»: inserted data is written directly to the filesystem. This makes it suitable only to INSERT data in batches, not by individual row and not very frequently – about once per second is ok, but a thousand times a second is not. We did it this way for simplicity's sake, and because we are already inserting data in batches in our applications.</p> <blockquote> <p>Таблицы MergeTree могут иметь только один (первичный) индекс: вторичных индексов не существует. Было бы неплохо разрешить несколько физических представлений в одной логической таблице, например, хранить данные в более чем одном физическом порядке или даже разрешить представления с предварительно агрегированными данными наряду с исходными данными.</p> </blockquote> <p>Есть движки MergeTree, которые выполняют дополнительную работу во время фоновых слияний. Примеры <code>CollapsingMergeTree</code> и <code>AggregatingMergeTree</code>. Это можно рассматривать как специальную поддержку обновлений. Имейте в виду, что это не настоящие обновления, поскольку пользователи обычно не имеют никакого контроля над временем выполнения фоновых слияний, а данные в <code>MergeTree</code> таблица почти всегда хранится в нескольких частях, а не в полностью объединенном виде.</p> <h2 id=replication>Копирование<a class=headerlink href=#replication title="Permanent link">&para;</a></h2> <p>Репликация в ClickHouse может быть настроена на основе каждой таблицы. Вы можете иметь некоторые реплицированные и некоторые нереплицированные таблицы на одном сервере. Вы также можете иметь таблицы, реплицируемые различными способами,например, одна таблица с двухфакторной репликацией, а другая-с трехфакторной.</p> <p>Репликация осуществляется в виде <code>ReplicatedMergeTree</code> подсистема хранилища. Путь в <code>ZooKeeper</code> указывается в качестве параметра для механизма хранения данных. Все таблицы с одинаковым путем внутри <code>ZooKeeper</code> становятся репликами друг друга: они синхронизируют свои данные и поддерживают согласованность. Реплики можно добавлять и удалять динамически, просто создавая или удаляя таблицу.</p> <p>Репликация использует асинхронную многомастерную схему. Вы можете вставить данные в любую реплику, которая имеет сеанс с <code>ZooKeeper</code>, и данные реплицируются во все остальные реплики асинхронно. Поскольку ClickHouse не поддерживает обновления, репликация является бесконфликтной. Поскольку нет подтверждения кворума вставок, только что вставленные данные могут быть потеряны, если один узел выйдет из строя.</p> <p>Метаданные для репликации хранятся в ZooKeeper. Существует журнал репликации, в котором перечислены необходимые действия. Действия таковы: получить часть; объединить части; удалить раздел и так далее. Каждая реплика копирует журнал репликации в свою очередь, а затем выполняет действия из этой очереди. Например, при вставке «get the part» действие создается в журнале, и каждая реплика загружает эту часть. Слияния координируются между репликами для получения идентичных байтам результатов. Все части объединяются одинаково на всех репликах. Это достигается путем выбора одной реплики в качестве лидера, и эта реплика инициирует слияние и запись «merge parts» действия по ведению журнала.</p> <p>Репликация является физической: между узлами передаются только сжатые части, а не запросы. Слияния обрабатываются на каждой реплике независимо в большинстве случаев, чтобы снизить затраты на сеть, избегая усиления сети. Большие объединенные части передаются по сети только в случаях значительного запаздывания репликации.</p> <p>Кроме того, каждая реплика хранит свое состояние в ZooKeeper как набор деталей и их контрольные суммы. Когда состояние локальной файловой системы отличается от эталонного состояния в ZooKeeper, реплика восстанавливает свою согласованность, загружая недостающие и сломанные части из других реплик. Когда в локальной файловой системе появляются неожиданные или неработающие данные, ClickHouse не удаляет их, а перемещает в отдельный каталог и забывает.</p> <div class="admonition note"> <p class=admonition-title>Примечание</p> <p>Кластер ClickHouse состоит из независимых сегментов, и каждый сегмент состоит из реплик. Кластер таков <strong>неупругий</strong>, поэтому после добавления нового осколка данные не будут автоматически перебалансированы между осколками. Вместо этого предполагается, что нагрузка на кластер будет регулироваться неравномерно. Эта реализация дает вам больше контроля, и это нормально для относительно небольших кластеров, таких как десятки узлов. Но для кластеров с сотнями узлов, которые мы используем в производстве, этот подход становится существенным недостатком. Мы должны реализовать механизм таблиц, который охватывает весь кластер с динамически реплицируемыми областями, которые могут быть разделены и сбалансированы между кластерами автоматически.</p> </div> </div> <div id=content-footer class="text-muted pt-5"> <div class=float-right>©2016–2020 Yandex LLC</div> <div>Собрано из <a href=https://github.com/ClickHouse/ClickHouse/commit/3166eab2dfc89323b9d756aeba6866381fd9c186 rel="external nofollow noreferrer" target=_blank class=text-reset>3166eab2df</a></div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>Cодержание</label> <a href=#columns title=Столбцы class="nav-link text-wrap d-inline-block w-100"> Столбцы </a> <a href=#field title=Поле class="nav-link text-wrap d-inline-block w-100"> Поле </a> <a href=#leaky-abstractions title="Дырявые абстракции" class="nav-link text-wrap d-inline-block w-100"> Дырявые абстракции </a> <a href=#data_types title="Тип данных" class="nav-link text-wrap d-inline-block w-100"> Тип данных </a> <a href=#block title=Блок class="nav-link text-wrap d-inline-block w-100"> Блок </a> <a href=#block-streams title="Блокировать Потоки" class="nav-link text-wrap d-inline-block w-100"> Блокировать Потоки </a> <a href=#formats title=Форматы class="nav-link text-wrap d-inline-block w-100"> Форматы </a> <a href=#io title=I/O class="nav-link text-wrap d-inline-block w-100"> I/O </a> <a href=#tables title=Таблицы class="nav-link text-wrap d-inline-block w-100"> Таблицы </a> <a href=#parsers title="Синтаксический анализатор" class="nav-link text-wrap d-inline-block w-100"> Синтаксический анализатор </a> <a href=#interpreters title=Переводчики class="nav-link text-wrap d-inline-block w-100"> Переводчики </a> <a href=#functions title=Функции class="nav-link text-wrap d-inline-block w-100"> Функции </a> <a href=#aggregate-functions title="Статистическая функция" class="nav-link text-wrap d-inline-block w-100"> Статистическая функция </a> <a href=#server title=Сервер class="nav-link text-wrap d-inline-block w-100"> Сервер </a> <a href=#distributed-query-execution title="Выполнение Распределенных Запросов" class="nav-link text-wrap d-inline-block w-100"> Выполнение Распределенных Запросов </a> <a href=#merge-tree title="Дерево Слияния" class="nav-link text-wrap d-inline-block w-100"> Дерево Слияния </a> <a href=#replication title=Копирование class="nav-link text-wrap d-inline-block w-100"> Копирование </a> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?7bd05efd></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>