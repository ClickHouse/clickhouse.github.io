<!DOCTYPE html><html lang=fa data-version=v19.15 data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>MergeTree - مستندات v19.15ClickHouse</title><link rel="shortcut icon" href=/favicon.ico><meta property=og:title content="MergeTree - مستندات v19.15ClickHouse"><meta property=og:description content="MergeTree The MergeTree engine and other engines of this family (*MergeTree) are the most robust ClickHousе table engine"><meta property=og:type content=website><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta property=twitter:title content="MergeTree - مستندات v19.15ClickHouse"><meta name=description content="MergeTree The MergeTree engine and other engines of this family (*MergeTree) are the most robust ClickHousе table engine"><meta name=keywords content="ClickHouse, DBMS, OLAP, relational, analytics, analytical, big data, open-source, SQL, web-analytics"><link href=/css/base.css?1d858e50 media=all rel=stylesheet></head> <body dir=rtl data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> MergeTree </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li class=nav-item> <a href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/fa/operations/table_engines/mergetree.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/fa.svg alt=فارسی title=فارسی width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/v19.15/en/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/v19.15/zh/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/v19.15/es/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/es.svg alt title width=32 class="d-inline-block mr-2">Español </a> <a href=/docs/v19.15/fr/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/fr.svg alt title width=32 class="d-inline-block mr-2">Français </a> <a href=/docs/v19.15/ru/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/v19.15/ja/operations/table_engines/mergetree/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> <a href=/docs/v19.15/fa/operations/table_engines/mergetree/ class="dropdown-item disabled"> <img src=/images/flags/fa.svg alt title width=32 class="d-inline-block mr-2">فارسی </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class="container-fluid text-right"> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label="چند صفحه یا یک صفحه"> <a href=../../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt="نسخه چند صفحه ای" title="نسخه چند صفحه ای"> </a> <a href=../../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt="نسخه تک صفحه ای" title="نسخه تک صفحه ای"> </a> </div> <div class="dropdown mb-3"> <a class="btn btn-dark dropdown-toggle text-muted" href=# role=button id=select-version data-toggle=dropdown aria-haspopup=true aria-expanded=false> نسخه: <span class=text-light>v19.15</span> </a> <div class="dropdown-menu bg-dark text-muted p-1" aria-labelledby=select-version> <a href=/docs/fa/ class=dropdown-item> <span class=text-light>جدیدترین</span> </a> <a href=/docs/v20.3/fa/ class=dropdown-item>v20.3</a> <a href=/docs/v20.1/fa/ class=dropdown-item>v20.1</a> <a href=/docs/v19.17/fa/ class=dropdown-item>v19.17</a> <a href=/docs/v19.16/fa/ class=dropdown-item>v19.16</a> <a href=/docs/v19.15/fa/ class="dropdown-item disable">v19.15</a> <a href=/docs/v19.14/fa/ class=dropdown-item>v19.14</a> <a href=/docs/v19.13/fa/ class=dropdown-item>v19.13</a> <a href=/docs/v19.11/fa/ class=dropdown-item>v19.11</a> <a href=/docs/v19.10/fa/ class=dropdown-item>v19.10</a> <a href=/docs/v19.9/fa/ class=dropdown-item>v19.9</a> <a href=/docs/v19.8/fa/ class=dropdown-item>v19.8</a> </div> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=Introduction class="nav-link text-light text-wrap dropdown-toggle px-0">Introduction</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../ title="ClickHouse چیست؟" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse چیست؟</a> <a href=../../../introduction/distinctive_features/ title=" ویژگی های برجسته ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> ویژگی های برجسته ClickHouse</a> <a href=../../../introduction/features_considered_disadvantages/ title=" ویژگی های از ClickHouse که می تواند معایبی باشد" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> ویژگی های از ClickHouse که می تواند معایبی باشد</a> <a href=../../../introduction/performance/ title=Performance class="nav-link text-light text-wrap d-inline-block w-100 px-0">Performance</a> <a href=../../../introduction/ya_metrika_task/ title="The Yandex.Metrica task" class="nav-link text-light text-wrap d-inline-block w-100 px-0">The Yandex.Metrica task</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title="Getting started" class="nav-link text-light text-wrap dropdown-toggle px-0">Getting started</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../getting_started/ title=" شروع به کار" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> شروع به کار</a> <a href=#sidebar-sidebar-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-2 title="Example datasets" class="nav-link text-light text-wrap dropdown-toggle px-0">Example datasets</a> <div id=sidebar-sidebar-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../getting_started/example_datasets/ontime/ title=OnTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">OnTime</a> <a href=../../../getting_started/example_datasets/nyc_taxi/ title=" داده های تاکسی New York" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> داده های تاکسی New York</a> <a href=../../../getting_started/example_datasets/amplab_benchmark/ title=" بنچمارک AMPLab Big Data" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> بنچمارک AMPLab Big Data</a> <a href=../../../getting_started/example_datasets/wikistat/ title=WikiStat class="nav-link text-light text-wrap d-inline-block w-100 px-0">WikiStat</a> <a href=../../../getting_started/example_datasets/criteo/ title=" ترابایت از لاگ های کلیک از سرویس Criteo" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> ترابایت از لاگ های کلیک از سرویس Criteo</a> <a href=../../../getting_started/example_datasets/star_schema/ title=" بنچمارک Star Schema" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> بنچمارک Star Schema</a> <a href=../../../getting_started/example_datasets/metrica/ title="Yandex.Metrica Data" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Yandex.Metrica Data</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=Interfaces class="nav-link text-light text-wrap dropdown-toggle px-0">Interfaces</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../interfaces/ title="Interface ها" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Interface ها</a> <a href=../../../interfaces/cli/ title=" کلاینت Command-line" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> کلاینت Command-line</a> <a href=../../../interfaces/tcp/ title="Native interface (TCP)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Native interface (TCP)</a> <a href=../../../interfaces/http/ title="HTTP interface" class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP interface</a> <a href=../../../interfaces/formats/ title=" فرمت های Input و Output" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> فرمت های Input و Output</a> <a href=../../../interfaces/jdbc/ title=" درایور JDBC" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> درایور JDBC</a> <a href=../../../interfaces/odbc/ title=" درایور ODBC" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> درایور ODBC</a> <a href=#sidebar-sidebar-3-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-8 title=Third-party class="nav-link text-light text-wrap dropdown-toggle px-0">Third-party</a> <div id=sidebar-sidebar-3-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../interfaces/third-party/client_libraries/ title="کتابخانه های مشتری" class="nav-link text-light text-wrap d-inline-block w-100 px-0">کتابخانه های مشتری</a> <a href=../../../interfaces/third-party/integrations/ title=یکپارچگی class="nav-link text-light text-wrap d-inline-block w-100 px-0">یکپارچگی</a> <a href=../../../interfaces/third-party/gui/ title="رابط های بصری" class="nav-link text-light text-wrap d-inline-block w-100 px-0">رابط های بصری</a> <a href=../../../interfaces/third-party/proxy/ title=پروکسی class="nav-link text-light text-wrap d-inline-block w-100 px-0">پروکسی</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title="Data types" class="nav-link text-light text-wrap dropdown-toggle px-0">Data types</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../data_types/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../../data_types/int_uint/ title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</a> <a href=../../../data_types/float/ title="Float32, Float64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32, Float64</a> <a href=../../../data_types/decimal/ title=Decimal class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal</a> <a href=../../../data_types/boolean/ title=" مقادیر Boolean" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> مقادیر Boolean</a> <a href=../../../data_types/string/ title=String class="nav-link text-light text-wrap d-inline-block w-100 px-0">String</a> <a href=../../../data_types/fixedstring/ title=FixedString(N) class="nav-link text-light text-wrap d-inline-block w-100 px-0">FixedString(N)</a> <a href=../../../data_types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../../data_types/date/ title=Date class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date</a> <a href=../../../data_types/datetime/ title=DateTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime</a> <a href=../../../data_types/enum/ title=Enum class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum</a> <a href=../../../data_types/array/ title=Array(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Array(T)</a> <a href=../../../data_types/nested_data_structures/aggregatefunction/ title="AggregateFunction(name, types_of_arguments...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction(name, types_of_arguments...)</a> <a href=../../../data_types/tuple/ title="Tuple(T1, T2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, ...)</a> <a href=../../../data_types/nullable/ title=Nullable class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable</a> <a href=#sidebar-sidebar-4-16 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-16 title="Nested data structures" class="nav-link text-light text-wrap dropdown-toggle px-0">Nested data structures</a> <div id=sidebar-sidebar-4-16 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../data_types/nested_data_structures/nested/ title="Nested(Name1 Type1, Name2 Type2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, ...)</a> </nav> </div> <a href=#sidebar-sidebar-4-17 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-17 title="Special data types" class="nav-link text-light text-wrap dropdown-toggle px-0">Special data types</a> <div id=sidebar-sidebar-4-17 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../data_types/special_data_types/expression/ title=Expression class="nav-link text-light text-wrap d-inline-block w-100 px-0">Expression</a> <a href=../../../data_types/special_data_types/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../../data_types/special_data_types/nothing/ title=Nothing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nothing</a> </nav> </div> <a href=#sidebar-sidebar-4-18 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-18 title=Domains class="nav-link text-light text-wrap dropdown-toggle px-0">Domains</a> <div id=sidebar-sidebar-4-18 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../data_types/domains/overview/ title=Overview class="nav-link text-light text-wrap d-inline-block w-100 px-0">Overview</a> <a href=../../../data_types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../../data_types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title="Database Engines" class="nav-link text-light text-wrap dropdown-toggle px-0">Database Engines</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../database_engines/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../../database_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> </nav> </div> <a href=#sidebar-sidebar-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6 title="Table Engines" class="nav-link text-light text-wrap dropdown-toggle px-0">Table Engines</a> <div id=sidebar-sidebar-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/table_engines/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=#sidebar-sidebar-6-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-2 title="MergeTree Family" class="nav-link text-light text-wrap dropdown-toggle px-0">MergeTree Family</a> <div id=sidebar-sidebar-6-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/table_engines/mergetree/ title=MergeTree class="nav-link text-white active text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../../operations/table_engines/replication/ title="Data Replication" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Data Replication</a> <a href=../../../operations/table_engines/custom_partitioning_key/ title="Custom Partitioning Key" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Custom Partitioning Key</a> <a href=../../../operations/table_engines/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../../operations/table_engines/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../../operations/table_engines/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../../operations/table_engines/collapsingmergetree/ title=CollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">CollapsingMergeTree</a> <a href=../../../operations/table_engines/versionedcollapsingmergetree/ title=VersionedCollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">VersionedCollapsingMergeTree</a> <a href=../../../operations/table_engines/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> </nav> </div> <a href=#sidebar-sidebar-6-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-3 title="Log Family" class="nav-link text-light text-wrap dropdown-toggle px-0">Log Family</a> <div id=sidebar-sidebar-6-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/table_engines/log_family/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../../operations/table_engines/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../../operations/table_engines/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../../operations/table_engines/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> </nav> </div> <a href=#sidebar-sidebar-6-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-4 title=Integrations class="nav-link text-light text-wrap dropdown-toggle px-0">Integrations</a> <div id=sidebar-sidebar-6-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/table_engines/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../../operations/table_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../../operations/table_engines/jdbc/ title=JDBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC</a> <a href=../../../operations/table_engines/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> <a href=../../../operations/table_engines/hdfs/ title=HDFS class="nav-link text-light text-wrap d-inline-block w-100 px-0">HDFS</a> </nav> </div> <a href=#sidebar-sidebar-6-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-5 title=Special class="nav-link text-light text-wrap dropdown-toggle px-0">Special</a> <div id=sidebar-sidebar-6-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/table_engines/distributed/ title=Distributed class="nav-link text-light text-wrap d-inline-block w-100 px-0">Distributed</a> <a href=../../../operations/table_engines/external_data/ title="External data" class="nav-link text-light text-wrap d-inline-block w-100 px-0">External data</a> <a href=../../../operations/table_engines/dictionary/ title=Dictionary class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary</a> <a href=../../../operations/table_engines/merge/ title=Merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">Merge</a> <a href=../../../operations/table_engines/file/ title=File class="nav-link text-light text-wrap d-inline-block w-100 px-0">File</a> <a href=../../../operations/table_engines/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../../operations/table_engines/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../../operations/table_engines/join/ title=Join class="nav-link text-light text-wrap d-inline-block w-100 px-0">Join</a> <a href=../../../operations/table_engines/url/ title=URL class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL</a> <a href=../../../operations/table_engines/view/ title=View class="nav-link text-light text-wrap d-inline-block w-100 px-0">View</a> <a href=../../../operations/table_engines/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../../operations/table_engines/memory/ title=Memory class="nav-link text-light text-wrap d-inline-block w-100 px-0">Memory</a> <a href=../../../operations/table_engines/buffer/ title=Buffer class="nav-link text-light text-wrap d-inline-block w-100 px-0">Buffer</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7 title="SQL Reference" class="nav-link text-light text-wrap dropdown-toggle px-0">SQL Reference</a> <div id=sidebar-sidebar-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/select/ title=SELECT class="nav-link text-light text-wrap d-inline-block w-100 px-0">SELECT</a> <a href=../../../query_language/insert_into/ title="INSERT INTO" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO</a> <a href=../../../query_language/create/ title=CREATE class="nav-link text-light text-wrap d-inline-block w-100 px-0">CREATE</a> <a href=../../../query_language/alter/ title=ALTER class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../../query_language/system/ title=SYSTEM class="nav-link text-light text-wrap d-inline-block w-100 px-0">SYSTEM</a> <a href=../../../query_language/misc/ title="Other Kinds of Queries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Other Kinds of Queries</a> <a href=#sidebar-sidebar-7-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-8 title=Functions class="nav-link text-light text-wrap dropdown-toggle px-0">Functions</a> <div id=sidebar-sidebar-7-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/functions/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../../query_language/functions/arithmetic_functions/ title=Arithmetic class="nav-link text-light text-wrap d-inline-block w-100 px-0">Arithmetic</a> <a href=../../../query_language/functions/comparison_functions/ title=Comparison class="nav-link text-light text-wrap d-inline-block w-100 px-0">Comparison</a> <a href=../../../query_language/functions/logical_functions/ title=Logical class="nav-link text-light text-wrap d-inline-block w-100 px-0">Logical</a> <a href=../../../query_language/functions/type_conversion_functions/ title="Type Conversion" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Type Conversion</a> <a href=../../../query_language/functions/date_time_functions/ title="Working with Dates and Times" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with Dates and Times</a> <a href=../../../query_language/functions/string_functions/ title="Working with strings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with strings</a> <a href=../../../query_language/functions/string_search_functions/ title="For Searching Strings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">For Searching Strings</a> <a href=../../../query_language/functions/string_replace_functions/ title="For Replacing in Strings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">For Replacing in Strings</a> <a href=../../../query_language/functions/conditional_functions/ title="Conditional " class="nav-link text-light text-wrap d-inline-block w-100 px-0">Conditional </a> <a href=../../../query_language/functions/math_functions/ title=Mathematical class="nav-link text-light text-wrap d-inline-block w-100 px-0">Mathematical</a> <a href=../../../query_language/functions/rounding_functions/ title=Rounding class="nav-link text-light text-wrap d-inline-block w-100 px-0">Rounding</a> <a href=../../../query_language/functions/array_functions/ title="Working with Arrays" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with Arrays</a> <a href=../../../query_language/functions/splitting_merging_functions/ title="Splitting and Merging Strings and Arrays" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Splitting and Merging Strings and Arrays</a> <a href=../../../query_language/functions/bit_functions/ title=Bit class="nav-link text-light text-wrap d-inline-block w-100 px-0">Bit</a> <a href=../../../query_language/functions/bitmap_functions/ title=Bitmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">Bitmap</a> <a href=../../../query_language/functions/hash_functions/ title=Hash class="nav-link text-light text-wrap d-inline-block w-100 px-0">Hash</a> <a href=../../../query_language/functions/random_functions/ title="Generating Pseudo-Random Numbers" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Generating Pseudo-Random Numbers</a> <a href=../../../query_language/functions/encoding_functions/ title=Encoding class="nav-link text-light text-wrap d-inline-block w-100 px-0">Encoding</a> <a href=../../../query_language/functions/uuid_functions/ title="Working with UUID" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with UUID</a> <a href=../../../query_language/functions/url_functions/ title="Working with URLs" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with URLs</a> <a href=../../../query_language/functions/ip_address_functions/ title="Working with IP Addresses" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with IP Addresses</a> <a href=../../../query_language/functions/json_functions/ title="Working with JSON." class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with JSON.</a> <a href=../../../query_language/functions/higher_order_functions/ title=Higher-Order class="nav-link text-light text-wrap d-inline-block w-100 px-0">Higher-Order</a> <a href=../../../query_language/functions/ext_dict_functions/ title="Working with External Dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with External Dictionaries</a> <a href=../../../query_language/functions/ym_dict_functions/ title="Working with Yandex.Metrica Dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with Yandex.Metrica Dictionaries</a> <a href=../../../query_language/functions/in_functions/ title="Implementing the IN Operator" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Implementing the IN Operator</a> <a href=../../../query_language/functions/array_join/ title=arrayJoin class="nav-link text-light text-wrap d-inline-block w-100 px-0">arrayJoin</a> <a href=../../../query_language/functions/geo/ title="Working with geographical coordinates" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with geographical coordinates</a> <a href=../../../query_language/functions/functions_for_nulls/ title="Working with Nullable arguments" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with Nullable arguments</a> <a href=../../../query_language/functions/machine_learning_functions/ title="Machine Learning Functions" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Machine Learning Functions</a> <a href=../../../query_language/functions/other_functions/ title=Other class="nav-link text-light text-wrap d-inline-block w-100 px-0">Other</a> </nav> </div> <a href=#sidebar-sidebar-7-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-9 title="Aggregate Functions" class="nav-link text-light text-wrap dropdown-toggle px-0">Aggregate Functions</a> <div id=sidebar-sidebar-7-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/agg_functions/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../../query_language/agg_functions/reference/ title=Reference class="nav-link text-light text-wrap d-inline-block w-100 px-0">Reference</a> <a href=../../../query_language/agg_functions/combinators/ title="Aggregate function combinators" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Aggregate function combinators</a> <a href=../../../query_language/agg_functions/parametric_functions/ title="Parametric aggregate functions" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Parametric aggregate functions</a> </nav> </div> <a href=#sidebar-sidebar-7-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-10 title="Table Functions" class="nav-link text-light text-wrap dropdown-toggle px-0">Table Functions</a> <div id=sidebar-sidebar-7-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/table_functions/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../../query_language/table_functions/file/ title=file class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a> <a href=../../../query_language/table_functions/merge/ title=merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a> <a href=../../../query_language/table_functions/numbers/ title=numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a> <a href=../../../query_language/table_functions/remote/ title=remote class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote</a> <a href=../../../query_language/table_functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../../query_language/table_functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../../query_language/table_functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../../query_language/table_functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> <a href=../../../query_language/table_functions/hdfs/ title=hdfs class="nav-link text-light text-wrap d-inline-block w-100 px-0">hdfs</a> <a href=../../../query_language/table_functions/input/ title=input class="nav-link text-light text-wrap d-inline-block w-100 px-0">input</a> </nav> </div> <a href=#sidebar-sidebar-7-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-11 title=Dictionaries class="nav-link text-light text-wrap dropdown-toggle px-0">Dictionaries</a> <div id=sidebar-sidebar-7-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/dicts/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=#sidebar-sidebar-7-11-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-11-2 title="External Dictionaries" class="nav-link text-light text-wrap dropdown-toggle px-0">External Dictionaries</a> <div id=sidebar-sidebar-7-11-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../query_language/dicts/external_dicts/ title="General Description" class="nav-link text-light text-wrap d-inline-block w-100 px-0">General Description</a> <a href=../../../query_language/dicts/external_dicts_dict/ title="Configuring an External Dictionary" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Configuring an External Dictionary</a> <a href=../../../query_language/dicts/external_dicts_dict_layout/ title="Storing Dictionaries in Memory" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Storing Dictionaries in Memory</a> <a href=../../../query_language/dicts/external_dicts_dict_lifetime/ title="Dictionary Updates" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary Updates</a> <a href=../../../query_language/dicts/external_dicts_dict_sources/ title="Sources of External Dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Sources of External Dictionaries</a> <a href=../../../query_language/dicts/external_dicts_dict_structure/ title="Dictionary Key and Fields" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary Key and Fields</a> </nav> </div> <a href=../../../query_language/dicts/internal_dicts/ title="Internal Dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Internal Dictionaries</a> <a href=../../../query_language/operators/ title=Operators class="nav-link text-light text-wrap d-inline-block w-100 px-0">Operators</a> <a href=../../../query_language/syntax/ title="General Syntax" class="nav-link text-light text-wrap d-inline-block w-100 px-0">General Syntax</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=Operations class="nav-link text-light text-wrap dropdown-toggle px-0">Operations</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../../operations/requirements/ title=Requirements class="nav-link text-light text-wrap d-inline-block w-100 px-0">Requirements</a> <a href=../../../operations/monitoring/ title=Monitoring class="nav-link text-light text-wrap d-inline-block w-100 px-0">Monitoring</a> <a href=../../../operations/troubleshooting/ title=Troubleshooting class="nav-link text-light text-wrap d-inline-block w-100 px-0">Troubleshooting</a> <a href=../../../operations/tips/ title="Usage Recommendations" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Usage Recommendations</a> <a href=../../../operations/update/ title="ClickHouse Update" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse Update</a> <a href=../../../operations/access_rights/ title="Access Rights" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Access Rights</a> <a href=../../../operations/backup/ title="Data Backup" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Data Backup</a> <a href=../../../operations/configuration_files/ title="Configuration Files" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Configuration Files</a> <a href=../../../operations/quotas/ title=Quotas class="nav-link text-light text-wrap d-inline-block w-100 px-0">Quotas</a> <a href=../../../operations/system_tables/ title="System Tables" class="nav-link text-light text-wrap d-inline-block w-100 px-0">System Tables</a> <a href=#sidebar-sidebar-8-12 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-12 title="Server Configuration Parameters" class="nav-link text-light text-wrap dropdown-toggle px-0">Server Configuration Parameters</a> <div id=sidebar-sidebar-8-12 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/server_settings/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../../operations/server_settings/settings/ title="Server Settings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Server Settings</a> </nav> </div> <a href=#sidebar-sidebar-8-13 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-13 title=Settings class="nav-link text-light text-wrap dropdown-toggle px-0">Settings</a> <div id=sidebar-sidebar-8-13 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/settings/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../../operations/settings/permissions_for_queries/ title="Permissions for Queries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Permissions for Queries</a> <a href=../../../operations/settings/query_complexity/ title="Restrictions on Query Complexity" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Restrictions on Query Complexity</a> <a href=../../../operations/settings/settings/ title=Settings class="nav-link text-light text-wrap d-inline-block w-100 px-0">Settings</a> <a href=../../../operations/settings/settings_profiles/ title="Settings Profiles" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Settings Profiles</a> <a href=../../../operations/settings/settings_users/ title="User Settings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">User Settings</a> <a href=../../../operations/settings/constraints_on_settings/ title="Constraints on Settings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Constraints on Settings</a> </nav> </div> <a href=#sidebar-sidebar-8-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-14 title=Utilities class="nav-link text-light text-wrap dropdown-toggle px-0">Utilities</a> <div id=sidebar-sidebar-8-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../operations/utils/ title=Overview class="nav-link text-light text-wrap d-inline-block w-100 px-0">Overview</a> <a href=../../../operations/utils/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../../operations/utils/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title=F.A.Q. class="nav-link text-light text-wrap dropdown-toggle px-0">F.A.Q.</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../faq/general/ title="General Questions" class="nav-link text-light text-wrap d-inline-block w-100 px-0">General Questions</a> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title=Development class="nav-link text-light text-wrap dropdown-toggle px-0">Development</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../development/architecture/ title="Overview of ClickHouse Architecture" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Overview of ClickHouse Architecture</a> <a href=../../../development/build/ title="How to Build ClickHouse on Linux" class="nav-link text-light text-wrap d-inline-block w-100 px-0">How to Build ClickHouse on Linux</a> <a href=../../../development/build_osx/ title="How to Build ClickHouse on Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">How to Build ClickHouse on Mac OS X</a> <a href=../../../development/style/ title="How to Write C++ code" class="nav-link text-light text-wrap d-inline-block w-100 px-0">How to Write C++ code</a> <a href=../../../development/tests/ title="How to Run ClickHouse Tests" class="nav-link text-light text-wrap d-inline-block w-100 px-0">How to Run ClickHouse Tests</a> <a href=../../../development/contrib/ title="Third-Party Libraries Used" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Third-Party Libraries Used</a> </nav> </div> <a href=#sidebar-sidebar-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-11 title="What's New" class="nav-link text-light text-wrap dropdown-toggle px-0">What's New</a> <div id=sidebar-sidebar-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../roadmap/ title=Roadmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">Roadmap</a> <a href=../../../changelog/ title=Changelog class="nav-link text-light text-wrap d-inline-block w-100 px-0">Changelog</a> <a href=../../../security_changelog/ title="Security Changelog" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Security Changelog</a> </nav> </div> <a href=../../../single/clickhouse_fa.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt="نسخه PDF" title="نسخه PDF" height=24 class="d-block mr-1 float-left"><div>نسخه PDF</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-5"> <div id=content> <h1 id=table_engines-mergetree>MergeTree<a class=headerlink href=#table_engines-mergetree title="Permanent link">&para;</a></h1> <p>The <code>MergeTree</code> engine and other engines of this family (<code>*MergeTree</code>) are the most robust ClickHousе table engines.</p> <p>Engines in the <code>MergeTree</code> family are designed for inserting a very large amount of data into a table. The data is quickly written to the table part by part, then rules are applied for merging the parts in the background. This method is much more efficient than continually rewriting the data in storage during insert.</p> <p>Main features:</p> <ul> <li> <p>Stores data sorted by primary key.</p> <p>This allows you to create a small sparse index that helps find data faster.</p> </li> <li> <p>Partitions can be used if the <a href=../custom_partitioning_key/ >partitioning key</a> is specified.</p> <p>ClickHouse supports certain operations with partitions that are more effective than general operations on the same data with the same result. ClickHouse also automatically cuts off the partition data where the partitioning key is specified in the query. This also improves query performance.</p> </li> <li> <p>Data replication support.</p> <p>The family of <code>ReplicatedMergeTree</code> tables provides data replication. For more information, see <a href=../replication/ >Data replication</a>.</p> </li> <li> <p>Data sampling support.</p> <p>If necessary, you can set the data sampling method in the table.</p> </li> </ul> <div class="admonition info"> <p class=admonition-title>Info</p> <p>The <a href=../merge/ >Merge</a> engine does not belong to the <code>*MergeTree</code> family.</p> </div> <h2 id=table_engine-mergetree-creating-a-table>Creating a Table<a class=headerlink href=#table_engine-mergetree-creating-a-table title="Permanent link">&para;</a></h2> <div class=codehilite><pre><span></span><code><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span>
<span class=p>(</span>
    <span class=n>name1</span> <span class=p>[</span><span class=n>type1</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr1</span><span class=p>]</span> <span class=p>[</span><span class=n>TTL</span> <span class=n>expr1</span><span class=p>],</span>
    <span class=n>name2</span> <span class=p>[</span><span class=n>type2</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr2</span><span class=p>]</span> <span class=p>[</span><span class=n>TTL</span> <span class=n>expr2</span><span class=p>],</span>
    <span class=p>...</span>
    <span class=k>INDEX</span> <span class=n>index_name1</span> <span class=n>expr1</span> <span class=k>TYPE</span> <span class=n>type1</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>value1</span><span class=p>,</span>
    <span class=k>INDEX</span> <span class=n>index_name2</span> <span class=n>expr2</span> <span class=k>TYPE</span> <span class=n>type2</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>value2</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=p>[</span><span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=k>ORDER</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=n>SAMPLE</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=n>TTL</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=n>SETTINGS</span> <span class=n>name</span><span class=o>=</span><span class=n>value</span><span class=p>,</span> <span class=p>...]</span>
</code></pre></div> <p>For a description of parameters, see the <a href=../../../query_language/create/ >CREATE query description</a>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p><code>INDEX</code> is an experimental feature, see <a href=#table_engine-mergetree-data_skipping-indexes>Data Skipping Indexes</a>.</p> </div> <h3 id=query-clauses>Query Clauses<a class=headerlink href=#query-clauses title="Permanent link">&para;</a></h3> <ul> <li> <p><code>ENGINE</code> — Name and parameters of the engine. <code>ENGINE = MergeTree()</code>. The <code>MergeTree</code> engine does not have parameters.</p> </li> <li> <p><code>PARTITION BY</code> — The <a href=../custom_partitioning_key/ >partitioning key</a>.</p> <p>For partitioning by month, use the <code>toYYYYMM(date_column)</code> expression, where <code>date_column</code> is a column with a date of the type <a href=../../../data_types/date/ >Date</a>. The partition names here have the <code>"YYYYMM"</code> format.</p> </li> <li> <p><code>ORDER BY</code> — The sorting key.</p> <p>A tuple of columns or arbitrary expressions. Example: <code>ORDER BY (CounterID, EventDate)</code>.</p> </li> <li> <p><code>PRIMARY KEY</code> — The primary key if it <a href=./ >differs from the sorting key</a>.</p> <p>By default the primary key is the same as the sorting key (which is specified by the <code>ORDER BY</code> clause). Thus in most cases it is unnecessary to specify a separate <code>PRIMARY KEY</code> clause.</p> </li> <li> <p><code>SAMPLE BY</code> — An expression for sampling.</p> <p>If a sampling expression is used, the primary key must contain it. Example: <code>SAMPLE BY intHash32(UserID) ORDER BY (CounterID, EventDate, intHash32(UserID))</code>.</p> </li> <li> <p><code>TTL</code> — An expression for setting storage time for rows.</p> <p>It must depend on the <code>Date</code> or <code>DateTime</code> column and have one <code>Date</code> or <code>DateTime</code> column as a result. Example:<br> <code>TTL date + INTERVAL 1 DAY</code></p> <p>For more details, see <a href=#table_engine-mergetree-ttl>TTL for columns and tables</a></p> </li> <li> <p><code>SETTINGS</code> — Additional parameters that control the behavior of the <code>MergeTree</code>:</p> <ul> <li><code>index_granularity</code> — The granularity of an index. The number of data rows between the "marks" of an index. By default, 8192. For the list of available parameters, see <a href=https://github.com/ClickHouse/ClickHouse/blob/master/dbms/src/Storages/MergeTree/MergeTreeSettings.h rel="external nofollow noreferrer">MergeTreeSettings.h</a>.</li> <li><code>use_minimalistic_part_header_in_zookeeper</code> — Storage method of the data parts headers in ZooKeeper. If <code>use_minimalistic_part_header_in_zookeeper=1</code>, then ZooKeeper stores less data. For more information, see the <a href=../../server_settings/settings/#server-settings-use_minimalistic_part_header_in_zookeeper>setting description</a> in "Server configuration parameters".</li> <li><code>min_merge_bytes_to_use_direct_io</code> — The minimum data volume for merge operation that is required for using direct I/O access to the storage disk. When merging data parts, ClickHouse calculates the total storage volume of all the data to be merged. If the volume exceeds <code>min_merge_bytes_to_use_direct_io</code> bytes, ClickHouse reads and writes the data to the storage disk using the direct I/O interface (<code>O_DIRECT</code> option). If <code>min_merge_bytes_to_use_direct_io = 0</code>, then direct I/O is disabled. Default value: <code>10 * 1024 * 1024 * 1024</code> bytes.<br> <a name=mergetree_setting-merge_with_ttl_timeout></a></li> <li><code>merge_with_ttl_timeout</code> — Minimum delay in seconds before repeating a merge with TTL. Default value: 86400 (1 day).</li> </ul> </li> </ul> <p><strong>Example of Sections Setting</strong></p> <div class=codehilite><pre><span></span><code><span class=n>ENGINE</span> <span class=n>MergeTree</span><span class=p>()</span> <span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>EventDate</span><span class=p>)</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>CounterID</span><span class=p>,</span> <span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>))</span> <span class=n>SAMPLE</span> <span class=k>BY</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>)</span> <span class=n>SETTINGS</span> <span class=n>index_granularity</span><span class=o>=</span><span class=mi>8192</span>
</code></pre></div> <p>In the example, we set partitioning by month.</p> <p>We also set an expression for sampling as a hash by the user ID. This allows you to pseudorandomize the data in the table for each <code>CounterID</code> and <code>EventDate</code>. If you define a <a href=../../../query_language/select/#select-sample-clause>SAMPLE</a> clause when selecting the data, ClickHouse will return an evenly pseudorandom data sample for a subset of users.</p> <p>The <code>index_granularity</code> setting can be omitted because 8192 is the default value.</p> <details> <p><summary>Deprecated Method for Creating a Table</summary></p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>Do not use this method in new projects. If possible, switch old projects to the method described above.</p> </div> <div class=codehilite><pre><span></span><code><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span>
<span class=p>(</span>
    <span class=n>name1</span> <span class=p>[</span><span class=n>type1</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr1</span><span class=p>],</span>
    <span class=n>name2</span> <span class=p>[</span><span class=n>type2</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr2</span><span class=p>],</span>
    <span class=p>...</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=p>[</span><span class=o>=</span><span class=p>]</span> <span class=n>MergeTree</span><span class=p>(</span><span class=nb>date</span><span class=o>-</span><span class=k>column</span> <span class=p>[,</span> <span class=n>sampling_expression</span><span class=p>],</span> <span class=p>(</span><span class=k>primary</span><span class=p>,</span> <span class=k>key</span><span class=p>),</span> <span class=n>index_granularity</span><span class=p>)</span>
</code></pre></div> <p><strong>MergeTree() Parameters</strong></p> <ul> <li><code>date-column</code> — The name of a column of the <a href=../../../data_types/date/ >Date</a> type. ClickHouse automatically creates partitions by month based on this column. The partition names are in the <code>"YYYYMM"</code> format.</li> <li><code>sampling_expression</code> — An expression for sampling.</li> <li><code>(primary, key)</code> — Primary key. Type: <a href=../../../data_types/tuple/ >Tuple()</a></li> <li><code>index_granularity</code> — The granularity of an index. The number of data rows between the "marks" of an index. The value 8192 is appropriate for most tasks.</li> </ul> <p><strong>Example</strong></p> <div class=codehilite><pre><span></span><code><span class=n>MergeTree</span><span class=p>(</span><span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>),</span> <span class=p>(</span><span class=n>CounterID</span><span class=p>,</span> <span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>)),</span> <span class=mi>8192</span><span class=p>)</span>
</code></pre></div> <p>The <code>MergeTree</code> engine is configured in the same way as in the example above for the main engine configuration method.</p> </details> <h2 id=data-storage>Data Storage<a class=headerlink href=#data-storage title="Permanent link">&para;</a></h2> <p>A table consists of data parts sorted by primary key.</p> <p>When data is inserted in a table, separate data parts are created and each of them is lexicographically sorted by primary key. For example, if the primary key is <code>(CounterID, Date)</code>, the data in the part is sorted by <code>CounterID</code>, and within each <code>CounterID</code>, it is ordered by <code>Date</code>.</p> <p>Data belonging to different partitions are separated into different parts. In the background, ClickHouse merges data parts for more efficient storage. Parts belonging to different partitions are not merged. The merge mechanism does not guarantee that all rows with the same primary key will be in the same data part.</p> <p>For each data part, ClickHouse creates an index file that contains the primary key value for each index row ("mark"). Index row numbers are defined as <code>n * index_granularity</code>. The maximum value <code>n</code> is equal to the integer part of dividing the total number of rows by the <code>index_granularity</code>. For each column, the "marks" are also written for the same index rows as the primary key. These "marks" allow you to find the data directly in the columns.</p> <p>You can use a single large table and continually add data to it in small chunks – this is what the <code>MergeTree</code> engine is intended for.</p> <h2 id=primary-keys-and-indexes-in-queries>Primary Keys and Indexes in Queries<a class=headerlink href=#primary-keys-and-indexes-in-queries title="Permanent link">&para;</a></h2> <p>Take the <code>(CounterID, Date)</code> primary key as an example. In this case, the sorting and index can be illustrated as follows:</p> <div class=codehilite><pre><span></span><code><span class=n>Whole</span><span class=w> </span><span class=k>data</span><span class=err>:</span><span class=w>     </span><span class=o>[</span><span class=n>-------------------------------------------------------------------------</span><span class=o>]</span><span class=w></span>
<span class=nl>CounterID</span><span class=p>:</span><span class=w>      </span><span class=o>[</span><span class=n>aaaaaaaaaaaaaaaaaabbbbcdeeeeeeeeeeeeefgggggggghhhhhhhhhiiiiiiiiikllllllll</span><span class=o>]</span><span class=w></span>
<span class=nc>Date</span><span class=err>:</span><span class=w>           </span><span class=o>[</span><span class=n>1111111222222233331233211111222222333211111112122222223111112223311122333</span><span class=o>]</span><span class=w></span>
<span class=nl>Marks</span><span class=p>:</span><span class=w>           </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w></span>
<span class=w>                </span><span class=n>a</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>a</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>a</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>b</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>e</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>e</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>g</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>h</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>i</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>l</span><span class=p>,</span><span class=mi>3</span><span class=w></span>
<span class=n>Marks</span><span class=w> </span><span class=nl>numbers</span><span class=p>:</span><span class=w>   </span><span class=mi>0</span><span class=w>      </span><span class=mi>1</span><span class=w>      </span><span class=mi>2</span><span class=w>      </span><span class=mi>3</span><span class=w>      </span><span class=mi>4</span><span class=w>      </span><span class=mi>5</span><span class=w>      </span><span class=mi>6</span><span class=w>      </span><span class=mi>7</span><span class=w>      </span><span class=mi>8</span><span class=w>      </span><span class=mi>9</span><span class=w>      </span><span class=mi>10</span><span class=w></span>
</code></pre></div> <p>If the data query specifies:</p> <ul> <li><code>CounterID in ('a', 'h')</code>, the server reads the data in the ranges of marks <code>[0, 3)</code> and <code>[6, 8)</code>.</li> <li><code>CounterID IN ('a', 'h') AND Date = 3</code>, the server reads the data in the ranges of marks <code>[1, 3)</code> and <code>[7, 8)</code>.</li> <li><code>Date = 3</code>, the server reads the data in the range of marks <code>[1, 10]</code>.</li> </ul> <p>The examples above show that it is always more effective to use an index than a full scan.</p> <p>A sparse index allows extra data to be read. When reading a single range of the primary key, up to <code>index_granularity * 2</code> extra rows in each data block can be read. In most cases, ClickHouse performance does not degrade when <code>index_granularity = 8192</code>.</p> <p>Sparse indexes allow you to work with a very large number of table rows, because such indexes are always stored in the computer's RAM.</p> <p>ClickHouse does not require a unique primary key. You can insert multiple rows with the same primary key.</p> <h3 id=selecting-the-primary-key>Selecting the Primary Key<a class=headerlink href=#selecting-the-primary-key title="Permanent link">&para;</a></h3> <p>The number of columns in the primary key is not explicitly limited. Depending on the data structure, you can include more or fewer columns in the primary key. This may:</p> <ul> <li> <p>Improve the performance of an index.</p> <p>If the primary key is <code>(a, b)</code>, then adding another column <code>c</code> will improve the performance if the following conditions are met:</p> <ul> <li>There are queries with a condition on column <code>c</code>.</li> <li>Long data ranges (several times longer than the <code>index_granularity</code>) with identical values for <code>(a, b)</code> are common. In other words, when adding another column allows you to skip quite long data ranges.</li> </ul> </li> <li> <p>Improve data compression.</p> <p>ClickHouse sorts data by primary key, so the higher the consistency, the better the compression.</p> </li> <li> <p>Provide additional logic when merging data parts in the <a href=../collapsingmergetree/#table_engine-collapsingmergetree>CollapsingMergeTree</a> and <a href=../summingmergetree/ >SummingMergeTree</a> engines.</p> <p>In this case it makes sense to specify the <em>sorting key</em> that is different from the primary key.</p> </li> </ul> <p>A long primary key will negatively affect the insert performance and memory consumption, but extra columns in the primary key do not affect ClickHouse performance during <code>SELECT</code> queries.</p> <h3 id=choosing-a-primary-key-that-differs-from-the-sorting-key>Choosing a Primary Key that Differs from the Sorting Key<a class=headerlink href=#choosing-a-primary-key-that-differs-from-the-sorting-key title="Permanent link">&para;</a></h3> <p>It is possible to specify a primary key (an expression with values that are written in the index file for each mark) that is different from the sorting key (an expression for sorting the rows in data parts). In this case the primary key expression tuple must be a prefix of the sorting key expression tuple.</p> <p>This feature is helpful when using the <a href=../summingmergetree/ >SummingMergeTree</a> and<br> <a href=../aggregatingmergetree/ >AggregatingMergeTree</a> table engines. In a common case when using these engines, the table has two types of columns: <em>dimensions</em> and <em>measures</em>. Typical queries aggregate values of measure columns with arbitrary <code>GROUP BY</code> and filtering by dimensions. Because SummingMergeTree and AggregatingMergeTree aggregate rows with the same value of the sorting key, it is natural to add all dimensions to it. As a result, the key expression consists of a long list of columns and this list must be frequently updated with newly added dimensions.</p> <p>In this case it makes sense to leave only a few columns in the primary key that will provide efficient range scans and add the remaining dimension columns to the sorting key tuple.</p> <p><a href=../../../query_language/alter/ >ALTER</a> of the sorting key is a lightweight operation because when a new column is simultaneously added to the table and to the sorting key, existing data parts don't need to be changed. Since the old sorting key is a prefix of the new sorting key and there is no data in the newly added column, the data is sorted by both the old and new sorting keys at the moment of table modification.</p> <h3 id=use-of-indexes-and-partitions-in-queries>Use of Indexes and Partitions in Queries<a class=headerlink href=#use-of-indexes-and-partitions-in-queries title="Permanent link">&para;</a></h3> <p>For <code>SELECT</code> queries, ClickHouse analyzes whether an index can be used. An index can be used if the <code>WHERE/PREWHERE</code> clause has an expression (as one of the conjunction elements, or entirely) that represents an equality or inequality comparison operation, or if it has <code>IN</code> or <code>LIKE</code> with a fixed prefix on columns or expressions that are in the primary key or partitioning key, or on certain partially repetitive functions of these columns, or logical relationships of these expressions.</p> <p>Thus, it is possible to quickly run queries on one or many ranges of the primary key. In this example, queries will be fast when run for a specific tracking tag, for a specific tag and date range, for a specific tag and date, for multiple tags with a date range, and so on.</p> <p>Let's look at the engine configured as follows:</p> <div class=codehilite><pre><span></span><code><span class=err>ENGINE MergeTree() PARTITION BY toYYYYMM(EventDate) ORDER BY (CounterID, EventDate) SETTINGS index_granularity=8192</span>
</code></pre></div> <p>In this case, in queries:</p> <div class=codehilite><pre><span></span><code><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>42</span><span class=p>)</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=p>((</span><span class=n>EventDate</span> <span class=o>&gt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>&#39;2014-01-01&#39;</span><span class=p>)</span> <span class=k>AND</span> <span class=n>EventDate</span> <span class=o>&lt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>&#39;2014-01-31&#39;</span><span class=p>))</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>&#39;2014-05-01&#39;</span><span class=p>))</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=k>IN</span> <span class=p>(</span><span class=mi>101500</span><span class=p>,</span> <span class=mi>731962</span><span class=p>,</span> <span class=mi>160656</span><span class=p>)</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>101500</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>!=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>&#39;2014-05-01&#39;</span><span class=p>))</span>
</code></pre></div> <p>ClickHouse will use the primary key index to trim improper data and the monthly partitioning key to trim partitions that are in improper date ranges.</p> <p>The queries above show that the index is used even for complex expressions. Reading from the table is organized so that using the index can't be slower than a full scan.</p> <p>In the example below, the index can't be used.</p> <div class=codehilite><pre><span></span><code><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>URL</span> <span class=k>LIKE</span> <span class=s1>&#39;%upyachka%&#39;</span>
</code></pre></div> <p>To check whether ClickHouse can use the index when running a query, use the settings <a href=../../settings/settings/#settings-force_index_by_date>force_index_by_date</a> and <a href=../../settings/settings/ >force_primary_key</a>.</p> <p>The key for partitioning by month allows reading only those data blocks which contain dates from the proper range. In this case, the data block may contain data for many dates (up to an entire month). Within a block, data is sorted by primary key, which might not contain the date as the first column. Because of this, using a query with only a date condition that does not specify the primary key prefix will cause more data to be read than for a single date.</p> <h3 id=use-of-index-for-partially-monotonic-primary-keys>Use of Index for Partially-Monotonic Primary Keys<a class=headerlink href=#use-of-index-for-partially-monotonic-primary-keys title="Permanent link">&para;</a></h3> <p>Consider, for example, the days of the month. They form a <a href=https://en.wikipedia.org/wiki/Monotonic_function rel="external nofollow noreferrer">monotonic sequence</a> for one month, but not monotonic for more extended periods. This is a partially-monotonic sequence. If a user creates the table with partially-monotonic primary key, ClickHouse creates a sparse index as usual. When a user selects data from this kind of table, ClickHouse analyzes the query conditions. If the user wants to get data between two marks of the index and both these marks fall within one month, ClickHouse can use the index in this particular case because it can calculate the distance between the parameters of a query and index marks.</p> <p>ClickHouse cannot use an index if the values of the primary key in the query parameter range don't represent a monotonic sequence. In this case, ClickHouse uses the full scan method.</p> <p>ClickHouse uses this logic not only for days of the month sequences, but for any primary key that represents a partially-monotonic sequence.</p> <h3 id=table_engine-mergetree-data_skipping-indexes>Data Skipping Indexes (Experimental)<a class=headerlink href=#table_engine-mergetree-data_skipping-indexes title="Permanent link">&para;</a></h3> <p>You need to set <code>allow_experimental_data_skipping_indices</code> to 1 to use indices. (run <code>SET allow_experimental_data_skipping_indices = 1</code>).</p> <p>The index declaration is in the columns section of the <code>CREATE</code> query.</p> <div class=codehilite><pre><span></span><code><span class=k>INDEX</span> <span class=n>index_name</span> <span class=n>expr</span> <span class=k>TYPE</span> <span class=k>type</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>granularity_value</span>
</code></pre></div> <p>For tables from the <code>*MergeTree</code> family, data skipping indices can be specified.</p> <p>These indices aggregate some information about the specified expression on blocks, which consist of <code>granularity_value</code> granules (the size of the granule is specified using the <code>index_granularity</code> setting in the table engine). Then these aggregates are used in <code>SELECT</code> queries for reducing the amount of data to read from the disk by skipping big blocks of data where the <code>where</code> query cannot be satisfied.</p> <p><strong>Example</strong></p> <div class=codehilite><pre><span></span><code><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=k>table_name</span>
<span class=p>(</span>
    <span class=n>u64</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>i32</span> <span class=n>Int32</span><span class=p>,</span>
    <span class=n>s</span> <span class=n>String</span><span class=p>,</span>
    <span class=p>...</span>
    <span class=k>INDEX</span> <span class=n>a</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>3</span><span class=p>,</span>
    <span class=k>INDEX</span> <span class=n>b</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=p>...</span>
</code></pre></div> <p>Indices from the example can be used by ClickHouse to reduce the amount of data to read from disk in the following queries:</p> <div class=codehilite><pre><span></span><code><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>s</span> <span class=o>&lt;</span> <span class=s1>&#39;z&#39;</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span> <span class=o>==</span> <span class=mi>10</span> <span class=k>AND</span> <span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>1234</span>
</code></pre></div> <h4 id=available-types-of-indices>Available Types of Indices<a class=headerlink href=#available-types-of-indices title="Permanent link">&para;</a></h4> <ul> <li> <p><code>minmax</code></p> <p>Stores extremes of the specified expression (if the expression is <code>tuple</code>, then it stores extremes for each element of <code>tuple</code>), uses stored info for skipping blocks of data like the primary key.</p> </li> <li> <p><code>set(max_rows)</code></p> <p>Stores unique values of the specified expression (no more than <code>max_rows</code> rows, <code>max_rows=0</code> means "no limits"). Uses the values to check if the <code>WHERE</code> expression is not satisfiable on a block of data. </p> </li> <li> <p><code>ngrambf_v1(n, size_of_bloom_filter_in_bytes, number_of_hash_functions, random_seed)</code></p> <p>Stores a <a href=https://en.wikipedia.org/wiki/Bloom_filter rel="external nofollow noreferrer">Bloom filter</a> that contains all ngrams from a block of data. Works only with strings. Can be used for optimization of <code>equals</code>, <code>like</code> and <code>in</code> expressions.</p> <ul> <li><code>n</code> — ngram size,</li> <li><code>size_of_bloom_filter_in_bytes</code> — Bloom filter size in bytes (you can use large values here, for example, 256 or 512, because it can be compressed well).</li> <li><code>number_of_hash_functions</code> — The number of hash functions used in the Bloom filter.</li> <li><code>random_seed</code> — The seed for Bloom filter hash functions.</li> </ul> </li> <li> <p><code>tokenbf_v1(size_of_bloom_filter_in_bytes, number_of_hash_functions, random_seed)</code></p> <p>The same as <code>ngrambf_v1</code>, but stores tokens instead of ngrams. Tokens are sequences separated by non-alphanumeric characters.</p> </li> <li> <p><code>bloom_filter([false_positive])</code> — Stores a <a href=https://en.wikipedia.org/wiki/Bloom_filter rel="external nofollow noreferrer">Bloom filter</a> for the specified columns.</p> <p>The optional <code>false_positive</code> parameter is the probability of receiving a false positive response from the filter. Possible values: (0, 1). Default value: 0.025.</p> <p>Supported data types: <code>Int*</code>, <code>UInt*</code>, <code>Float*</code>, <code>Enum</code>, <code>Date</code>, <code>DateTime</code>, <code>String</code>, <code>FixedString</code>.</p> <p>The following functions can use it: <a href=../../../query_language/functions/comparison_functions/ >equals</a>, <a href=../../../query_language/functions/comparison_functions/ >notEquals</a>, <a href=../../../query_language/functions/in_functions/ >in</a>, <a href=../../../query_language/functions/in_functions/ >notIn</a>.</p> </li> </ul> <div class=codehilite><pre><span></span><code><span class=k>INDEX</span> <span class=n>sample_index</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=k>INDEX</span> <span class=n>sample_index2</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>i32</span> <span class=o>+</span> <span class=n>f64</span> <span class=o>*</span> <span class=mi>100</span><span class=p>,</span> <span class=nb>date</span><span class=p>,</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=k>INDEX</span> <span class=n>sample_index3</span> <span class=p>(</span><span class=k>lower</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>ngrambf_v1</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>256</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
</code></pre></div> <h4 id=functions-support>Functions Support<a class=headerlink href=#functions-support title="Permanent link">&para;</a></h4> <p>Conditions in the <code>WHERE</code> clause contains calls of the functions that operate with columns. If the column is a part of an index, ClickHouse tries to use this index when performing the functions. ClickHouse supports different subsets of functions for using indexes.</p> <p>The <code>set</code> index can be used with all functions. Function subsets for other indexes are shown in the table below.</p> <table> <thead> <tr> <th>Function (operator) / Index</th> <th>primary key</th> <th>minmax</th> <th>ngrambf_v1</th> <th>tokenbf_v1</th> <th>bloom_filter</th> </tr> </thead> <tbody> <tr> <td><a href=../../../query_language/functions/comparison_functions/#function-equals>equals (=, ==)</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../query_language/functions/comparison_functions/#function-notequals>notEquals(!=, &lt;&gt;)</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../query_language/functions/string_search_functions/#function-like>like</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../query_language/functions/string_search_functions/#function-notlike>notLike</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../query_language/functions/string_functions/#function-startswith>startsWith</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../query_language/functions/string_functions/#function-endswith>endsWith</a></td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../query_language/functions/string_search_functions/#function-multisearchany>multiSearchAny</a></td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../query_language/functions/in_functions/#in-functions>in</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../query_language/functions/in_functions/#in-functions>notIn</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../query_language/functions/comparison_functions/#function-less>less (&lt;)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../query_language/functions/comparison_functions/#function-greater>greater (&gt;)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../query_language/functions/comparison_functions/#function-lessorequals>lessOrEquals (&lt;=)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../query_language/functions/comparison_functions/#function-greaterorequals>greaterOrEquals (&gt;=)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../query_language/functions/array_functions/#function-empty>empty</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../query_language/functions/array_functions/#function-notempty>notEmpty</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td>hasToken</td> <td>✗</td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✗</td> </tr> </tbody> </table> <p>Functions with a constant argument that is less than ngram size can't be used by <code>ngrambf_v1</code> for query optimization.</p> <p>Bloom filters can have false positive matches, so the <code>ngrambf_v1</code>, <code>tokenbf_v1</code>, and <code>bloom_filter</code> indexes can't be used for optimizing queries where the result of a function is expected to be false, for example:</p> <ul> <li>Can be optimized:<ul> <li><code>s LIKE '%test%'</code></li> <li><code>NOT s NOT LIKE '%test%'</code></li> <li><code>s = 1</code></li> <li><code>NOT s != 1</code></li> <li><code>startsWith(s, 'test')</code></li> </ul> </li> <li>Can't be optimized:<ul> <li><code>NOT s LIKE '%test%'</code></li> <li><code>s NOT LIKE '%test%'</code></li> <li><code>NOT s = 1</code></li> <li><code>s != 1</code></li> <li><code>NOT startsWith(s, 'test')</code></li> </ul> </li> </ul> <h2 id=concurrent-data-access>Concurrent Data Access<a class=headerlink href=#concurrent-data-access title="Permanent link">&para;</a></h2> <p>For concurrent table access, we use multi-versioning. In other words, when a table is simultaneously read and updated, data is read from a set of parts that is current at the time of the query. There are no lengthy locks. Inserts do not get in the way of read operations.</p> <p>Reading from a table is automatically parallelized.</p> <h2 id=table_engine-mergetree-ttl>TTL for Columns and Tables<a class=headerlink href=#table_engine-mergetree-ttl title="Permanent link">&para;</a></h2> <p>Determines the lifetime of values.</p> <p>The <code>TTL</code> clause can be set for the whole table and for each individual column. If both <code>TTL</code> are set, ClickHouse uses that <code>TTL</code> which expires earlier.</p> <p>The table must have the column in the <a href=../../../data_types/date/ >Date</a> or <a href=../../../data_types/datetime/ >DateTime</a> data type. To define the lifetime of data, use operations on this time column, for example:</p> <div class=codehilite><pre><span></span><code><span class=n>TTL</span> <span class=n>time_column</span>
<span class=n>TTL</span> <span class=n>time_column</span> <span class=o>+</span> <span class=nb>interval</span>
</code></pre></div> <p>To define <code>interval</code>, use <a href=../../../query_language/operators/#operators-datetime>time interval</a> operators.</p> <div class=codehilite><pre><span></span><code><span class=n>TTL</span> <span class=n>date_time</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span>
<span class=n>TTL</span> <span class=n>date_time</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>15</span> <span class=n>HOUR</span>
</code></pre></div> <p><strong>Column TTL</strong></p> <p>When the values in the column expire, ClickHouse replaces them with the default values for the column data type. If all the column values in the data part expire, ClickHouse deletes this column from the data part in a filesystem.</p> <p>The <code>TTL</code> clause can't be used for key columns.</p> <p>Examples:</p> <p>Creating a table with TTL</p> <div class=codehilite><pre><span></span><code><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>example_table</span> 
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>,</span>
    <span class=n>b</span> <span class=nb>Int</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>,</span>
    <span class=k>c</span> <span class=n>String</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span><span class=p>;</span>
</code></pre></div> <p>Adding TTL to a column of an existing table</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=k>COLUMN</span>
    <span class=k>c</span> <span class=n>String</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>DAY</span><span class=p>;</span>
</code></pre></div> <p>Altering TTL of the column</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=k>COLUMN</span>
    <span class=k>c</span> <span class=n>String</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>;</span>
</code></pre></div> <p><strong>Table TTL</strong></p> <p>When data in a table expires, ClickHouse deletes all corresponding rows.</p> <p>Examples:</p> <p>Creating a table with TTL</p> <div class=codehilite><pre><span></span><code><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>example_table</span> 
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span>
<span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>;</span>
</code></pre></div> <p>Altering TTL of the table</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>DAY</span><span class=p>;</span>
</code></pre></div> <p><strong>Removing Data</strong></p> <p>Data with an expired TTL is removed when ClickHouse merges data parts.</p> <p>When ClickHouse see that data is expired, it performs an off-schedule merge. To control the frequency of such merges, you can set <a href=#mergetree_setting-merge_with_ttl_timeout>merge_with_ttl_timeout</a>. If the value is too low, it will perform many off-schedule merges that may consume a lot of resources.</p> <p>If you perform the <code>SELECT</code> query between merges, you may get expired data. To avoid it, use the <a href=../../../query_language/misc/#misc_operations-optimize>OPTIMIZE</a> query before <code>SELECT</code>.</p> </div> <div id=content-footer class="text-muted pt-5"> <div class=float-right>©2016–2020 Yandex LLC</div> <div>ساخته شده از <a href=https://github.com/ClickHouse/ClickHouse/commit/a24471233fce463ffd70bff561f7842d4d0b7bd9 rel="external nofollow noreferrer" target=_blank class=text-reset>a24471233f</a></div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>جدول محتویات</label> <a href=#table_engine-mergetree-creating-a-table title="Creating a Table" class="nav-link text-wrap d-inline-block w-100"> Creating a Table </a> <nav id=toc-toc-1 class="nav flex-column pl-2"> <a href=#query-clauses title="Query Clauses" class="nav-link text-wrap d-inline-block w-100"> Query Clauses </a> </nav> <a href=#data-storage title="Data Storage" class="nav-link text-wrap d-inline-block w-100"> Data Storage </a> <a href=#primary-keys-and-indexes-in-queries title="Primary Keys and Indexes in Queries" class="nav-link text-wrap d-inline-block w-100"> Primary Keys and Indexes in Queries </a> <nav id=toc-toc-3 class="nav flex-column pl-2"> <a href=#selecting-the-primary-key title="Selecting the Primary Key" class="nav-link text-wrap d-inline-block w-100"> Selecting the Primary Key </a> <a href=#choosing-a-primary-key-that-differs-from-the-sorting-key title="Choosing a Primary Key that Differs from the Sorting Key" class="nav-link text-wrap d-inline-block w-100"> Choosing a Primary Key that Differs from the Sorting Key </a> <a href=#use-of-indexes-and-partitions-in-queries title="Use of Indexes and Partitions in Queries" class="nav-link text-wrap d-inline-block w-100"> Use of Indexes and Partitions in Queries </a> <a href=#use-of-index-for-partially-monotonic-primary-keys title="Use of Index for Partially-Monotonic Primary Keys" class="nav-link text-wrap d-inline-block w-100"> Use of Index for Partially-Monotonic Primary Keys </a> <a href=#table_engine-mergetree-data_skipping-indexes title="Data Skipping Indexes (Experimental)" class="nav-link text-wrap d-inline-block w-100"> Data Skipping Indexes (Experimental) </a> <nav id=toc-toc-3-5 class="nav flex-column pl-2"> <a href=#available-types-of-indices title="Available Types of Indices" class="nav-link text-wrap d-inline-block w-100"> Available Types of Indices </a> <a href=#functions-support title="Functions Support" class="nav-link text-wrap d-inline-block w-100"> Functions Support </a> </nav> </nav> <a href=#concurrent-data-access title="Concurrent Data Access" class="nav-link text-wrap d-inline-block w-100"> Concurrent Data Access </a> <a href=#table_engine-mergetree-ttl title="TTL for Columns and Tables" class="nav-link text-wrap d-inline-block w-100"> TTL for Columns and Tables </a> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?7bd05efd></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>