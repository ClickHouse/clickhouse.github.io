<!DOCTYPE html><html lang=fa data-version=v19.17 data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>ALTER - مستندات v19.17ClickHouse</title><link rel="shortcut icon" href=/favicon.ico><meta property=og:title content="ALTER - مستندات v19.17ClickHouse"><meta property=og:description content="ALTER The ALTER query is only supported for *MergeTree tables, as well as MergeandDistributed. The query has several var"><meta property=og:type content=website><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta property=twitter:title content="ALTER - مستندات v19.17ClickHouse"><meta name=description content="ALTER The ALTER query is only supported for *MergeTree tables, as well as MergeandDistributed. The query has several var"><meta name=keywords content="ClickHouse, DBMS, OLAP, relational, analytics, analytical, big data, open-source, SQL, web-analytics"><link href=/css/base.css?1d858e50 media=all rel=stylesheet></head> <body dir=rtl data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> ALTER </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li class=nav-item> <a href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/fa/query_language/alter.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/fa.svg alt=فارسی title=فارسی width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/v19.17/en/query_language/alter/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/v19.17/zh/query_language/alter/ class=dropdown-item> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/v19.17/es/query_language/alter/ class=dropdown-item> <img src=/images/flags/es.svg alt title width=32 class="d-inline-block mr-2">Español </a> <a href=/docs/v19.17/fr/query_language/alter/ class=dropdown-item> <img src=/images/flags/fr.svg alt title width=32 class="d-inline-block mr-2">Français </a> <a href=/docs/v19.17/ru/query_language/alter/ class=dropdown-item> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/v19.17/ja/query_language/alter/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> <a href=/docs/v19.17/fa/query_language/alter/ class="dropdown-item disabled"> <img src=/images/flags/fa.svg alt title width=32 class="d-inline-block mr-2">فارسی </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class="container-fluid text-right"> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label="چند صفحه یا یک صفحه"> <a href=../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt="نسخه چند صفحه ای" title="نسخه چند صفحه ای"> </a> <a href=../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt="نسخه تک صفحه ای" title="نسخه تک صفحه ای"> </a> </div> <div class="dropdown mb-3"> <a class="btn btn-dark dropdown-toggle text-muted" href=# role=button id=select-version data-toggle=dropdown aria-haspopup=true aria-expanded=false> نسخه: <span class=text-light>v19.17</span> </a> <div class="dropdown-menu bg-dark text-muted p-1" aria-labelledby=select-version> <a href=/docs/fa/ class=dropdown-item> <span class=text-light>جدیدترین</span> </a> <a href=/docs/v20.3/fa/ class=dropdown-item>v20.3</a> <a href=/docs/v20.1/fa/ class=dropdown-item>v20.1</a> <a href=/docs/v19.17/fa/ class="dropdown-item disable">v19.17</a> <a href=/docs/v19.16/fa/ class=dropdown-item>v19.16</a> <a href=/docs/v19.15/fa/ class=dropdown-item>v19.15</a> <a href=/docs/v19.14/fa/ class=dropdown-item>v19.14</a> <a href=/docs/v19.13/fa/ class=dropdown-item>v19.13</a> <a href=/docs/v19.11/fa/ class=dropdown-item>v19.11</a> <a href=/docs/v19.10/fa/ class=dropdown-item>v19.10</a> <a href=/docs/v19.9/fa/ class=dropdown-item>v19.9</a> <a href=/docs/v19.8/fa/ class=dropdown-item>v19.8</a> </div> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=Introduction class="nav-link text-light text-wrap dropdown-toggle px-0">Introduction</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../ title="ClickHouse چیست؟" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse چیست؟</a> <a href=../../introduction/distinctive_features/ title=" ویژگی های برجسته ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> ویژگی های برجسته ClickHouse</a> <a href=../../introduction/features_considered_disadvantages/ title=" ویژگی های از ClickHouse که می تواند معایبی باشد" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> ویژگی های از ClickHouse که می تواند معایبی باشد</a> <a href=../../introduction/performance/ title=Performance class="nav-link text-light text-wrap d-inline-block w-100 px-0">Performance</a> <a href=../../introduction/ya_metrika_task/ title="The Yandex.Metrica task" class="nav-link text-light text-wrap d-inline-block w-100 px-0">The Yandex.Metrica task</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title="Getting started" class="nav-link text-light text-wrap dropdown-toggle px-0">Getting started</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/ title=" شروع به کار" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> شروع به کار</a> <a href=#sidebar-sidebar-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-2 title="Example datasets" class="nav-link text-light text-wrap dropdown-toggle px-0">Example datasets</a> <div id=sidebar-sidebar-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting_started/example_datasets/ontime/ title=OnTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">OnTime</a> <a href=../../getting_started/example_datasets/nyc_taxi/ title=" داده های تاکسی New York" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> داده های تاکسی New York</a> <a href=../../getting_started/example_datasets/amplab_benchmark/ title=" بنچمارک AMPLab Big Data" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> بنچمارک AMPLab Big Data</a> <a href=../../getting_started/example_datasets/wikistat/ title=WikiStat class="nav-link text-light text-wrap d-inline-block w-100 px-0">WikiStat</a> <a href=../../getting_started/example_datasets/criteo/ title=" ترابایت از لاگ های کلیک از سرویس Criteo" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> ترابایت از لاگ های کلیک از سرویس Criteo</a> <a href=../../getting_started/example_datasets/star_schema/ title=" بنچمارک Star Schema" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> بنچمارک Star Schema</a> <a href=../../getting_started/example_datasets/metrica/ title="Yandex.Metrica Data" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Yandex.Metrica Data</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=Interfaces class="nav-link text-light text-wrap dropdown-toggle px-0">Interfaces</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/ title="Interface ها" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Interface ها</a> <a href=../../interfaces/cli/ title=" کلاینت Command-line" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> کلاینت Command-line</a> <a href=../../interfaces/tcp/ title="Native interface (TCP)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Native interface (TCP)</a> <a href=../../interfaces/http/ title="HTTP interface" class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP interface</a> <a href=../../interfaces/formats/ title=" فرمت های Input و Output" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> فرمت های Input و Output</a> <a href=../../interfaces/jdbc/ title=" درایور JDBC" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> درایور JDBC</a> <a href=../../interfaces/odbc/ title=" درایور ODBC" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> درایور ODBC</a> <a href=../../interfaces/cpp/ title="C ++ کتابخانه مشتری" class="nav-link text-light text-wrap d-inline-block w-100 px-0">C ++ کتابخانه مشتری</a> <a href=#sidebar-sidebar-3-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-9 title=Third-party class="nav-link text-light text-wrap dropdown-toggle px-0">Third-party</a> <div id=sidebar-sidebar-3-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/third-party/client_libraries/ title="کتابخانه های مشتری" class="nav-link text-light text-wrap d-inline-block w-100 px-0">کتابخانه های مشتری</a> <a href=../../interfaces/third-party/integrations/ title=یکپارچگی class="nav-link text-light text-wrap d-inline-block w-100 px-0">یکپارچگی</a> <a href=../../interfaces/third-party/gui/ title="رابط های بصری" class="nav-link text-light text-wrap d-inline-block w-100 px-0">رابط های بصری</a> <a href=../../interfaces/third-party/proxy/ title=پروکسی class="nav-link text-light text-wrap d-inline-block w-100 px-0">پروکسی</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title="Data types" class="nav-link text-light text-wrap dropdown-toggle px-0">Data types</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../data_types/int_uint/ title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</a> <a href=../../data_types/float/ title="Float32, Float64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32, Float64</a> <a href=../../data_types/decimal/ title=Decimal class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal</a> <a href=../../data_types/boolean/ title=" مقادیر Boolean" class="nav-link text-light text-wrap d-inline-block w-100 px-0"> مقادیر Boolean</a> <a href=../../data_types/string/ title=String class="nav-link text-light text-wrap d-inline-block w-100 px-0">String</a> <a href=../../data_types/fixedstring/ title=FixedString(N) class="nav-link text-light text-wrap d-inline-block w-100 px-0">FixedString(N)</a> <a href=../../data_types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../data_types/date/ title=Date class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date</a> <a href=../../data_types/datetime/ title=DateTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime</a> <a href=../../data_types/enum/ title=Enum class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum</a> <a href=../../data_types/array/ title=Array(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Array(T)</a> <a href=../../data_types/nested_data_structures/aggregatefunction/ title="AggregateFunction(name, types_of_arguments...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction(name, types_of_arguments...)</a> <a href=../../data_types/tuple/ title="Tuple(T1, T2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, ...)</a> <a href=../../data_types/nullable/ title=Nullable class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable</a> <a href=#sidebar-sidebar-4-16 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-16 title="Nested data structures" class="nav-link text-light text-wrap dropdown-toggle px-0">Nested data structures</a> <div id=sidebar-sidebar-4-16 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/nested_data_structures/nested/ title="Nested(Name1 Type1, Name2 Type2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, ...)</a> </nav> </div> <a href=#sidebar-sidebar-4-17 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-17 title="Special data types" class="nav-link text-light text-wrap dropdown-toggle px-0">Special data types</a> <div id=sidebar-sidebar-4-17 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/special_data_types/expression/ title=Expression class="nav-link text-light text-wrap d-inline-block w-100 px-0">Expression</a> <a href=../../data_types/special_data_types/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../data_types/special_data_types/nothing/ title=Nothing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nothing</a> <a href=../../data_types/special_data_types/interval/ title=Interval class="nav-link text-light text-wrap d-inline-block w-100 px-0">Interval</a> </nav> </div> <a href=#sidebar-sidebar-4-18 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-18 title=Domains class="nav-link text-light text-wrap dropdown-toggle px-0">Domains</a> <div id=sidebar-sidebar-4-18 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../data_types/domains/overview/ title=Overview class="nav-link text-light text-wrap d-inline-block w-100 px-0">Overview</a> <a href=../../data_types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../data_types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title="Database Engines" class="nav-link text-light text-wrap dropdown-toggle px-0">Database Engines</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../database_engines/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../database_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../database_engines/lazy/ title=Lazy class="nav-link text-light text-wrap d-inline-block w-100 px-0">Lazy</a> </nav> </div> <a href=#sidebar-sidebar-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6 title="Table Engines" class="nav-link text-light text-wrap dropdown-toggle px-0">Table Engines</a> <div id=sidebar-sidebar-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=#sidebar-sidebar-6-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-2 title="MergeTree Family" class="nav-link text-light text-wrap dropdown-toggle px-0">MergeTree Family</a> <div id=sidebar-sidebar-6-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/mergetree/ title=MergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../operations/table_engines/replication/ title="Data Replication" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Data Replication</a> <a href=../../operations/table_engines/custom_partitioning_key/ title="Custom Partitioning Key" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Custom Partitioning Key</a> <a href=../../operations/table_engines/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../operations/table_engines/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../operations/table_engines/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../operations/table_engines/collapsingmergetree/ title=CollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">CollapsingMergeTree</a> <a href=../../operations/table_engines/versionedcollapsingmergetree/ title=VersionedCollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">VersionedCollapsingMergeTree</a> <a href=../../operations/table_engines/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> </nav> </div> <a href=#sidebar-sidebar-6-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-3 title="Log Family" class="nav-link text-light text-wrap dropdown-toggle px-0">Log Family</a> <div id=sidebar-sidebar-6-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/log_family/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../operations/table_engines/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../operations/table_engines/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../operations/table_engines/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> </nav> </div> <a href=#sidebar-sidebar-6-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-4 title=Integrations class="nav-link text-light text-wrap dropdown-toggle px-0">Integrations</a> <div id=sidebar-sidebar-6-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../operations/table_engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../operations/table_engines/jdbc/ title=JDBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC</a> <a href=../../operations/table_engines/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> <a href=../../operations/table_engines/hdfs/ title=HDFS class="nav-link text-light text-wrap d-inline-block w-100 px-0">HDFS</a> </nav> </div> <a href=#sidebar-sidebar-6-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-5 title=Special class="nav-link text-light text-wrap dropdown-toggle px-0">Special</a> <div id=sidebar-sidebar-6-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/table_engines/distributed/ title=Distributed class="nav-link text-light text-wrap d-inline-block w-100 px-0">Distributed</a> <a href=../../operations/table_engines/external_data/ title="External data" class="nav-link text-light text-wrap d-inline-block w-100 px-0">External data</a> <a href=../../operations/table_engines/dictionary/ title=Dictionary class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary</a> <a href=../../operations/table_engines/merge/ title=Merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">Merge</a> <a href=../../operations/table_engines/file/ title=File class="nav-link text-light text-wrap d-inline-block w-100 px-0">File</a> <a href=../../operations/table_engines/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../operations/table_engines/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../operations/table_engines/join/ title=Join class="nav-link text-light text-wrap d-inline-block w-100 px-0">Join</a> <a href=../../operations/table_engines/url/ title=URL class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL</a> <a href=../../operations/table_engines/view/ title=View class="nav-link text-light text-wrap d-inline-block w-100 px-0">View</a> <a href=../../operations/table_engines/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../operations/table_engines/memory/ title=Memory class="nav-link text-light text-wrap d-inline-block w-100 px-0">Memory</a> <a href=../../operations/table_engines/buffer/ title=Buffer class="nav-link text-light text-wrap d-inline-block w-100 px-0">Buffer</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7 title="SQL Reference" class="nav-link text-light text-wrap dropdown-toggle px-0">SQL Reference</a> <div id=sidebar-sidebar-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/select/ title=SELECT class="nav-link text-light text-wrap d-inline-block w-100 px-0">SELECT</a> <a href=../../query_language/insert_into/ title="INSERT INTO" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO</a> <a href=../../query_language/create/ title=CREATE class="nav-link text-light text-wrap d-inline-block w-100 px-0">CREATE</a> <a href=../../query_language/alter/ title=ALTER class="nav-link text-white active text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../query_language/system/ title=SYSTEM class="nav-link text-light text-wrap d-inline-block w-100 px-0">SYSTEM</a> <a href=../../query_language/show/ title=SYSTEM class="nav-link text-light text-wrap d-inline-block w-100 px-0">SYSTEM</a> <a href=../../query_language/misc/ title="Other Kinds of Queries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Other Kinds of Queries</a> <a href=#sidebar-sidebar-7-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-9 title=Functions class="nav-link text-light text-wrap dropdown-toggle px-0">Functions</a> <div id=sidebar-sidebar-7-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/functions/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../query_language/functions/arithmetic_functions/ title=Arithmetic class="nav-link text-light text-wrap d-inline-block w-100 px-0">Arithmetic</a> <a href=../../query_language/functions/comparison_functions/ title=Comparison class="nav-link text-light text-wrap d-inline-block w-100 px-0">Comparison</a> <a href=../../query_language/functions/logical_functions/ title=Logical class="nav-link text-light text-wrap d-inline-block w-100 px-0">Logical</a> <a href=../../query_language/functions/type_conversion_functions/ title="Type Conversion" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Type Conversion</a> <a href=../../query_language/functions/date_time_functions/ title="Working with Dates and Times" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with Dates and Times</a> <a href=../../query_language/functions/string_functions/ title="Working with strings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with strings</a> <a href=../../query_language/functions/string_search_functions/ title="For Searching Strings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">For Searching Strings</a> <a href=../../query_language/functions/string_replace_functions/ title="For Replacing in Strings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">For Replacing in Strings</a> <a href=../../query_language/functions/conditional_functions/ title="Conditional " class="nav-link text-light text-wrap d-inline-block w-100 px-0">Conditional </a> <a href=../../query_language/functions/math_functions/ title=Mathematical class="nav-link text-light text-wrap d-inline-block w-100 px-0">Mathematical</a> <a href=../../query_language/functions/rounding_functions/ title=Rounding class="nav-link text-light text-wrap d-inline-block w-100 px-0">Rounding</a> <a href=../../query_language/functions/array_functions/ title="Working with Arrays" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with Arrays</a> <a href=../../query_language/functions/splitting_merging_functions/ title="Splitting and Merging Strings and Arrays" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Splitting and Merging Strings and Arrays</a> <a href=../../query_language/functions/bit_functions/ title=Bit class="nav-link text-light text-wrap d-inline-block w-100 px-0">Bit</a> <a href=../../query_language/functions/bitmap_functions/ title=Bitmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">Bitmap</a> <a href=../../query_language/functions/hash_functions/ title=Hash class="nav-link text-light text-wrap d-inline-block w-100 px-0">Hash</a> <a href=../../query_language/functions/random_functions/ title="Generating Pseudo-Random Numbers" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Generating Pseudo-Random Numbers</a> <a href=../../query_language/functions/encoding_functions/ title=Encoding class="nav-link text-light text-wrap d-inline-block w-100 px-0">Encoding</a> <a href=../../query_language/functions/uuid_functions/ title="Working with UUID" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with UUID</a> <a href=../../query_language/functions/url_functions/ title="Working with URLs" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with URLs</a> <a href=../../query_language/functions/ip_address_functions/ title="Working with IP Addresses" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with IP Addresses</a> <a href=../../query_language/functions/json_functions/ title="Working with JSON." class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with JSON.</a> <a href=../../query_language/functions/higher_order_functions/ title=Higher-Order class="nav-link text-light text-wrap d-inline-block w-100 px-0">Higher-Order</a> <a href=../../query_language/functions/ext_dict_functions/ title="Working with External Dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with External Dictionaries</a> <a href=../../query_language/functions/ym_dict_functions/ title="Working with Yandex.Metrica Dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with Yandex.Metrica Dictionaries</a> <a href=../../query_language/functions/in_functions/ title="Implementing the IN Operator" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Implementing the IN Operator</a> <a href=../../query_language/functions/array_join/ title=arrayJoin class="nav-link text-light text-wrap d-inline-block w-100 px-0">arrayJoin</a> <a href=../../query_language/functions/geo/ title="Working with geographical coordinates" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with geographical coordinates</a> <a href=../../query_language/functions/functions_for_nulls/ title="Working with Nullable arguments" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Working with Nullable arguments</a> <a href=../../query_language/functions/machine_learning_functions/ title="Machine Learning Functions" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Machine Learning Functions</a> <a href=../../query_language/functions/other_functions/ title=Other class="nav-link text-light text-wrap d-inline-block w-100 px-0">Other</a> </nav> </div> <a href=#sidebar-sidebar-7-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-10 title="Aggregate Functions" class="nav-link text-light text-wrap dropdown-toggle px-0">Aggregate Functions</a> <div id=sidebar-sidebar-7-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/agg_functions/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../query_language/agg_functions/reference/ title=Reference class="nav-link text-light text-wrap d-inline-block w-100 px-0">Reference</a> <a href=../../query_language/agg_functions/combinators/ title="Aggregate function combinators" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Aggregate function combinators</a> <a href=../../query_language/agg_functions/parametric_functions/ title="Parametric aggregate functions" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Parametric aggregate functions</a> </nav> </div> <a href=#sidebar-sidebar-7-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-11 title="Table Functions" class="nav-link text-light text-wrap dropdown-toggle px-0">Table Functions</a> <div id=sidebar-sidebar-7-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/table_functions/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../query_language/table_functions/file/ title=file class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a> <a href=../../query_language/table_functions/merge/ title=merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a> <a href=../../query_language/table_functions/numbers/ title=numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a> <a href=../../query_language/table_functions/remote/ title=remote class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote</a> <a href=../../query_language/table_functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../query_language/table_functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../query_language/table_functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../query_language/table_functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> <a href=../../query_language/table_functions/hdfs/ title=hdfs class="nav-link text-light text-wrap d-inline-block w-100 px-0">hdfs</a> <a href=../../query_language/table_functions/input/ title=input class="nav-link text-light text-wrap d-inline-block w-100 px-0">input</a> </nav> </div> <a href=#sidebar-sidebar-7-12 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-12 title=Dictionaries class="nav-link text-light text-wrap dropdown-toggle px-0">Dictionaries</a> <div id=sidebar-sidebar-7-12 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/dicts/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=#sidebar-sidebar-7-12-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-12-2 title="External Dictionaries" class="nav-link text-light text-wrap dropdown-toggle px-0">External Dictionaries</a> <div id=sidebar-sidebar-7-12-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../query_language/dicts/external_dicts/ title="General Description" class="nav-link text-light text-wrap d-inline-block w-100 px-0">General Description</a> <a href=../../query_language/dicts/external_dicts_dict/ title="Configuring an External Dictionary" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Configuring an External Dictionary</a> <a href=../../query_language/dicts/external_dicts_dict_layout/ title="Storing Dictionaries in Memory" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Storing Dictionaries in Memory</a> <a href=../../query_language/dicts/external_dicts_dict_lifetime/ title="Dictionary Updates" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary Updates</a> <a href=../../query_language/dicts/external_dicts_dict_sources/ title="Sources of External Dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Sources of External Dictionaries</a> <a href=../../query_language/dicts/external_dicts_dict_structure/ title="Dictionary Key and Fields" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary Key and Fields</a> </nav> </div> <a href=../../query_language/dicts/internal_dicts/ title="Internal Dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Internal Dictionaries</a> <a href=../../query_language/operators/ title=Operators class="nav-link text-light text-wrap d-inline-block w-100 px-0">Operators</a> <a href=../../query_language/syntax/ title="General Syntax" class="nav-link text-light text-wrap d-inline-block w-100 px-0">General Syntax</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=Operations class="nav-link text-light text-wrap dropdown-toggle px-0">Operations</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../operations/requirements/ title=Requirements class="nav-link text-light text-wrap d-inline-block w-100 px-0">Requirements</a> <a href=../../operations/monitoring/ title=Monitoring class="nav-link text-light text-wrap d-inline-block w-100 px-0">Monitoring</a> <a href=../../operations/troubleshooting/ title=Troubleshooting class="nav-link text-light text-wrap d-inline-block w-100 px-0">Troubleshooting</a> <a href=../../operations/tips/ title="Usage Recommendations" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Usage Recommendations</a> <a href=../../operations/update/ title="ClickHouse Update" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse Update</a> <a href=../../operations/access_rights/ title="Access Rights" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Access Rights</a> <a href=../../operations/backup/ title="Data Backup" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Data Backup</a> <a href=../../operations/configuration_files/ title="Configuration Files" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Configuration Files</a> <a href=../../operations/quotas/ title=Quotas class="nav-link text-light text-wrap d-inline-block w-100 px-0">Quotas</a> <a href=../../operations/system_tables/ title="System Tables" class="nav-link text-light text-wrap d-inline-block w-100 px-0">System Tables</a> <a href=#sidebar-sidebar-8-12 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-12 title="Server Configuration Parameters" class="nav-link text-light text-wrap dropdown-toggle px-0">Server Configuration Parameters</a> <div id=sidebar-sidebar-8-12 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/server_settings/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../operations/server_settings/settings/ title="Server Settings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Server Settings</a> </nav> </div> <a href=#sidebar-sidebar-8-13 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-13 title=Settings class="nav-link text-light text-wrap dropdown-toggle px-0">Settings</a> <div id=sidebar-sidebar-8-13 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/settings/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../operations/settings/permissions_for_queries/ title="Permissions for Queries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Permissions for Queries</a> <a href=../../operations/settings/query_complexity/ title="Restrictions on Query Complexity" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Restrictions on Query Complexity</a> <a href=../../operations/settings/settings/ title=Settings class="nav-link text-light text-wrap d-inline-block w-100 px-0">Settings</a> <a href=../../operations/settings/settings_profiles/ title="Settings Profiles" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Settings Profiles</a> <a href=../../operations/settings/settings_users/ title="User Settings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">User Settings</a> <a href=../../operations/settings/constraints_on_settings/ title="Constraints on Settings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Constraints on Settings</a> </nav> </div> <a href=#sidebar-sidebar-8-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8-14 title=Utilities class="nav-link text-light text-wrap dropdown-toggle px-0">Utilities</a> <div id=sidebar-sidebar-8-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/utils/ title=Overview class="nav-link text-light text-wrap d-inline-block w-100 px-0">Overview</a> <a href=../../operations/utils/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../operations/utils/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title=F.A.Q. class="nav-link text-light text-wrap dropdown-toggle px-0">F.A.Q.</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../faq/general/ title="General Questions" class="nav-link text-light text-wrap d-inline-block w-100 px-0">General Questions</a> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title=Development class="nav-link text-light text-wrap dropdown-toggle px-0">Development</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../development/architecture/ title="Overview of ClickHouse Architecture" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Overview of ClickHouse Architecture</a> <a href=../../development/build/ title="How to Build ClickHouse on Linux" class="nav-link text-light text-wrap d-inline-block w-100 px-0">How to Build ClickHouse on Linux</a> <a href=../../development/build_osx/ title="How to Build ClickHouse on Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">How to Build ClickHouse on Mac OS X</a> <a href=../../development/style/ title="How to Write C++ code" class="nav-link text-light text-wrap d-inline-block w-100 px-0">How to Write C++ code</a> <a href=../../development/tests/ title="How to Run ClickHouse Tests" class="nav-link text-light text-wrap d-inline-block w-100 px-0">How to Run ClickHouse Tests</a> <a href=../../development/contrib/ title="Third-Party Libraries Used" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Third-Party Libraries Used</a> </nav> </div> <a href=#sidebar-sidebar-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-11 title="What's New" class="nav-link text-light text-wrap dropdown-toggle px-0">What's New</a> <div id=sidebar-sidebar-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../roadmap/ title=Roadmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">Roadmap</a> <a href=../../changelog/ title=Changelog class="nav-link text-light text-wrap d-inline-block w-100 px-0">Changelog</a> <a href=../../security_changelog/ title="Security Changelog" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Security Changelog</a> </nav> </div> <a href=../../single/clickhouse_fa.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt="نسخه PDF" title="نسخه PDF" height=24 class="d-block mr-1 float-left"><div>نسخه PDF</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-5"> <div id=content> <h2 id=query_language_queries_alter>ALTER<a class=headerlink href=#query_language_queries_alter title="Permanent link">&para;</a></h2> <p>The <code>ALTER</code> query is only supported for <code>*MergeTree</code> tables, as well as <code>Merge</code>and<code>Distributed</code>. The query has several variations.</p> <h3 id=column-manipulations>Column Manipulations<a class=headerlink href=#column-manipulations title="Permanent link">&para;</a></h3> <p>Changing the table structure.</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=p>[</span><span class=n>db</span><span class=p>].</span><span class=n>name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span> <span class=k>ADD</span><span class=o>|</span><span class=k>DROP</span><span class=o>|</span><span class=n>CLEAR</span><span class=o>|</span><span class=k>COMMENT</span><span class=o>|</span><span class=k>MODIFY</span> <span class=k>COLUMN</span> <span class=p>...</span>
</code></pre></div> <p>In the query, specify a list of one or more comma-separated actions.<br> Each action is an operation on a column.</p> <p>The following actions are supported:</p> <ul> <li><a href=#alter_add-column>ADD COLUMN</a> — Adds a new column to the table.</li> <li><a href=#alter_drop-column>DROP COLUMN</a> — Deletes the column.</li> <li><a href=#alter_clear-column>CLEAR COLUMN</a> — Resets column values.</li> <li><a href=#alter_comment-column>COMMENT COLUMN</a> — Adds a text comment to the column.</li> <li><a href=#alter_modify-column>MODIFY COLUMN</a> — Changes column's type and/or default expression.</li> </ul> <p>These actions are described in detail below.</p> <h4 id=alter_add-column>ADD COLUMN<a class=headerlink href=#alter_add-column title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ADD</span> <span class=k>COLUMN</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=n>name</span> <span class=p>[</span><span class=k>type</span><span class=p>]</span> <span class=p>[</span><span class=n>default_expr</span><span class=p>]</span> <span class=p>[</span><span class=k>AFTER</span> <span class=n>name_after</span><span class=p>]</span>
</code></pre></div> <p>Adds a new column to the table with the specified <code>name</code>, <code>type</code>, and <code>default_expr</code> (see the section <a href=../create/#create-default-values>Default expressions</a>).</p> <p>If the <code>IF NOT EXISTS</code> clause is included, the query won't return an error if the column already exists. If you specify <code>AFTER name_after</code> (the name of another column), the column is added after the specified one in the list of table columns. Otherwise, the column is added to the end of the table. Note that there is no way to add a column to the beginning of a table. For a chain of actions, <code>name_after</code> can be the name of a column that is added in one of the previous actions.</p> <p>Adding a column just changes the table structure, without performing any actions with data. The data doesn't appear on the disk after <code>ALTER</code>. If the data is missing for a column when reading from the table, it is filled in with default values (by performing the default expression if there is one, or using zeros or empty strings). The column appears on the disk after merging data parts (see <a href=../../operations/table_engines/mergetree/ >MergeTree</a>).</p> <p>This approach allows us to complete the <code>ALTER</code> query instantly, without increasing the volume of old data.</p> <p>Example:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=k>ADD</span> <span class=k>COLUMN</span> <span class=n>browser</span> <span class=n>String</span> <span class=k>AFTER</span> <span class=n>user_id</span>
</code></pre></div> <h4 id=alter_drop-column>DROP COLUMN<a class=headerlink href=#alter_drop-column title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>DROP</span> <span class=k>COLUMN</span> <span class=p>[</span><span class=k>IF</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=n>name</span>
</code></pre></div> <p>Deletes the column with the name <code>name</code>. If the <code>IF EXISTS</code> clause is specified, the query won't return an error if the column doesn't exist.</p> <p>Deletes data from the file system. Since this deletes entire files, the query is completed almost instantly.</p> <p>Example:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=k>DROP</span> <span class=k>COLUMN</span> <span class=n>browser</span>
</code></pre></div> <h4 id=alter_clear-column>CLEAR COLUMN<a class=headerlink href=#alter_clear-column title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=n>CLEAR</span> <span class=k>COLUMN</span> <span class=p>[</span><span class=k>IF</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=n>name</span> <span class=k>IN</span> <span class=n>PARTITION</span> <span class=n>partition_name</span>
</code></pre></div> <p>Resets all data in a column for a specified partition. Read more about setting the partition name in the section <a href=#alter-how-to-specify-part-expr>How to specify the partition expression</a>.</p> <p>If the <code>IF EXISTS</code> clause is specified, the query won't return an error if the column doesn't exist.</p> <p>Example:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=n>CLEAR</span> <span class=k>COLUMN</span> <span class=n>browser</span> <span class=k>IN</span> <span class=n>PARTITION</span> <span class=n>tuple</span><span class=p>()</span>
</code></pre></div> <h4 id=alter_comment-column>COMMENT COLUMN<a class=headerlink href=#alter_comment-column title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>COMMENT</span> <span class=k>COLUMN</span> <span class=p>[</span><span class=k>IF</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=n>name</span> <span class=s1>&#39;comment&#39;</span>
</code></pre></div> <p>Adds a comment to the column. If the <code>IF EXISTS</code> clause is specified, the query won't return an error if the column doesn't exist.</p> <p>Each column can have one comment. If a comment already exists for the column, a new comment overwrites the previous comment.</p> <p>Comments are stored in the <code>comment_expression</code> column returned by the <a href=../misc/#misc-describe-table>DESCRIBE TABLE</a> query.</p> <p>Example:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=k>COMMENT</span> <span class=k>COLUMN</span> <span class=n>browser</span> <span class=s1>&#39;The table shows the browser used for accessing the site.&#39;</span>
</code></pre></div> <h4 id=alter_modify-column>MODIFY COLUMN<a class=headerlink href=#alter_modify-column title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>MODIFY</span> <span class=k>COLUMN</span> <span class=p>[</span><span class=k>IF</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=n>name</span> <span class=p>[</span><span class=k>type</span><span class=p>]</span> <span class=p>[</span><span class=n>default_expr</span><span class=p>]</span>
</code></pre></div> <p>This query changes the <code>name</code> column's type to <code>type</code> and/or the default expression to <code>default_expr</code>. If the <code>IF EXISTS</code> clause is specified, the query won't return an error if the column doesn't exist.</p> <p>When changing the type, values are converted as if the <a href=../functions/type_conversion_functions/ >toType</a> functions were applied to them. If only the default expression is changed, the query doesn't do anything complex, and is completed almost instantly.</p> <p>Example:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=k>MODIFY</span> <span class=k>COLUMN</span> <span class=n>browser</span> <span class=nb>Array</span><span class=p>(</span><span class=n>String</span><span class=p>)</span>
</code></pre></div> <p>Changing the column type is the only complex action – it changes the contents of files with data. For large tables, this may take a long time.</p> <p>There are several processing stages:</p> <ul> <li>Preparing temporary (new) files with modified data.</li> <li>Renaming old files.</li> <li>Renaming the temporary (new) files to the old names.</li> <li>Deleting the old files.</li> </ul> <p>Only the first stage takes time. If there is a failure at this stage, the data is not changed.<br> If there is a failure during one of the successive stages, data can be restored manually. The exception is if the old files were deleted from the file system but the data for the new files did not get written to the disk and was lost.</p> <p>The <code>ALTER</code> query for changing columns is replicated. The instructions are saved in ZooKeeper, then each replica applies them. All <code>ALTER</code> queries are run in the same order. The query waits for the appropriate actions to be completed on the other replicas. However, a query to change columns in a replicated table can be interrupted, and all actions will be performed asynchronously.</p> <h4 id=alter-query-limitations>ALTER Query Limitations<a class=headerlink href=#alter-query-limitations title="Permanent link">&para;</a></h4> <p>The <code>ALTER</code> query lets you create and delete separate elements (columns) in nested data structures, but not whole nested data structures. To add a nested data structure, you can add columns with a name like <code>name.nested_name</code> and the type <code>Array(T)</code>. A nested data structure is equivalent to multiple array columns with a name that has the same prefix before the dot.</p> <p>There is no support for deleting columns in the primary key or the sampling key (columns that are used in the <code>ENGINE</code> expression). Changing the type for columns that are included in the primary key is only possible if this change does not cause the data to be modified (for example, you are allowed to add values to an Enum or to change a type from <code>DateTime</code> to <code>UInt32</code>).</p> <p>If the <code>ALTER</code> query is not sufficient to make the table changes you need, you can create a new table, copy the data to it using the <a href=../insert_into/#insert_query_insert-select>INSERT SELECT</a> query, then switch the tables using the <a href=../misc/#misc_operations-rename>RENAME</a> query and delete the old table. You can use the <a href=../../operations/utils/clickhouse-copier/ >clickhouse-copier</a> as an alternative to the <code>INSERT SELECT</code> query.</p> <p>The <code>ALTER</code> query blocks all reads and writes for the table. In other words, if a long <code>SELECT</code> is running at the time of the <code>ALTER</code> query, the <code>ALTER</code> query will wait for it to complete. At the same time, all new queries to the same table will wait while this <code>ALTER</code> is running.</p> <p>For tables that don't store data themselves (such as <code>Merge</code> and <code>Distributed</code>), <code>ALTER</code> just changes the table structure, and does not change the structure of subordinate tables. For example, when running ALTER for a <code>Distributed</code> table, you will also need to run <code>ALTER</code> for the tables on all remote servers.</p> <h3 id=manipulations-with-key-expressions>Manipulations With Key Expressions<a class=headerlink href=#manipulations-with-key-expressions title="Permanent link">&para;</a></h3> <p>The following command is supported:</p> <div class=codehilite><pre><span></span><code><span class=k>MODIFY</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=n>new_expression</span>
</code></pre></div> <p>It only works for tables in the <a href=../../operations/table_engines/mergetree/ ><code>MergeTree</code></a> family (including<br> <a href=../../operations/table_engines/replication/ >replicated</a> tables). The command changes the<br> <a href=../../operations/table_engines/mergetree/ >sorting key</a> of the table<br> to <code>new_expression</code> (an expression or a tuple of expressions). Primary key remains the same.</p> <p>The command is lightweight in a sense that it only changes metadata. To keep the property that data part<br> rows are ordered by the sorting key expression you cannot add expressions containing existing columns<br> to the sorting key (only columns added by the <code>ADD COLUMN</code> command in the same <code>ALTER</code> query).</p> <h3 id=manipulations-with-data-skipping-indices>Manipulations With Data Skipping Indices<a class=headerlink href=#manipulations-with-data-skipping-indices title="Permanent link">&para;</a></h3> <p>It only works for tables in the <a href=../../operations/table_engines/mergetree/ ><code>*MergeTree</code></a> family (including<br> <a href=../../operations/table_engines/replication/ >replicated</a> tables). The following operations<br> are available:</p> <ul> <li> <p><code>ALTER TABLE [db].name ADD INDEX name expression TYPE type GRANULARITY value AFTER name [AFTER name2]</code> - Adds index description to tables metadata.</p> </li> <li> <p><code>ALTER TABLE [db].name DROP INDEX name</code> - Removes index description from tables metadata and deletes index files from disk.</p> </li> </ul> <p>These commands are lightweight in a sense that they only change metadata or remove files.<br> Also, they are replicated (syncing indices metadata through ZooKeeper).</p> <h3 id=manipulations-with-constraints>Manipulations with constraints<a class=headerlink href=#manipulations-with-constraints title="Permanent link">&para;</a></h3> <p>See more on <a href=../create/#constraints>constraints</a></p> <p>Constraints could be added or deleted using following syntax:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=p>[</span><span class=n>db</span><span class=p>].</span><span class=n>name</span> <span class=k>ADD</span> <span class=k>CONSTRAINT</span> <span class=k>constraint_name</span> <span class=k>CHECK</span> <span class=n>expression</span><span class=p>;</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=p>[</span><span class=n>db</span><span class=p>].</span><span class=n>name</span> <span class=k>DROP</span> <span class=k>CONSTRAINT</span> <span class=k>constraint_name</span><span class=p>;</span>
</code></pre></div> <p>Queries will add or remove metadata about constraints from table so they are processed immediately.</p> <p>Constraint check <em>will not be executed</em> on existing data if it was added.</p> <p>All changes on replicated tables are broadcasting to ZooKeeper so will be applied on other replicas.</p> <h3 id=alter_manipulations-with-partitions>Manipulations With Partitions and Parts<a class=headerlink href=#alter_manipulations-with-partitions title="Permanent link">&para;</a></h3> <p>The following operations with <a href=../../operations/table_engines/custom_partitioning_key/ >partitions</a> are available:</p> <ul> <li><a href=#alter_detach-partition>DETACH PARTITION</a> – Moves a partition to the <code>detached</code> directory and forget it.</li> <li><a href=#alter_drop-partition>DROP PARTITION</a> – Deletes a partition.</li> <li><a href=#alter_attach-partition>ATTACH PART|PARTITION</a> – Adds a part or partition from the <code>detached</code> directory to the table.</li> <li><a href=#alter_replace-partition>REPLACE PARTITION</a> - Copies the data partition from one table to another.</li> <li><a href=#alter_clear-column-partition>CLEAR COLUMN IN PARTITION</a> - Resets the value of a specified column in a partition.</li> <li><a href=#alter_clear-index-partition>CLEAR INDEX IN PARTITION</a> - Resets the specified secondary index in a partition.</li> <li><a href=#alter_freeze-partition>FREEZE PARTITION</a> – Creates a backup of a partition.</li> <li><a href=#alter_fetch-partition>FETCH PARTITION</a> – Downloads a partition from another server.</li> <li><a href=#alter_move-partition>MOVE PARTITION|PART</a> – Move partition/data part to another disk or volume. </li> </ul> <h4 id=alter_detach-partition>DETACH PARTITION<a class=headerlink href=#alter_detach-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=n>DETACH</span> <span class=n>PARTITION</span> <span class=n>partition_expr</span>
</code></pre></div> <p>Moves all data for the specified partition to the <code>detached</code> directory. The server forgets about the detached data partition as if it does not exist. The server will not know about this data until you make the <a href=#alter_attach-partition>ATTACH</a> query.</p> <p>Example:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=n>DETACH</span> <span class=n>PARTITION</span> <span class=mi>201901</span>
</code></pre></div> <p>Read about setting the partition expression in a section <a href=#alter-how-to-specify-part-expr>How to specify the partition expression</a>.</p> <p>After the query is executed, you can do whatever you want with the data in the <code>detached</code> directory — delete it from the file system, or just leave it.</p> <p>This query is replicated – it moves the data to the <code>detached</code> directory on all replicas. Note that you can execute this query only on a leader replica. To find out if a replica is a leader, perform the <code>SELECT</code> query to the <a href=../../operations/system_tables/#system_tables-replicas>system.replicas</a> table. Alternatively, it is easier to make a <code>DETACH</code> query on all replicas - all the replicas throw an exception, except the leader replica.</p> <h4 id=alter_drop-partition>DROP PARTITION<a class=headerlink href=#alter_drop-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=k>DROP</span> <span class=n>PARTITION</span> <span class=n>partition_expr</span>
</code></pre></div> <p>Deletes the specified partition from the table. This query tags the partition as inactive and deletes data completely, approximately in 10 minutes.</p> <p>Read about setting the partition expression in a section <a href=#alter-how-to-specify-part-expr>How to specify the partition expression</a>.</p> <p>The query is replicated – it deletes data on all replicas.</p> <h4 id=alter_drop-detached>DROP DETACHED PARTITION|PART<a class=headerlink href=#alter_drop-detached title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=k>DROP</span> <span class=n>DETACHED</span> <span class=n>PARTITION</span><span class=o>|</span><span class=n>PART</span> <span class=n>partition_expr</span>
</code></pre></div> <p>Removes the specified part or all parts of the specified partition from <code>detached</code>.<br> Read more about setting the partition expression in a section <a href=#alter-how-to-specify-part-expr>How to specify the partition expression</a>.</p> <h4 id=alter_attach-partition>ATTACH PARTITION|PART<a class=headerlink href=#alter_attach-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=n>ATTACH</span> <span class=n>PARTITION</span><span class=o>|</span><span class=n>PART</span> <span class=n>partition_expr</span>
</code></pre></div> <p>Adds data to the table from the <code>detached</code> directory. It is possible to add data for an entire partition or for a separate part. Examples:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=n>ATTACH</span> <span class=n>PARTITION</span> <span class=mi>201901</span><span class=p>;</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=n>ATTACH</span> <span class=n>PART</span> <span class=mi>201901</span><span class=n>_2_2_0</span><span class=p>;</span>
</code></pre></div> <p>Read more about setting the partition expression in a section <a href=#alter-how-to-specify-part-expr>How to specify the partition expression</a>.</p> <p>This query is replicated. Each replica checks whether there is data in the <code>detached</code> directory. If the data is in this directory, the query checks the integrity, verifies that it matches the data on the server that initiated the query. If everything is correct, the query adds data to the replica. If not, it downloads data from the query requestor replica, or from another replica where the data has already been added.</p> <p>So you can put data to the <code>detached</code> directory on one replica, and use the <code>ALTER ... ATTACH</code> query to add it to the table on all replicas.</p> <h4 id=alter_replace-partition>REPLACE PARTITION<a class=headerlink href=#alter_replace-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>table2</span> <span class=k>REPLACE</span> <span class=n>PARTITION</span> <span class=n>partition_expr</span> <span class=k>FROM</span> <span class=n>table1</span>
</code></pre></div> <p>This query copies the data partition from the <code>table1</code> to <code>table2</code>. Note that data won't be deleted from <code>table1</code>.</p> <p>For the query to run successfully, the following conditions must be met:</p> <ul> <li>Both tables must have the same structure.</li> <li>Both tables must have the same partition key.</li> </ul> <h4 id=alter_clear-column-partition>CLEAR COLUMN IN PARTITION<a class=headerlink href=#alter_clear-column-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=n>CLEAR</span> <span class=k>COLUMN</span> <span class=k>column_name</span> <span class=k>IN</span> <span class=n>PARTITION</span> <span class=n>partition_expr</span>
</code></pre></div> <p>Resets all values in the specified column in a partition. If the <code>DEFAULT</code> clause was determined when creating a table, this query sets the column value to a specified default value.</p> <p>Example:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>visits</span> <span class=n>CLEAR</span> <span class=k>COLUMN</span> <span class=n>hour</span> <span class=k>in</span> <span class=n>PARTITION</span> <span class=mi>201902</span>
</code></pre></div> <h4 id=alter_freeze-partition>FREEZE PARTITION<a class=headerlink href=#alter_freeze-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=k>FREEZE</span> <span class=p>[</span><span class=n>PARTITION</span> <span class=n>partition_expr</span><span class=p>]</span>
</code></pre></div> <p>This query creates a local backup of a specified partition. If the <code>PARTITION</code> clause is omitted, the query creates the backup of all partitions at once.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The entire backup process is performed without stopping the server.</p> </div> <p>Note that for old-styled tables you can specify the prefix of the partition name (for example, '2019') - then the query creates the backup for all the corresponding partitions. Read about setting the partition expression in a section <a href=#alter-how-to-specify-part-expr>How to specify the partition expression</a>.</p> <p>At the time of execution, for a data snapshot, the query creates hardlinks to a table data. Hardlinks are placed in the directory <code>/var/lib/clickhouse/shadow/N/...</code>, where:</p> <ul> <li><code>/var/lib/clickhouse/</code> is the working ClickHouse directory specified in the config.</li> <li><code>N</code> is the incremental number of the backup.</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>If you use <a href=../../operations/table_engines/mergetree/#table_engine-mergetree-multiple-volumes>a set of disks for data storage in a table</a>, the <code>shadow/N</code> directory appears on every disk, storing data parts that matched by the <code>PARTITION</code> expression.</p> </div> <p>The same structure of directories is created inside the backup as inside <code>/var/lib/clickhouse/</code>. The query performs 'chmod' for all files, forbidding writing into them.</p> <p>After creating the backup, you can copy the data from <code>/var/lib/clickhouse/shadow/</code> to the remote server and then delete it from the local server. Note that the <code>ALTER t FREEZE PARTITION</code> query is not replicated. It creates a local backup only on the local server.</p> <p>The query creates backup almost instantly (but first it waits for the current queries to the corresponding table to finish running).</p> <p><code>ALTER TABLE t FREEZE PARTITION</code> copies only the data, not table metadata. To make a backup of table metadata, copy the file <code>/var/lib/clickhouse/metadata/database/table.sql</code></p> <p>To restore data from a backup, do the following:</p> <ol> <li>Create the table if it does not exist. To view the query, use the .sql file (replace <code>ATTACH</code> in it with <code>CREATE</code>).</li> <li>Copy the data from the <code>data/database/table/</code> directory inside the backup to the <code>/var/lib/clickhouse/data/database/table/detached/</code> directory.</li> <li>Run <code>ALTER TABLE t ATTACH PARTITION</code> queries to add the data to a table.</li> </ol> <p>Restoring from a backup doesn't require stopping the server.</p> <p>For more information about backups and restoring data, see the <a href=../../operations/backup/ >Data Backup</a> section.</p> <h4 id=alter_clear-index-partition>CLEAR INDEX IN PARTITION<a class=headerlink href=#alter_clear-index-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=n>CLEAR</span> <span class=k>INDEX</span> <span class=n>index_name</span> <span class=k>IN</span> <span class=n>PARTITION</span> <span class=n>partition_expr</span>
</code></pre></div> <p>The query works similar to <code>CLEAR COLUMN</code>, but it resets an index instead of a column data.</p> <h4 id=alter_fetch-partition>FETCH PARTITION<a class=headerlink href=#alter_fetch-partition title="Permanent link">&para;</a></h4> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=k>FETCH</span> <span class=n>PARTITION</span> <span class=n>partition_expr</span> <span class=k>FROM</span> <span class=s1>&#39;path-in-zookeeper&#39;</span>
</code></pre></div> <p>Downloads a partition from another server. This query only works for the replicated tables.</p> <p>The query does the following:</p> <ol> <li>Downloads the partition from the specified shard. In 'path-in-zookeeper' you must specify a path to the shard in ZooKeeper.</li> <li>Then the query puts the downloaded data to the <code>detached</code> directory of the <code>table_name</code> table. Use the <a href=#alter_attach-partition>ATTACH PARTITION|PART</a> query to add the data to the table.</li> </ol> <p>For example:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>users</span> <span class=k>FETCH</span> <span class=n>PARTITION</span> <span class=mi>201902</span> <span class=k>FROM</span> <span class=s1>&#39;/clickhouse/tables/01-01/visits&#39;</span><span class=p>;</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>users</span> <span class=n>ATTACH</span> <span class=n>PARTITION</span> <span class=mi>201902</span><span class=p>;</span>
</code></pre></div> <p>Note that:</p> <ul> <li>The <code>ALTER ... FETCH PARTITION</code> query isn't replicated. It places the partition to the <code>detached</code> directory only on the local server.</li> <li>The <code>ALTER TABLE ... ATTACH</code> query is replicated. It adds the data to all replicas. The data is added to one of the replicas from the <code>detached</code> directory, and to the others - from neighboring replicas.</li> </ul> <p>Before downloading, the system checks if the partition exists and the table structure matches. The most appropriate replica is selected automatically from the healthy replicas.</p> <p>Although the query is called <code>ALTER TABLE</code>, it does not change the table structure and does not immediately change the data available in the table.</p> <h4 id=alter_move-partition>MOVE PARTITION|PART<a class=headerlink href=#alter_move-partition title="Permanent link">&para;</a></h4> <p>Moves partitions or data parts to another volume or disk for <code>MergeTree</code>-engine tables. See <a href=../../operations/table_engines/mergetree/#table_engine-mergetree-multiple-volumes>Using Multiple Block Devices for Data Storage</a>.</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=k>MOVE</span> <span class=n>PARTITION</span><span class=o>|</span><span class=n>PART</span> <span class=n>partition_expr</span> <span class=k>TO</span> <span class=n>DISK</span><span class=o>|</span><span class=n>VOLUME</span> <span class=s1>&#39;disk_name&#39;</span>
</code></pre></div> <p>The <code>ALTER TABLE t MOVE</code> query:</p> <ul> <li>Not replicated, because different replicas can have different storage policies.</li> <li>Returns an error if the specified disk or volume is not configured. Query also returns an error if conditions of data moving, that specified in the storage policy, can't be applied.</li> <li>Can return an error in the case, when data to be moved is already moved by a background process, concurrent <code>ALTER TABLE t MOVE</code> query or as a result of background data merging. A user shouldn't perform any additional actions in this case.</li> </ul> <p>Example:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>hits</span> <span class=k>MOVE</span> <span class=n>PART</span> <span class=s1>&#39;20190301_14343_16206_438&#39;</span> <span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>&#39;slow&#39;</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>hits</span> <span class=k>MOVE</span> <span class=n>PARTITION</span> <span class=s1>&#39;2019-09-01&#39;</span> <span class=k>TO</span> <span class=n>DISK</span> <span class=s1>&#39;fast_ssd&#39;</span>
</code></pre></div> <h4 id=alter-how-to-specify-part-expr>How To Set Partition Expression<a class=headerlink href=#alter-how-to-specify-part-expr title="Permanent link">&para;</a></h4> <p>You can specify the partition expression in <code>ALTER ... PARTITION</code> queries in different ways:</p> <ul> <li>As a value from the <code>partition</code> column of the <code>system.parts</code> table. For example, <code>ALTER TABLE visits DETACH PARTITION 201901</code>.</li> <li>As the expression from the table column. Constants and constant expressions are supported. For example, <code>ALTER TABLE visits DETACH PARTITION toYYYYMM(toDate('2019-01-25'))</code>.</li> <li>Using the partition ID. Partition ID is a string identifier of the partition (human-readable, if possible) that is used as the names of partitions in the file system and in ZooKeeper. The partition ID must be specified in the <code>PARTITION ID</code> clause, in a single quotes. For example, <code>ALTER TABLE visits DETACH PARTITION ID '201901'</code>.</li> <li>In the <a href=#alter_attach-partition>ALTER ATTACH PART</a> and <a href=#alter_drop-detached>DROP DETACHED PART</a> query, to specify the name of a part, use string literal with a value from the <code>name</code> column of the <a href=../../operations/system_tables/#system_tables-detached_parts>system.detached_parts</a> table. For example, <code>ALTER TABLE visits ATTACH PART '201901_1_1_0'</code>.</li> </ul> <p>Usage of quotes when specifying the partition depends on the type of partition expression. For example, for the <code>String</code> type, you have to specify its name in quotes (<code>'</code>). For the <code>Date</code> and <code>Int*</code> types no quotes are needed.</p> <p>For old-style tables, you can specify the partition either as a number <code>201901</code> or a string <code>'201901'</code>. The syntax for the new-style tables is stricter with types (similar to the parser for the VALUES input format).</p> <p>All the rules above are also true for the <a href=../misc/#misc_operations-optimize>OPTIMIZE</a> query. If you need to specify the only partition when optimizing a non-partitioned table, set the expression <code>PARTITION tuple()</code>. For example:</p> <div class=codehilite><pre><span></span><code><span class=n>OPTIMIZE</span> <span class=k>TABLE</span> <span class=n>table_not_partitioned</span> <span class=n>PARTITION</span> <span class=n>tuple</span><span class=p>()</span> <span class=k>FINAL</span><span class=p>;</span>
</code></pre></div> <p>The examples of <code>ALTER ... PARTITION</code> queries are demonstrated in the tests <a href=https://github.com/ClickHouse/ClickHouse/blob/master/dbms/tests/queries/0_stateless/00502_custom_partitioning_local.sql rel="external nofollow noreferrer"><code>00502_custom_partitioning_local</code></a> and <a href=https://github.com/ClickHouse/ClickHouse/blob/master/dbms/tests/queries/0_stateless/00502_custom_partitioning_replicated_zookeeper.sql rel="external nofollow noreferrer"><code>00502_custom_partitioning_replicated_zookeeper</code></a>.</p> <h3 id=synchronicity-of-alter-queries>Synchronicity of ALTER Queries<a class=headerlink href=#synchronicity-of-alter-queries title="Permanent link">&para;</a></h3> <p>For non-replicatable tables, all <code>ALTER</code> queries are performed synchronously. For replicatable tables, the query just adds instructions for the appropriate actions to <code>ZooKeeper</code>, and the actions themselves are performed as soon as possible. However, the query can wait for these actions to be completed on all the replicas.</p> <p>For <code>ALTER ... ATTACH|DETACH|DROP</code> queries, you can use the <code>replication_alter_partitions_sync</code> setting to set up waiting.<br> Possible values: <code>0</code> – do not wait; <code>1</code> – only wait for own execution (default); <code>2</code> – wait for all.</p> <h3 id=alter-mutations>Mutations<a class=headerlink href=#alter-mutations title="Permanent link">&para;</a></h3> <p>Mutations are an ALTER query variant that allows changing or deleting rows in a table. In contrast to standard <code>UPDATE</code> and <code>DELETE</code> queries that are intended for point data changes, mutations are intended for heavy operations that change a lot of rows in a table. Supported for the <code>MergeTree</code> family of table engines including the engines with replication support.</p> <p>Existing tables are ready for mutations as-is (no conversion necessary), but after the first mutation is applied to a table, its metadata format becomes incompatible with previous server versions and falling back to a previous version becomes impossible.</p> <p>Currently available commands:</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table</span> <span class=k>DELETE</span> <span class=k>WHERE</span> <span class=n>filter_expr</span>
</code></pre></div> <p>The <code>filter_expr</code> must be of type <code>UInt8</code>. The query deletes rows in the table for which this expression takes a non-zero value.</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table</span> <span class=k>UPDATE</span> <span class=n>column1</span> <span class=o>=</span> <span class=n>expr1</span> <span class=p>[,</span> <span class=p>...]</span> <span class=k>WHERE</span> <span class=n>filter_expr</span>
</code></pre></div> <p>The <code>filter_expr</code> must be of type <code>UInt8</code>. This query updates values of specified columns to the values of corresponding expressions in rows for which the <code>filter_expr</code> takes a non-zero value. Values are casted to the column type using the <code>CAST</code> operator. Updating columns that are used in the calculation of the primary or the partition key is not supported.</p> <div class=codehilite><pre><span></span><code><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table</span> <span class=n>MATERIALIZE</span> <span class=k>INDEX</span> <span class=n>name</span> <span class=k>IN</span> <span class=n>PARTITION</span> <span class=n>partition_name</span>
</code></pre></div> <p>The query rebuilds the secondary index <code>name</code> in the partition <code>partition_name</code>.</p> <p>One query can contain several commands separated by commas.</p> <p>For *MergeTree tables mutations execute by rewriting whole data parts. There is no atomicity - parts are substituted for mutated parts as soon as they are ready and a <code>SELECT</code> query that started executing during a mutation will see data from parts that have already been mutated along with data from parts that have not been mutated yet.</p> <p>Mutations are totally ordered by their creation order and are applied to each part in that order. Mutations are also partially ordered with INSERTs - data that was inserted into the table before the mutation was submitted will be mutated and data that was inserted after that will not be mutated. Note that mutations do not block INSERTs in any way.</p> <p>A mutation query returns immediately after the mutation entry is added (in case of replicated tables to ZooKeeper, for nonreplicated tables - to the filesystem). The mutation itself executes asynchronously using the system profile settings. To track the progress of mutations you can use the <a href=../../operations/system_tables/#system_tables-mutations><code>system.mutations</code></a> table. A mutation that was successfully submitted will continue to execute even if ClickHouse servers are restarted. There is no way to roll back the mutation once it is submitted, but if the mutation is stuck for some reason it can be cancelled with the <a href=../misc/#kill-mutation><code>KILL MUTATION</code></a> query.</p> <p>Entries for finished mutations are not deleted right away (the number of preserved entries is determined by the <code>finished_mutations_to_keep</code> storage engine parameter). Older mutation entries are deleted.</p> </div> <div id=content-footer class="text-muted pt-5"> <div class=float-right>©2016–2020 Yandex LLC</div> <div>ساخته شده از <a href=https://github.com/ClickHouse/ClickHouse/commit/25eae6abe035bda78634f17d15c9f05348d97aad rel="external nofollow noreferrer" target=_blank class=text-reset>25eae6abe0</a></div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>جدول محتویات</label> <a href=#query_language_queries_alter title=ALTER class="nav-link text-wrap d-inline-block w-100"> ALTER </a> <nav id=toc-toc-1 class="nav flex-column pl-2"> <a href=#column-manipulations title="Column Manipulations" class="nav-link text-wrap d-inline-block w-100"> Column Manipulations </a> <nav id=toc-toc-1-1 class="nav flex-column pl-2"> <a href=#alter_add-column title="ADD COLUMN" class="nav-link text-wrap d-inline-block w-100"> ADD COLUMN </a> <a href=#alter_drop-column title="DROP COLUMN" class="nav-link text-wrap d-inline-block w-100"> DROP COLUMN </a> <a href=#alter_clear-column title="CLEAR COLUMN" class="nav-link text-wrap d-inline-block w-100"> CLEAR COLUMN </a> <a href=#alter_comment-column title="COMMENT COLUMN" class="nav-link text-wrap d-inline-block w-100"> COMMENT COLUMN </a> <a href=#alter_modify-column title="MODIFY COLUMN" class="nav-link text-wrap d-inline-block w-100"> MODIFY COLUMN </a> <a href=#alter-query-limitations title="ALTER Query Limitations" class="nav-link text-wrap d-inline-block w-100"> ALTER Query Limitations </a> </nav> <a href=#manipulations-with-key-expressions title="Manipulations With Key Expressions" class="nav-link text-wrap d-inline-block w-100"> Manipulations With Key Expressions </a> <a href=#manipulations-with-data-skipping-indices title="Manipulations With Data Skipping Indices" class="nav-link text-wrap d-inline-block w-100"> Manipulations With Data Skipping Indices </a> <a href=#manipulations-with-constraints title="Manipulations with constraints" class="nav-link text-wrap d-inline-block w-100"> Manipulations with constraints </a> <a href=#alter_manipulations-with-partitions title="Manipulations With Partitions and Parts" class="nav-link text-wrap d-inline-block w-100"> Manipulations With Partitions and Parts </a> <nav id=toc-toc-1-5 class="nav flex-column pl-2"> <a href=#alter_detach-partition title="DETACH PARTITION" class="nav-link text-wrap d-inline-block w-100"> DETACH PARTITION </a> <a href=#alter_drop-partition title="DROP PARTITION" class="nav-link text-wrap d-inline-block w-100"> DROP PARTITION </a> <a href=#alter_drop-detached title="DROP DETACHED PARTITION|PART" class="nav-link text-wrap d-inline-block w-100"> DROP DETACHED PARTITION|PART </a> <a href=#alter_attach-partition title="ATTACH PARTITION|PART" class="nav-link text-wrap d-inline-block w-100"> ATTACH PARTITION|PART </a> <a href=#alter_replace-partition title="REPLACE PARTITION" class="nav-link text-wrap d-inline-block w-100"> REPLACE PARTITION </a> <a href=#alter_clear-column-partition title="CLEAR COLUMN IN PARTITION" class="nav-link text-wrap d-inline-block w-100"> CLEAR COLUMN IN PARTITION </a> <a href=#alter_freeze-partition title="FREEZE PARTITION" class="nav-link text-wrap d-inline-block w-100"> FREEZE PARTITION </a> <a href=#alter_clear-index-partition title="CLEAR INDEX IN PARTITION" class="nav-link text-wrap d-inline-block w-100"> CLEAR INDEX IN PARTITION </a> <a href=#alter_fetch-partition title="FETCH PARTITION" class="nav-link text-wrap d-inline-block w-100"> FETCH PARTITION </a> <a href=#alter_move-partition title="MOVE PARTITION|PART" class="nav-link text-wrap d-inline-block w-100"> MOVE PARTITION|PART </a> <a href=#alter-how-to-specify-part-expr title="How To Set Partition Expression" class="nav-link text-wrap d-inline-block w-100"> How To Set Partition Expression </a> </nav> <a href=#synchronicity-of-alter-queries title="Synchronicity of ALTER Queries" class="nav-link text-wrap d-inline-block w-100"> Synchronicity of ALTER Queries </a> <a href=#alter-mutations title=Mutations class="nav-link text-wrap d-inline-block w-100"> Mutations </a> </nav> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?7bd05efd></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>